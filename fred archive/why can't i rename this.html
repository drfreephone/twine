<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>FragmentsOfSkullFestivalEdition</title>
<style title="Twine CSS">@-webkit-keyframes appear{0%{opacity:0}to{opacity:1}}@keyframes appear{0%{opacity:0}to{opacity:1}}@-webkit-keyframes fade-in-out{0%,to{opacity:0}50%{opacity:1}}@keyframes fade-in-out{0%,to{opacity:0}50%{opacity:1}}@-webkit-keyframes rumble{50%{-webkit-transform:translateY(-0.2em);transform:translateY(-0.2em)}}@keyframes rumble{50%{-webkit-transform:translateY(-0.2em);transform:translateY(-0.2em)}}@-webkit-keyframes shudder{50%{-webkit-transform:translateX(0.2em);transform:translateX(0.2em)}}@keyframes shudder{50%{-webkit-transform:translateX(0.2em);transform:translateX(0.2em)}}@-webkit-keyframes box-flash{0%{background-color:white;color:white}}@keyframes box-flash{0%{background-color:white;color:white}}@-webkit-keyframes pulse{0%{-webkit-transform:scale(0, 0);transform:scale(0, 0)}20%{-webkit-transform:scale(1.2, 1.2);transform:scale(1.2, 1.2)}40%{-webkit-transform:scale(0.9, 0.9);transform:scale(0.9, 0.9)}60%{-webkit-transform:scale(1.05, 1.05);transform:scale(1.05, 1.05)}80%{-webkit-transform:scale(0.925, 0.925);transform:scale(0.925, 0.925)}to{-webkit-transform:scale(1, 1);transform:scale(1, 1)}}@keyframes pulse{0%{-webkit-transform:scale(0, 0);transform:scale(0, 0)}20%{-webkit-transform:scale(1.2, 1.2);transform:scale(1.2, 1.2)}40%{-webkit-transform:scale(0.9, 0.9);transform:scale(0.9, 0.9)}60%{-webkit-transform:scale(1.05, 1.05);transform:scale(1.05, 1.05)}80%{-webkit-transform:scale(0.925, 0.925);transform:scale(0.925, 0.925)}to{-webkit-transform:scale(1, 1);transform:scale(1, 1)}}@-webkit-keyframes shudder-in{0%, to{-webkit-transform:translateX(0em);transform:translateX(0em)}5%, 25%, 45%{-webkit-transform:translateX(-1em);transform:translateX(-1em)}15%, 35%, 55%{-webkit-transform:translateX(1em);transform:translateX(1em)}65%{-webkit-transform:translateX(-0.6em);transform:translateX(-0.6em)}75%{-webkit-transform:translateX(0.6em);transform:translateX(0.6em)}85%{-webkit-transform:translateX(-0.2em);transform:translateX(-0.2em)}95%{-webkit-transform:translateX(0.2em);transform:translateX(0.2em)}}@keyframes shudder-in{0%, to{-webkit-transform:translateX(0em);transform:translateX(0em)}5%, 25%, 45%{-webkit-transform:translateX(-1em);transform:translateX(-1em)}15%, 35%, 55%{-webkit-transform:translateX(1em);transform:translateX(1em)}65%{-webkit-transform:translateX(-0.6em);transform:translateX(-0.6em)}75%{-webkit-transform:translateX(0.6em);transform:translateX(0.6em)}85%{-webkit-transform:translateX(-0.2em);transform:translateX(-0.2em)}95%{-webkit-transform:translateX(0.2em);transform:translateX(0.2em)}}.debug-mode tw-expression[type=hookref]{background-color:rgba(115,123,140,0.15)}.debug-mode tw-expression[type=hookref]::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"?" attr(name)}.debug-mode tw-expression[type=variable]{background-color:rgba(140,128,115,0.15)}.debug-mode tw-expression[type=variable]::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"$" attr(name)}.debug-mode tw-expression[type=macro]:nth-of-type(4n+0){background-color:rgba(136,153,102,0.15)}.debug-mode tw-expression[type=macro]:nth-of-type(2n+1){background-color:rgba(102,153,102,0.15)}.debug-mode tw-expression[type=macro]:nth-of-type(4n+2){background-color:rgba(102,153,136,0.15)}.debug-mode tw-expression[type=macro][name="display"]{background-color:rgba(0,170,255,0.1) !important}.debug-mode tw-expression[type=macro][name="if"],.debug-mode tw-expression[type=macro][name="if"]+tw-hook:not([name]),.debug-mode tw-expression[type=macro][name="unless"],.debug-mode tw-expression[type=macro][name="unless"]+tw-hook:not([name]),.debug-mode tw-expression[type=macro][name="elseif"],.debug-mode tw-expression[type=macro][name="elseif"]+tw-hook:not([name]),.debug-mode tw-expression[type=macro][name="else"],.debug-mode tw-expression[type=macro][name="else"]+tw-hook:not([name]){background-color:rgba(0,255,0,0.1) !important}.debug-mode tw-expression[type=macro].false{background-color:rgba(255,0,0,0.2) !important}.debug-mode tw-expression[type=macro].false+tw-hook:not([name]){display:none}.debug-mode tw-expression[type=macro][name="a"],.debug-mode tw-expression[type=macro][name="array"],.debug-mode tw-expression[type=macro][name="datamap"],.debug-mode tw-expression[type=macro][name="dataset"],.debug-mode tw-expression[type=macro][name="colour"],.debug-mode tw-expression[type=macro][name="color"],.debug-mode tw-expression[type=macro][name="num"],.debug-mode tw-expression[type=macro][name="number"],.debug-mode tw-expression[type=macro][name="text"],.debug-mode tw-expression[type=macro][name="print"]{background-color:rgba(255,255,0,0.2) !important}.debug-mode tw-expression[type=macro][name="put"],.debug-mode tw-expression[type=macro][name="set"]{background-color:rgba(255,128,0,0.2) !important}.debug-mode tw-expression[type=macro][name="script"]{background-color:rgba(255,191,0,0.2) !important}.debug-mode tw-expression[type=macro][name="style"]{background-color:rgba(185,198,198,0.2) !important}.debug-mode tw-expression[type=macro][name^="link"],.debug-mode tw-expression[type=macro][name^="click"],.debug-mode tw-expression[type=macro][name^="mouseover"],.debug-mode tw-expression[type=macro][name^="mouseout"]{background-color:rgba(128,223,32,0.2) !important}.debug-mode tw-expression[type=macro][name^="replace"],.debug-mode tw-expression[type=macro][name^="prepend"],.debug-mode tw-expression[type=macro][name^="append"],.debug-mode tw-expression[type=macro][name^="remove"]{background-color:rgba(223,96,32,0.2) !important}.debug-mode tw-expression[type=macro][name="live"]{background-color:rgba(32,96,223,0.2) !important}.debug-mode tw-expression[type=macro]::before{content:"(" attr(name) ":)";padding:0 0.5rem;font-size:1rem;vertical-align:middle;line-height:normal;background-color:inherit;border:1px solid rgba(255,255,255,0.5)}.debug-mode tw-hook{background-color:rgba(0,85,255,0.1) !important}.debug-mode tw-hook::before{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"["}.debug-mode tw-hook::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"]"}.debug-mode tw-hook[name]::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"]<" attr(name) "|"}.debug-mode tw-pseudo-hook{background-color:rgba(255,170,0,0.1) !important}.debug-mode tw-collapsed::before{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"{"}.debug-mode tw-collapsed::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"}"}.debug-mode tw-verbatim::before,.debug-mode tw-verbatim::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:"`"}.debug-mode tw-align[style*="text-align: center"]{background:linear-gradient(to right, rgba(255,204,189,0) 0%, rgba(255,204,189,0.25) 50%, rgba(255,204,189,0) 100%)}.debug-mode tw-align[style*="text-align: left"]{background:linear-gradient(to right, rgba(255,204,189,0.25) 0%, rgba(255,204,189,0) 100%)}.debug-mode tw-align[style*="text-align: right"]{background:linear-gradient(to right, rgba(255,204,189,0) 0%, rgba(255,204,189,0.25) 100%)}.debug-mode p{background-color:rgba(255,213,0,0.1)}.debug-mode tw-enchantment{animation:enchantment 0.5s infinite;-webkit-animation:enchantment 0.5s infinite;border:1px solid}.debug-mode tw-link::after,.debug-mode tw-broken-link::after{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:attr(passage-name)}.debug-mode tw-include{background-color:rgba(204,128,51,0.1)}.debug-mode tw-include::before{font-size:0.8rem;padding-left:0.2rem;padding-right:0.2rem;vertical-align:top;content:attr(type) ' "' attr(title) '"'}@keyframes enchantment{0%,to{border-color:#ffb366}50%{border-color:#6fc}}@-webkit-keyframes enchantment{0%,to{border-color:#ffb366}50%{border-color:#6fc}}tw-debugger{position:fixed;bottom:0;right:0;z-index:999999;min-width:10em;min-height:1em;padding:1em;font-size:1.5em;border-left:solid #000 2px;border-top:solid #000 2px;border-top-left-radius:0.5em;background:#fff;transition:opacity 0.2s;-webkit-transition:opacity 0.2s;opacity:0.8}@media screen and (max-width: 1280px){tw-debugger{font-size:1.25em}}@media screen and (max-width: 960px){tw-debugger{font-size:1em}}@media screen and (max-width: 640px){tw-debugger{font-size:0.8em}}tw-debugger:hover{opacity:1}.show-invisibles{border-radius:3px;border:solid #999 1px;background-color:#fff;font-size:inherit}.debug-mode .show-invisibles{background-color:#eee;box-shadow:inset #ddd 3px 5px 0.5em}tw-link,.link,tw-icon{cursor:pointer}tw-link,.enchantment-link{color:#4169E1;font-weight:bold;text-decoration:none;transition:color 0.2s ease-in-out}tw-link:hover,.enchantment-link:hover{color:DeepSkyBlue}tw-link:active,.enchantment-link:active{color:#DD4B39}.visited{color:#6941e1}.visited:hover{color:#E3E}tw-broken-link{color:#993333;border-bottom:2px solid #993333;cursor:not-allowed}.enchantment-mouseover{border-bottom:1px dashed #666}.enchantment-mouseout{border:rgba(64,149,191,0.25) 1px solid}.enchantment-mouseout:hover{background-color:rgba(64,149,191,0.25);border:transparent 1px solid;border-radius:0.2em}html{font:100% Georgia, serif;margin:0;background-color:transparent;color:#000;height:100%;overflow-x:hidden;box-sizing:border-box}*,:before,:after{position:relative;box-sizing:inherit}body{margin:0;background-color:transparent}tw-storydata{display:none}tw-story{display:-webkit-box;display:-webkit-flex;display:-moz-flex;display:-ms-flexbox;display:flex;-webkit-box-direction:normal;-webkit-box-orient:vertical;-webkit-flex-direction:column;-moz-flex-direction:column;-ms-flex-direction:column;flex-direction:column;width:60%;font-size:1.5em;line-height:1.5em;margin:5% auto}@media screen and (max-width: 1024px){tw-story{font-size:1.2em}}@media screen and (max-width: 896px){tw-story{font-size:1.05em}}@media screen and (max-width: 768px){tw-story{font-size:.9em}}tw-passage{display:block}tw-sidebar{left:-5em;width:3em;position:absolute;text-align:center;display:block}tw-icon{display:block;margin:0.5em 0;opacity:0.1;font-size:2.75em}tw-icon:hover{opacity:0.3}tw-error{display:inline-block;border-radius:0.2em;padding:0.2em;font-size:1rem;cursor:help}tw-error.error{background-color:rgba(223,58,190,0.4);color:black}tw-error.warning{background-color:rgba(223,140,58,0.4);color:black;display:none}.debug-mode tw-error.warning{display:inline}tw-error-explanation{display:block;font-size:0.8rem;line-height:1rem}tw-error-explanation-button{cursor:pointer;line-height:0em;border-radius:1px;border:1px solid black;font-size:0.8rem;margin:0 0.4rem;opacity:0.5}tw-error-explanation-button .folddown-arrowhead{display:inline-block}tw-notifier{border-radius:0.2em;padding:0.2em;font-size:1rem;background-color:rgba(223,182,58,0.4);display:none}.debug-mode tw-notifier{display:inline}tw-notifier::before{content:attr(message)}tw-colour{border:1px solid black;display:inline-block;width:1em;height:1em}h1{font-size:3em}h2{font-size:2.25em}h3{font-size:1.75em}h1,h2,h3,h4,h5,h6{line-height:1em;margin:0.6em 0}pre{font-size:1rem}small{font-size:70%}big{font-size:120%}mark{color:rgba(0,0,0,0.6);background-color:#ff9}ins{color:rgba(0,0,0,0.6);background-color:rgba(255,242,204,0.5);border-radius:0.5em;box-shadow:0em 0em 0.2em #ffe699;text-decoration:none}del{background-color:#000;text-decoration:none}center{text-align:center;margin:0 auto;width:60%}blink{text-decoration:none;animation:fade-in-out 1s steps(1, end) infinite alternate;-webkit-animation:fade-in-out 1s steps(1, end) infinite alternate}tw-align{display:block}tw-outline{color:white;text-shadow:-1px -1px 0 #000, 1px -1px 0 #000, -1px 1px 0 #000, 1px 1px 0 #000}tw-shadow{text-shadow:0.08em 0.08em 0.08em #000}tw-emboss{text-shadow:0.08em 0.08em 0em #000;color:white}tw-condense{letter-spacing:-0.08em}tw-expand{letter-spacing:0.1em}tw-blur{color:transparent;text-shadow:0em 0em 0.08em #000}tw-blurrier{color:transparent;text-shadow:0em 0em 0.2em #000}tw-blurrier::selection{background-color:transparent;color:transparent}tw-blurrier::-moz-selection{background-color:transparent;color:transparent}tw-smear{color:transparent;text-shadow:0em 0em 0.02em rgba(0,0,0,0.75),-0.2em 0em 0.5em rgba(0,0,0,0.5),0.2em 0em 0.5em rgba(0,0,0,0.5)}tw-mirror{display:inline-block;transform:scaleX(-1);-webkit-transform:scaleX(-1)}tw-upside-down{display:inline-block;transform:scaleY(-1);-webkit-transform:scaleY(-1)}tw-fade-in-out{text-decoration:none;animation:fade-in-out 2s ease-in-out infinite alternate;-webkit-animation:fade-in-out 2s ease-in-out infinite alternate}tw-rumble{-webkit-animation:rumble linear 0.1s 0s infinite;animation:rumble linear 0.1s 0s infinite;display:inline-block}tw-shudder{-webkit-animation:shudder linear 0.1s 0s infinite;animation:shudder linear 0.1s 0s infinite;display:inline-block}tw-shudder-in{animation:shudder-in 1s ease-out;-webkit-animation:shudder-in 1s ease-out}.transition-in{-webkit-animation:appear 0ms step-start;animation:appear 0ms step-start}.transition-out{-webkit-animation:appear 0ms step-end;animation:appear 0ms step-end}[data-t8n^=fade-in].transition-in,.transition-in[data-t8n^=dissolve]{-webkit-animation:appear 0.8s;animation:appear 0.8s}[data-t8n^=dissolve].transition-out{-webkit-animation:appear 0.8s reverse;animation:appear 0.8s reverse}[data-t8n^=shudder-in].transition-in,.transition-in[data-t8n^=shudder]{display:inline-block;-webkit-animation:shudder-in 0.8s;animation:shudder-in 0.8s}[data-t8n^=shudder-out].transition-out,.transition-out[data-t8n^=shudder]{display:inline-block;-webkit-animation:shudder-out 0.8s;animation:shudder-out 0.8s}[data-t8n^=boxflash].transition-in{-webkit-animation:box-flash 0.8s;animation:box-flash 0.8s}[data-t8n^=pulse].transition-in{-webkit-animation:pulse 0.8s;animation:pulse 0.8s}[data-t8n^=pulse].transition-out{-webkit-animation:pulse 0.8s reverse;animation:pulse 0.8s reverse}[data-t8n$=fast]{animation-duration:0.4s;-webkit-animation-duration:0.4s}[data-t8n$=slow]{animation-duration:1.2s;-webkit-animation-duration:1.2s}
</style>
</head>

<body>

<tw-story></tw-story>

<tw-storydata name="FragmentsOfSkullFestivalEdition" startnode="1" creator="Twine" creator-version="2.0.11" ifid="437DEA39-C4E6-49D8-85B4-E6A4EB2F9F54" format="Harlowe" options="" hidden><style role="stylesheet" id="twine-user-stylesheet" type="text/twine-css">@import url('https://fonts.googleapis.com/css?family=Cinzel|Oldenburg');


html {
	font-family: 'Oldenburg', serif;
	background-color: rgba(221, 173, 125, 255);
	background-image: url(fragmentsBackground.png); 
	background-position: center; 
	background-size: 100% 400%; 
	background-repeat: no-repeat;
}

.Normal {
	font-family: 'Oldenburg', serif;
	font-weight: normal;
}

.Title {
		font-family: 'Cinzel', serif;
		font-size: 2em;
}

.Fancy {
	font-family: 'Cinzel', serif;
	font-weight: bold;
}

.Fancy, tw-link {
	color: rgb(168, 20, 20)
	font-family: 'Cinzel', serif;	
}


.Boxout {	
	border: double #000 0.25em; 
	border-radius: 0.02em;
	
	float: right;
	width: 45%;
	
	padding: 1em;
	
	box-shadow: #000 0.05em 0.05em 0;
	
	color: rgb(168, 20, 20)
	
	font-family: font-family: 'Cinzel', serif;
	font-size: 1.3em
}

tw-story {
	font-size: 1.1em;
}

tw-passage {
	color: rgb(60,60,60)
}

tw-sidebar {
display: none;	
}

tw-link {
	color: rgb(168, 20, 20)
}

tw-link, .enchantment-link {
	color: rgb(168, 20, 20)
}


.enchantment-link:hover, tw-link:hover {
	color: rgb(112, 13, 41);
}

.enchantment-link.visited:hover, tw-link.visited:hover {
	color: rgb(142, 43, 71);
}

tw-link.visited {
	color: rgb(112, 13, 41)
}
















































</style><script role="script" id="twine-user-script" type="text/twine-javascript">




















































</script><tw-passagedata pid="1" name="Initialisation" tags="" position="312,2">
(set: $playerTags to (a:))
(set: $inv to (a:&quot;waterskin&quot;))

(set: $health to 5)
(set: $filth to 1)
(set: $timeindungeon to 1)

(set: $clothing to (datamap:
&quot;head&quot;, &quot;&quot;,
&quot;torso&quot;, &quot;dusty robe&quot;,
&quot;feet&quot;, &quot;sandals&quot;,
&quot;hands&quot;, &quot;&quot;,
))

(set: $headDescription to &quot;Your face is drawn and reddened by the sun.&quot;)
(set: $torsoDescription to &quot;Your robe is tattered and bleached from months on the road.&quot;)
(set: $feetDescription to &quot;Ragged sandals adorn your feet.&quot;)
(set: $handsDescription to &quot;Your hands are empty.&quot;)

(set: $playerJourney to &quot;&quot;)

(set: $knowledge to (datamap:
&quot;people&quot;, (datamap:),
&quot;places&quot;, (datamap:),
&quot;history&quot;, (datamap:),
))

(goto:&quot;InitialiseConversation&quot;)</tw-passagedata>
<tw-passagedata pid="2" name="GenericActions" tags="" position="1094,28">&lt;div class = &quot;Boxout&quot;&gt;\
how I look
how I feel
what I carry
what I know\
\
(click: &quot;how I feel&quot;)[(goto: &quot;Feelings&quot;)]
(click: &quot;how I look&quot;)[(goto: &quot;Appearance&quot;)]\
(click: &quot;what I carry&quot;)[(goto: &quot;InventoryExplorer&quot;)]\
(click: &quot;what I know&quot;)[(goto: &quot;KnowledgeExplorer&quot;)]\
&lt;/div&gt;</tw-passagedata>
<tw-passagedata pid="3" name="ToDo" tags="" position="68,19">-- develop filth and water (add filth description to appearance)
-- Add a rummage pile of items (use a push-your-luck mechanic)
-- Add a way to hang out in the library
-- Add a situation where you must evade the Pit Crew
-- Apply nice CSS to conversation system

-- Threads to develop: Pit crew, strange symbols, whispering keepers, woman on the roof, locket, burial sites

-- some option to remove clothing (eg to uncover face)
-- concept of Filth, which should be attached to clothing rather than to the player generally. Think how this interacts with the 
-- Conversation system needs the following: options for silence or threatening behvaiour
-- some more procedural stuff for use in conversations (the hag will be the first place to really explore this I reckon)
-- explore concept of &#39;bring knowledge up to a certain point&#39; passages for (display)ing when new information is gained and there are various cases for what needs bringing to what point

-- ways to escape cell: wait for transferral to the Pit, use broken glass to cut bonds, persuade jailer using Ledger conversation, or else perhaps using knowledge of the Whispering Keepers?

- consider possible variations on ending: Reach the Depths either via the Pit (by escaping the slavers/making them dig in the right place) or via the Comb (by overcoming the monster that lives there). Also, you should be able to simply escape from the skull through some other means, either contacting the Whispering Keepers or via the roof somehow. However, before you can leave either of those ways you should have to encounter the FACT of the ledger and its unbelievable power, and learn something that makes you think that YOU might be able to access it (that isn&#39;t just the fact that you&#39;re the protagonist of the game). Perhaps your ability to read differentiates you, and you could use the library?



- Traveller&#39;s Friend -&gt; her real role? Involves luring people to the skull, bamboozling them into making the wrongheaded decision to enter? She&#39;s definitely not aligned to any of the agents at work within the skull, however. Her role might be to disrupt whatever&#39;s happening in there. Perhaps her story contains some personal tragedy. Perhaps she is very ancient indeed.



-some characters might refuse to talk to you about certain topics until criteria are met. For example, someone might need bribing with items or some such thing. This is easy to do - just add extra elements to their conversation database when appropritate, and remove these same things from their &#39;list of things asked already&#39; array to allow those topics to be revisited.
</tw-passagedata>
<tw-passagedata pid="4" name="Debug Footer" tags="debug-footer" position="64,160">(print: $croachOpinion)

(link:&quot;log&quot;)[(display:&quot;log&quot;)]</tw-passagedata>
<tw-passagedata pid="5" name="Intro1" tags="" position="613,151">The skull rises above the bone-bare plain. The sheer ivory walls reveal no windows, doors or gates. Above the walls, the structure is ribbed by gantries, walkways, and flying buttresses. It squats, pallid in the cold afternoon sun.

Light glints off something moving along a cloister. The temple&#39;s cathedral-deep eye sockets stare, blind and hollow, across the desert. A lick of smoke emerges from somewhere behind the dome of the skull and curls into the sky.

[[you have strayed too close|Intro1b]]</tw-passagedata>
<tw-passagedata pid="6" name="Intro2" tags="" position="374,680">You bid farewell to the shrouded stranger and her gaunt horse and begin the long walk toward the monument. Dust eddies between the lifeless rocks.

You lose an hour picking your way around the base of a vast rampart. The stone is foreign to this land. Was it from some far continent, borne here on the backs of countless long-dead slaves? You stare upwards, admiring the way that the flying buttresses seem to form a diadem around the temples of the skull.
{(set: $playerTags to it + (a:&quot;curious&quot;))}
[[night falls quickly in this part of the world|Intro5]]</tw-passagedata>
<tw-passagedata pid="7" name="Intro3" tags="" position="616,668">You bid farewell to the gaunt horse and its owner and begin the long walk toward the monument. Dust eddies between the lifeless rocks.

Against the advice of a memory now fading, you tread a path across the plateau, meaning to keep a mile or more between you and the accursed heap. What is it that draws you toward it? No matter how many times you adjust your course away from the thing, it seems always to grow larger, coming between you and the setting sun, until you find yourself in its shadow, a mere stones throw from its base.
{(set: $playerTags to it + (a:&quot;impetuous&quot;))}
[[night falls quickly in this part of the world|Intro5]]</tw-passagedata>
<tw-passagedata pid="8" name="Intro4" tags="" position="806,676">You take a farewell drink with the kindly woman and begin the long march. It&#39;s a fine day for it.

You yomp across the plain, full of confrontations. The evening sunlight spills behind rounded domes and elevated cornices until you stand at the base of the long, high wall that&#39;s the first barrier between you and the skull.
{(set: $playerTags to it + (a:&quot;drunk&quot;))
(set: $inv to it + (a:&quot;empty wine bottle&quot;))}
[[i&#39;m going to be sick|Intro4a]]
[[a noisome yell|Intro4b]]</tw-passagedata>
<tw-passagedata pid="9" name="Intro5" tags="" position="468,1000">As the darkness sets in, you cast about for somewhere you can lay your head. This is no place to spend a night out in the open. You curse aloud the chain of events that led you on this journey.

[[i had a wedding to attend|Intro6]]
[[a census had been called in the city of my birth|Intro7]]
[[i am an exile|Intro8]]</tw-passagedata>
<tw-passagedata pid="10" name="Intro0" tags="" position="610,1">&lt;span class = &quot;Title&quot;&gt;

[[Fragments of Skull|Intro1]]&lt;/span&gt;
by Fred Francis and Ed Sibley



(display: &quot;Devcon&quot;)</tw-passagedata>
<tw-passagedata pid="11" name="Intro4a" tags="" position="736,816">You heave the last of your wine in a red yawn into the dirt. The chalk-white dust turns grape-skin purple to blood. You fall gently into the filth. The sun sets behind you. It&#39;s been a tough road.
(set: $filth to it + 1)
[[night falls quickly in this part of the world|Intro5b]]</tw-passagedata>
<tw-passagedata pid="12" name="Intro4b" tags="" position="888,816">{(set: $playerTags to it + (a:&quot;noisy&quot;))} You shout yourself hoarse, and once you almost fancy that you hear a yell responding to your own. You stop and listen, but you hear nothing else. A dismal place to find yourself at the end of a dismal journey.

[[night falls quickly in this part of the world|Intro5b]]</tw-passagedata>
<tw-passagedata pid="13" name="Intro6" tags="" position="420,1223">(set: $playerJourney to &quot;wedding&quot;)The penalties for failing to attend a licensed wedding are severe. What crippled family you have left will not suffer at the hands of the Record-Keepers by your failing.

[[so i must present myself for the marriage to which i am bound|Intro6a]]
[[so again i must bear witness to the binding of another pair of wretches|Intro6b]]</tw-passagedata>
<tw-passagedata pid="14" name="Intro7" tags="" position="620,1239">(set: $playerJourney to &quot;census&quot;)And with you halfway across the continent. But, the consequences for your family if you were not registered are too severe to contemplate. If you are absent on the day that the Notariser-General visits the seat of your birth, your father will be found in Contempt of Rigour, and your sister deprived of her right to marry.

Still, six months should have been plenty of time to make the journey.

[[but the journey went awry|Intro9]]</tw-passagedata>
<tw-passagedata pid="15" name="Intro8" tags="" position="820,1216">{(set: $playerTags to it + (a:&quot;exile&quot;))
(set: $playerJourney to &quot;exile&quot;)}In choosing exile, you spared your family the more egregious consequences of the wrath of the State. Of course, your disgrace will cast a shadow over them forever. But at least they still have a License to Possess Currency, and a Designated Homestead. It could have been much worse for them.

[[So, it seems the life of the monastery is the fate I have been cast|Intro8a]]
[[So, I must learn to glean some succour from this barren land and establish a farm far from the watchful writ of the State|Intro8b]]</tw-passagedata>
<tw-passagedata pid="16" name="Intro9" tags="" position="621,1583">{(if: $playerJourney is &quot;wedding&quot;)[At first, you travelled in style. You had a good horse, plenty of money, and made good time. ]
(if: $playerJourney is &quot;exile&quot;)[You left the city through the Unmarked Gate and turned your back on everything you&#39;d ever known. This was bad country, and you were sustained only by the fickle kindness of others. Much of the time, you lacked the energy to travel, and slumped by the roadside in a scrap of shade until someone took pity. It took some time for the charity of a generous stranger to put you on your feet, with a little money and a good horse under you. ]
(if: $playerJourney is &quot;census&quot;)[The start of your journey was delayed by several days as the Gate Warden was taken ill and your travelling permit could not be validated. Your rode hard, at first, to make up for lost time. ]

(if: $playerTags contains &quot;curious&quot;)[However, one afternoon you observed a curious marking on the hand of a beggar. He wore the blackened garb of those without Documentation, and he took exception to your questions about his tattoo. That evening, you were assailed in your sleep and drugged. You awoke in a stone circle atop a windy hill covered in bruises and devoid of possessions, saving the clothes on your back.]
(elseif: $playerTags contains &quot;impetuous&quot;)[However, you soon found yourself travelling with companions who proved less than competent. They proposed to save three days of riding by taking a shortcut across a river that they assured you was easily fordable. They were all of them swept away, and you barely escaped the surge with your life. It took you over a week to find the main road again.]
(elseif: $playerTags contains &quot;drunk&quot;)[However, your journey was measured in stops at public houses. Whole days were lost to revels in dusty shacks by the roadside, and your gold reserves dwindled day-by-day. You fell foul of a group of ruffians with rancid breath who beat you and relieved you of your supplies.]}

Without money or any evidence of social standing, you were forced to travel cross-country, on foot. This was dangerous.

(if: $playerJourney is &quot;wedding&quot; or $playerJourney is &quot;census&quot;)[[[time was short|Intro10]]](else:)[[[your destination seemed further away than ever|Intro10]]]</tw-passagedata>
<tw-passagedata pid="17" name="Intro6a" tags="" position="340,1420">As the end of your eleven-year betrothment approached, you found your attention diverted by a sudden threat to your mother&#39;s business interests. The expedition to the mining colony and back shouldn&#39;t have taken more than a month or so. You curse into the frigid air.
{(set: $inv to it + (a:&quot;locket&quot;))}
[[Blight the gods who wrote this journey into my life!|Intro9]]</tw-passagedata>
<tw-passagedata pid="18" name="Intro6b" tags="" position="496,1364">You last saw this pair over a decade ago, when you were present at the solemnisation of their betrothment. When you recieved the summons, so many years after you saw them last, you had virtually forgotten about the responsibility. Little time remained - you quickly packed a bag and set out on the road, towards the city of your birth.

[[Alas, that damned journey too went awry|Intro9]]
[[What will have become of the poor pair, withering through their Committal?|Intro6c]]</tw-passagedata>
<tw-passagedata pid="19" name="Intro8a" tags="" position="688,1364">You had heard tell of an order of exiles who live in the mountains to the West who have foresworn the intrusion of the written word. These apostates, barely tolerated by virtue of their remoteness, pass on the secrets of their religion by whispering in the ears of initiates in darkened rooms far above the ground. That sounded like a good place.
{
(set: $playerTags to it + (a:&quot;spiritual&quot;))
(set: &quot;people&quot; of $knowledge to it + (datamap: &quot;Whispering Keepers&quot;,&quot;An isolated order who hold a heretical ideology - that the written word is not inviolate, and that the secret history of the world can only be truly told in whispers&quot;))
}
[[Could I not have been offered a final journey through the land of my birth without obstruction?|Intro9]]</tw-passagedata>
<tw-passagedata pid="20" name="Intro8b" tags="" position="896,1416">You would plough your field wherever the soil looked less than dead. You would pitch a tent somewhere with a view away from the land that had cast you out, and build a lodge for yourself to whatever specification you pleased. You&#39;d cut down trees, un-notarised, and with the plants you&#39;d grow, you&#39;d cook whatever you wanted.
{(set: $inv to it + (a:&quot;seed-bag&quot;))}
[[But, there is nothing it this land that does not fail at the first step|Intro9]]</tw-passagedata>
<tw-passagedata pid="21" name="Intro10" tags="" position="619,1708">{
(if: $playerJourney is &quot;wedding&quot;)[(set: $tmp to &quot;the city you seek&quot;)]
(if: $playerJourney is &quot;census&quot;)[(set: $tmp to &quot;the city of your birth&quot;)]
(if: $playerJourney is &quot;exile&quot;)[(set: $tmp to &quot;the distant South&quot;)]
}If the ancient Traveller&#39;s-Friend with the shrouded face had not happened upon you, you would have starved trying to cross the long desert. Days passed, barely broken by a fleeting, crescent-mooned night. Your lips cracked, your skin blistered, you realised that you were due to die. And then! You felt the dry rasp of her finger across your jaw, and the taste of brackish water in your mouth. She lay you across her horse, and fed you, and eventually you were well enough to walk beside her. 

She led you across the desert, until you reached this bone-bare plain and the strange towering structure that now looms above your head. The track that leads to the Golden Road to $tmp lies far to the East, in the lee of a mountain whose peak you can just make out in the distance.

You recall the last words you exchanged with the Traveller&#39;s Friend.

[[&#39;all this time, and I have yet to ask your name...&#39;|IntroTutorialConv]]
[[&#39;i will go now. you have my gratitude.&#39;|Intro10a]]</tw-passagedata>
<tw-passagedata pid="22" name="Intro1b" tags="" position="613,288">A withered hand reaches out to your reins and stays your mare; a puff of ashen-white dust blusters from her hooves. You turn to your travelling companion. Scraps of winding-sheet hood and mask her and protect her from the dust. It strikes you that you can no longer remember her name. Did you ever know it?

Her voice is muffled by the shroud.

&#39;These slow bones will go no further. I must leave you. Will you cross this desert alone?&#39;

[[&#39;i wish to see the famous structure near-at-hand.&#39;|Intro2]]
[[&#39;my shortest route leads across the plain.&#39;|Intro3]]
[[&#39;i am flush with the courage of drink, and will brook no objection.&#39;|Intro4]]
(link-goto: &quot;&#39;i will not. i shall heed your advice, rest here awhile and return.&#39;&quot;, &quot;gameover&quot;)</tw-passagedata>
<tw-passagedata pid="23" name="IntroTutorialConv" tags="" position="421,1752">A gust of wind made devils in the sand. Something in the distance rattled.\
(set: $playerTags to it + (a:&quot;friendswitholdwoman&quot;))\

&quot;I will not tell you my name,&quot; she said after a moment. &quot;It is foresworn. I have helped you. What else would you ask of me?&quot;

(set: $interlocutor to $friend)\
(display: &quot;ConversationInitialise&quot;)\
(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="24" name="gameover" tags="" position="783,11">enter game over text here</tw-passagedata>
<tw-passagedata pid="25" name="Intro5b" tags="" position="764,1012">You tilt into blackness, propped against the chalky wall. After a time, you are half-waked as the wall burns with the desert cold. You draw a ragged cloak around your shoulders and begin to recount the events that led you here in an effort to pass the time.

[[i had a wedding to attend|Intro6]]
[[a census had been called in the city of my birth|Intro7]]
[[i am an exile|Intro8]]</tw-passagedata>
<tw-passagedata pid="26" name="Intro6c" tags="" position="416,1560">You have spent many any hour wondering this on the lonely journey. Will their lavish vestments have decayed to tattered rags? Will their rosy skin have taken the ashen pallor of the dead? It is comforting to think that even the successful cannot be immune to the cruel vissicitudes that are the daily life of the people of this land. 

(set: $playerTags to it + (a:&quot;weddingfriends&quot;))

[[For even I have not been able to escape trials on this journey|Intro9]]</tw-passagedata>
<tw-passagedata pid="27" name="InitialiseConversation" tags="" position="318,136">(set: $interlocutor to (datamap:))

(display: &quot;InitialiseFriend&quot;)

(display: &quot;InitialiseJailer&quot;)

(display: &quot;InitialiseShad&quot;)

(display: &quot;InitialiseCroach&quot;)

(goto: &quot;InitialiseKnowledge&quot;)</tw-passagedata>
<tw-passagedata pid="28" name="InitialiseKnowledge" tags="" position="319,261">(set: &quot;people&quot; of $knowledge to it + (datamap:
&quot;Traveller&#39;s Friend&quot;, &quot;A woman wrapped in winding sheets who brought you to this place.&quot;,
&quot;Arbiters&quot;, &quot;Those whose rigid governance maintains the order upon which your old life was built.&quot;,

))

(set: &quot;places&quot; of $knowledge to it + (datamap:
&quot;the bone-bare plain&quot;, &quot;At the edge of the map, orthogonal to every road, avoided by those who know their business, blasted.&quot;,

&quot;the skull&quot;, &quot;It would take days to walk all the way around its outer wall. Its provenance is unknown. You are somewhere within it.&quot;,
&quot;my destination&quot;,&quot;Past the mountain range that rises in the east of this plain is a pass that leads to the Great Gold Road, and thence to the object of your journey.&quot;,
))

(set: &quot;history&quot; of $knowledge to it + (datamap:
&quot;the Administration&quot;, &quot;A bureaucracy as old as written records. Every detail of your life - the time of your birth, the positions of the planets on your coming-of-age, the projected date of your death - is stored in rolls somewhere below the Capital.&quot;,
))

(set: $trash to (datamap:))
(goto: &quot;InitialiseFeelings&quot;)</tw-passagedata>
<tw-passagedata pid="29" name="KnowledgeExplorer" tags="" position="1105,181">People:

&lt;span class = &quot;Fancy&quot;&gt;(print: (datanames: &quot;people&quot; of $knowledge).join(&quot;
&quot;))\
&lt;/span&gt;\
(set: $peopleNumber to (datanames: (&quot;people&quot; of $knowledge))&#39;s length)\
(set: $i to 0)\
[(display: &quot;PeopleKnowledgeLooper&quot;)]&lt;peopleLoop|

Places:

&lt;span class = &quot;Fancy&quot;&gt;(print: (datanames: &quot;places&quot; of $knowledge).join(&quot;
&quot;))\
&lt;/span&gt;\
(set: $placesNumber to (datanames: (&quot;places&quot; of $knowledge))&#39;s length)\
(set: $i to 0)\
[(display: &quot;PlacesKnowledgeLooper&quot;)]&lt;placesLoop|

History:

&lt;span class = &quot;Fancy&quot;&gt;(print: (datanames: &quot;history&quot; of $knowledge).join(&quot;
&quot;))\
&lt;/span&gt;\
(set: $historyNumber to (datanames: (&quot;history&quot; of $knowledge))&#39;s length)\
(set: $i to 0)\
[(display: &quot;HistoryKnowledgeLooper&quot;)]&lt;historyLoop|

(link: &quot;return&quot;)[(goto:(history:)&#39;s last)]</tw-passagedata>
<tw-passagedata pid="30" name="PeopleKnowledgeLooper" tags="" position="1240,183">(if: $i &lt; $peopleNumber)[\
(set: $name to (datanames: &quot;people&quot; of $knowledge)&#39;s ($i))\
(set: $value to $knowledge&#39;s (&quot;people&quot;)&#39;s ($name))\
(set: $link to &#39;(clickappend: &quot;&#39; + $name + &#39;&quot;)[&lt;span class = &quot;Normal&quot;&gt; - &#39; + $value + &#39;&lt;/span&gt;
]&#39;)\
(print: $link)\
(set: $i to it + 1)\
(replace: ?peopleLoop)[(display: &quot;PeopleKnowledgeLooper&quot;)]\
]</tw-passagedata>
<tw-passagedata pid="31" name="PlacesKnowledgeLooper" tags="" position="1365,181">(if: $i &lt; $placesNumber)[\
(set: $name to (datanames: &quot;places&quot; of $knowledge)&#39;s ($i))\
(set: $value to $knowledge&#39;s (&quot;places&quot;)&#39;s ($name))\
(set: $link to &#39;(clickappend: &quot;&#39; + $name + &#39;&quot;)[&lt;span class = &quot;Normal&quot;&gt; - &#39; + $value + &#39;&lt;/span&gt;
]&#39;)\
(print: $link)\
(set: $i to it + 1)\
(replace: ?placesLoop)[(display: &quot;PlacesKnowledgeLooper&quot;)]\
]</tw-passagedata>
<tw-passagedata pid="32" name="HistoryKnowledgeLooper" tags="" position="1491,181">(if: $i &lt; $historyNumber)[\
(set: $name to (datanames: &quot;history&quot; of $knowledge)&#39;s ($i))\
(set: $value to $knowledge&#39;s (&quot;history&quot;)&#39;s ($name))\
(set: $link to &#39;(clickappend: &quot;&#39; + $name + &#39;&quot;)[&lt;span class = &quot;Normal&quot;&gt; - &#39; + $value + &#39;&lt;/span&gt;
]&#39;)\
(print: $link)\
(set: $i to it + 1)\
(replace: ?historyLoop)[(display: &quot;HistoryKnowledgeLooper&quot;)]\
]</tw-passagedata>
<tw-passagedata pid="33" name="relevant strings" tags="" position="60,418">KNOWLEDGE
People:
Traveller&#39;s Friend
Arbiters
Whispering Keepers
stooped figures //replacable with Pit Crew//
Pit Crew
the betrothed woman
Croach
Shad
the maggot

Places:
the bone-bare plain
the skull
what&#39;s below //replacable with whatever that is//
the cell
the library
skull burial site
hips burial site //currently unimplemented, but this is the burial site that marks the real location of the ledger (it is below here, but the pit crew could excavate it//

History:
the Administration
the Bitten Tongue
Strange symbol of teeth // Should be replaced with both Whispering Keepers (people) and The Bitten Tongue (history) if investigated somehow inside the dungeon. This might be a mechanism we use to develop knowledge - sometimes you&#39;ll gain incomplete knowledge and you&#39;ll get a placeholder entry in the knowledge bank like this, which is overwritten later. See Intro11 for an example of what I mean.//
Children&#39;s Song
the ledger //you don&#39;t know what this is yet//
The Black Ledger //you know what this is and it&#39;s dangerous knowledge to admit to//
sign of linked circles
strange spectral attire
location of the Ledger //currently unimplemented. Represents the point at which you know that the ledger is under the hips burial site. If you have this knowledge as well as hips burial site, you can try to convince the pit crew that they&#39;re digging in the wrong place.//

player tags:

curious
impetuous
drunk
noisy
exile
spiritual
weddingfriends
friendswitholdwoman
boundhands
thirsty
released //for if you&#39;re out of jail//

unchained //for if you&#39;re out of the chain gang//
revolution //for if Croach has been overthrown//
manacles //for if you&#39;re wearing manacles//
shoulderchains //for if you&#39;re in the Pit Crew with their chains//

journey tags:

wedding
census
exile

inventory items:

empty wine bottle
waterskin
sandals
dusty robe
locket
seed-bag
winding sheet
bone brooch
shard of green glass

body parts:

head
torso
feet
hands</tw-passagedata>
<tw-passagedata pid="34" name="Intro11" tags="" position="468,2207">The ceiling of the shelter is a rotten board, wedged into ragged cracks the stonework. The space is larger than it seemed from outside. The walls in the shelter are tacked with talismans of bone and hair, and something large and rotten is bundled up in the crook of the corner. There is a patterned mat of reeds spread across the floor. On the far wall, glistening, is a series of angular markings that depict a fleshy tongue, impaled on a series of long triangles. 

You gaze at it, transfixed.

(if: (datanames: &quot;people&quot; of $knowledge) contains &quot;Whispering Keepers&quot;)[It is the icon of the Whispering Keepers, the order of monks that you seek. This sign is used by others to refer to them. What is it doing here? You know it to be a heretical sign, but then this is a place avoided by most, so perhaps here, of all places, it is not too unexpected to see it. You fear that it designates a warning.
(set: &quot;history&quot; of $knowledge to it + (datamap:&quot;The Bitten Tongue&quot;,&quot;An icon that depicts a tongue protruding between sharpened teeth. It is used to refer to the Whispering Monks, and has been daubed (perhaps in warning) on the wall of a shack, leaning up against the exterior of the skull.&quot;))]
(else:)[You&#39;ve never seen anything like it.(set: &quot;history&quot; of $knowledge to it + (datamap:&quot;Strange symbol of teeth&quot;, &quot;A marking spotted outside the Skull, depicting a tongue clamped tight between sharp fangs.&quot;))]

It&#39;s the last thing you see before the grit beneath your feet starts to shift, and the ground gives way, and you begin to fall into the ground. 

[[i bid my freedom goodbye|Entrance0]]</tw-passagedata>
<tw-passagedata pid="35" name="Intro12" tags="" position="633,2145">You attempt to sleep. With the darkness comes an intense cold, and through the veil of half-waking you hear voices, and the sound of a campfire. Inchoate, you rise and walk towards the light. You are shaking with cold, but you are surrounded by voices of encouragement and welcome, so you keep moving forwards towards the flickering light of more fortunate campers. Hands touch your back and your neck as you are brought into the fold. Their touch is dry, like that of the Traveller&#39;s Friend.

(if: $playerJourney is &quot;wedding&quot;)[Things are fine here. The voices are warm. You are invited to sit down. Such comfort - so unlike the treatment you will, in all likelihood, receive upon the completion of your journey. The thin gruel, the sour wine of the wedding feast are as nothing to the repast at this desert campfire.]

Something gives way beneath you. You begin to fall. This is bad. Something very bad is happening. (if: $inv contains &quot;winding-sheet&quot;)[The winding-sheet flaps in the updraft as you plummet. As you land in a pile of straw, it falls across your face. You faint.]

[[i bid my freedom goodbye|Entrance0]]</tw-passagedata>
<tw-passagedata pid="36" name="Intro13" tags="" position="788,2098">A jagged outcrop of rocks, shafting the sky with daggers that would rend its woollen flesh if they could but reach. The rocks offer a little shelter from the wind and you curl up. Exhaustion overtakes you, and you fall into a fitful sleep. 

(if: ($playerTags contains &quot;drunk&quot;) is false)[You awaken to see a figure standing over you, stoop-shouldered, hooded against the wind. Chains glitter in the moonlight, linking its neck and arms. It shouts something, but you can&#39;t hear its voice. It reaches down and clubs you over the head. The world goes black.(set: &quot;people&quot; of $knowledge to it + (datamap:&quot;stooped figures&quot;,&quot;You were abducted by a figure in a hood with a crooked back and heavy chains threaded between its neck and wrists.&quot;))]\
(else:)[You dream of choppy seas, and pits full of bones, and of a grinning skull many miles high which opens its jaws wide and consumes you.]

(set: $playerTags to it + (a:&quot;boundhands&quot;))\
[[i bid my freedom goodbye|Entrance0]]</tw-passagedata>
<tw-passagedata pid="37" name="Intro14" tags="" position="920,1997">You carry on around the skull, scanning the horizon for the mountain that is your destination, black on navy blue. (if: $playerTags contains &quot;noisy&quot;)[It feels good to sing. Your voice travels far across the plain. The dangers of the road are nothing to you as you bawl the story of the harlot and the reeve at the top of your lungs.](else:)[Before long, you realise that your footsteps are not the only ones you can hear. And then, a voice, whispering not quietly enough - 
&#39;Yes, we&#39;ll take this one in now, and leave it in the usual place.&#39; You cast about for a rock, a branch, some kind of weapon, but too late. You risk a glance behind you, and see a hunched silhouette, with metal glinting on its shoulders. It looks like it is wearing chains.(set: &quot;people&quot; of $knowledge to it + (datamap:&quot;stooped figures&quot;,&quot;You were abducted by a figure in a hood with a crooked back and heavy chains threaded between its neck and wrists.&quot;))]

A net erupts from the sand beneath your feet and raises you into the air. A rope creaks above you. You sway backwards and forwards, wishing that you had a knife. 
&#39;Oh yes, this one will make good repast for what&#39;s below,&#39; yells a voice nearby. 
&#39;Its hunger will be well-sated, I&#39;ve no doubt.&#39;(set: &quot;places&quot; of $knowledge to it + (datamap:&quot;something below&quot;,&quot;Your abuductors mentioned something dwelling down below, which they intended to feed you to.&quot;)) The net goes slack, and you drop towards the ground, hard. A rock meets the back of your neck, and you go limp.

(set: $playerTags to it + (a:&quot;boundhands&quot;))\
[[i bid my freedom goodbye|Entrance0]]</tw-passagedata>
<tw-passagedata pid="38" name="Entrance1" tags="" position="1243,2343">You awaken to the sharp touch of icy water, stinging your forhead in fat drops. Light comes in through a rectangular opening in the ceiling above you, slanting down through the chamber where you lie in a pile of straw.
(if: $playerTags contains &quot;boundhands&quot;)[Your hands are bound.]

[[Pull yourself together-&gt;Entrance2]]</tw-passagedata>
<tw-passagedata pid="39" name="OldConversationOptions" tags="" position="1936,340">ask about (print: (datanames: &quot;people&quot; of $knowledge).join(&quot;
ask about &quot;))
ask about (print: (datanames: &quot;places&quot; of $knowledge).join(&quot;
ask about &quot;))
ask about (print: (datanames: &quot;history&quot; of $knowledge).join(&quot;
ask about &quot;))
(linkgoto: &quot;say farewell&quot;,&quot;playerExit&quot; of $interlocutor)
{
(set: $peopleNumber to (datanames: (&quot;people&quot; of $knowledge))&#39;s length)\
(set: $i to 0)\
[(display: &quot;PeopleConversationLooper&quot;)]&lt;peopleLoop|
(set: $placesNumber to (datanames: (&quot;places&quot; of $knowledge))&#39;s length)\
(set: $i to 0)\
[(display: &quot;PlacesConversationLooper&quot;)]&lt;placesLoop|
(set: $historyNumber to (datanames: (&quot;history&quot; of $knowledge))&#39;s length)\
(set: $i to 0)\
[(display: &quot;HistoryConversationLooper&quot;)]&lt;historyLoop|
}</tw-passagedata>
<tw-passagedata pid="40" name="ConversationResponse" tags="" position="1216,476">(set: $displayInterjections to true)\
(if: $patience &gt; 0)[{
(set: $topicsDiscussed to it + (a: $query))
(if: &quot;opinions&quot; of $interlocutor contains $query)[
(set: $patience to it + $query of &quot;opinions&quot; of $interlocutor)]

(if: $patience &gt; 3)[
(set: $tic to (string:&quot;warm&quot; + (string:(either: 1, 2))))]
(elseif: $patience &gt; 1)[
(set: $tic to (string:&quot;cool&quot; + (string:(either: 1, 2))))]
(else:)[
(set: $tic to (string:&quot;cold&quot; + (string:(either: 1, 2))))]

}(print: $tic of &quot;attitudes&quot; of $interlocutor)

(if: &quot;responses&quot; of $interlocutor contains $query)[(print: $query of &quot;responses&quot; of $interlocutor)]\
(else:)[(print: $iDontKnow&#39;s 1st)(set: $iDontKnow to (rotated: 1, ...$iDontKnow))(set: $patience to it - 2)]
\
(set: $interjections to (rotated: 1, ...$interjections))\
\
(display: &quot;ConversationResponseStage2&quot;)
]\
(else:)[(display: &quot;exit&quot; of $interlocutor)]</tw-passagedata>
<tw-passagedata pid="41" name="PeopleConversationLooper" tags="" position="1504,428">(if: $i &lt; $peopleNumber)[\
(set: $name to (datanames: &quot;people&quot; of $knowledge)&#39;s ($i))\
(if: ($topicsDiscussed contains $name) is false)[
(set: $link to &#39;(click: &quot;&#39; + $name + &#39;&quot;)[
(set: $query to &quot;&#39; + $name + &#39;&quot;)(goto: &quot;ConversationResponse&quot;)
]&#39;)\
(print: $link)\
]
(set: $i to it + 1)\
(replace: ?peopleLoop)[(display: &quot;PeopleConversationLooper&quot;)]\
]</tw-passagedata>
<tw-passagedata pid="42" name="PlacesConversationLooper" tags="" position="1628,428">(if: $i &lt; $placesNumber)[\
(set: $name to (datanames: &quot;places&quot; of $knowledge)&#39;s ($i))\
(if: ($topicsDiscussed contains $name) is false)[
(set: $link to &#39;(click: &quot;&#39; + $name + &#39;&quot;)[
(set: $query to &quot;&#39; + $name + &#39;&quot;)(goto: &quot;ConversationResponse&quot;)
]&#39;)\
(print: $link)\
]
(set: $i to it + 1)\
(replace: ?placesLoop)[(display: &quot;PlacesConversationLooper&quot;)]\
]</tw-passagedata>
<tw-passagedata pid="43" name="HistoryConversationLooper" tags="" position="1752,428">(if: $i &lt; $historyNumber)[\
(set: $name to (datanames: &quot;history&quot; of $knowledge)&#39;s ($i))\
(if: ($topicsDiscussed contains $name) is false)[
(set: $link to &#39;(click: &quot;&#39; + $name + &#39;&quot;)[
(set: $query to &quot;&#39; + $name + &#39;&quot;)(goto: &quot;ConversationResponse&quot;)
]&#39;)\
(print: $link)\
]
(set: $i to it + 1)\
(replace: ?historyLoop)[(display: &quot;HistoryConversationLooper&quot;)]\
]
</tw-passagedata>
<tw-passagedata pid="44" name="skullResponse" tags="" position="386,3718">&#39;There is a rhyme about this place. It goes like this:
All is known to the maid atop the dome,
Apart from the fate of the maggot in the heart,
And the beast that curls about the feet.
Children sing it. It chills my old blood. I dread to get too close.&#39; (set: $knowledge&#39;s (&quot;history&quot;) to it + (datamap: &quot;Children&#39;s Song&quot;, &quot;It goes like this:
All is known to the maid atop the dome,
Apart from the fate of the maggot in the heart,
And the beast that curls about the feet.&quot;))</tw-passagedata>
<tw-passagedata pid="45" name="Intro10b" tags="" position="636,1985">Now you are alone again, and your journey is far from over. It is nightfall. You find yourself stood at the base of this preposterous fortress, hundreds of miles from anywhere you want to be. Exhaustion dogs you.

(if: $playerTags contains &quot;spiritual&quot; and (either: true, false))[
[[i spot a sagging shelter in the angle between a butress and the wall and move into it
|Intro11]]]\
(if: $inv contains &quot;winding-sheet&quot;)[
[[i wrap myself in the sheet the old woman dropped and try to sleep
|Intro12]]]\
(if: $playerJourney is &quot;wedding&quot; and (either: true, false))[
[[i try to distract myself from my present plight by imagining, for the hundredth time, the celebrations i will enjoy on my return
|Intro12]]]\
(if: $playerTags contains &quot;impetuous&quot; or (either: true, false))[
[[i curl up at the bottom of the wall and look up at the stars
|Intro13]]]\
(if: $playerTags contains &quot;drunk&quot; and (either: true, false))[
[[my head aches and my stomach churns, so i rest for a moment on a rock
|Intro13]]]\
(if: $playerTags contains &quot;noisy&quot; and (either: true, false))[
[[i keep myself awake by singing a bawdy song as i stroll on around the parapet
|Intro14]]]\
(if: (either: true, false))[
[[i feel that exercise will keep exhaustion at bay, so i keep exploring the perimeter of the fortress
|Intro14]]]\
(else:)[
[[i wander beneath the stars and consider my situation
|Intro14]]]</tw-passagedata>
<tw-passagedata pid="46" name="Intro10a" tags="" position="796,1734">She nodded at you, and without saying another word she turned and rode back the way you came.
[[Intro10b]]</tw-passagedata>
<tw-passagedata pid="47" name="TFCoughs" tags="" position="515,3991">She stopped, then, and took a rattling breath. Her body twisted, sinuous, and was wracked with coughs. Red droplets, indistinct, blotted through the sheet that covered her mouth.

[[&#39;you are sick. i should stay with you.&#39;|TFCoughsA]]
[[&#39;i hope your illness is not contagious.&#39;|TFCoughsB]]</tw-passagedata>
<tw-passagedata pid="48" name="ConversationTutorialExit" tags="" position="415,1877">As she shrank into the distance, a length of sheet came away from her figure and drifted towards you in the wind. 

(link: &quot;you caught it&quot;)[(set: $inv to it + (a:&quot;winding sheet&quot;))(goto:&quot;Intro10b&quot;)]
[[you let it blow away|Intro10b]]</tw-passagedata>
<tw-passagedata pid="49" name="TFCoughsA" tags="" position="450,4116">She turned sharply in her saddle and looked directly at you. A rare gesture.

&#39;No,&#39; she said. &#39;Foolishness. How dare you? After the miles we have walked together, you would squander my goodwill on the ministrations of a nursemaid? Pah. I would not brook it.&#39; (set: $patience to it - 2)

(display:&quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="50" name="TFCoughsB" tags="" position="586,4116">She laughed, and you heard blood gargling in her mouth.

&#39;Fear not, child. You will do just fine. Yes, you will do very well.&#39; (set: $patience to it + 2)

(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="51" name="TFBrushOff" tags="" position="370,3991">A silence fell between you.

&#39;Did you have aught else to say? I detest prolonged farewells.&#39;

(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="52" name="TFExit" tags="" position="316,3858">Her stick-thin arm reached across and she touched your shoulder.

&#39;Enough,&#39; she said. &#39;Here is where our paths diverge. Perhaps we will see one another again, but I think it is unlikely. I would wish you luck, but those who need recourse to luck in a world such as this are lost already. So I will say only farewell.&#39;

(display: &quot;ConversationExit&quot;)\
(display: &quot;ConversationTutorialExit&quot;)</tw-passagedata>
<tw-passagedata pid="53" name="TFExitPlayer" tags="" position="461,3858">&#39;It is the time,&#39; she says. &#39;Your fate is now yours to direct. Your destination is known to you.&#39;

Her fingers tightened on the reins.

&#39;Until the next life, then.&#39;

(display: &quot;ConversationExit&quot;)\
(display: &quot;ConversationTutorialExit&quot;)</tw-passagedata>
<tw-passagedata pid="54" name="TFQuestion" tags="" position="241,3988">She scratched her lower back with a bony finger.

&#39;Now, let me ask you something. Is there anyone in this world that you care about, truly? If the worn tapestry of this tattered world were one day rent asunder, would your final thought be of yourself, or of some other person?&#39;

[[&#39;i would regret only the wine i left undrunk.&#39;|TFQuestionA]]
[[&#39;truly, there is another who is often in my thoughts.&#39;|TFQuestionB]]</tw-passagedata>
<tw-passagedata pid="55" name="TFQuestionA" tags="" position="175,4128">The woman&#39;s laugh is brief and sharp.

&#39;I am glad I saved you, stranger. Truly I am. So many lonely travellers disappoint me.&#39;

[[&#39;what is it in these people that disappoints you so?&#39;|TFQuestionC]]
(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="56" name="TFQuestionB" tags="" position="315,4121">&#39;Hm,&#39; she said. &#39;Then I will think on your beloved in my reveries.&#39; You thought you heard something malign in her tone, but you couldn&#39;t be sure.

(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="57" name="TFQuestionC" tags="" position="140,4271">&#39;They often fail to devliver my expectations. I ask for so little in return for my friendship.&#39;

[[&#39;what kind of charity is this, that comes with such conditions?&#39;|TFQuestionD]]
[[&#39;is there something you would have of me?|TFQuestionE]]
(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="58" name="TFQuestionD" tags="" position="220,4406">&#39;Whoever said my intentions were charitable?&#39;

(display: &quot;TFExit&quot;)</tw-passagedata>
<tw-passagedata pid="59" name="TFQuestionE" tags="" position="81,4398">&#39;We will probably never cross paths again. However, if we do, I will ask something small of you. Only something small. Better not to think of it.&#39;

(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="60" name="ConversationInitialise" tags="" position="1091,348">{(set: $topicsDiscussed to (a:))
(set: $interjections to &quot;interjections&quot; of $interlocutor)
(set: $interjections to (shuffled: ...$interjections))
(set: $iDontKnow to &quot;iDontKnow&quot; of $interlocutor)
(set: $iDontKnow to (shuffled: ...$iDontKnow))

(if: $timeindungeon&gt;(&quot;timelastmet&quot; of $interlocutor))[
(set: &quot;patience&quot; of $interlocutor to it+($timeindungeon-(&quot;timelastmet&quot; of $interlocutor)))]

&lt;!-- could maybe do something here with modifying patience based on items of clothing, etc --&gt;

(if: (&quot;patience&quot; of $interlocutor)&gt;(&quot;maxpatience&quot; of $interlocutor))[(set: (&quot;patience&quot; of $interlocutor) to (&quot;maxpatience&quot; of $interlocutor))]

(if: (datanames: $interlocutor) contains &quot;specialPatienceLevel&quot;)[(display:&quot;specialPatienceLevel&quot; of $interlocutor)]

(set: $patience to &quot;patience&quot; of $interlocutor)

}</tw-passagedata>
<tw-passagedata pid="61" name="ConversationExit" tags="" position="1091,473">{(set: $interlocutor&#39;s &quot;topicsDiscussed&quot; to (a:) + $topicsDiscussed)
(set: $interlocutor&#39;s &quot;timelastmet&quot; to $timeindungeon)
(set: $interlocutor to (datamap:))
}</tw-passagedata>
<tw-passagedata pid="62" name="InventoryExplorer" tags="" position="1076,740">(set: $inv to it - (a: &quot;&quot;))
(print: $inv.join(&quot;
&quot;))\
(set: $invNumber to $inv&#39;s length)\
(set: $i to 0)\
[(display: &quot;ItemsLooper&quot;)]&lt;itemsLoop|

(link: &quot;Done&quot;)[(goto: (history:)&#39;s last)]</tw-passagedata>
<tw-passagedata pid="63" name="ItemsLooper" tags="" position="1211,736">(if: $i &lt; $invNumber)[\
(set: $name to (string:$inv&#39;s ($i)))\
(set: $link to &#39;(click: &quot;&#39; + $name + &#39;&quot;)[(goto: &quot;&#39; + $name + &#39;&quot;)]&#39;)\
(print: $link)\
\
(set: $i to it + 1)\
(replace: ?itemsLoop)[(display: &quot;ItemsLooper&quot;)]\
]</tw-passagedata>
<tw-passagedata pid="64" name="waterskin" tags="" position="71,1016">The waterskin is empty.

(link: &quot;Done&quot;)[(goto: (history:)&#39;s 2ndlast)]</tw-passagedata>
<tw-passagedata pid="65" name="SYSTEMS!" tags="" position="52,285">Some notes on the main systems in the game. Note - to keep the code here from firing (and messing up the actual game, possibly) I&#39;m nesting it in little `` markers that basically neuter it and stop it from having magic code power.

//Tags and Variables//
NB - if you want to change a tag or variable, do it in a silent passage where possible. Doing it in a passage which has the generic actions means it runs every time you go back to it, which causes all kinds of problems

//Relevant strings//
There&#39;s a passage called relevant strings under this one where I&#39;m keeping a record of every string that we use for items, tags, knowledge datanames, etc. I think this is important because all these `(if:)` comparisons are case-sensitive and having the wrong capitalisation or punctuation can throw them off, so the version of a string in the relevant strings passage should be what you refer to when you&#39;re putting checks in the game. Update it whenever you add a new tag or whatever. Given that Twine doesn&#39;t have the concept of a Enum, this is the best way to keep the code nice and sanitary.

//Knowledge//
This is a datamap that contains three sub-datamaps for people, places and history. To add to it, use a set macro like this:

`(set: &quot;history&quot; of $knowledge to it + (datamap:&quot;The Great Schism&quot;,&quot;Whatever this is.&quot;))`

You can also check if something is known or not using something like this:

`(if: (datanames: &quot;history&quot; of $knowledge) contains &quot;The Great Schism&quot;)[You recognise the depiction of the Great Schism on the wall.]
(else:)[It&#39;s not clear what this mural depicts, but it involves people burning books and scholars wailing. A shadowy figure presides over all.]`

Sometimes a bit of knowledge might make a previous entry irrelevant or obsolete. For example, in Intro11, if you know about the Whispering Keepers, you recognise their mark and get a knowledge entry about The Bitten Tongue. Otherwise, you get a placeholder enrty called &#39;strange symbol of teeth&#39; that might be updated later on if you talk to someone, or some such thing.

//Conversation//
NOTE: The Traveller&#39;s Friend dialogue is in the past tense but the rest ought to be in the present.

To create a person who can be talked to, do the following:

1) First, add an entry for them to the InitialiseConversations passage. The datamap contains values for &quot;patience&quot;, &quot;maxpatience&quot;, &quot;timelastmet&quot;, &quot;responses&quot;, &quot;opinions&quot;, &quot;attitudes&quot;, &quot;interjections&quot;, &quot;iDontKnow&quot;, &quot;playerExit&quot;, &quot;exit&quot; and &quot;topicsDiscussed&quot;.

Here&#39;s what those things are:

patience - number - the &#39;HP&#39; of the conversation. When it gets to zero, the NPC ends the conversation. If we want characters who are going to recur or be visitable more than once, we&#39;ll need to work out how to top it back up after sufficient time is passed (SEE BELOW). It gets stored in a variable called $patience during the conversation itself so you don&#39;t have to keep typing (set: &quot;patience&quot; of $interlocutor to it - 1).

maxpatience - the maximum value of patience for this character

timelastmet - this is a record of the player variable $timeindungeon. it&#39;s set in the ConversationExit passage to whatever $timeindungeon was at that point. When a conversation happens, the conversation intialise passage checks if $timeindungeon is higher than timelastmet. If so, it tops up &quot;patience&quot; accordingly, but won&#39;t go above maxpatience (so meeting new characters will always be at their maxpatience). Should be set to 0 in intialisation 

responses - datamap of either strings or macros - The main feature of this whole system. This is the list of their responses to things you might ask them about. The datanames in this datamap must be spelled and capitalised exatctly the same as their counterparts the datanames in the &quot;knowledge&quot; datamap. The value that comes afterwards can be one of two things - either a string, if you want their response to just be text, or else a `(display:)` macro referring to a passage if you want their response to trigger some code (for example, to add an entry to the knowledge datamap). See the &quot;skullResponse&quot; passage for an example of this. If you want the response to exit the conversation entirely (for example, if someone takes you somewhere, or pushes you down a hole) then make sure you put a `(display: &quot;ConversationExit&quot;)` macro in there somewhere. Also, this doesn&#39;t need to contain an entry for every single thing in the knowledge datamap. If you ask an NPC about something that they don&#39;t know about, they&#39;ll display something from the &quot;iDontKnow&quot; entry instead. 
NEW CHANGE HERE**********************
If you want a passage-response to display ONLY itself and not the interjection or options underneath, you&#39;re advised to add this line (for example if you want the passage to lead OUT of the conversation and you don&#39;t want a mid-page link with some irrelevant stuff under it:
(set: $displayInterjections to false)\
See jailerLedgerResponse for example usage.
*********************************

opinions - datamap of numbers - This contains a list of numbers that tell you how the patience value should change in response to what you ask them about. So, everything in the &#39;responses&#39; section should also be represented here. In the tutorial conversation, the woman likes talking about the Skull and the Children&#39;s Song, but hates talking about the Arbiters. 

attitudes - datamap of strings - This contains a bunch of flavourtext that indicates how the person feels at a given moment (attitudes in the sense of &#39;she struck a diffident attitude&#39; - not very well-named probably). They are divided into warm1, warm2, cool1, cool2, cold1, cold2.

interjections - array of passage names - I wanted the conversations to be a bit more organic than just &#39;ask them lots of questions until they say go away&#39; so this was my solution to that problem. Each character can have any number of passages (must be at least one) that get displayed after they answer your question. For the Traveller&#39;s Friend these are TFBrushOff, TFQuestions and TFCoughs. These let the characters talk about something they want to talk about, by asking you questions or whatever. The brushoff one is just some flavourtext but the other two conversations affect the Friend&#39;s patience with you and also offer some insight into her character. The nice thing about this way of arranging the conversations is we can have little mini-flowchart-trees that let the dialogue go off in a direction. The only consideration here is that each branch of conversation needs to end with (display: &quot;ConversationOptions&quot;) or else the game will get stuck.

iDontKnow - array of strings - Just a couple of options for stuff the NPC says if you ask them something they don&#39;t know about (can be any length).

playerExit - string (passage title) - If the player terminates the conversation by saying farewell, what happens? For example, see TFExitPlayer. This passage should either (display:) or else have a link to somewhere on the main story tree. It must also contain (display: &quot;ConversationExit&quot;).

exit - string (passage title) - The passage that gets displayed if they become impatient with you and end the dialogue. Simillar to above. Example is TFExit. It must also contain (display: &quot;ConversationExit&quot;) and link back to the main story tree.

topicsDiscussed - an empty array - Just needs to be there to keep track of what you&#39;ve said to whom.

specialPatienceLevel - passage name string - if you want to have the patience of the person set by some special means other than the normal system, include this field and put a passage name in it. The passage named here should set `&quot;patience&quot; of $interlocutor` using whatever criteria (such as what clothes you&#39;re wearing or how hard you&#39;ve been working in the mine that day). Can also use it to stack the interjections deck, if you want (see Shad).

2) So by the time you&#39;ve put all that stuff together, you&#39;ve pretty much written the NPC. All that remains is to put the section into the main game tree that links into the conversation. To start a conversation, all you do is the following:

`(set: $interlocutor to $friend)\
(display: &quot;ConversationInitialise&quot;)\
(display: &quot;ConversationOptions&quot;)`

The first bit loads the right datamap into the $interlocutor variable, the second bit sets up some other code that helps it all to hang together, and the third bit displays the initial list of conversation options.

That&#39;s all! Simple.

//Items//
Remember to make a note of all items in the relevant strings passage. Each item has a passage associated with it (with the same name as the inventory string). That passage contains relevant bits and bobs. The important thing about these is that leaving their page, you want to (goto: (history:)&#39;s 2ndlast) as that&#39;ll correspond to wherever you were on the main tree ((history:)&#39;s last would take you to the inventory menu itself, but this should be avoided as it&#39;ll mean that any other page you visit from the inventory will send you to the wrong place).

The inventory is an array of strings, and the $clothing datamap contains slots for various body parts that could have clothes on them. Clothes you&#39;re wearing aren&#39;t in the inventory because that&#39;s conventional. We need an option for removing clothes. When you put a piece of clothing in, it is removed from the inventory and whatever was in its slot is put into the inventory. Each body part is assosciated with a variable that contains a string, such as $feetDescription or $headDescription, and these variables should be updated when you put a piece of clothing on so that the &#39;How I Look&#39; thing reads accurately. This system isn&#39;t ideal (because it won&#39;t play well with filth) but I&#39;m loathe to complicate it further at this stage.

//feelings//
any variable that&#39;s a number that stores information about the player, such as $health or $timeindungeon can be exploited for a sliding scale or feelings, as well as making use of the $playerTags section. 

In the InitialiseFeelings passage are arrays containing strings that describe each stage as the variable progresses. It&#39;s important that these are in a progressive order, and that the order matches the way the number for the associated value changes (eg. in the $healthfeeling array higher is better, but in the $timeindungeonfeeling array lower is better). the Feelings passage then calls e.g. `$healthfeeling&#39;s $health` to show the string that corresponds to the current health variable. Any more variables then simply need to be added to the playerinit, a corresponding array of progressive descriptions added to the FeelingsInit passage, and print: macro added to the Feelings passage.
NB: for this to work, variables must not go into numbers that couldn&#39;t relate to an array length. therefore, $filth can&#39;t go below 1, for example (and we&#39;ll have to have system t keep health within a certain range that&#39;s matched by the array). this is good practice anyway though. 

To make use of playertags, simply use an if:contains inside the Feelings passage


//knowledge appender//

This is for when you want to add a new dimension to some knowledge without replacing the entire category (for example, when you get some more information about something but not enough to warrant creating a whole new entry in that table). The kind of block I was having to write can be seen in Ghosts1, and a sample of this new system can be seen in Ghosts2. This system replaces that horrid mess with something like the following:

`
(set: $knowledgeCategory to &quot;history&quot;)
(set: $knowledgeName to &quot;what&#39;s below&quot;)
(set: $appendedKnowledge to &quot;whatever you want added&quot;)
(set: $newKnowledge to &quot;whatever you want the entry to say if this is the first part of it&quot;)
(display: &quot;KnowledgeAppender&quot;)
`

The script thus called first checks if &quot;what&#39;s below&quot; is already in the knowledge database, and then either appends something new to it or makes a new entry if there isn&#39;t one there already.
Note: currently not working for some reason.</tw-passagedata>
<tw-passagedata pid="66" name="sandals" tags="" position="66,1151">This was a fine pair of sandals, once. You wouldn&#39;t think so to look at them now.

(link: &quot;put them on&quot;)[\
(set: $inv to it + (a:&quot;feet&quot; of $clothing))\
(set: $inv to it - (a:&quot;sandals&quot;))
(set: &quot;feet&quot; of $clothing to &quot;sandals&quot;)\
(set: $feetDescription to &quot;Ragged sandals adorn your feet.&quot;)\
(goto: (history:)&#39;s 2ndlast)]
(link: &quot;done&quot;)[(goto: (history:)&#39;s 2ndlast)]</tw-passagedata>
<tw-passagedata pid="67" name="dusty robe" tags="" position="71,1296">This robe has seen far better days. The unrelenting sun has turned it pale. Dust falls out of every crease in the fabric.

(link: &quot;put it on&quot;)[\
(set: $inv to it + (a:&quot;torso&quot; of $clothing))\
(set: $inv to it - (a:&quot;dusty robe&quot;))
(set: &quot;torso&quot; of $clothing to &quot;dusty robe&quot;)\
(set: $torsoDescription to &quot;Your robe is tattered and bleached from months on the road.&quot;)\
(goto: (history:)&#39;s 2ndlast)]
(link: &quot;done&quot;)[(goto: (history:)&#39;s 2ndlast)]</tw-passagedata>
<tw-passagedata pid="68" name="seed-bag" tags="" position="68,1436">You gathered these seeds carefully from reedbeds and verges and from the dirt beneath the stalls of fruit-sellers during your weeks on the road. There are many different types. If even one in twenty of them grow to maturity, you will never be hungry again.

(link: &quot;Done&quot;)[(goto: (history:)&#39;s 2ndlast)]</tw-passagedata>
<tw-passagedata pid="69" name="locket" tags="" position="66,1571">This person was once significant to you: In your betrothal, you guaranteed yourself good social standing and full complicity with breeding regulations. Now, the face in the locket is as a stranger. You barely recognise it.

(link: &quot;close the locket&quot;)[(goto: (history:)&#39;s 2ndlast)]</tw-passagedata>
<tw-passagedata pid="70" name="winding sheet" tags="" position="66,1701">The Traveller&#39;s Friend dropped this length of sheet when she left your company. When you hold it close to your face, the smell of tombs is unignorable.

(link: &quot;use it to cover your head&quot;)[\
(set: $inv to it + (a:&quot;head&quot; of $clothing))\
(set: $inv to it - (a:&quot;winding sheet&quot;))
(set: &quot;head&quot; of $clothing to &quot;winding sheet&quot;)\
(set: $headDescription to &quot;Your face is obscured by a stinking cloth.&quot;)\
(goto: (history:)&#39;s 2ndlast)]
(link: &quot;done&quot;)[(goto: (history:)&#39;s 2ndlast)]</tw-passagedata>
<tw-passagedata pid="71" name="example" tags="" position="61,1841">This is a pair of stylish Examples.

(link: &quot;put them on&quot;)[\
(set: $inv to it + (a:&quot;feet&quot; of $clothing))\
(set: $inv to it - (a:&quot;example&quot;))
(set: &quot;feet&quot; of $clothing to &quot;example&quot;)\
(set: $feetDescription to &quot;Your feet are encased in some nice Examples.&quot;)\
(goto: (history:)&#39;s 2ndlast)]
(link: &quot;done&quot;)[(goto: (history:)&#39;s 2ndlast)]</tw-passagedata>
<tw-passagedata pid="72" name="Appearance" tags="" position="1448,708">(print: $headDescription) (print: $torsoDescription) (print: $feetDescription) (print: $handsDescription) (if: $playerTags contains &quot;boundhands&quot;)[Your hands are roughly bound with course rope.] (if: $playerTags contains &quot;manacles&quot;)[Manacles bind your feet, attached to a length of chain.] (if: $playerTags contains &quot;shoulderchains&quot;)[Loops of chain go from your neck to your arms, weighing you down but affording you some freedom.]

(link: &quot;done&quot;)[(goto: (history:)&#39;s last)]</tw-passagedata>
<tw-passagedata pid="73" name="Feelings" tags="" position="1573,706">(print: $healthfeeling&#39;s $health)
(if: $filth&gt;$filthfeeling&#39;s length)[(print: $hfilthfeeling&#39;s last)](else:)[(print: $filthfeeling&#39;s $filth)]
(if: $timeindungeon&gt;$timeindungeonfeeling&#39;s length)[(print: $timeindungeonfeelings&#39;s last)](else:)[(print: $timeindungeonfeeling&#39;s $timeindungeon)]

(if: $playerTags contains &quot;drunk&quot;)[I am bouyed by the spirits of the bottle. ]\
(if: $playerTags contains &quot;thirsty&quot;)[I am desperately thirsty. ]\
(if: $playerTags contains &quot;boundhands&quot;)[Ropes chafe my wrists. ]

(link: &quot;done&quot;)[(goto: (history:)&#39;s last)]</tw-passagedata>
<tw-passagedata pid="74" name="InitialiseFeelings" tags="" position="316,386">(set: $healthfeeling to (a: 
&quot;My exertions have left me near death&quot;,
&quot;I am exhausted by my travails&quot;,
&quot;I am weary, but can continue&quot;,
&quot;I am beginning to feel the strain my endeavours&quot;,
&quot;I have energy enough to continue&quot;,
))

(set: $healthfeeling2 to (a: 
&quot;You are close to collapse, close to death.&quot;,
&quot;Your trials have left you exhausted.&quot;,
&quot;Your muscles ache but you have some small strength left.&quot;,
&quot;Your hardships are wearing you down, gradually.&quot;,
&quot;You have as much strength as you could hope for.&quot;,
))

(set: $filthfeeling to (a:
&quot;I am clean as can be hoped for&quot;,
&quot;I should wash soon&quot;,
&quot;I dislike being dirty&quot;,
&quot;I am filthy and must soon wash away my sins&quot;,
&quot;I am distressed by my appearance. I must look like a sewer-dwelling troglodyte&quot;,
))

(set: $timeindungeonfeeling to (a:
&quot;I find this place intriguing&quot;,
&quot;My time in this place has begun to change me&quot;,
&quot;I feel the atmosphere of this place seep into my bones&quot;,
&quot;I can hardly keep the dry death of this place from breaking my spirit&quot;,
&quot;I fear I shall soon become another dry corpse, trapped in this frightful charnal-house for all eternity&quot;,
))

(goto: &quot;InitialiseGhosts&quot;)</tw-passagedata>
<tw-passagedata pid="75" name="Entrance0" tags="" position="1102,2316">(if: $playerTags contains &quot;drunk&quot;)[(set: $playerTags to it - (a:&quot;drunk&quot;))(set: $playerTags to it+(a:&quot;thirsty&quot;))]
(set: $tallymarks to 0)
(set: &quot;places&quot; of $knowledge to it + (datamap: &quot;the cell&quot;, &quot;A stinking room where you awoke. The walls are scored with tally-marks.&quot;))
(set: $songStorylet to false)
(goto: &quot;Entrance1&quot;)

///when going through places, a silent passage to change tags and variables is necessary otherwise they change when you go back to a passage from the inventory passage///</tw-passagedata>
<tw-passagedata pid="76" name="Entrance2" tags="" position="1485,2343">(if: not ((history:)&#39;s (range:1,((history:)&#39;s length-1)) contains &quot;Entrance2&quot;))[By the time you&#39;ve realised where you are, and checked yourself and your possessions, the icy water has stopped. The last faint traces of moisture in the air offer scant relief against the dry and acrid smell of the cell. The straw you&#39;re lying on has its own musty animal odour that doesn&#39;t help much either. Or is it a human odour? Perhaps you aren&#39;t the first to be trapped in this place.](else:)[The straw still reeks. The walls are still oppressive.]

The studded wooden door opposite you has a small barred window. The black, domed outline of a balding human head blocks the wan light. 

[[investigate the straw-&gt;Entrance2a]]
[[investigate the cell-&gt;Entrance2b]]
[[approach the door-&gt;Entrance3]]
(if: not ($playerTags contains &quot;released&quot;))[\
(if: $tallymarks&gt;0)[[[make a tally mark in the cell wall-&gt;Entrance2d]]
]\
(if: ($playerTags contains &quot;noisy&quot; or $playerTags contains &quot;impetuous&quot;) and $songStorylet is false)[[[sing a song|Entrance5]]
]]\
(else:)[(goto:&quot;Entrance2Alt&quot;)
]\

(display: &quot;GenericActions&quot;)</tw-passagedata>
<tw-passagedata pid="77" name="Entrance2a" tags="" position="1643,2023">(if: $playerTags contains &quot;boundhands&quot;)[You make an attempt to rummage through the straw, but it&#39;s too difficult with your hands tied like this. The smell of human sweat and fear that emanates from the disturbed bedding is palpable.]
(else-if: ($inv contains &quot;bone brooch&quot;) is false)[You scrabble through the bedding, desperate for any sign of another life. A small brooch, carved from bone, drops from a dry and musty handful of straw. (set: $broochonfloor to true)]
(else:)[You dig through the straw, but now you find nothing but disappointment]

{
(if: $broochonfloor is true)[
(link: &quot;pick up the brooch&quot;)[You pick it up(set: $broochonfloor to false)(set: $inv to it+(a:&quot;bone brooch&quot;))]
]}
[[sit back|Entrance2]]</tw-passagedata>
<tw-passagedata pid="78" name="Entrance2b" tags="" position="1288,2676">The floor of the cell is dry and dusty, with round spots where the water splashed into the dirt. Where did that water come from?

NB THIS IS THE PANEL TO PUT ANOTHER ESCAPE OPTION IN

The walls of the cell bare the signs of a long and desperate occupation. Or, a series of short ones. In several places, scratch marks make a tally, but what are they counting? Days? Hours? Meals? A red-rust stain in each groove of one set of tallies looks like blood. A poor wretch, marking their time with the tarnish of their humanity. 

None of the tally marks reach above six. 

[[Make a tally mark in the cell wall-&gt;Entrance2d]]
[[sit back down|Entrance2]]</tw-passagedata>
<tw-passagedata pid="79" name="Entrance3" tags="" position="1951,2656">As you approach the door, you can hear the laboured breathing of a tired man. Perhaps he has spent too long in this place.

(set: $interlocutor to $jailer)\
(display: &quot;ConversationInitialise&quot;)\
(display: &quot;ConversationOptions&quot;)
(if: $playerTags contains &quot;released&quot;)[[[nothing keeps you here|Hallway 1]]]</tw-passagedata>
<tw-passagedata pid="80" name="bone brooch" tags="" position="66,1976">The brooch is carved from a single piece of bone. The round face has the image of two quills, crossed over a single scroll. On the other side, a spar of bone juts out and tapers to a point. 
(if: $playerJourney is &quot;wedding&quot;)[You recognise it as a wedding gift, worn by a woman betrothed. Who was held had lain on the straw before you? (set: &quot;people&quot; of $knowledge to it+(datamap: &quot;the betrothed woman&quot;, &quot;Someone has lost their engagement brooch when they lay in the straw in the cell. Perhaps I should return it&quot;))]
(else:)[I wonder who it could have belonged to?]



(link: &quot;Done&quot;)[(goto: (history:)&#39;s 2ndlast)]</tw-passagedata>
<tw-passagedata pid="81" name="jailerSkullResponse" tags="" position="205,2931">&#39;Listen sunshine, I didn&#39;t have my name spoken at the Birth Ceremony yesterday so don&#39;t treat me like I did. Every one of you hand-scrawling outsiders comes in here pretending you were at the Cranial Temple by accident, and of course you don&#39;t know about the hidebound ledger, and I won&#39;t fall for it. Not again, at any rate.&#39;\
\
(set: $knowledge&#39;s (&quot;history&quot;) to it + (datamap: &quot;the ledger&quot;, &quot;the jailer mentioned this, but I don&#39;t know what it is.&quot;))</tw-passagedata>
<tw-passagedata pid="82" name="jailerLedgerResponse" tags="" position="348,2931">&#39;Oh. You really don&#39;t know, do you? Well here&#39;s a sight for my sore and fading eyes. A true-to-life accidental captive. Let&#39;s see what we can do here.&#39; (set: $displayInterjections to false)

(link-goto: &quot;A rusty key scrapes in the lock&quot;, &quot;JExitPlayer&quot;)</tw-passagedata>
<tw-passagedata pid="83" name="Hallway 1" tags="" position="2285,2630">The cell that was yours is one of several, clustered together behind a high partition of weathered sandstone. The echoes of your footsteps reveal this area to be part of a much larger room. The jail cells are part of the original construction, but the architecture has been contrived to render them invisible from the main chamber. 

Near the cells, some stones have subsided under the weight of eons to produce a crack, just wide enough for a person to contort between. A rope lolls out of the shadows like the tongue of an idle beast.\
(if: $playerTags contains &quot;released&quot;)[

The jailer is nowhere to be seen.

[[follow the rope into the wall-&gt;hallway 2]]]
(else:)[
(link:&quot;wait for the jailer to fall asleep, then sneak past him to the crack in the wall&quot;)[(set: $timeindungeon to it + 1)(goto:&quot;hallway 2&quot;)]]
[[step into the airy chamber-&gt;hallway 3]]

(display: &quot;GenericActions&quot;)</tw-passagedata>
<tw-passagedata pid="84" name="JExit" tags="" position="200,3085">The jailer bangs against the door.

&#39;That&#39;s enough out of you.&#39;

(display: &quot;ConversationExit&quot;)\
(if: $playerTags contains &quot;released&quot;)[(display: &quot;Hallway 1&quot;)]\
(else:)[(display: &quot;Entrance2c&quot;)]</tw-passagedata>
<tw-passagedata pid="85" name="JExitPlayer" tags="" position="359,3086">The door swings open and the jailer stands aside. 

&#39;No,&#39; he says, &#39;I&#39;ll not have another like you on my conscience. I will tell them that you hanged yourself, and that I sent your body down the corpse chute. But know this: There&#39;s little succour here. I release you only into a larger cell. You&#39;ll not leave here. No-one does. Now go, and quick, before I regret my decision. I&#39;ll speak no more to you. By scrip they&#39;d have my tongue if they heard such talk from me.&#39;

He pauses.

&#39;Head for somewhere high up,&#39; he said. &#39;The pit crew seldom trouble to go up there. Do not get comfortable. I&#39;m not giving you your freedom. I doubt you&#39;ll live out the week in either case.&#39;

He spits on the ground.

(display: &quot;ConversationExit&quot;)\
(set: $playerTags to it + (a: &quot;released&quot;))\
(display: &quot;Hallway 1&quot;)</tw-passagedata>
<tw-passagedata pid="86" name="Entrance2c" tags="" position="1686,2670">(set: $timeindungeon to it+1)Time passes. The jail cell is cold and dank. Water condenses on the wall as the evening draws in, and you sip a little. The jailer shoves a heel of mossy bread through the bars. You eat it.

[[nothing happens|Entrance2]]</tw-passagedata>
<tw-passagedata pid="87" name="hallway 2" tags="" position="2576,2740">(if: $playerTags contains &quot;released&quot;)[The jailer raises an eye as you squeeze between the large blocks, but says nothing.]

This way: Down to wherever the jailer lives (the Middens), and a chute for putting corpses down. [[CorpseChute0]]

[[Middens1]]</tw-passagedata>
<tw-passagedata pid="88" name="hallway 3" tags="" position="2510,2133">A smell of dusty incense is baked into the stones of this vast atrium. Light comes down in narrow shafts through small windows high overhead. The walls are tawny sandstone. The layout is regulation, orderly. The room is bisected by a row of polished lecterns, behind which are a great many small doors, most of which have collapsed. A large doorway at the opposite end of the room has been assiduously sealed with large rocks, and something is painted on to them.

The cells are in a corner behind you, concealed from view and yet near-at-hand.

[[examine the lecterns|Hallway3a]]
[[investigate the sealed door|Hallway3b]]

[[through the small doors|Hallway5]]
[[a partition conceals the cells|Hallway 1]]

(display: &quot;GenericActions&quot;)</tw-passagedata>
<tw-passagedata pid="89" name="JQuestion" tags="" position="146,3233">The jailer&#39;s eyelids droop over his eyes as he considers you for a moment.

&#39;I&#39;ll tell you what. Waste my time and tell me why you&#39;re here. I might be a little more disposed to  treat you favourably if you did.&#39;

[[&#39;I&#39;m afraid I&#39;d rather not&#39;-&gt;JQuestionA]]
[[&#39;If it will pass the time&#39;-&gt;JQuestion2]]</tw-passagedata>
<tw-passagedata pid="90" name="JQuestionA" tags="" position="88,3380">(set: $patience to it - 1)&#39;Useless runt! Ah well, so much the better I suppose really. Not knowing makes it easier keeping you here, after all.&#39;

(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="91" name="JQuestion2" tags="" position="238,3380">The jailer eyes you with some interest.

(if: $playerJourney is &quot;wedding&quot;)[[[My friends are to be betrothed, some distance from here-&gt;JQuestion2A]] ]
(if: $playerJourney is &quot;exile&quot;)[[[The country is still bad past the unmarked gate. I have travelled some miles in search of a fresh start-&gt;JQuestion2A]] ]
(if: $playerJourney is &quot;census&quot;)[[[The census has been called, and I must make my way to my Registered birth-town-&gt;JQuestion2B]] ]</tw-passagedata>
<tw-passagedata pid="92" name="JQuestion2A" tags="" position="286,3530">(set: &quot;patience&quot; of $jailer to it+1)

&#39;What a boring life you lead, and the world outside has changed little. Still, the time passes and we all become closer to death with a story like that, eh?&#39;

(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="93" name="JBrushOff" tags="" position="295,3230">&#39;Your yapping gums wear thin my patience. Is there anything else?&#39;

(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="94" name="Entrance2d" tags="" position="1488,2761">(set: $tallymarks to it+1)
Your fingernail rasps across the dry stone, and you repeat the motion until the blood draws from underneath.


(if:$tallymarks&lt;5)[
There are $tallymarks marks in the wall, in the spot you have chosen. A hopeless reminder of your captivity.

[[Try to sleep|Entrance2c]]
]

(else:)[As you forlornly blacken your latest furrow with blood and dirt, you hear the scraping of the cell door. You glimpse a gaunt face you don&#39;t recognise, before a hood is thrust over your face. 

(link-goto: &quot;the jailer laughs as you are dragged away&quot;, &quot;DescentToPit&quot;)]
</tw-passagedata>
<tw-passagedata pid="95" name="ThePit1" tags="" position="3976,3756">///NB you can get here straight from the cell///

--Text here relating to the way the Pit looks if you arrive on foot from elsewhere (toiling slaves down below, or if you&#39;ve had the revolution then it&#39;s deserted).


(if: $playerTags contains &quot;unchained&quot; and $playerTags contains &quot;revolution&quot;)[CASE: Croach is dead, Shad is here, the Pit is open to you. People mill about, unsure what to do.]\
(if: $playerTags contains &quot;unchained&quot;)[CASE: Croach is alive, so is Shad, you&#39;ve been allowed out to do Croach business. Shad probably inacessable to you at this point (would resent you in any case).]\
(else:)[Neither thing has happened, and you&#39;ve come here on foot by process of exploration. Possibility of getting caught.{
(if: not (&quot;history&quot; of $knowledge contains &quot;skull burial site&quot;))[
(set: $knowledgeCategory to &quot;history&quot;)
(set: $knowledgeName to &quot;skull burial site&quot;)
(set: $appendedKnowledge to &quot;From where they&#39;re digging, it seems like the Pit Crew are working on this site.&quot;)
(set: $newKnowledge to &quot;The area under the Skull where the Pit Crew have made their operation is rich with skulls. Strangely, no other bones seem to be down there. How did they get down there? What forgotten people did they belong to?&quot;)
(display: &quot;KnowledgeAppender&quot;)]
}
]

Relevant playerTags:
unchained //for if you&#39;ve escaped the chain gang//
revolution //for if Croach has been overthrown//

SO: if you&#39;re here but without the unchained or revolution tags, that means you&#39;ve arrived at the pit on foot from some other bit of the skull and there should be appropriate hazard for being here.

If you&#39;re here unchained but without revolution, that means you&#39;ve been promoted to Pit Crew and you&#39;ve done their maggot mission (chance to tell them they&#39;re digging in the wrong place and reach the ledger) NB Clue might be to do with burial places for specific body parts (you&#39;re always digging up skulls, but the ledger is beneath the place where pelvises were buried)

If you&#39;re here unchained and with the revolution tag, that means the captors have been overthrown (check Shad&#39;s health to know if Shad is here or not)



[[Depths1]] </tw-passagedata>
<tw-passagedata pid="96" name="empty wine bottle" tags="" position="63,2101">The glass is cloudy with imperfections. The stopper is gone. It contains nothing but the acid reek of wine like piss.

(link: &quot;Smash it&quot;)[(set: $inv to it - (a: &quot;empty wine bottle&quot;))(set: $inv to it + (a:&quot;shard of green glass&quot;))(goto: (history:)&#39;s 2ndlast)]
(link: &quot;Done&quot;)[(goto: (history:)&#39;s 2ndlast)]</tw-passagedata>
<tw-passagedata pid="97" name="JSneer" tags="" position="430,3238">The Jailer rubs his leather skullcap. &#39;You wonder after my manner,&#39; sneers the Jailer. &#39;Your look betrays you. You ask yourself &#39;whatever have I done to this man, to deserve such short treatement&#39;. Well, let me ask you - where do you think I&#39;ll lay my head tonight, hm?&#39;

[[&#39;somewhere softer than this hole, I&#39;ve no doubt&#39;|JSneer1]]
[[&#39;somewhere foul cranny near at hand&#39;|JSneer2]]</tw-passagedata>
<tw-passagedata pid="98" name="JSneer1" tags="" position="430,3390">(set: $patience to it - 2)&#39;No,&#39; he says. &#39;You are wrong, loathesomely wrong. I will lodge here tonight, scant meters from your reeking accomodation.I do not relish the charge. Whenever a fool such as you happens to fall into our compass, I must pass five days away from all the comforts of my station, until they come for you. And for this disruption, I blame you.&#39;

(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="99" name="JSneer2" tags="" position="580,3390">&#39;Yes,&#39; he says, &#39;and here I&#39;ll stay, until they come for you. The lot of the jailer. It&#39;s a pile of shit. I&#39;m as much a prisoner of these bars as you, although I&#39;m on the airier side. Oh, but we&#39;re all prisoners up here in the skull in any case. None can leave and live.&#39; His lip curls. (set: $patience to it +1)

(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="100" name="shard of green glass" tags="" position="66,2228">A large piece of curved green glass, wickedly sharp.

(if: (history:)&#39;s 2ndlast is &quot;hallway 3&quot; or (history:)&#39;s 2ndlast is &quot;Hallway3a&quot; or (history:)&#39;s 2ndlast is &quot;Hallway3b&quot;)[(link: &quot;peer through the glass&quot;)[(goto: &quot;Hallway5a&quot;)]

](else:)[The light glints dimly off the shard&#39;s jagged edge.

](if: $playerTags contains &quot;boundhands&quot;)[(link: &quot;cut your bonds&quot;)[(set: $playerTags to it - (a:&quot;boundhands&quot;))(goto: (history:)&#39;s 2ndlast)]]
(link: &quot;Done&quot;)[(goto: (history:)&#39;s 2ndlast)]</tw-passagedata>
<tw-passagedata pid="101" name="JQuestion2B" tags="" position="148,3533">(set: &quot;patience&quot; of $jailer to it+1)&#39;Ha!&#39; says the jailer. &#39;Displeased them, did you? What was your crime, so heinous that you were sent a-wandering? Hm? Wore the wrong coloured hat on festival day? Lost a receipt for a bread roll? Hm? Forgot a detail on some symbol on a scrap of vellum? Such stuff is smothering to life. Me, I&#39;ve spent the last fifty years inside this same foul citadel, with maggots and slavers for neighbours, but which of us lived more freely? Hm?;

(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="102" name="log" tags="" position="57,543">Devcon: (link:&quot;display&quot;)[(display: &quot;Devcon&quot;)]

Inventory: (print: $inv)

Playertags: (print: $playerTags)

Health: (print: $health)

Filth: $filth

Time in dungeon: $timeindungeon

Clothing: (print: $clothing)


Generic actions: (link: &quot;show&quot;)[(display:&quot;GenericActions&quot;)]

Interolcutor: (print: $interlocutor)
</tw-passagedata>
<tw-passagedata pid="103" name="Rooftop1" tags="" position="3563,213">- a woman lives up here
- she messes with the religion in the Vaults by yelling stuff down at them through this tall well-like opening
- huge birds circle outside that carry you off somewhere if you try to climb down and out
- some process lets you escape but before you can take it you hear about the ledger and what it does so decision to leave is more interesting (perhaps you are given a task involving making it all the way across the dungeon in a certain number of days?)


[[Skull1]]
[[Chute1]]
[[Vaults1]]</tw-passagedata>
<tw-passagedata pid="104" name="Skull1" tags="" position="4895,313">[[Chute1]] 

Something in this area should be the ear-bones (maybe the anvil is actually being used as an anvil!)

- whispering keepers live in its ears
- they know a way to leave but before you can take it you hear about the ledger and what it does so decision to leave is more interesting
- The person up here won&#39;t want to talk to you unless you&#39;re clean</tw-passagedata>
<tw-passagedata pid="105" name="Chute1" tags="" position="4998,1060">- inside the spinal coloumn, takes you down past the vaults (which are between the ribs, partially)

- can abseil down on rope and arrive who-knows-where

- can get stuff from a bird&#39;s nest on a narrow ledge (push-your-luck)

[[Underbelly1]]</tw-passagedata>
<tw-passagedata pid="106" name="Vaults1" tags="" position="2328,980">- in sections that are below ground level, huge lateral arches of bones turn out to be ribs, commensurate in size with the skull above
- can see down into the chest cavity from places: mostly hollow, heart dangles in centre, pit visible way down below (where diaphragm would be)
- older than library and entrance hall
- darker stone, not local stone
- murals on walls (cataclysms, ledgers)
- some kind of arena, where people fought with blindfolds
- some sort of organised religion happens somewhere here, tolerated by pit crew, left to own devices

[[Underbelly1]] 
[[Heart1]]</tw-passagedata>
<tw-passagedata pid="107" name="LowerLibrary1" tags="" position="4012,1964">- full of rot
- books mostly ruined
- very tall, lit from above
- one wall is skull-exterior

[[UpperLibrary1]]
[[Chute1]] 
[[Underbelly1]] </tw-passagedata>
<tw-passagedata pid="108" name="Middens1" tags="" position="3083,2685">- where some people (including the jailer) make their home
- ad-hoc structures, reinforcements
- squeezed under pressure of buildings around it, built in cracks
- traps and ambushes

- if playertags contains released, the jailer might be here somewhere and you can chat in a way that is less adversereal (maybe)

[[UpperLibrary1]] 
[[LowerLibrary1]] 
[[Vaults1]] </tw-passagedata>
<tw-passagedata pid="109" name="UpperLibrary1" tags="" position="3733,1000">- not damp as below
- books are in strange languages but some stuff can be gleaned
- large sections have all books torn out

[[Rooftop1]]</tw-passagedata>
<tw-passagedata pid="110" name="Underbelly1" tags="" position="3748,2848">- the base of the ribcage, below the chest cavity
- you must avoid wherever the rumbling is coming from

[[Heart1]] 
[[ThePit1]] 
[[Comb1]]</tw-passagedata>
<tw-passagedata pid="111" name="Heart1" tags="" position="3484,1420">- a horrific creature lives inside this tattered leather tent-looking thing in the centre of the chest-cavity</tw-passagedata>
<tw-passagedata pid="112" name="Comb1" tags="" position="3100,3712">- a labyrinth of porous rocks with a beast inside who must be avoided in darkness. Nobody in living memory has made it past the beast alive, hence why the pit crew are digging: trying to find a way around it. However, they&#39;re digging in the wrong direction.

What was once a town square with shopfronts
[[Depths1]] </tw-passagedata>
<tw-passagedata pid="113" name="Depths1" tags="" position="3260,4328">[[Crucible]] </tw-passagedata>
<tw-passagedata pid="114" name="Crucible" tags="" position="3332,4832"></tw-passagedata>
<tw-passagedata pid="115" name="jailerFiguresResponse" tags="" position="478,2935">(move: &quot;stooped figures&quot; of &quot;people&quot; of $knowledge into $trash)
(set: &quot;people&quot; of $knowledge to it + (datamap: &quot;Pit Crew&quot;, &quot;Indentured labourers toil below the earth to some unknown purpose, swelling their ranks with isolated travellers such as yourself.&quot;)) &#39;The Pit Crew. Sorry bastards, really. Even when they let them out to hunt, they leave them in chains so as to make sure that they&#39;d die if they tried to cross the desert. Digging, constantly, the rest of your days, towards who-knows. But you&#39;ll find out all you want to know, soon enough. Just (print: 6-$tallmarks) days to go.&#39;</tw-passagedata>
<tw-passagedata pid="116" name="Hallway4" tags="" position="2652,1856">- damp floor
- corridors stink
- evidence of people moving about

[[LowerLibrary1]]</tw-passagedata>
<tw-passagedata pid="117" name="Hallway3a" tags="" position="2665,2235">Notches and scraps of wood indicate that there were once wooden turnstiles between these pedestals, although the wood has long-since been scavenged. You realise that this is a recieving chamber, not unlike the entrance halls of most civic buildings. Visitors would enter through the now-sealed archway and hold discourse with an official at one of these lecterns before being admitted into the building via the small doors behind you. But visitors from where? There is nowhere else for miles around. And to what purpose? (if: (history:)&#39;s (range:1,((history:)&#39;s length-1)) contains &quot;Hallway3a&quot;)[](else:)[(set: &quot;the skull&quot; of &quot;places&quot; of $knowledge to (string: &quot;the skull&quot; of &quot;places&quot; of $knowledge + &quot; People once travelled here from far away. Some areas have an architecture that recalls the place of your birth.&quot;))]

[[the room|hallway 3]]</tw-passagedata>
<tw-passagedata pid="118" name="Hallway3b" tags="" position="2670,2106">(if: not ((datanames: &quot;history&quot; of $knowledge) contains &quot;sign of linked circles&quot;))[(set: &quot;history&quot; of $knowledge to it + (datamap: &quot;sign of linked circles&quot;, &quot;A symbol made of several overlapping circles has been rudely painted on a collapsed doorway in the Recieving Hall.&quot;))]A sign of linked circles, painted on the rockface.

[[the room|hallway 3]]</tw-passagedata>
<tw-passagedata pid="119" name="Hallway5" tags="" position="2395,1945">

[[towards the library|Hallway4]]
[[towards the vaults|Vaults1]]</tw-passagedata>
<tw-passagedata pid="120" name="ConversationResponseStage2" tags="" position="1344,480">(if: $displayInterjections is true)[\
	(display: $interjections&#39;s 1st)]</tw-passagedata>
<tw-passagedata pid="121" name="Hallway5a" tags="" position="2596,2363">(if: $totalGhostVisits is $ghostConvos&#39;s length)[The ghosts continue to walk in their pensive rows, but there is nothing else for you to learn from them.]\
(elseif: $lastGhostVisit is -1)[Through the green glass, you see a parade of spectres, dressed in clothing that recalls the Ceremoninal Attire of your homeland, but with one particular difference: Every one of these people wears a silver mirror prominently on their breast. You&#39;ve never seen anything quite like it. (set: &quot;history&quot; of $knowledge to it + (datamap:&quot;strange spectral attire&quot;,&quot;The spectres that you saw through the glass wore clothes very simillar to your own, but with the curious addition of a mirrored amulet.&quot;))

	(display: $ghostConvos&#39;s 1st)\
	(set: $ghostConvos to (rotated: 1, ...$ghostConvos))\
	(set: $totalGhostVisits to it + 1)\
](elseif: $lastGhostVisit &lt; $timeindungeon)[\
	(display: $ghostConvos&#39;s 1st)\
	(set: $ghostConvos to (rotated: 1, ...$ghostConvos))\
	(set: $totalGhostVisits to it + 1)\
](elseif: $lastGhostVisit is $timeindungeon)[The ghosts look much as they did when last you looked. Time trickles slowly by.]

(set: $lastGhostVisit to $timeindungeon)\
[[put the glass away|hallway 3]]</tw-passagedata>
<tw-passagedata pid="122" name="InitialiseGhosts" tags="" position="316,512">(set: $lastGhostVisit to -1)
(set: $ghostConvos to (a:&quot;Ghosts1&quot;, &quot;Ghosts2&quot;, &quot;Ghosts3&quot;))
(set: $ghostConvos to (shuffled: ...$ghostConvos))
(set: $totalGhostVisits to 0)
(goto: &quot;Intro0&quot;)</tw-passagedata>
<tw-passagedata pid="123" name="Ghosts1" tags="" position="70,2410">As they stand in an unmoving queue before a lectern, one figure turns and speaks to the figure behind it. As you peer through the glass, you make out their words.

&#39;If he survives the arena, then I believe this cycle&#39;s applicant will be the one to fell the beast. In my heart, I believe it is possible.&#39;

&#39;You place too much hope in him. The arena&#39;s function is to find the strongest among us. Whether this person will be strong enough to contend with the beast is quite another issue. It is illogical to assume that one follows the other.&#39;

&#39;But if not him, then who? For surely it is our right as a people to fell the beast?&#39;

Someone shushes them. Silence resumes. (if: (datanames: &quot;places&quot; of $knowledge) contains &quot;what&#39;s below&quot;)[(set: &quot;what&#39;s below&quot; of &quot;places&quot; of $knowledge to (string: &quot;what&#39;s below&quot; of &quot;places&quot; of $knowledge +  &quot; At some point in the past, people would compete for the right to contend with it.&quot;))](else:)[(set: &quot;places&quot; of $knowledge to it + (datamap:&quot;what&#39;s below&quot;,&quot;At some point in the past, people would compete for the right to contend with some foul thing that lives below the structure.&quot;))]</tw-passagedata>
<tw-passagedata pid="124" name="Ghosts2" tags="" position="65,2535">At the lectern sits a functionary dressed in the flamboyant robes of her caste. She pours thick scorn onto a supplicant who has had his petition notarised by an official of inferior rank. Her lips move:

&#39;This form does not qualify you to access the library. It is  poorly-done. The quality of your penmanship is likewise inferior. You would do well to return to your station and do not trouble us again until you can find a notary not drunk on pigswill.&#39;

The man departs, shame-faced.{
(set: $knowledgeCategory to &quot;places&quot;)
(set: $knowledgeName to &quot;the library&quot;)
(set: $appendedKnowledge to &quot;The library was somewhere that only certain people were permitted to enter, with correct authorisation.&quot;)
(set: $newKnowledge to &quot;There is a library somewhere inside the skull, but the people that built it would only allow particular visitors access to it.&quot;)
(display: &quot;KnowledgeAppender&quot;)
}</tw-passagedata>
<tw-passagedata pid="125" name="Ghosts3" tags="" position="69,2663">In one corner of the room, a man in the reinforced leathers of an Enforcer scans the assembled lines. He wears an expression of concern.

As they stand in their neat columns, the spectres look suddenly uneasy. The ground below them seems to shake, and they look about, uncertain if they are permitted to flee. Then there is some kind of noise - many of them cover their ears and drop to their knees. Their faces betray intense pain. Abruptly, the room is still again. Some stand up, and one runs towards the now-blocked doorway.

&#39;Faith preserve us,&#39; he says, his words echoing across time. &#39;It&#39;s gone. The city - the palace - everything - it&#39;s all disappeared - nothing remains but naked earth -&#39;

The ghosts begin to panic. The glass clears.{
(set: $knowledgeCategory to &quot;places&quot;)
(set: $knowledgeName to &quot;the bone-bare plain&quot;)
(set: $appendedKnowledge to &quot; Impossible as it seems, there was once a sprawling city atop the plain. It vanished suddenly at some indeterminate point in the past.&quot;)
(set: $newKnowledge to &quot;FOOBAR.&quot;)
(display: &quot;KnowledgeAppender&quot;)
}</tw-passagedata>
<tw-passagedata pid="126" name="Entrance5" tags="" position="1825,2096">The figure of the jailer shifts around outside. (set: $songStorylet to true)

&#39;Stop that,&#39; he yells.

[[stop singing|Entrance2]]
[[keep singing|Entrance5a]]</tw-passagedata>
<tw-passagedata pid="127" name="Entrance5a" tags="" position="1830,2261">(set: &quot;patience&quot; of $jailer to it - 1) &#39;I said stop that, you maggot filth, or I&#39;ll have you!&#39; 

[[keep singing|Entrance5b]]
[[stop singing|Entrance2]]</tw-passagedata>
<tw-passagedata pid="128" name="Entrance5b" tags="" position="1973,2090">(set: &quot;patience&quot; of $jailer to it - 1)The jailer bangs on the door with something heavy. &#39;Listen, runt. I&#39;m serious. You stop that right now or you&#39;ll regret it.&#39;(if: $playerTags contains &quot;boundhands&quot;)[ Your hands are still bound. If he&#39;s armed, you&#39;re not sure if you could overpower him.]

[[keep singing|Entrance5c]]
[[stop singing|Entrance2]]</tw-passagedata>
<tw-passagedata pid="129" name="Entrance5c" tags="" position="1976,2263">The door bursts open. The jailer&#39;s low-slung bulk is silhouetted against the opening. (if: $playerTags contains &quot;boundhands&quot;)[&#39;Right,&#39; he says. &#39;I warned you. I won&#39;t have you putting me in danger, caterwauling for all to hear.&#39; He advances. &#39;Yeah, that&#39;s right,&#39; he says. &#39;Danger. It&#39;s a rough establishment, out there in the Cranium. Not wise to make too much noise. Not at all.&#39; He carries a large chunk of stone. It swings towards your head, knocks you to the ground. &#39;It&#39;s no big loss to me,&#39; he says. &#39;I won&#39;t get my extra rations but I won&#39;t be eviscerated by some foul creature drawn by your singing, neither. I&#39;ll just tell the Boss that you died.&#39; 

[[thrash about|Entrance5d]]
[[plead|Entrance5d]]](else:)[ He is carrying a huge piece of rock in one hand, and a short, wicked knife in the other. The muscles on his arms are rounded and glossy. Light glints off a gold tooth.

[[rush him|Entrance5d]]
[[cower|Entrance5e]]
(if: $inv contains &quot;shard of green glass&quot; or $inv contains &quot;empty wine bottle&quot;)[[brandish your glass weapon|Entrance5f]]]</tw-passagedata>
<tw-passagedata pid="130" name="Entrance5d" tags="" position="2150,2228">He grabs your legs. You thrash about, but he&#39;s stronger. He drags you out of the cell, through a crack in a wall. Your shoulders are grazed and bloody as you&#39;re pulled down a flight of stairs. He heaves you off the ground, and you feel yourself shoved into a narrow opening in the wall. (set: $playerTags to it + (a: &quot;released&quot;))

[[you begin to fall|CorpseChute0]]</tw-passagedata>
<tw-passagedata pid="131" name="CorpseChute0" tags="" position="3146,2925">-not a big section, just a spacer page between the hallway and wherever this chute goes
(set: $filth to it + 5)</tw-passagedata>
<tw-passagedata pid="132" name="Entrance5e" tags="" position="1971,2403">&#39;You bloody idiot,&#39; he says, and punches you in the ear. &#39;Let that be a lesson.&#39;

The door closes again behind him.

[[back to square one|Entrance2]]</tw-passagedata>
<tw-passagedata pid="133" name="Entrance5f" tags="" position="2140,2401">A smile flickers in the corner of his mouth. &#39;Oh, hark at this one,&#39; he says. &#39;Gonna stick me with that little fragment, are you? Hm?&#39; he spits. &#39;Got some fight in him, this one. Perhaps that&#39;s why...&#39; but he stops himself, and then lets out a laugh. &#39;Oh, go on then,&#39; he says. &#39;My back aches bad enough. You&#39;ll only give me more trouble, I can tell. And they don&#39;t pay me barely a pittance. I&#39;ve little loyalty. Get gone.&#39;

(link: &quot;he releases you&quot;)[(goto:&quot;JExitPlayer&quot;)]</tw-passagedata>
<tw-passagedata pid="134" name="ConversationOptions" tags="" position="1216,350">talk about a person (clickreplace: &quot;talk about a person&quot;)[ask about (print: (datanames: &quot;people&quot; of $knowledge).join(&quot;
ask about &quot;)){
(set: $peopleNumber to (datanames: (&quot;people&quot; of $knowledge))&#39;s length)\
(set: $i to 0)\
[(display: &quot;PeopleConversationLooper&quot;)]&lt;peopleLoop|
}]\

talk about a place (clickreplace: &quot;talk about a place&quot;)[ask about (print: (datanames: &quot;places&quot; of $knowledge).join(&quot;
ask about &quot;)){
(set: $placesNumber to (datanames: (&quot;places&quot; of $knowledge))&#39;s length)\
(set: $i to 0)\
[(display: &quot;PlacesConversationLooper&quot;)]&lt;placesLoop|
}]\

talk about a thing (clickreplace: &quot;talk about a thing&quot;)[ask about (print: (datanames: &quot;history&quot; of $knowledge).join(&quot;
ask about &quot;)){
(set: $historyNumber to (datanames: (&quot;history&quot; of $knowledge))&#39;s length)\
(set: $i to 0)\
[(display: &quot;HistoryConversationLooper&quot;)]&lt;historyLoop|
}]\

listen (click: &quot;listen&quot;)[(goto: &quot;ConversationInterjectionOnly&quot;)]\

(linkgoto: &quot;say farewell&quot;,&quot;playerExit&quot; of $interlocutor)</tw-passagedata>
<tw-passagedata pid="135" name="Entrance2Alt" tags="" position="1510,3001">The cell is tiny and squalid. The door hangs open. There is little to maintain your attention.

[[nothing keeps you here|Hallway 1]]</tw-passagedata>
<tw-passagedata pid="136" name="Devcon" tags="" position="60,676">get (link: &quot;bottle&quot;)[(set: $inv to it + (a:&quot;empty wine bottle&quot;))]
advance (link: &quot;time&quot;)[(set: $timeindungeon to it + 1)]
skip to (link: &quot;cell&quot;)[(goto:&quot;Entrance0&quot;)]
skip to (link: &quot;hallway&quot;)[(goto:&quot;Hallway 1&quot;)]
skip to (link:&quot;enslavement&quot;)[(set: $timeindungeon to 3)(goto:&quot;DescentToPit&quot;)]</tw-passagedata>
<tw-passagedata pid="137" name="KnowledgeAppender" tags="" position="1248,25">{
(if: (datanames: $knowledgeCategory of $knowledge) contains $knowledgeName)[
(set: (string:$knowledgeName) of $knowledgeCategory of $knowledge to (string: $knowledgeName of $knowledgeCategory of $knowledge + &quot; &quot; + $appendedKnowledge))]
(else:)[(set: (string:$knowledgeCategory) of $knowledge to it + (datamap: (string:$knowledgeName), (string:$newKnowledge)))]
}</tw-passagedata>
<tw-passagedata pid="138" name="Slavery0" tags="" position="4948,3104">(set: $dayofarrival to $timeindungeon)

(set: $croachOpinion to 1)\
(set: $daylastspoketoCroach to 0)\
\
(set: $shadOpinion to 2)\
(set: $shadHealth to 5)\
(set: $daylastspoketoShad to 0)\
\
(set: $impoundedGoods to $inv)\
(set: $inv to (a:))\
\
(set: $resistanceStarted to false)\
(set: $resistance to 0)\
\
(set: $shadHealthArray to (a:&quot;Shad looks to be lingering on death&#39;s doorstep.&quot;,&quot;Shad looks like another day of hard work could kill them.&quot;,&quot;Shad is clearly exhausted.&quot;,&quot;Shad looks like someone hanging to their last scrap of strength.&quot;,&quot;Shad looks thin and unsteady.&quot;))

(set: $shadOpinionArray to (a:&quot;They mutter obscene words when you are near them.&quot;,&quot;They refuse to meet your eye.&quot;,&quot;They appraise you with a flat expression.&quot;,&quot;They give you a small nod of solidarity.&quot;,&quot;They look at you like you are their only hope.&quot;))

(set: $croachOpinionArray to (a:&quot;Croach glares ar you with undisguised malice.&quot;,&quot;Croach&#39;s sneering gaze singles you out. He leers at you.&quot;,&quot;Croach doesn&#39;t even seem to see you during his morning inspection.&quot;,&quot;Croach nods when you fall under his gaze.&quot;,&quot;Croach points his gap-toothed grin at you, his favourite slave.&quot;))

(set: $slaveryEventCards to (a: &quot;CroachDrunkDay&quot;, &quot;MaggotAttack&quot;, &quot;CroachRandomSearch&quot;, &quot;SlaveViciousness&quot;, &quot;QuietEvening&quot;,&quot;QuietEvening&quot;))
(set: $slaveryEventDeck to (shuffled: ...$slaveryEventCards))

(set: $resistanceArray to (a:&quot;If you were to attempt the uprising now, you would certainly fail. More preparations are needed.&quot;,&quot;You don&#39;t judge that the time is yet ripe for the uprising. Attacking the captors today would be a desperate thing.&quot;,&quot;Your preparations for the uprising thus far may not prove adequate&quot;,&quot;The time for the attack is near. There is little more you could do to prepare. One more day might make all the difference, or you could try to attack now.&quot;,&quot;You have prepared all you can. Weapons are hidden, your manacles are weakened, and you have worked out which guard has the keys. You are ready for the uprising.&quot;))

Win states: 
Get Croach respect up to five to escape to Maggotzone
Get Resistance up to five (by getting Shad up) to get in control
Get Croach respect up high enough to tell him he&#39;s digging in the wrong place

Unfavourable exit states:
Your health gets too low: placed as bait for maggot? Resistance is set back? Given to the Cultists as a sacrifice?
Shad can die, which is a pain, but you&#39;re still trapped

(goto:&quot;Slavery0A&quot;)</tw-passagedata>
<tw-passagedata pid="139" name="InitialiseFriend" tags="" position="236,3724">(set: $friend to (datamap:))

(set: &quot;maxpatience&quot; of $friend to 5)
(set: &quot;patience&quot; of $friend to 5)
(set: &quot;timelastmet&quot; of $friend to 0)

(set: &quot;responses&quot; of $friend to (datamap:
&quot;Arbiters&quot;,
&quot;&#39;Fools, confusing rigour with righteousness. You do well to fear the tyranny of the trivial. They disgust me.&#39;&quot;,

&quot;Traveller&#39;s Friend&quot;,
&quot;&#39;I&#39;ve told you all I will about myself. I am here to help, as is my perogative. If you will travel across this plain, then I will come no further with you. My time with you is over.&#39;&quot;,

&quot;the bone-bare plain&quot;,
&quot;&#39;You asked to come this way, not I. I merely helped. We are here now. It is a bad place, and I will go no further with you.&#39;&quot;,

&quot;the skull&quot;,
(display: &quot;skullResponse&quot;),

&quot;the Administration&quot;,
&quot;&#39;It would be right for their archives to burn to the ground. Such talk would have my tongue cut out, no doubt. A blood-notary would daub his affadavit with the stump. Ha! They think that this would mean they owned me. You would do well to leave that world behind for good.&#39;&quot;,

&quot;Children&#39;s Song&quot;, 
&quot;&#39;My own daughter used to sing it, many years ago, before I stopped her.&#39;&quot;,

&quot;my destination&quot;,
&quot;&#39;It is as we have discussed. Across this plain, to the East. There, you can see it even now. At the base of that mountain is a trail used by goatherds. It leads to the Gold Road. From there, the way is simple, although you have a great many miles left to walk.&#39;&quot;,
))

(set: &quot;opinions&quot; of $friend to (datamap:
&quot;Arbiters&quot;,-3,
&quot;Traveller&#39;s Friend&quot;,-2,
&quot;the bone-bare plain&quot;,-1,
&quot;the skull&quot;,-1,
&quot;the Administration&quot;,-4,
&quot;Children&#39;s Song&quot;, 1,
&quot;my destination&quot;, -1
))

(set: &quot;attitudes&quot; of $friend to (datamap:
&quot;warm1&quot;,&quot;She turned to face you, and you see the black pinpricks of her eyes peered out at you from behind scraps of cloth.&quot;,
&quot;warm2&quot;,&quot;She seemed to sag in her saddle for a moment, and looked up at the sky.&quot;,
&quot;cool1&quot;,&quot;Her fingers tightened on the reins.&quot;,
&quot;cool2&quot;,&quot;She shifted around in her saddle, as if suddenly uncomfortable.&quot;,
&quot;cold1&quot;,&quot;Her horse snorted as she dug her feet into its gaunt sides.&quot;,
&quot;cold2&quot;,&quot;She straightened her back, and pointed her horse back the way you came.&quot;,
))

(set: &quot;interjections&quot; of $friend to (a:&quot;TFQuestion&quot;,&quot;TFBrushOff&quot;,&quot;TFCoughs&quot;))

(set: &quot;iDontKnow&quot; of $friend to
(a:&quot;&#39;I don&#39;t know anything about that.&#39;&quot;, &quot;&#39;I&#39;m not interested in this.&#39;&quot;))

(set: &quot;playerExit&quot; of $friend to &quot;TFExitPlayer&quot;)

(set: &quot;exit&quot; of $friend to &quot;TFExit&quot;)

(set: &quot;topicsDiscussed&quot; of $friend to (a:))
</tw-passagedata>
<tw-passagedata pid="140" name="InitialiseJailer" tags="" position="51,2930">(set: $jailer to (datamap:))

(set: &quot;maxpatience&quot; of $jailer to 5)
(set: &quot;patience&quot; of $jailer to 5)
(set: &quot;timelastmet&quot; of $jailer to 0)

(set: &quot;responses&quot; of $jailer to (datamap:
&quot;the cell&quot;,
&quot;&#39;This is where we keep fools who think they can sneak into our fortress. Like you. You ain&#39;t the first, and you won&#39;t be the last.&#39;&quot;,

&quot;Traveller&#39;s Friend&quot;,
&quot;&#39;That old bitch lured you in eh? If you didn&#39;t already learn your lesson from your current predicament, don&#39;t know that what I can say will help you much&#39;&quot;,

&quot;the skull&quot;,
(display: &quot;jailerSkullResponse&quot;),

&quot;the ledger&quot;,
(display: &quot;jailerLedgerResponse&quot;),

&quot;stooped figures&quot;,
(display: &quot;jailerFiguresResponse&quot;),

&quot;something below&quot;,
&quot;&#39;Your labour will be good or you&#39;ll find out soon enough, sunshine.&#39;&quot;,

&quot;The Black Ledger&quot;,
&quot;&#39;You deserve to be in this cell, scum&#39;&quot;,

&quot;Children&#39;s Song&quot;,
&quot;&#39;It chills my blood to hear those words. You stay silent or I&#39;ll have to whip you. She&#39;d hate to be called a maid! I daresay she wouldn&#39;t let the child live who sung that song.&#39;&quot;
))

(set: &quot;opinions&quot; of $jailer to (datamap:
&quot;the cell&quot;,-1,
&quot;Traveller&#39;s Friend&quot;,-1,
&quot;the skull&quot;,0,
&quot;the ledger&quot;,0,
&quot;The Black Ledger&quot;, -5,
&quot;Children&#39;s Song&quot;, -1,
&quot;stooped figures&quot;, 1,
&quot;something below&quot;, 1,
))

(set: &quot;attitudes&quot; of $jailer to (datamap:
&quot;warm1&quot;,&quot;The black outline of his face cracks to reveal shards of yellow. A gap-toothed smile.&quot;,
&quot;warm2&quot;,&quot;He wheezes, and exhales slowly but calmly&quot;,
&quot;cool1&quot;,&quot;He breathes in, his features narrowing.&quot;,
&quot;cool2&quot;,&quot;You notice the shape change, as the jailer turns away.&quot;,
&quot;cold1&quot;,&quot;You hear the unmistakable sound of a knife drawing from a sheath.&quot;,
&quot;cold2&quot;,&quot;The jailer turns away, his large frame blocking the light almost completely.&quot;,
))

(set: &quot;interjections&quot; of $jailer to (a:&quot;JQuestion&quot;,&quot;JBrushOff&quot;, &quot;JSneer&quot;))

(set: &quot;iDontKnow&quot; of $jailer to
(a:&quot;&#39;I don&#39;t know anything about that.&#39;&quot;, &quot;&#39;I&#39;m not paid to stand here and chat.&#39;&quot;))

(set: &quot;playerExit&quot; of $jailer to &quot;JExit&quot;)

(set: &quot;exit&quot; of $jailer to &quot;JExit&quot;)

(set: &quot;topicsDiscussed&quot; of $jailer to (a:))
</tw-passagedata>
<tw-passagedata pid="141" name="SlaveryDaytime" tags="" position="5239,3952">The day begins. (print: $healthfeeling2&#39;s $health)

(if: $shadHealth&gt;0)[(print: $shadHealthArray&#39;s $shadHealth)  (print: $shadOpinionArray&#39;s $shadOpinion)

]\
(print: $croachOpinionArray&#39;s $croachOpinion)(if: $resistanceStarted)[

(print: $resistanceArray&#39;s $resistance)

]
 
With no time wasted, a shovel is thrust into your hand. The gang lines up on the rough-dug floor of the pit. The person at the front calls out a chant, and you all begin to dig in unison.

[[put your back into it|slaveryHard]]
[[work slowly to conserve your strength|slaveryEasy]]
(if: $shadHealth&gt;0)[[[take some of Shad&#39;s burden|slaveryHelp]]]
(if: $resistanceStarted)[[[hide tools for the resistance|slaveryResistance]]]
(if: $resistance&gt;3)[[[smash your shackles with a shovel and launch the attack|slaveryUprising]]]

(display: &quot;GenericActions&quot;)</tw-passagedata>
<tw-passagedata pid="142" name="SlaveryEvent" tags="" position="6106,3943">(if: $shadHealth  is 0)[(set: $shadHealth to -1)(display: &quot;ShadDeath&quot;)]\
(else:)[\
(display: $slaveryEventDeck&#39;s 1st)\
(set: $slaveryEventDeck to (rotated: 1, ...$slaveryEventDeck))]</tw-passagedata>
<tw-passagedata pid="143" name="SlaveryNight" tags="" position="5441,4711">A small amound of time remains yours, to dispose of how you will.

(if: ($timeindungeon-1 &gt; $daylastspoketoCroach) and (either: true, true, false))[(link:&quot;approach Croach as he makes his rounds and speak to him&quot;)[(set: $daylastspoketoCroach to $timeindungeon)(goto:&quot;CroachConv&quot;)]](else:)[Croach does not appear this night, so you have little chance to approach him.]

(if: $shadHealth&gt;0 and ($timeindungeon-1 &gt; $daylastspoketoShad) and (either: true, true, false))[(link:&quot;talk to Shad&quot;)[(set: $daylastspoketoShad to $timeindungeon)(goto:&quot;ShadConv&quot;)]](elseif: $shadHealth&gt;0)[Shad seems to be fast asleep.]

(link: &quot;try to rest&quot;)[(goto: &quot;SlaveryNightEnd&quot;)]

(if: $resistanceStarted)[(link: &quot;discreetly weaken your shackles instead of sleeping&quot;)[(set: $health to it - 1)(set: $resistance to it + 1)(goto: &quot;SlaveryDaytime&quot;)]]{

(if: $health &lt; 1)[(goto:&quot;SlaveryDeath&quot;)]
(if: $shadHealth &lt; 5)[(set: $shadHealth to 5)]
(if: $shadOpinion &lt; 5)[(set: $shadOpinion to 5)]
(if: $croachOpinion &lt; 5)[(set: $croachOpinion to 5)]}

(display: &quot;GenericActions&quot;)</tw-passagedata>
<tw-passagedata pid="144" name="slaveryHard" tags="" position="5648,3776">(set:$health to it - 1)\
(set: $shadHealth to it - 1)\
(set: $croachOpinion to it + 1)\
(set: $filth to it + 2)\
\
(if: $dayofarrival is $timeindungeon)[(display: &quot;SkullsInMineDiscovery&quot;)

]\
\
(either: &quot;The day wears by with agonising slowness. Blisters form and burst on your hands from the handle of the shovel.&quot;,&quot;Another gang is charged with operating wheelbarrows and a winching mechanism to clear away the dirt you shovel up. Today, they are barely able to keep pace with you.&quot;, &quot;You are like a machine, pawing huge clods of dirt out of the ground.&quot;)

The other miners don&#39;t like to see you working so hard, as your exertions raise the standard of the group and make them appear idle by comparison. This puts them in a dangerous position. As such, nobody will speak to you all day. Croach takes notice, however.

(either: &quot;There is no way to tell the position of the sun down here, so you mark your time by observing how often the lanterns need refilling. Eventually, Croach appears at the lip of the pit, far above you, and yells something indistinct. The chain gang downs tools.&quot;, &quot;You shovel countless skulls out of the soggy earth. You wonder, for the thousandth time, how the ground came to be so deeply seeded with skulls.&quot;)

[[you collapse, exhausted|SlaveryEvent]]</tw-passagedata>
<tw-passagedata pid="145" name="slaveryEasy" tags="" position="5650,3903">(set:$health to it + 1)\
(set: $filth to it + 1)\
\
(if: $dayofarrival is $timeindungeon)[(display: &quot;SkullsInMineDiscovery&quot;)

]\
\
(either: &quot;The others in the chain clearly do not work hard enough for Croach, who beats them savagely at the end of the day as an example to the rest of you. It is unclear how much more of this treatment Shad could survive.&quot;,&quot;Croach makes occasional appearances and doles out beatings at random, but you avoid the worst of it by seeming to dig harder when he is nearby. He notices the deception, however, when he sees your barrow lying half-empty. He blackens your eye, but it&#39;s a small price for a day that doesn&#39;t leave your back feeling broken.&quot;,&quot;You spend the day digging slowly, maintaining a steady pace. The calluses on your hands begin to toughen up. Croach is displeased, however. It&#39;s not clear how much more of this pace he&#39;d accept.&quot;) (if: (either: true, false))[Croach has definitely noticed the slowness of your work.(set:$croachOpinion to it - 1)]

[[the call to down tools arrives at last|SlaveryEvent]]</tw-passagedata>
<tw-passagedata pid="146" name="slaveryHelp" tags="" position="5655,4035">(set:$shadOpinion to it + 1)\
(set:$shadHealth to it + 1)\
(set: $health to it - 1)\
(set: $filth to it + 1)\
\
(if: $dayofarrival is $timeindungeon)[(display: &quot;SkullsInMineDiscovery&quot;)

]\
(either: &quot;Shad soon realises what you are doing as you attempt to fill their barrow as well as your own. A look of gratitude crosses their face. Croach is disappointed with your meagre output and makes it known as he knocks you to the ground repeatedly.&quot;,&quot;Shad can barely carry their shovel, so you spend some time shovelling the area next to them to make it seem as though they&#39;ve dug farther than they have.&quot;) (if: (either: true, false))[Croach has definitely noticed the slowness of your work.(set:$croachOpinion to it - 1)]

[[evening arrives|SlaveryEvent]]</tw-passagedata>
<tw-passagedata pid="147" name="slaveryResistance" tags="" position="5656,4166">(set: $shadOpinion to it + 1)\
(set: $shadHealth to it - 1)\
(set: $filth to it + 1)\
\
(if: (either: true, true, false))[(set:$resistance to it + 1)(either:&quot;During your day, you take opportunities to steal anything not locked down and hide these useful objects in the walls of the pit behind loose rocks. A small trowel, a bit of wood, sharp rocks: All these objects can be made into impromptu weapons.&quot;,&quot;Today, by keeping a close eye on the Pit Crew, you are able to discern which of the guards has the keys to the locks on your chain and at what times the shifts change. There is one guard in particular who is smaller than the others and often does his shift drunk. You could easily overpower him.&quot;,&quot;Today, your shovel strikes the chain around your ankles more often than it strikes the dirt. You keep yourself up to your knees in mud to conceal the sparks. By the end of the day, the chain is significantly weaker, but so is the blade of the shovel, so you stop before the damage becomes too obvious.&quot;)]\
(else:)[(either:&quot;The Pit Crew seem to be particularly vigilant today, and you don&#39;t manage to make any meaningful preparation for fear of drawing attention to the plans already laid.&quot;,&quot;As you toil, something happens. Two guards notice something glinting in the dirt near where you just stashed the bone shiv you spent all morning discreetly assembling. You didn&#39;t hide it well enough. They come so close to discovering it that you dare not hide anything else all day.&quot;,&quot;Croach spends most of today lurking around in your general vicinity, telling lush tales of drunken exploits in towns you&#39;ve never heard of. You try to steal some time to work on your plans, but find little opportunity.&quot;)]

(if: (either: true, false))[Croach has definitely noticed the slowness of your work.(set:$croachOpinion to it - 1)]

[[the day passes slowly|SlaveryEvent]]</tw-passagedata>
<tw-passagedata pid="148" name="CroachDrunkDay" tags="" position="6391,4318">This evening, Croach has drunk more than usual, and some trivial thing provokes him into a rage.(set: $daylastspoketoCroach to $timeindungeon-1) Nobody is spared his wrath. The guards eye him fearfully as he stamps about the pit, kicking and frothing at the mouth.

(if: $shadHealth&gt;5)[[[i try to keep Shad safe|CroachDrunkDay1]]
]\
[[i keep out of the way|CroachDrunkDay2]]
[[i try to calm him down|CroachDrunkDay3]]</tw-passagedata>
<tw-passagedata pid="149" name="MaggotAttack" tags="" position="6065,5328">Suddenly, there comes a yelling from the top of the pit. Clods of earth fall from the above, and then a something long and white and wriggling squeezes itself through a narrow gap in the ceiling-stones and drops to the bottom of the pit near you.

&#39;The maggot!&#39; roars Croach. &#39;The maggot cometh!&#39;

It rears up, squirming as it is pelted by rocks and stones from the people around you. Mud streaks its translucent skin. A small ring of cruel hooked teeth flex, and it lunges towards one of the Crew. Its chest opens revealing an interior of polyps and fangs and half-digested bodies, and it slams down on this hapless crewman. It lands atop him, thrashes around, and then rears up again. He is gone. It twists about, searching for its next target. You still hold your shovel, but nobody else is still armed.
{
(set: $knowledgeCategory to &quot;people&quot;)
(set: $knowledgeName to &quot;the maggot&quot;)
(set: $appendedKnowledge to &quot;It attacks the denizens of the Pit periodically. They are powerless to prevent its raids, but would love to see it dead.&quot;)
(set: $newKnowledge to &quot;The maggot is a creature of senseless cruelty. It hangs pendulous in the heart of the fortress, making a feast of any denizen who enters its domain. The denizens of the Pit would love to see it dead, but they are powerless to overcome its speed and ferocity.&quot;)
(display: &quot;KnowledgeAppender&quot;)
}[[attack it|MaggotAttackA]]
[[flee|MaggotAttackB]]</tw-passagedata>
<tw-passagedata pid="150" name="CroachRandomSearch" tags="" position="6450,4750">Just as you&#39;re about to climb the ladder out of the pit, a horn sounds. Croach yells for everybody to stop and lie down. The denizens of the pit obey. He descends the ladder, which bows under his bulk. He sinks up to his shins in filth and grime as he lands.

&#39;Inspection!&#39; he says. &#39;I shall size thee up, my muddy compatriots.&#39;

He moves along the chain-bound rows, prodding the supplicant figures before him. (if: $resistanceStarted)[You realise with a start that he&#39;s about to put his stick into a patch of mud where you have stashed several sharpened bones wrapped in sackcloth, to use as blades for the uprising. 

[[do nothing and hope for the best|CroachRandomSearchA]]
[[attempt a distraction|CroachRandomSearchB]]
](else:)[(if:$croachOpinion&gt;3)[&#39;And thee!&#39; he says as he stands above you. &#39;Such busywork! Daily I see thou diggest most arduously, as if thou lovest the cool squelch of mud!&#39;(set: $croachOpinion to it + 1)(set:$shadOpinion to it - 1)](else:)[&#39;Thou art a worm like all the rest, and must do better if you&#39;re not to perish by my hand or one of my boys. This is no way to gain my preferment.&#39; (if: $playerTags contains &quot;impetuous&quot;)[As he departs, you make an obscene hand gesture at him. The others in the chain notice, approvingly.(set:$shadOpinion to it + 1)]]]

[[another wretched day comes to an end|SlaveryNight]]
</tw-passagedata>
<tw-passagedata pid="151" name="SlaveViciousness" tags="" position="5645,5465">(if: $croachOpinion&gt;3)[As you rest before the evening bowl of slop is handed round, some members of your gang from further up the chain surround you. &#39;Croach&#39;s little friend,&#39; one of them mutters, &#39;his special little lad, his plaything.&#39; Suddenly, they are upon you. You resist these pale forms as best you can but you still emerge bloody and stinging.(set: $health to it - 1)(set: $filth to it + 1)](else:)[The other slaves are in a nasty mood tonight, and prowl around, rattling their chains and decrying one another for laziness, avarice, heathen beliefs. They seem to come from all manner of different nations and systems of belief, but here they are united in theirsuffering, and in their spite for the human race.](if: $shadHeath&gt;0)[ Shad keeps their head down throughout.]

[[another wretched day comes to an end|SlaveryNight]]</tw-passagedata>
<tw-passagedata pid="152" name="SlaveryNightEnd" tags="" position="5038,4705">//check if slavery escaped in case you&#39;re talking to Shad afterwards, as their exit page redirects here//
//THIS IS THE BOUNCEOUT PAGE for if you&#39;re promoted//


(either: &quot;You bed down on the chilly floor and look at towards the little square of light that is the window of Croach&#39;s shack. You envy him his food and his rich ale, but most of all you envy him the warmth of his fire.&quot;,&quot;You bed down in a huddle with the other members of the chain gang, careless of personal space and of the reeking smell, seeking only warmth.&quot;,&quot;You doze fitfully, having dreams of pits and shovelling that you can scarce distinguish from your daily travails. A plague on this accursed place.&quot;, &quot;Another day comes to its desolate end with you searching for a patch of ground to sleep on devoid of water, filth, or other sleepers.&quot;)

(set: $timeindungeon to it + 1)
[[get what little sleep you can|SlaveryDaytime]]

(if: $croachOpinion&gt;5)[(goto:&quot;SlaveryPromotion&quot;)]</tw-passagedata>
<tw-passagedata pid="153" name="InitialiseCroach" tags="" position="90,4625">(set: $Croach to (datamap:))

(set: &quot;maxpatience&quot; of $Croach to 5)
(set: &quot;patience&quot; of $Croach to 5)
(set: &quot;timelastmet&quot; of $Croach to 0)

(set: &quot;responses&quot; of $Croach to (datamap:
&quot;Arbiters&quot;,
&quot;&#39;Fools, confusing rigour with righteousness. You do well to fear the tyranny of the trivial. They disgust me.&#39;&quot;,
))

(set: &quot;opinions&quot; of $Croach to (datamap:
&quot;Arbiters&quot;,-3,

))

(set: &quot;attitudes&quot; of $Croach to (datamap:
&quot;warm1&quot;,&quot;Croach gurgles and looks at you.&quot;,
&quot;warm2&quot;,&quot;He pulls a crust of bread from a pocket and offers it to you.&quot;,
&quot;cool1&quot;,&quot;Croach stares at you down his snout.&quot;,
&quot;cool2&quot;,&quot;Croach eyes you narrowly, before a noise across the floor takes his attention for a moment.&quot;,
&quot;cold1&quot;,&quot;Croach yawns and turns away from you, drinking deeply from a flask.&quot;,
&quot;cold2&quot;,&quot;Croach&#39;s eyes droop shut and his head lolls for a moment, before he snaps awake again.&quot;,
))

(set: &quot;interjections&quot; of $Croach to (a:&quot;CroachVomit&quot;,&quot;CroachYell&quot;,&quot;CroachSnort&quot;,&quot;CroachQuiet&quot;, &quot;CroachQuiet&quot;))

(set: &quot;iDontKnow&quot; of $Croach to
(a:))

(set: &quot;playerExit&quot; of $Croach to &quot;CroachExit&quot;)

(set: &quot;exit&quot; of $Croach to &quot;CroachExit&quot;)

(set: &quot;topicsDiscussed&quot; of $Croach to (a:))

(set: &quot;specialPatienceLevel&quot; of $Croach to &quot;CroachPatienceSet&quot;)</tw-passagedata>
<tw-passagedata pid="154" name="InitialiseShad" tags="" position="100,5245">(set: $Shad to (datamap:))

(set: &quot;maxpatience&quot; of $Shad to 5)
(set: &quot;patience&quot; of $Shad to 5)
(set: &quot;timelastmet&quot; of $Shad to 0)

(set: &quot;responses&quot; of $Shad to (datamap:
&quot;Arbiters&quot;,
&quot;&#39;I came here trying to escape their scrutiny, but I would give anything now to return to that life.&#39;&quot;,
&quot;the Administration&quot;,
&quot;&#39;They had such a capacity for cruelty, back in the old country, but the cruelty was of a different sort to this. Distant and indifferent. Here, it seems like every part of life is bent towards the ends of our discomfort.&#39;&quot;,
&quot;Traveller&#39;s Friend&quot;,
&quot;&#39;I too was escorted here by such a person, many years ago. I realise now that her intention must have been malign, but strangely I bare her no ill will.&#39;&quot;,
&quot;Pit Crew&quot;,
&quot;&#39;Spineless freaks. I despise them too. They have liberty enough - why do they not overpower Croach and leave him to rot?&#39;&quot;,
&quot;Croach&quot;,
&quot;&#39;I flinch at his every move. Please, I don&#39;t want to talk about him now. I spend every day fearful of him. That is horror enough. Let us keep his spectre at bay at night.&#39;&quot;,
&quot;Shad&quot;,
&quot;&#39;You know what this place does to you? It makes you forget who you are. I used to think a lot about freedom, of escaping from this chain, from this horrid building. Now, a good dream is one where I have a dry bit of sacking to sleep under, and where Croach is placid and not in a rage. Perhaps the world outside has vanished. Perhaps it isn&#39;t even there anymore.&#39;&quot;,
&quot;the maggot&quot;,
&quot;&#39;It lives in a chamber at the heart of the fortress. Sometimes it comes to feed on us. Once, Croach sent some boys to hunt it, but they never returned. I believe he leaves the corpses out for it, too. To placate it. Figures that&#39;ll keep it at bay, if it&#39;s well fed. I heard the guard talking...&#39;&quot;,
&quot;the bone-bare plain&quot;,
&quot;&#39;I was travelling North on the Gold Road when I became ill. For fear of contagion, my travelling companions threw off the wagon. For days I lay in the sun, crawling towards a creek that I thought I heard in the distance. I passed out at the edge of the bone-bare plain, and awoke down here.&#39;&quot;,
&quot;the skull&quot;,
&quot;&#39;The skull is the world, now. No sense thinking about the place outside.&#39;&quot;,
&quot;what&#39;s below&quot;,
(display: &quot;ShadWhatsBelow&quot;),
&quot;skull burial site&quot;,
&quot;&#39;What, we spend all day knee-deep in loamy skull-filled earth and you would sully our few hours of rest by recollecting it?&#39;&quot;,
&quot;hips burial site&quot;,
&quot;&#39;Another pit, somewhere else, just waiting to be dug... It makes no odds to me. The world outside this room, this pit, is as a vapour.&#39;&quot;,
&quot;the ledger&quot;,
(display: &quot;ShadLedger&quot;),
&quot;location of the Ledger&quot;,
&quot;&#39;I don&#39;t know why you&#39;d say such a thing. Never, never mention that again. Say not a word to Croach, nor to me neither. Why, if you&#39;re wrong, then you&#39;d condemn us to another lifetime&#39;s digging. And if you&#39;re right, then Croach might get what he wants. And how would you have come by such heretic knowledge? Be silent.&#39;&quot;,
))

(set: &quot;opinions&quot; of $Shad to (datamap:
&quot;Arbiters&quot;,-1,
&quot;the Administration&quot;,-2,
&quot;Traveller&#39;s Friend&quot;,-1,
&quot;Pit Crew&quot;, -2,
&quot;Croach&quot;, -2,
&quot;Shad&quot;, 0,
&quot;the maggot&quot;, -2,
&quot;the bone-bare plain&quot;, -2,
&quot;the skull&quot;, -2,
&quot;what&#39;s below&quot;, -2,
&quot;skull burial site&quot;, -3,
&quot;hips burial site&quot;, -2,
&quot;the ledger&quot;, -2,
&quot;location of the Ledger&quot;, -4,
))

(set: &quot;attitudes&quot; of $Shad to (datamap:
&quot;warm1&quot;,&quot;Shad shuffles a little closer to you.&quot;,
&quot;warm2&quot;,&quot;You feel the warmth of Shad&#39;s body as they rest against you.&quot;,
&quot;cool1&quot;,&quot;Shad stretches and tries to get comfortable.&quot;,
&quot;cool2&quot;,&quot;They look distracted as you talk.&quot;,
&quot;cold1&quot;,&quot;Shad moves away from you and settles down into the ground.&quot;,
&quot;cold2&quot;,&quot;Shad yawns.&quot;,
))

(set: &quot;interjections&quot; of $Shad to (a:&quot;ShadApples&quot;, &quot;ShadQuestions&quot;,&quot;ShadRumour&quot;, &quot;ShadQuiet&quot;, &quot;ShadQuiet&quot;, &quot;ShadQuiet&quot;))

(set: &quot;iDontKnow&quot; of $Shad to
(a:&quot;&#39;You tell me. I&#39;ve never heard anything about that.&#39;&quot;, &quot;&#39;What? Sorry, I wasn&#39;t listening.&#39;&quot;, &quot;&#39;Forgive me, I&#39;m very tired. I don&#39;t understand what you mean.&#39;&quot;))

(set: &quot;playerExit&quot; of $Shad to &quot;ShadExit&quot;)

(set: &quot;exit&quot; of $Shad to &quot;ShadExit&quot;)

(set: &quot;topicsDiscussed&quot; of $Shad to (a:))

(set: &quot;specialPatienceLevel&quot; of $Shad to &quot;ShadPatienceSet&quot;)</tw-passagedata>
<tw-passagedata pid="155" name="Template for conversations" tags="" position="60,808">//NB COPYPASTE THIS SOMEWHERE ELSE, DON&#39;T JUST TYPE YOUR SHIT INTO IT, YOU DIV, OR YOU&#39;LL HAVE TO WRITE THE WHOLE FUCKING THING OUT AGAIN//

(set: $XXX to (datamap:))

(set: &quot;maxpatience&quot; of $XXX to 5)
(set: &quot;patience&quot; of $XXX to 5)
(set: &quot;timelastmet&quot; of $XXX to 0)

(set: &quot;responses&quot; of $XXX to (datamap:
&quot;Arbiters&quot;,
&quot;&#39;Fools, confusing rigour with righteousness. You do well to fear the tyranny of the trivial. They disgust me.&#39;&quot;,
))

(set: &quot;opinions&quot; of $XXX to (datamap:
&quot;Arbiters&quot;,-3,

))

(set: &quot;attitudes&quot; of $XXX to (datamap:
&quot;warm1&quot;,&quot;&quot;,
&quot;warm2&quot;,&quot;&quot;,
&quot;cool1&quot;,&quot;&quot;,
&quot;cool2&quot;,&quot;&quot;,
&quot;cold1&quot;,&quot;&quot;,
&quot;cold2&quot;,&quot;&quot;,
))

(set: &quot;interjections&quot; of $XXX to (a:))

(set: &quot;iDontKnow&quot; of $XXX to
(a:))

(set: &quot;playerExit&quot; of $XXX to &quot;&quot;)

(set: &quot;exit&quot; of $XXX to &quot;&quot;)

(set: &quot;topicsDiscussed&quot; of $XXX to (a:))

(set: &quot;specialPatienceLevel&quot; of $XXX to &quot;&quot;) //Delete this if not doing anything unusual with patience.//</tw-passagedata>
<tw-passagedata pid="156" name="CroachExit" tags="" position="93,4760">&#39;I tire of talking to you, little wormling. Scurry off now.&#39;

(set: $daylastspoketoCroach to $timeindungeon)\
(display: &quot;ConversationExit&quot;)\
(if: $playerTags contains &quot;unchained&quot;)[(display: &quot;ThePit1&quot;)]
(else:)[(display: &quot;SlaveryNightEnd&quot;)]</tw-passagedata>
<tw-passagedata pid="157" name="ShadExit" tags="" position="100,5370">&#39;You should get some sleep,&#39; says Shad. &#39;That&#39;s enough talking for today.&#39;

(set: $daylastspoketoShad to $timeindungeon)
(display: &quot;ConversationExit&quot;)\
(display: &quot;SlaveryNightEnd&quot;)</tw-passagedata>
<tw-passagedata pid="158" name="CroachPatienceSet" tags="" position="236,4624">(set: &quot;patience&quot; of $interlocutor to $croachOpinion)
(if: $croachOpinion &gt; 4)[(set: $interjections to it +(a:&quot;CroachPromotion&quot;))]</tw-passagedata>
<tw-passagedata pid="159" name="ShadPatienceSet" tags="" position="229,5243">(set: &quot;patience&quot; of $interlocutor to $shadOpinion)
(if: $shadOpinion &gt; 4)[(set: $interjections to it +(a:&quot;ShadResistance&quot;))]</tw-passagedata>
<tw-passagedata pid="160" name="Slavery0A" tags="" position="4948,3244">The air is rich with the sound of clinking chains and groaning. The bag is pulled roughly off your head and you stare into the eyes of a face like a pig. Grey whiskers sprout unevenly from his sagging jowls. He reeks of distilled spirits and piss. 

&#39;Croach,&#39; he says. &#39;Thou wilt call me Croach. Thou art property of Croach.&#39; His voice is deep and drawling.

He swings a greasy paw towards your mouth, and when you flinch someone trips you from behind. You sprawl onto the floor. (if: not($playerTags contains &quot;boundhands&quot;))[(set: $playerTags to it + (a:&quot;boundhands&quot;))Your hands are bound with coarse hempen rope. ]Manacles are fitted to your feet. Your meagre possessions are taken away from you.
{
(set: $knowledgeCategory to &quot;people&quot;)
(set: $knowledgeName to &quot;Croach&quot;)
(set: $appendedKnowledge to &quot;Having met him, you can confirm his ill reputation.&quot;)
(set: $newKnowledge to &quot;Muscular and swine-faced, Croach is the master of the Pit, commanding the chain-gangs there with lazy cruelty.&quot;)
(display: &quot;KnowledgeAppender&quot;)
}
[[&#39;why have you brought me here?&#39;|Slavery0B]]
[[say nothing|Slavery0C]]</tw-passagedata>
<tw-passagedata pid="161" name="ShadApples" tags="" position="107,5552">&#39;You know what I miss? Applejack.&#39;

[[&#39;what&#39;s applejack?&#39;|ShadApplesA]]
[[&#39;trouble me not with the agony of reminiscence.&#39;|ShadAppledB]]</tw-passagedata>
<tw-passagedata pid="162" name="ShadApplesA" tags="" position="108,5702">Shad&#39;s face clounds over, briefly, with a look of contentment. &#39;It&#39;s strong liquor. Real strong. Peasants make it where I&#39;m from, upcountry. They take some of the season&#39;s cider, any that&#39;s too sour to drink or that&#39;s spoiled, and they leave it outside in a barrel until the ice forms, which doesn&#39;t take long, and every morning they break the ice and pull it out and throw it away, and they do that all winter until they&#39;re left with applejack. And when it&#39;s finished, let me tell you... You can barely see afterward.&#39; (set: $patience to it + 1)(set: $shadOpinion to it + 1)

(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="163" name="ShadAppledB" tags="" position="258,5702">Shad looks down at their chains. &#39;You&#39;re right, of course,&#39; they say. &#39;It only makes it worse.&#39;

(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="164" name="ShadQuestions" tags="" position="548,5556">&#39;So where are you from, stranger?&#39;

[[answer vaguely|ShadQuestionsA]]
(if: $playerJourney is &quot;wedding&quot;)[[[&#39;i hail from a city far to the west. i&#39;d be there still, had i not been called away for an accursed wedding.&#39;|ShadQuestionsB]]]\
(if: $playerJourney is &quot;census&quot;)[[[&#39;i hail from a city far to the west, but i was forced to travel for a census. misfortune befell me on that pointless journey.&#39;|ShadQuestionsB]]]\
(if: $playerJourney is &quot;exile&quot;)[[[&#39;i was exiled from my home because of a foolish altercation with an alderman. now i do not have a home.&#39;|ShadQuestionsB]]]
[[&#39;there was some purpose to my journey, but it seems to strange and remote in light of current circumstances that i can barely recall it&#39;|ShadQuestionsC]]

(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="165" name="ConversationInterjectionOnly" tags="" position="1348,348">(set: $patience to it - 1)\
(if: $patience &gt; 0)[\
{(if: $patience &gt; 3)[
(set: $tic to (string:&quot;warm&quot; + (string:(either: 1, 2))))]
(elseif: $patience &gt; 1)[
(set: $tic to (string:&quot;cool&quot; + (string:(either: 1, 2))))]
(else:)[
(set: $tic to (string:&quot;cold&quot; + (string:(either: 1, 2))))]
}(print: $tic of &quot;attitudes&quot; of $interlocutor) (set: $interjections to (rotated: 1, ...$interjections))\
\
(display: $interjections&#39;s 1st)
]\
(else:)[(display: &quot;exit&quot; of $interlocutor)]</tw-passagedata>
<tw-passagedata pid="166" name="DescentToPit" tags="" position="4900,2956">Your captor leads you by a rope tied around your neck as you descend down unknown passages. You try to keep your bearings and remember any turnings you make but this soon becomes impossible. The air becomes colder and damper as the journey carries on, and several times you slip and fall when the figure leading you neglects to draw your attention to a sudden drop.

[[little choice but to submit|Slavery0]]
[[make a break for it|DescentToPitA]]</tw-passagedata>
<tw-passagedata pid="167" name="Slavery0B" tags="" position="4844,3452">(set: $croachOpinion to it - 1)&#39;Shut thine mouth, filth,&#39; he says. &#39;You speak when Croach speaks to you. Understood? Don&#39;t say anything. Worm.&#39;

[[say nothing|Slavery0C]]
[[&#39;i&#39;ll not listen to you, vile crap-hound&#39;|Slavery0D]]</tw-passagedata>
<tw-passagedata pid="168" name="Slavery0C" tags="" position="4980,3752">&#39;This is the pit,&#39; says Croach, pulling you across the muddy floor to a precipice. From the dim light of torches, you can see you are in a vast stone cellar. The floor here is composed of slabs of white granite, but in the centre of the floor a great many of these have been removed, revealing the coarse earth below. You find yourself staring vertiginously down into a deep shaft. The sound of shovelling comes from below. A mechanism hoists debris to the surface, which is piled up in one corner. Bits of white show in the dirt.

&#39;A simple job is thine. Daily you shall descend. You will dig until we find that which we seek, or until you die. If thou shouldst see fit to disobey, one of my boys will whip thine haunches &#39;til they run bloody. If thou art a good worker, we might find better uses for thee.&#39; He gestures at a looming man, hunched low, who stands nearby. Chains connect his shoulder to his neck. He carries a bludgeon. Some kind of enforcer. {(if: (datanames:&quot;people&quot; of $knowledge) contains &quot;stooped figures&quot;)[(move: &quot;stooped figures&quot; of &quot;people&quot; of $knowledge into $trash)]

(set: $knowledgeCategory to &quot;people&quot;)
(set: $knowledgeName to &quot;Pit Crew&quot;)
(set: $appendedKnowledge to &quot;They guard the labourers in the Pit, their backs rounded off by the weight of chains. They are led by a foul man named Croach.&quot;)
(set: $newKnowledge to &quot;Cruel souls, twisted by years of darkness. They command a cohort of chain-gangs deep beneath the Skull, digging down for some unknown purpose. They are led by a foul man named Croach.&quot;)
(display: &quot;KnowledgeAppender&quot;)

}(set: $playerTags to it + (a:&quot;manacles&quot;))

[[a length of chain is affixed to your ankles|Slavery0E]]</tw-passagedata>
<tw-passagedata pid="169" name="Slavery0D" tags="" position="4820,3624">(set: $croachOpinion to it - 2)(set: $health to it - 1)&#39;Then you and Croach shall have a problem, thou boot-grime, thou streak o&#39; my piss.&#39; He kicks you in the head. He&#39;s strong.

You catch sight of a figure at the edge of the lamplight,  with ankles chained like yours. You see a sliver of admiration on its face. (set: $shadOpinion to it + 1)

[[i curse croach inwardly|Slavery0C]]</tw-passagedata>
<tw-passagedata pid="170" name="DescentToPitA" tags="" position="4816,3104">(chance to escape to another zone?)</tw-passagedata>
<tw-passagedata pid="171" name="Slavery0E" tags="" position="4988,3904">Croach gurgles as he trudges heavily away, and someone yanks the chain tied round your ankles.

&#39;Come away,&#39; says a figure off in the shadows. &#39;Come away with us now or he&#39;ll strike you for idleness, or one of his boys will. Look - hold your head low, like this.&#39; The figure stoops, endeavours to look pitiful, a simple feat. You realise that your chain leads to this person&#39;s manacled feet, and then snakes away towards a small cluster of figures. All are dressed in rags, smeared in grime.

&#39;My name is Shad,&#39; says the figure. &#39;I used to be the back of the chain, but I suppose now it&#39;s you.&#39;

If Shad&#39;s condition is testament to the trials of life in the pit, then you are right to be fearful. As you move off, en-masse, down the rickety ladder to the pit floor, Shad moves with agonised slowness. Their arms are thin and wasted, and their face hidden beneath grime and bruises. They strain to lift the shovel handed to them by the foreman. Shad won&#39;t live much longer under these conditions. (if: $health &lt; 2)[(set: $health to 2)]
{
(set: $knowledgeCategory to &quot;people&quot;)
(set: $knowledgeName to &quot;Shad&quot;)
(set: $appendedKnowledge to &quot;Shad labours in the depths of the pit. You do not know how Shad came to be here, or if they did anything to deserve this fate.&quot;)
(set: $newKnowledge to &quot;Shad labours in the depths of the pit. You do not know how Shad came to be here, or if they did anything to deserve this fate.&quot;)
(display: &quot;KnowledgeAppender&quot;)}
[[and so my time as indentured labour begins|SlaveryDaytime]]</tw-passagedata>
<tw-passagedata pid="172" name="SkullsInMineDiscovery" tags="" position="5645,3651">After only a few moments of digging, your shovel collides with something hard. It seems to be a large rock. You pry it out of the ground. You are about to throw it onto the wagon when you notice teeth protruding from the earth that clings to it. You clean it up a little and realise that this is not a rock, but a human skull. You cry out in alarm, but Shad just looks at you with resignation.

&#39;The ground here&#39;s full of them. Never any other part - just skulls. It doesn&#39;t matter. Throw it on the wheelbarrow.&#39;

You do so. Shad isn&#39;t lying: Over the coming days, you turn up hundreds of skulls like this. They go into the wheelbarrow with the excavated earth and another chain gang wheels them away to be disposed of.{
(set: $knowledgeCategory to &quot;history&quot;)
(set: $knowledgeName to &quot;skull burial site&quot;)
(set: $appendedKnowledge to &quot;The pit of skulls seems to correspond to the site where the Pit Crew are digging. The ground where they dig is rich with skulls, but no other body parts.&quot;)
(set: $newKnowledge to &quot;The area under the Skull where the Pit Crew have made their operation is rich with skulls. Strangely, no other bones seem to be down there. How did they get down there? What forgotten people did they belong to?&quot;)
(display: &quot;KnowledgeAppender&quot;)
}</tw-passagedata>
<tw-passagedata pid="173" name="ShadDeath" tags="" position="5920,4188">In the evening, as usual, the guards pass down small bowls of thin mushroom gruel for you to eat. A few slimy lengths of boiled fungus floating in dank water. The bowls are passed from hand to hand down the chains, and the hands are watched avariciously for signs of spillage, and to ensure that nobody takes more than their meagre share. As you are at the back of the chain, Shad is always the one to pass you your bowl. You stare at their hands intently, waiting for them to pass you your dinner. As your bowl approaches, Shad makes no move to take it. The person beyond Shad in the chain nudges them, but Shad does not respond. You look up at Shad&#39;s face. Their eyes are vacant, misty. Shad is dead.

After some time, the guards come and remove the body.
{
(set: $knowledgeCategory to &quot;people&quot;)
(set: $knowledgeName to &quot;Shad&quot;)
(set: $appendedKnowledge to &quot;Shad died quietly one evening. Life carried on much as before.&quot;)
(set: $newKnowledge to &quot;Shad is one of the slaves who labours in the pit.&quot;)
(display: &quot;KnowledgeAppender&quot;)}
[[another wretched day comes to an end|SlaveryNight]]</tw-passagedata>
<tw-passagedata pid="174" name="slaveryUprising" tags="" position="5241,3711">WOAH HERE WE GO NOW


(set: $playerTags to it + (a:&quot;revolution&quot;))
(set: $playerTags to it + (a:&quot;unchained&quot;))
(set: $inv to $impoundedGoods)</tw-passagedata>
<tw-passagedata pid="175" name="ShadResistance" tags="" position="360,5248">(set: $resistanceStarted to true)Shad comes close to you, whispers something quietly in your ear. &#39;There&#39;s a plan, you know... Some of the others... There are some guards who are sympathetic... Who resent Croach... Some are preparing for an uprising. Hiding bits of useful weapon, weakening their chains... They wait for the right moment to strike. Perhaps you should lay in some preparations...&#39;

(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="176" name="QuietEvening" tags="" position="5513,5465">(either:&quot;Something moves in the depths of the gruel you&#39;re given for dinner. You make sure to chew it thoroughly.&quot;,&quot;A slave in another gang drops dead. The guards become suddenly worried that you&#39;re all dying too often, so they give you a larger portion of mushroom stew this evening. You thank the dead person, quietly, and someone near you utters a pagan prayer in their honour.&quot;,&quot;You are able to rest for almost an hour before anyone disturbs you, massaging your aching limbs.&quot;)

[[another wretched day comes to an end|SlaveryNight]]</tw-passagedata>
<tw-passagedata pid="177" name="CroachDrunkDay1" tags="" position="6140,4243">(set: $shadOpinion to it + 2)\
(set: $shadHealth to it + 1)\
(set: $health to it - 1)\
(set: $filth to it + 1)\
As Croach raises his hammy fist to strike Shad, you leap up and clip his haunches with the slack of your chain. He turns, wide-eyed, yelling, and bites you hard. He attempts to knock you down, but only falls in the mud himself. He drags you down with him, and delivers a devestating blow to your gut. You pull yourself free. The others - guard and slave alike - marvel at your boldness. Mercifully, Croach seems to remember nothing of the spectacle in the morning.

[[another wretched day comes to an end|SlaveryNight]]</tw-passagedata>
<tw-passagedata pid="178" name="CroachDrunkDay2" tags="" position="6140,4368">(set: $shadOpinion to it - 1)\
(set: $filth to it + 3)\
You keep your head low, and attempt to hide as best you can under a pile of dirt. You are so filthy already, you succeed at this, and Croach passes you by. The other slaves note your cowardice.

[[another wretched day comes to an end|SlaveryNight]]</tw-passagedata>
<tw-passagedata pid="179" name="CroachDrunkDay3" tags="" position="6140,4495">Croach sways before you, eyes unfocused. You cast about for some way to placate him, and in a desperate moment you start to sing. (if: $corachOpinion&gt;3)[Somehow, this works. He listens to your voice, and a little smile plays across his lips, and he falls to the ground, fast asleep. Everyone is impressed.(set: $croachOpinion to it + 1)(set: $shadOpinion to it + 1)](else:)[Croach sneers and punches you in the mouth.(set:$health to it - 1)]

[[another wretched day comes to an end|SlaveryNight]]</tw-passagedata>
<tw-passagedata pid="180" name="SlaveryDeath" tags="" position="5433,4556">sent to be with other corpses to placate maggot (not quite dead) (found by Keepers?)(set: $playerTags to it - (a:&quot;manacles&quot;))</tw-passagedata>
<tw-passagedata pid="181" name="SlaveryPromotion" tags="" position="5036,4833">explain that nobody else in the skull will trust you with the chains and that you&#39;ll never escape, so you&#39;ll come back to croachy if you know what&#39;s good for you

after this point, you&#39;re able to return to tell Croach the true location of the Ledger

(set: $inv to $impoundedGoods)(set: $playerTags to it - (a:&quot;manacles&quot;))
(set: $playerTags to it + (a:&quot;shoulderchains&quot;))
(set: $playerTags to it + (a:&quot;unchained&quot;))

if you win, do a tag</tw-passagedata>
<tw-passagedata pid="182" name="CroachRandomSearchA" tags="" position="6156,4845">(if: (either: true, false, false))[Mercifully, Croach doesn&#39;t seem to notice anything as his stick turns up a clod of dirt, revealing your cache of sharpened jawbones. Perhaps the floor of the pit is so thick with bones that he doesn&#39;t notice anything out of the ordinary. Once he is gone, you quickly re-hide them unless some guard with more wits about him comes by.](else:)[Your hope is in vain. Croach notices something amiss as he leans on his pole, and quickly uses it to bring what he&#39;s found to the surface. He isn&#39;t pleased when he discovers the cache of sharpened jawbones. &#39;Oho well,&#39; he says with glee. &#39;Who&#39;s done this, then? Who here fancies sticking Old Croach with a pointed bone, hm? One of you runts would dearly love to pierce the neck of Old Croach with a tool such as this, and wallow in his blood. Well, who&#39;s done it? All will be whipped unless one speaks out.&#39;(set: $resistance to it - 2)

[[own up|CroachRandomSearchC]]
[[say nothing|CroachRandomSearchD]]\
(if: $shadHealth&gt;0)[
[[blame shad|CroachRandomSearchE]]
]]</tw-passagedata>
<tw-passagedata pid="183" name="CroachRandomSearchB" tags="" position="6146,4631">(if:$croachOpinion&gt;2)[](else:)[]</tw-passagedata>
<tw-passagedata pid="184" name="CroachRandomSearchC" tags="" position="5950,5100">(set: $croachOpinion to 1)&#39;Well, well, well!&#39; says Croach. &#39;Our newest runt has done this thing! And we thought so well of him before. Now I shall make you black and blue!&#39; He beats you to within an inch of your life with his walking stick. When he grows tired, you are strung by your manacles above the pit and left to hang there overnight. You lapse in and out of consciousness, head swimming. You don&#39;t recall being let down, but you awaken on your back on the ground.(set: $health to 2)

Later, Shad speaks to you. &#39;That was a brave thing you did,&#39; they say. &#39;Stupid, but brave.&#39; (set: $shadOpinion to it + 1)

[[another wretched day comes to an end|SlaveryNight]]</tw-passagedata>
<tw-passagedata pid="185" name="CroachRandomSearchD" tags="" position="5950,4800">&#39;Nobody?&#39; says Croach. &#39;No worm will lay himself out for the goodness of the other worms? Then all shall be punished.&#39; The guards demonstrate efficiency and thoroughness in their treatment of the chain gangs. (set: $shadOpinion to it + 1)(set: $shadHealth to it - 1)(set: $health to it - 1)

[[another wretched day comes to an end|SlaveryNight]]</tw-passagedata>
<tw-passagedata pid="186" name="CroachRandomSearchE" tags="" position="5950,4950">(set: $shadOpinion to 0)\
(set: $shadHealth to 1)\
(set: $croachOpinion to it - 1)\
Even Croach looks momentarily appalled as you point the finger at Shad. Still, Shad is quickly removed from the chain by two guards and taken away to somewhere out of sight. When they reappear, Shad is shivering and bruised all over. Nobody will meet your eye.

[[another wretched day comes to an end|SlaveryNight]]</tw-passagedata>
<tw-passagedata pid="187" name="Template for Knowledge Appender" tags="" position="200,800">(set: $knowledgeCategory to &quot;history&quot;)
(set: $knowledgeName to &quot;what&#39;s below&quot;)
(set: $appendedKnowledge to &quot;whatever you want added&quot;)
(set: $newKnowledge to &quot;whatever you want the entry to say if this is the first part of it&quot;)
(display: &quot;KnowledgeAppender&quot;)</tw-passagedata>
<tw-passagedata pid="188" name="MaggotAttackA" tags="" position="5800,5200">The creature yells as you strike its side with your shovel.\
(set:$croachOpinion to it + 2)\
(set:$shadOpinion to it + 1)\
(if: (either: true, false))[(set:$health to it - 2) It rears around, lacerating your side with its teeth. ](else:)[(set:$health to it - 1)You catch it by surprise, the flat of your shovel splatting into its muscular haunch. It whips around and attempts to smother you, but with strength afforded you by terror you are able to push it off you. ]You&#39;ve alarmed it, though. It makes a shrill noise and with alarming speed it burrows into the floor and is gone.

&#39;Such bravery!&#39; Croach yells. &#39;Thou art as much a fool as a warrior, and thou shalt recieve extra slop on account of it.&#39; He is pleased. Shad smiles at you as you sit down, after Croach leaves. People treat you with a certain respect that evening.

[[another wretched day comes to an end|SlaveryNight]]</tw-passagedata>
<tw-passagedata pid="189" name="MaggotAttackB" tags="" position="5753,5336">Croach yells at the guards to confront it, and they nervously form a ring around it. Two more perish before the beast makes its exit, burrowing into the floor with its muscles pulsating furiously. The camp is quiet until Croach breaks the silence with a yell of rage.

[[another wretched day comes to an end|SlaveryNight]]</tw-passagedata>
<tw-passagedata pid="190" name="ShadConv" tags="" position="5305,4645">You curl up close to Shad, for warmth. The two of you talk quietly, in whispers, so as not to wake the others.

(set: $interlocutor to $Shad)\
(display: &quot;ConversationInitialise&quot;)\
(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="191" name="CroachConv" tags="" position="5306,4773">Croach looms out of the darkness, cup in hand, as you tentatively approach him. (either: &quot;&#39;What is it, worm?&#39;&quot;, &quot;&#39;Approach, thou swine.&#39;&quot;)

(set: $interlocutor to $Croach)\
(display: &quot;ConversationInitialise&quot;)\
(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="192" name="ShadRumour" tags="" position="404,5551">//PLACEHOLDER//

(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="193" name="ShadWhatsBelow" tags="" position="227,5376">&#39;Somewhere below the skull, it lurks, grinning, in its maze. None know what it looks like for none have seen it and lived. It guards the ledger that is this place&#39;s cosmic sin. Hah! It&#39;s why we dig, you know. Because none can pass by what&#39;s below, yet Croach would have this ancient ledger, whose import is so vast that none will talk of it directly. That&#39;s what we dig for - some way to the heart of this place, where the ledger dwells, to get around the hidden beast that guards it. There&#39;s the secret, gleaned by careful listening.&#39;{

(set: $knowledgeCategory to &quot;history&quot;)
(set: $knowledgeName to &quot;what&#39;s below&quot;)
(set: $appendedKnowledge to &quot;Croach is so afraid of it that he is attempting to dig around it using scores of indentured slaves.&quot;)
(set: $newKnowledge to &quot;A beast so deadly that none survive to recollect its appearance. It dwells below the skull in a labyrinth, guarding the ledger.&quot;)
(display: &quot;KnowledgeAppender&quot;)

(set: $knowledgeCategory to &quot;history&quot;)
(set: $knowledgeName to &quot;the ledger&quot;)
(set: $appendedKnowledge to &quot;A cosminc sin, desired by the depraved. It is guarded by some appaling fiend, and Croach hopes to avoid obtain it by digging around the labyrinth where the beast dwells.&quot;)
(set: $newKnowledge to &quot;An object of cosmic import, whispered about by the denizens of the skull. Its secret. Its original sin. It lies somewhere below the earth, guarded by a creature in a labyrinth.&quot;)
(display: &quot;KnowledgeAppender&quot;)

(if: (datanames: of &quot;history&quot; of $knowledge contains &quot;The Black Ledger&quot;))[
(set: $knowledgeCategory to &quot;history&quot;)
(set: $knowledgeName to &quot;The Black Ledger&quot;)
(set: $appendedKnowledge to &quot;Croach would have it, by digging past the creature in the labyrinth.&quot;)
(set: $newKnowledge to &quot;FUBAR&quot;)
(display: &quot;KnowledgeAppender&quot;)
]
}</tw-passagedata>
<tw-passagedata pid="194" name="ShadLedger" tags="" position="356,5376">&#39;I know that Croach desires it. It&#39;s the whole reason for our being here. At night, I have heard him speak lustfully of power and influence that will be his when we reach the place where this ledger is kept, but I don&#39;t know why. The way he spoke of it made me fearful. I do not want him to have anything that he desires so strongly.&#39;{
(set: $knowledgeCategory to &quot;people&quot;)
(set: $knowledgeName to &quot;Croach&quot;)
(set: $appendedKnowledge to &quot;His whole project is bent towards the ends of discovering the ledger, far below the skull.&quot;)
(set: $newKnowledge to &quot;FOOBAR&quot;)
(display: &quot;KnowledgeAppender&quot;)

(set: $knowledgeCategory to &quot;history&quot;)
(set: $knowledgeName to &quot;the ledger&quot;)
(set: $appendedKnowledge to &quot;The nature of its power is uncertain, but Croach desires it, which tells you something about it.&quot;)
(set: $newKnowledge to &quot;FOOBAR&quot;)
(display: &quot;KnowledgeAppender&quot;)
}</tw-passagedata>
<tw-passagedata pid="195" name="ShadQuestionsA" tags="" position="441,5738">(set: $shadOpinion to it - 1)(set: $patience to it -1)&#39;Fine, don&#39;t tell me. Whatever pleases you.&#39;

(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="196" name="ShadQuiet" tags="" position="256,5556">(either:&quot;Shad mumbles something, seeming to doze off for a moment.&quot;,&quot;They hum a quiet tune whose origin you cannot place.&quot;,&quot;Shad shapes a pile of mud into a small face, and then flattens it under their palm.&quot;,&quot;For the next few minutes, Shad is distracted by fixated scratching.&quot;,&quot;Shad picks absently at the calluses inside their hands.&quot;)

(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="197" name="ShadQuestionsB" tags="" position="566,5730">(if: $playerJourney is &quot;wedding&quot;)[&#39;What wretchedness. The wedding will collapse without you there. Your family will scorn you for your disappearance. And through no fault of your own!&#39;

Not for the last time, the image of ceremonial raiments crosses your mind. The thought of yolk-cakes and almond paste spoiling and being thrown away causes the pit of your chest to ache with regret more profound than that which you feel when you imagine your family, the engravings on the ceremonial blade, or the arms of your beloved.]\
(if: $playerJourney is &quot;census&quot;)[&#39;Bah! That your life should be so twisted by foolish procedure! I&#39;m sorry, I mean no disrespect, but I fail to understand what good is wrought by such zealous organisation. Does it make your butter taste better? Does a notarised bottle of wine have better nose? I weep.&#39;]\
(if: $playerJourney is &quot;exile&quot;)[&#39;Then I suppose you can take small solace in the thought that your family do not expect to see you again, and so your current plight does not pour oil on present misery. As for me, my family must wonder daily what has become of me. I imagine them looking expectantly at the entrance to our tent as they sit for evening meals, setting a place for me, pouring sweet milk into a gourd on my behalf... They await my return. You, at least, leave no uncertainty behind.&#39;]

(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="198" name="ShadQuestionsC" tags="" position="691,5730">&#39;I understand your plight,&#39; says Shad. &#39;Something about this place... When I dream about the outside world, the dreams are frail and watery, as if printed on paper. My life before this place seems thin and insubstantial.&#39;

(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="199" name="CroachVomit" tags="" position="83,4885">Suddenly, he leans forwards. His eyes lock onto yours, and he makes a pained gasping sound.

[[step towards him|CroachVomitA]]
[[step away from him|CroachVomitB]]</tw-passagedata>
<tw-passagedata pid="200" name="CroachYell" tags="" position="226,4873">(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="201" name="CroachSnort" tags="" position="368,4871">(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="202" name="CroachQuiet" tags="" position="511,4878"></tw-passagedata>
<tw-passagedata pid="203" name="CroachPromotion" tags="" position="443,4573">Croach considers you for a moment, head tilted, as if seeing you in a new light.

&#39;A strong frame hast thou, for a new arrival. A good worker art thou also. If thour&#39;t loyal, perhaps Croach can find better use for you than a-digging in the bottom of the pit. Tell me, what dost thou know of our wriggling foe, the mighty maggot?&#39;

(if: &quot;people&quot; of $knowledge contains &quot;the maggot&quot;)[(link: &quot;&#39;i believe i could defeat it.&#39;&quot;)[(goto:&quot;SlaveryPromotion&quot;)]
[[&#39;it fills me with horror.&#39;|CroacPromotionB]]]
[[&#39;i know nothing of this thing.&#39;|CroachPromotionC]]</tw-passagedata>
<tw-passagedata pid="204" name="CroacPromotionB" tags="" position="361,4735">&#39;Ha! Afeared, is it? And rightly so, for the maggot is loathely and furious. But Croach has no need of a shrinking pit-violet of lily-white brow. Thou canst leave me now.&#39; (set: $croachOpinion to it - 2)

(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="205" name="CroachPromotionC" tags="" position="530,4721">{
(set: $knowledgeCategory to &quot;people&quot;)
(set: $knowledgeName to &quot;the maggot&quot;)
(set: $appendedKnowledge to &quot;Croach wishes dearly to see it dead.&quot;)
(set: $newKnowledge to &quot;The maggot is the foe of the Pit Crew, harassing them constantly. The denizens of the Pit would love to see it dead, but they are powerless to overcome its speed and ferocity. Croach searches for someone strong enough to confront it.&quot;)
(display: &quot;KnowledgeAppender&quot;)
}&#39;A monsterous carbuncle is the maggot, dwelling far above us in a chamber of vast granite ribs. He treats Croach&#39;s operation as a delicious platter of repast, coming some days to munch my finest slaves. We name him maggot, but I dread to see the blowfly that blew him! Wouldst thou of brawny arm go contend with him? All others have died who have made the attempt, I tell thee, and their screams are most piteous to hear.&#39;

(link: &quot;&#39;i believe i could defeat it.&#39;&quot;)[(goto:&quot;SlaveryPromotion&quot;)]
[[&#39;this task is not for me.&#39;|CroacPromotionB]]</tw-passagedata>
<tw-passagedata pid="206" name="CroachVomitA" tags="" position="83,5035">(display: &quot;ConversationOptions&quot;)</tw-passagedata>
<tw-passagedata pid="207" name="CroachVomitB" tags="" position="235,5035">(display: &quot;ConversationOptions&quot;)</tw-passagedata>
</tw-storydata>


<script title="Twine engine code" data-main="harlowe">"use strict";function _toConsumableArray(arr){if(Array.isArray(arr)){for(var i=0,arr2=Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}return Array.from(arr)}var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i["return"]&&_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj};!function(){/**
 * @license almond 0.3.1 Copyright (c) 2011-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/jrburke/almond for details
 */
var requirejs,require,define;!function(undef){function hasProp(obj,prop){return hasOwn.call(obj,prop)}function normalize(name,baseName){var nameParts,nameSegment,mapValue,foundMap,lastIndex,foundI,foundStarMap,starI,i,j,part,baseParts=baseName&&baseName.split("/"),map=config.map,starMap=map&&map["*"]||{};if(name&&"."===name.charAt(0))if(baseName){for(name=name.split("/"),lastIndex=name.length-1,config.nodeIdCompat&&jsSuffixRegExp.test(name[lastIndex])&&(name[lastIndex]=name[lastIndex].replace(jsSuffixRegExp,"")),name=baseParts.slice(0,baseParts.length-1).concat(name),i=0;i<name.length;i+=1)if(part=name[i],"."===part)name.splice(i,1),i-=1;else if(".."===part){if(1===i&&(".."===name[2]||".."===name[0]))break;i>0&&(name.splice(i-1,2),i-=2)}name=name.join("/")}else 0===name.indexOf("./")&&(name=name.substring(2));if((baseParts||starMap)&&map){for(nameParts=name.split("/"),i=nameParts.length;i>0;i-=1){if(nameSegment=nameParts.slice(0,i).join("/"),baseParts)for(j=baseParts.length;j>0;j-=1)if(mapValue=map[baseParts.slice(0,j).join("/")],mapValue&&(mapValue=mapValue[nameSegment])){foundMap=mapValue,foundI=i;break}if(foundMap)break;!foundStarMap&&starMap&&starMap[nameSegment]&&(foundStarMap=starMap[nameSegment],starI=i)}!foundMap&&foundStarMap&&(foundMap=foundStarMap,foundI=starI),foundMap&&(nameParts.splice(0,foundI,foundMap),name=nameParts.join("/"))}return name}function makeRequire(relName,forceSync){return function(){var args=aps.call(arguments,0);return"string"!=typeof args[0]&&1===args.length&&args.push(null),_req.apply(undef,args.concat([relName,forceSync]))}}function makeNormalize(relName){return function(name){return normalize(name,relName)}}function makeLoad(depName){return function(value){defined[depName]=value}}function callDep(name){if(hasProp(waiting,name)){var args=waiting[name];delete waiting[name],defining[name]=!0,main.apply(undef,args)}if(!hasProp(defined,name)&&!hasProp(defining,name))throw new Error("No "+name);return defined[name]}function splitPrefix(name){var prefix,index=name?name.indexOf("!"):-1;return index>-1&&(prefix=name.substring(0,index),name=name.substring(index+1,name.length)),[prefix,name]}function makeConfig(name){return function(){return config&&config.config&&config.config[name]||{}}}var main,_req,makeMap,handlers,defined={},waiting={},config={},defining={},hasOwn=Object.prototype.hasOwnProperty,aps=[].slice,jsSuffixRegExp=/\.js$/;makeMap=function(name,relName){var plugin,parts=splitPrefix(name),prefix=parts[0];return name=parts[1],prefix&&(prefix=normalize(prefix,relName),plugin=callDep(prefix)),prefix?name=plugin&&plugin.normalize?plugin.normalize(name,makeNormalize(relName)):normalize(name,relName):(name=normalize(name,relName),parts=splitPrefix(name),prefix=parts[0],name=parts[1],prefix&&(plugin=callDep(prefix))),{f:prefix?prefix+"!"+name:name,n:name,pr:prefix,p:plugin}},handlers={require:function(name){return makeRequire(name)},exports:function(name){var e=defined[name];return"undefined"!=typeof e?e:defined[name]={}},module:function(name){return{id:name,uri:"",exports:defined[name],config:makeConfig(name)}}},main=function(name,deps,callback,relName){var cjsModule,depName,ret,map,i,usingExports,args=[],callbackType="undefined"==typeof callback?"undefined":_typeof(callback);if(relName=relName||name,"undefined"===callbackType||"function"===callbackType){for(deps=!deps.length&&callback.length?["require","exports","module"]:deps,i=0;i<deps.length;i+=1)if(map=makeMap(deps[i],relName),depName=map.f,"require"===depName)args[i]=handlers.require(name);else if("exports"===depName)args[i]=handlers.exports(name),usingExports=!0;else if("module"===depName)cjsModule=args[i]=handlers.module(name);else if(hasProp(defined,depName)||hasProp(waiting,depName)||hasProp(defining,depName))args[i]=callDep(depName);else{if(!map.p)throw new Error(name+" missing "+depName);map.p.load(map.n,makeRequire(relName,!0),makeLoad(depName),{}),args[i]=defined[depName]}ret=callback?callback.apply(defined[name],args):void 0,name&&(cjsModule&&cjsModule.exports!==undef&&cjsModule.exports!==defined[name]?defined[name]=cjsModule.exports:ret===undef&&usingExports||(defined[name]=ret))}else name&&(defined[name]=callback)},requirejs=require=_req=function(deps,callback,relName,forceSync,alt){if("string"==typeof deps)return handlers[deps]?handlers[deps](callback):callDep(makeMap(deps,callback).f);if(!deps.splice){if(config=deps,config.deps&&_req(config.deps,config.callback),!callback)return;callback.splice?(deps=callback,callback=relName,relName=null):deps=undef}return callback=callback||function(){},"function"==typeof relName&&(relName=forceSync,forceSync=alt),forceSync?main(undef,deps,callback,relName):setTimeout(function(){main(undef,deps,callback,relName)},4),_req},_req.config=function(cfg){return _req(cfg)},requirejs._defined=defined,define=function(name,deps,callback){if("string"!=typeof name)throw new Error("See almond README: incorrect module build, no module name");deps.splice||(callback=deps,deps=[]),hasProp(defined,name)||hasProp(waiting,name)||(waiting[name]=[name,deps,callback])},define.amd={jQuery:!0}}(),define("almond",function(){}),function(global,factory){"object"===("undefined"==typeof module?"undefined":_typeof(module))&&"object"===_typeof(module.exports)?module.exports=global.document?factory(global,!0):function(w){if(!w.document)throw new Error("jQuery requires a window with a document");return factory(w)}:factory(global)}("undefined"!=typeof window?window:this,function(window,noGlobal){function isArrayLike(obj){var length=!!obj&&"length"in obj&&obj.length,type=jQuery.type(obj);return"function"===type||jQuery.isWindow(obj)?!1:"array"===type||0===length||"number"==typeof length&&length>0&&length-1 in obj}function winnow(elements,qualifier,not){if(jQuery.isFunction(qualifier))return jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not});if(qualifier.nodeType)return jQuery.grep(elements,function(elem){return elem===qualifier!==not});if("string"==typeof qualifier){if(risSimple.test(qualifier))return jQuery.filter(qualifier,elements,not);qualifier=jQuery.filter(qualifier,elements)}return jQuery.grep(elements,function(elem){return indexOf.call(qualifier,elem)>-1!==not})}function sibling(cur,dir){for(;(cur=cur[dir])&&1!==cur.nodeType;);return cur}function createOptions(options){var object={};return jQuery.each(options.match(rnotwhite)||[],function(_,flag){object[flag]=!0}),object}function completed(){document.removeEventListener("DOMContentLoaded",completed),window.removeEventListener("load",completed),jQuery.ready()}function Data(){this.expando=jQuery.expando+Data.uid++}function dataAttr(elem,key,data){var name;if(void 0===data&&1===elem.nodeType)if(name="data-"+key.replace(rmultiDash,"-$&").toLowerCase(),data=elem.getAttribute(name),"string"==typeof data){try{data="true"===data?!0:"false"===data?!1:"null"===data?null:+data+""===data?+data:rbrace.test(data)?jQuery.parseJSON(data):data}catch(e){}dataUser.set(elem,key,data)}else data=void 0;return data}function adjustCSS(elem,prop,valueParts,tween){var adjusted,scale=1,maxIterations=20,currentValue=tween?function(){return tween.cur()}:function(){return jQuery.css(elem,prop,"")},initial=currentValue(),unit=valueParts&&valueParts[3]||(jQuery.cssNumber[prop]?"":"px"),initialInUnit=(jQuery.cssNumber[prop]||"px"!==unit&&+initial)&&rcssNum.exec(jQuery.css(elem,prop));if(initialInUnit&&initialInUnit[3]!==unit){unit=unit||initialInUnit[3],valueParts=valueParts||[],initialInUnit=+initial||1;do scale=scale||".5",initialInUnit/=scale,jQuery.style(elem,prop,initialInUnit+unit);while(scale!==(scale=currentValue()/initial)&&1!==scale&&--maxIterations)}return valueParts&&(initialInUnit=+initialInUnit||+initial||0,adjusted=valueParts[1]?initialInUnit+(valueParts[1]+1)*valueParts[2]:+valueParts[2],tween&&(tween.unit=unit,tween.start=initialInUnit,tween.end=adjusted)),adjusted}function getAll(context,tag){var ret="undefined"!=typeof context.getElementsByTagName?context.getElementsByTagName(tag||"*"):"undefined"!=typeof context.querySelectorAll?context.querySelectorAll(tag||"*"):[];return void 0===tag||tag&&jQuery.nodeName(context,tag)?jQuery.merge([context],ret):ret}function setGlobalEval(elems,refElements){for(var i=0,l=elems.length;l>i;i++)dataPriv.set(elems[i],"globalEval",!refElements||dataPriv.get(refElements[i],"globalEval"))}function buildFragment(elems,context,scripts,selection,ignored){for(var elem,tmp,tag,wrap,contains,j,fragment=context.createDocumentFragment(),nodes=[],i=0,l=elems.length;l>i;i++)if(elem=elems[i],elem||0===elem)if("object"===jQuery.type(elem))jQuery.merge(nodes,elem.nodeType?[elem]:elem);else if(rhtml.test(elem)){for(tmp=tmp||fragment.appendChild(context.createElement("div")),tag=(rtagName.exec(elem)||["",""])[1].toLowerCase(),wrap=wrapMap[tag]||wrapMap._default,tmp.innerHTML=wrap[1]+jQuery.htmlPrefilter(elem)+wrap[2],j=wrap[0];j--;)tmp=tmp.lastChild;jQuery.merge(nodes,tmp.childNodes),tmp=fragment.firstChild,tmp.textContent=""}else nodes.push(context.createTextNode(elem));for(fragment.textContent="",i=0;elem=nodes[i++];)if(selection&&jQuery.inArray(elem,selection)>-1)ignored&&ignored.push(elem);else if(contains=jQuery.contains(elem.ownerDocument,elem),tmp=getAll(fragment.appendChild(elem),"script"),contains&&setGlobalEval(tmp),scripts)for(j=0;elem=tmp[j++];)rscriptType.test(elem.type||"")&&scripts.push(elem);return fragment}function returnTrue(){return!0}function returnFalse(){return!1}function safeActiveElement(){try{return document.activeElement}catch(err){}}function _on(elem,types,selector,data,fn,one){var origFn,type;if("object"===("undefined"==typeof types?"undefined":_typeof(types))){"string"!=typeof selector&&(data=data||selector,selector=void 0);for(type in types)_on(elem,type,selector,data,types[type],one);return elem}if(null==data&&null==fn?(fn=selector,data=selector=void 0):null==fn&&("string"==typeof selector?(fn=data,data=void 0):(fn=data,data=selector,selector=void 0)),fn===!1)fn=returnFalse;else if(!fn)return this;return 1===one&&(origFn=fn,fn=function(event){return jQuery().off(event),origFn.apply(this,arguments)},fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)),elem.each(function(){jQuery.event.add(this,types,fn,data,selector)})}function manipulationTarget(elem,content){return jQuery.nodeName(elem,"table")&&jQuery.nodeName(11!==content.nodeType?content:content.firstChild,"tr")?elem.getElementsByTagName("tbody")[0]||elem:elem}function disableScript(elem){return elem.type=(null!==elem.getAttribute("type"))+"/"+elem.type,elem}function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);return match?elem.type=match[1]:elem.removeAttribute("type"),elem}function cloneCopyEvent(src,dest){var i,l,type,pdataOld,pdataCur,udataOld,udataCur,events;if(1===dest.nodeType){if(dataPriv.hasData(src)&&(pdataOld=dataPriv.access(src),pdataCur=dataPriv.set(dest,pdataOld),events=pdataOld.events)){delete pdataCur.handle,pdataCur.events={};for(type in events)for(i=0,l=events[type].length;l>i;i++)jQuery.event.add(dest,type,events[type][i])}dataUser.hasData(src)&&(udataOld=dataUser.access(src),udataCur=jQuery.extend({},udataOld),dataUser.set(dest,udataCur))}}function fixInput(src,dest){var nodeName=dest.nodeName.toLowerCase();"input"===nodeName&&rcheckableType.test(src.type)?dest.checked=src.checked:("input"===nodeName||"textarea"===nodeName)&&(dest.defaultValue=src.defaultValue)}function domManip(collection,args,callback,ignored){args=concat.apply([],args);var fragment,first,scripts,hasScripts,node,doc,i=0,l=collection.length,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);if(isFunction||l>1&&"string"==typeof value&&!support.checkClone&&rchecked.test(value))return collection.each(function(index){var self=collection.eq(index);isFunction&&(args[0]=value.call(this,index,self.html())),domManip(self,args,callback,ignored)});if(l&&(fragment=buildFragment(args,collection[0].ownerDocument,!1,collection,ignored),first=fragment.firstChild,1===fragment.childNodes.length&&(fragment=first),first||ignored)){for(scripts=jQuery.map(getAll(fragment,"script"),disableScript),hasScripts=scripts.length;l>i;i++)node=fragment,i!==iNoClone&&(node=jQuery.clone(node,!0,!0),hasScripts&&jQuery.merge(scripts,getAll(node,"script"))),callback.call(collection[i],node,i);if(hasScripts)for(doc=scripts[scripts.length-1].ownerDocument,jQuery.map(scripts,restoreScript),i=0;hasScripts>i;i++)node=scripts[i],rscriptType.test(node.type||"")&&!dataPriv.access(node,"globalEval")&&jQuery.contains(doc,node)&&(node.src?jQuery._evalUrl&&jQuery._evalUrl(node.src):jQuery.globalEval(node.textContent.replace(rcleanScript,"")))}return collection}function _remove(elem,selector,keepData){for(var node,nodes=selector?jQuery.filter(selector,elem):elem,i=0;null!=(node=nodes[i]);i++)keepData||1!==node.nodeType||jQuery.cleanData(getAll(node)),node.parentNode&&(keepData&&jQuery.contains(node.ownerDocument,node)&&setGlobalEval(getAll(node,"script")),node.parentNode.removeChild(node));return elem}function actualDisplay(name,doc){var elem=jQuery(doc.createElement(name)).appendTo(doc.body),display=jQuery.css(elem[0],"display");return elem.detach(),display}function defaultDisplay(nodeName){var doc=document,display=elemdisplay[nodeName];return display||(display=actualDisplay(nodeName,doc),"none"!==display&&display||(iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>")).appendTo(doc.documentElement),doc=iframe[0].contentDocument,doc.write(),doc.close(),display=actualDisplay(nodeName,doc),iframe.detach()),elemdisplay[nodeName]=display),display}function curCSS(elem,name,computed){var width,minWidth,maxWidth,ret,style=elem.style;return computed=computed||getStyles(elem),computed&&(ret=computed.getPropertyValue(name)||computed[name],""!==ret||jQuery.contains(elem.ownerDocument,elem)||(ret=jQuery.style(elem,name)),!support.pixelMarginRight()&&rnumnonpx.test(ret)&&rmargin.test(name)&&(width=style.width,minWidth=style.minWidth,maxWidth=style.maxWidth,style.minWidth=style.maxWidth=style.width=ret,ret=computed.width,style.width=width,style.minWidth=minWidth,style.maxWidth=maxWidth)),void 0!==ret?ret+"":ret}function addGetHookIf(conditionFn,hookFn){return{get:function(){return conditionFn()?void delete this.get:(this.get=hookFn).apply(this,arguments)}}}function vendorPropName(name){if(name in emptyStyle)return name;for(var capName=name[0].toUpperCase()+name.slice(1),i=cssPrefixes.length;i--;)if(name=cssPrefixes[i]+capName,name in emptyStyle)return name}function setPositiveNumber(elem,value,subtract){var matches=rcssNum.exec(value);return matches?Math.max(0,matches[2]-(subtract||0))+(matches[3]||"px"):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){for(var i=extra===(isBorderBox?"border":"content")?4:"width"===name?1:0,val=0;4>i;i+=2)"margin"===extra&&(val+=jQuery.css(elem,extra+cssExpand[i],!0,styles)),isBorderBox?("content"===extra&&(val-=jQuery.css(elem,"padding"+cssExpand[i],!0,styles)),"margin"!==extra&&(val-=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles))):(val+=jQuery.css(elem,"padding"+cssExpand[i],!0,styles),"padding"!==extra&&(val+=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles)));return val}function getWidthOrHeight(elem,name,extra){var valueIsBorderBox=!0,val="width"===name?elem.offsetWidth:elem.offsetHeight,styles=getStyles(elem),isBorderBox="border-box"===jQuery.css(elem,"boxSizing",!1,styles);if(document.msFullscreenElement&&window.top!==window&&elem.getClientRects().length&&(val=Math.round(100*elem.getBoundingClientRect()[name])),0>=val||null==val){if(val=curCSS(elem,name,styles),(0>val||null==val)&&(val=elem.style[name]),rnumnonpx.test(val))return val;valueIsBorderBox=isBorderBox&&(support.boxSizingReliable()||val===elem.style[name]),val=parseFloat(val)||0}return val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles)+"px"}function showHide(elements,show){for(var display,elem,hidden,values=[],index=0,length=elements.length;length>index;index++)elem=elements[index],elem.style&&(values[index]=dataPriv.get(elem,"olddisplay"),display=elem.style.display,show?(values[index]||"none"!==display||(elem.style.display=""),""===elem.style.display&&isHidden(elem)&&(values[index]=dataPriv.access(elem,"olddisplay",defaultDisplay(elem.nodeName)))):(hidden=isHidden(elem),"none"===display&&hidden||dataPriv.set(elem,"olddisplay",hidden?display:jQuery.css(elem,"display"))));for(index=0;length>index;index++)elem=elements[index],elem.style&&(show&&"none"!==elem.style.display&&""!==elem.style.display||(elem.style.display=show?values[index]||"":"none"));return elements}function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}function createFxNow(){return window.setTimeout(function(){fxNow=void 0}),fxNow=jQuery.now()}function genFx(type,includeWidth){var which,i=0,attrs={height:type};for(includeWidth=includeWidth?1:0;4>i;i+=2-includeWidth)which=cssExpand[i],attrs["margin"+which]=attrs["padding"+which]=type;return includeWidth&&(attrs.opacity=attrs.width=type),attrs}function createTween(value,prop,animation){for(var tween,collection=(Animation.tweeners[prop]||[]).concat(Animation.tweeners["*"]),index=0,length=collection.length;length>index;index++)if(tween=collection[index].call(animation,prop,value))return tween}function defaultPrefilter(elem,props,opts){var prop,value,toggle,tween,hooks,oldfire,display,checkDisplay,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHidden(elem),dataShow=dataPriv.get(elem,"fxshow");opts.queue||(hooks=jQuery._queueHooks(elem,"fx"),null==hooks.unqueued&&(hooks.unqueued=0,oldfire=hooks.empty.fire,hooks.empty.fire=function(){hooks.unqueued||oldfire()}),hooks.unqueued++,anim.always(function(){anim.always(function(){hooks.unqueued--,jQuery.queue(elem,"fx").length||hooks.empty.fire()})})),1===elem.nodeType&&("height"in props||"width"in props)&&(opts.overflow=[style.overflow,style.overflowX,style.overflowY],display=jQuery.css(elem,"display"),checkDisplay="none"===display?dataPriv.get(elem,"olddisplay")||defaultDisplay(elem.nodeName):display,"inline"===checkDisplay&&"none"===jQuery.css(elem,"float")&&(style.display="inline-block")),opts.overflow&&(style.overflow="hidden",anim.always(function(){style.overflow=opts.overflow[0],style.overflowX=opts.overflow[1],style.overflowY=opts.overflow[2]}));for(prop in props)if(value=props[prop],rfxtypes.exec(value)){if(delete props[prop],toggle=toggle||"toggle"===value,value===(hidden?"hide":"show")){if("show"!==value||!dataShow||void 0===dataShow[prop])continue;hidden=!0}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}else display=void 0;if(jQuery.isEmptyObject(orig))"inline"===("none"===display?defaultDisplay(elem.nodeName):display)&&(style.display=display);else{dataShow?"hidden"in dataShow&&(hidden=dataShow.hidden):dataShow=dataPriv.access(elem,"fxshow",{}),toggle&&(dataShow.hidden=!hidden),hidden?jQuery(elem).show():anim.done(function(){jQuery(elem).hide()}),anim.done(function(){var prop;dataPriv.remove(elem,"fxshow");for(prop in orig)jQuery.style(elem,prop,orig[prop])});for(prop in orig)tween=createTween(hidden?dataShow[prop]:0,prop,anim),prop in dataShow||(dataShow[prop]=tween.start,hidden&&(tween.end=tween.start,tween.start="width"===prop||"height"===prop?1:0))}}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props)if(name=jQuery.camelCase(index),easing=specialEasing[name],value=props[index],jQuery.isArray(value)&&(easing=value[1],value=props[index]=value[0]),index!==name&&(props[name]=value,delete props[index]),hooks=jQuery.cssHooks[name],hooks&&"expand"in hooks){value=hooks.expand(value),delete props[name];for(index in value)index in props||(props[index]=value[index],specialEasing[index]=easing)}else specialEasing[name]=easing}function Animation(elem,properties,options){var result,stopped,index=0,length=Animation.prefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped)return!1;for(var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;length>index;index++)animation.tweens[index].run(percent);return deferred.notifyWith(elem,[animation,percent,remaining]),1>percent&&length?remaining:(deferred.resolveWith(elem,[animation]),!1)},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(!0,{specialEasing:{},easing:jQuery.easing._default},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);return animation.tweens.push(tween),tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped)return this;for(stopped=!0;length>index;index++)animation.tweens[index].run(1);return gotoEnd?(deferred.notifyWith(elem,[animation,1,0]),deferred.resolveWith(elem,[animation,gotoEnd])):deferred.rejectWith(elem,[animation,gotoEnd]),this}}),props=animation.props;for(propFilter(props,animation.opts.specialEasing);length>index;index++)if(result=Animation.prefilters[index].call(animation,elem,props,animation.opts))return jQuery.isFunction(result.stop)&&(jQuery._queueHooks(animation.elem,animation.opts.queue).stop=jQuery.proxy(result.stop,result)),result;return jQuery.map(props,createTween,animation),jQuery.isFunction(animation.opts.start)&&animation.opts.start.call(elem,animation),jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue})),animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}function getClass(elem){return elem.getAttribute&&elem.getAttribute("class")||""}function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){"string"!=typeof dataTypeExpression&&(func=dataTypeExpression,dataTypeExpression="*");var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(rnotwhite)||[];if(jQuery.isFunction(func))for(;dataType=dataTypes[i++];)"+"===dataType[0]?(dataType=dataType.slice(1)||"*",(structure[dataType]=structure[dataType]||[]).unshift(func)):(structure[dataType]=structure[dataType]||[]).push(func)}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){function inspect(dataType){var selected;return inspected[dataType]=!0,jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);return"string"!=typeof dataTypeOrTransport||seekingTransport||inspected[dataTypeOrTransport]?seekingTransport?!(selected=dataTypeOrTransport):void 0:(options.dataTypes.unshift(dataTypeOrTransport),inspect(dataTypeOrTransport),!1)}),selected}var inspected={},seekingTransport=structure===transports;return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src)void 0!==src[key]&&((flatOptions[key]?target:deep||(deep={}))[key]=src[key]);return deep&&jQuery.extend(!0,target,deep),target}function ajaxHandleResponses(s,jqXHR,responses){for(var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes;"*"===dataTypes[0];)dataTypes.shift(),void 0===ct&&(ct=s.mimeType||jqXHR.getResponseHeader("Content-Type"));if(ct)for(type in contents)if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}if(dataTypes[0]in responses)finalDataType=dataTypes[0];else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}firstDataType||(firstDataType=type)}finalDataType=finalDataType||firstDataType}return finalDataType?(finalDataType!==dataTypes[0]&&dataTypes.unshift(finalDataType),responses[finalDataType]):void 0}function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1])for(conv in s.converters)converters[conv.toLowerCase()]=s.converters[conv];for(current=dataTypes.shift();current;)if(s.responseFields[current]&&(jqXHR[s.responseFields[current]]=response),!prev&&isSuccess&&s.dataFilter&&(response=s.dataFilter(response,s.dataType)),prev=current,current=dataTypes.shift())if("*"===current)current=prev;else if("*"!==prev&&prev!==current){if(conv=converters[prev+" "+current]||converters["* "+current],!conv)for(conv2 in converters)if(tmp=conv2.split(" "),tmp[1]===current&&(conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]])){conv===!0?conv=converters[conv2]:converters[conv2]!==!0&&(current=tmp[0],dataTypes.unshift(tmp[1]));break}if(conv!==!0)if(conv&&s["throws"])response=conv(response);else try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}return{state:"success",data:response}}function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj))jQuery.each(obj,function(i,v){traditional||rbracket.test(prefix)?add(prefix,v):buildParams(prefix+"["+("object"===("undefined"==typeof v?"undefined":_typeof(v))&&null!=v?i:"")+"]",v,traditional,add)});else if(traditional||"object"!==jQuery.type(obj))add(prefix,obj);else for(name in obj)buildParams(prefix+"["+name+"]",obj[name],traditional,add)}function getWindow(elem){return jQuery.isWindow(elem)?elem:9===elem.nodeType&&elem.defaultView}var arr=[],document=window.document,_slice=arr.slice,concat=arr.concat,push=arr.push,indexOf=arr.indexOf,class2type={},toString=class2type.toString,hasOwn=class2type.hasOwnProperty,support={},version="2.2.0",jQuery=function jQuery(selector,context){return new jQuery.fn.init(selector,context)},rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase()};jQuery.fn=jQuery.prototype={jquery:version,constructor:jQuery,selector:"",length:0,toArray:function(){return _slice.call(this)},get:function(num){return null!=num?0>num?this[num+this.length]:this[num]:_slice.call(this)},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);return ret.prevObject=this,ret.context=this.context,ret},each:function(callback){return jQuery.each(this,callback)},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},slice:function(){return this.pushStack(_slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(i){var len=this.length,j=+i+(0>i?len:0);return this.pushStack(j>=0&&len>j?[this[j]]:[])},end:function(){return this.prevObject||this.constructor()},push:push,sort:arr.sort,splice:arr.splice},jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=!1;for("boolean"==typeof target&&(deep=target,target=arguments[i]||{},i++),"object"===("undefined"==typeof target?"undefined":_typeof(target))||jQuery.isFunction(target)||(target={}),i===length&&(target=this,i--);length>i;i++)if(null!=(options=arguments[i]))for(name in options)src=target[name],copy=options[name],target!==copy&&(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))?(copyIsArray?(copyIsArray=!1,clone=src&&jQuery.isArray(src)?src:[]):clone=src&&jQuery.isPlainObject(src)?src:{},target[name]=jQuery.extend(deep,clone,copy)):void 0!==copy&&(target[name]=copy));return target},jQuery.extend({expando:"jQuery"+(version+Math.random()).replace(/\D/g,""),isReady:!0,error:function(msg){throw new Error(msg)},noop:function(){},isFunction:function(obj){return"function"===jQuery.type(obj)},isArray:Array.isArray,isWindow:function(obj){return null!=obj&&obj===obj.window},isNumeric:function(obj){var realStringObj=obj&&obj.toString();return!jQuery.isArray(obj)&&realStringObj-parseFloat(realStringObj)+1>=0},isPlainObject:function(obj){return"object"!==jQuery.type(obj)||obj.nodeType||jQuery.isWindow(obj)?!1:obj.constructor&&!hasOwn.call(obj.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(obj){var name;for(name in obj)return!1;return!0},type:function(obj){return null==obj?obj+"":"object"===("undefined"==typeof obj?"undefined":_typeof(obj))||"function"==typeof obj?class2type[toString.call(obj)]||"object":"undefined"==typeof obj?"undefined":_typeof(obj)},globalEval:function(code){var script,indirect=eval;code=jQuery.trim(code),code&&(1===code.indexOf("use strict")?(script=document.createElement("script"),script.text=code,document.head.appendChild(script).parentNode.removeChild(script)):indirect(code))},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()},each:function(obj,callback){var length,i=0;if(isArrayLike(obj))for(length=obj.length;length>i&&callback.call(obj[i],i,obj[i])!==!1;i++);else for(i in obj)if(callback.call(obj[i],i,obj[i])===!1)break;return obj},trim:function(text){return null==text?"":(text+"").replace(rtrim,"")},makeArray:function(arr,results){var ret=results||[];return null!=arr&&(isArrayLike(Object(arr))?jQuery.merge(ret,"string"==typeof arr?[arr]:arr):push.call(ret,arr)),ret},inArray:function(elem,arr,i){return null==arr?-1:indexOf.call(arr,elem,i)},merge:function(first,second){for(var len=+second.length,j=0,i=first.length;len>j;j++)first[i++]=second[j];return first.length=i,first},grep:function(elems,callback,invert){for(var callbackInverse,matches=[],i=0,length=elems.length,callbackExpect=!invert;length>i;i++)callbackInverse=!callback(elems[i],i),callbackInverse!==callbackExpect&&matches.push(elems[i]);return matches},map:function(elems,callback,arg){var length,value,i=0,ret=[];if(isArrayLike(elems))for(length=elems.length;length>i;i++)value=callback(elems[i],i,arg),null!=value&&ret.push(value);else for(i in elems)value=callback(elems[i],i,arg),null!=value&&ret.push(value);return concat.apply([],ret)},guid:1,proxy:function proxy(fn,context){var tmp,args,proxy;return"string"==typeof context&&(tmp=fn[context],context=fn,fn=tmp),jQuery.isFunction(fn)?(args=_slice.call(arguments,2),proxy=function(){return fn.apply(context||this,args.concat(_slice.call(arguments)))},proxy.guid=fn.guid=fn.guid||jQuery.guid++,proxy):void 0},now:Date.now,support:support}),"function"==typeof Symbol&&(jQuery.fn[Symbol.iterator]=arr[Symbol.iterator]),jQuery.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()});var Sizzle=function(window){function Sizzle(selector,context,results,seed){var m,i,elem,nid,nidselect,match,groups,newSelector,newContext=context&&context.ownerDocument,nodeType=context?context.nodeType:9;if(results=results||[],"string"!=typeof selector||!selector||1!==nodeType&&9!==nodeType&&11!==nodeType)return results;if(!seed&&((context?context.ownerDocument||context:preferredDoc)!==document&&setDocument(context),context=context||document,documentIsHTML)){if(11!==nodeType&&(match=rquickExpr.exec(selector)))if(m=match[1]){if(9===nodeType){if(!(elem=context.getElementById(m)))return results;if(elem.id===m)return results.push(elem),results}else if(newContext&&(elem=newContext.getElementById(m))&&contains(context,elem)&&elem.id===m)return results.push(elem),results}else{if(match[2])return push.apply(results,context.getElementsByTagName(selector)),results;if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName)return push.apply(results,context.getElementsByClassName(m)),results}if(!(!support.qsa||compilerCache[selector+" "]||rbuggyQSA&&rbuggyQSA.test(selector))){if(1!==nodeType)newContext=context,newSelector=selector;else if("object"!==context.nodeName.toLowerCase()){
for((nid=context.getAttribute("id"))?nid=nid.replace(rescape,"\\$&"):context.setAttribute("id",nid=expando),groups=tokenize(selector),i=groups.length,nidselect=ridentifier.test(nid)?"#"+nid:"[id='"+nid+"']";i--;)groups[i]=nidselect+" "+toSelector(groups[i]);newSelector=groups.join(","),newContext=rsibling.test(selector)&&testContext(context.parentNode)||context}if(newSelector)try{return push.apply(results,newContext.querySelectorAll(newSelector)),results}catch(qsaError){}finally{nid===expando&&context.removeAttribute("id")}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){function cache(key,value){return keys.push(key+" ")>Expr.cacheLength&&delete cache[keys.shift()],cache[key+" "]=value}var keys=[];return cache}function markFunction(fn){return fn[expando]=!0,fn}function assert(fn){var div=document.createElement("div");try{return!!fn(div)}catch(e){return!1}finally{div.parentNode&&div.parentNode.removeChild(div),div=null}}function addHandle(attrs,handler){for(var arr=attrs.split("|"),i=arr.length;i--;)Expr.attrHandle[arr[i]]=handler}function siblingCheck(a,b){var cur=b&&a,diff=cur&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff)return diff;if(cur)for(;cur=cur.nextSibling;)if(cur===b)return-1;return a?1:-1}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return("input"===name||"button"===name)&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){return argument=+argument,markFunction(function(seed,matches){for(var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;i--;)seed[j=matchIndexes[i]]&&(seed[j]=!(matches[j]=seed[j]))})})}function testContext(context){return context&&"undefined"!=typeof context.getElementsByTagName&&context}function setFilters(){}function toSelector(tokens){for(var i=0,len=tokens.length,selector="";len>i;i++)selector+=tokens[i].value;return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&"parentNode"===dir,doneName=done++;return combinator.first?function(elem,context,xml){for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)return matcher(elem,context,xml)}:function(elem,context,xml){var oldCache,uniqueCache,outerCache,newCache=[dirruns,doneName];if(xml){for(;elem=elem[dir];)if((1===elem.nodeType||checkNonElements)&&matcher(elem,context,xml))return!0}else for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements){if(outerCache=elem[expando]||(elem[expando]={}),uniqueCache=outerCache[elem.uniqueID]||(outerCache[elem.uniqueID]={}),(oldCache=uniqueCache[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName)return newCache[2]=oldCache[2];if(uniqueCache[dir]=newCache,newCache[2]=matcher(elem,context,xml))return!0}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){for(var i=matchers.length;i--;)if(!matchers[i](elem,context,xml))return!1;return!0}:matchers[0]}function multipleContexts(selector,contexts,results){for(var i=0,len=contexts.length;len>i;i++)Sizzle(selector,contexts[i],results);return results}function condense(unmatched,map,filter,context,xml){for(var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=null!=map;len>i;i++)(elem=unmatched[i])&&(!filter||filter(elem,context,xml))&&(newUnmatched.push(elem),mapped&&map.push(i));return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){return postFilter&&!postFilter[expando]&&(postFilter=setMatcher(postFilter)),postFinder&&!postFinder[expando]&&(postFinder=setMatcher(postFinder,postSelector)),markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=!preFilter||!seed&&selector?elems:condense(elems,preMap,preFilter,context,xml),matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher&&matcher(matcherIn,matcherOut,context,xml),postFilter)for(temp=condense(matcherOut,postMap),postFilter(temp,[],context,xml),i=temp.length;i--;)(elem=temp[i])&&(matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem));if(seed){if(postFinder||preFilter){if(postFinder){for(temp=[],i=matcherOut.length;i--;)(elem=matcherOut[i])&&temp.push(matcherIn[i]=elem);postFinder(null,matcherOut=[],temp,xml)}for(i=matcherOut.length;i--;)(elem=matcherOut[i])&&(temp=postFinder?indexOf(seed,elem):preMap[i])>-1&&(seed[temp]=!(results[temp]=elem))}}else matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut),postFinder?postFinder(null,results,matcherOut,xml):push.apply(results,matcherOut)})}function matcherFromTokens(tokens){for(var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,!0),matchAnyContext=addCombinator(function(elem){return indexOf(checkContext,elem)>-1},implicitRelative,!0),matchers=[function(elem,context,xml){var ret=!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml));return checkContext=null,ret}];len>i;i++)if(matcher=Expr.relative[tokens[i].type])matchers=[addCombinator(elementMatcher(matchers),matcher)];else{if(matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches),matcher[expando]){for(j=++i;len>j&&!Expr.relative[tokens[j].type];j++);return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:" "===tokens[i-2].type?"*":""})).replace(rtrim,"$1"),matcher,j>i&&matcherFromTokens(tokens.slice(i,j)),len>j&&matcherFromTokens(tokens=tokens.slice(j)),len>j&&toSelector(tokens))}matchers.push(matcher)}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i="0",unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",outermost),dirrunsUnique=dirruns+=null==contextBackup?1:Math.random()||.1,len=elems.length;for(outermost&&(outermostContext=context===document||context||outermost);i!==len&&null!=(elem=elems[i]);i++){if(byElement&&elem){for(j=0,context||elem.ownerDocument===document||(setDocument(elem),xml=!documentIsHTML);matcher=elementMatchers[j++];)if(matcher(elem,context||document,xml)){results.push(elem);break}outermost&&(dirruns=dirrunsUnique)}bySet&&((elem=!matcher&&elem)&&matchedCount--,seed&&unmatched.push(elem))}if(matchedCount+=i,bySet&&i!==matchedCount){for(j=0;matcher=setMatchers[j++];)matcher(unmatched,setMatched,context,xml);if(seed){if(matchedCount>0)for(;i--;)unmatched[i]||setMatched[i]||(setMatched[i]=pop.call(results));setMatched=condense(setMatched)}push.apply(results,setMatched),outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1&&Sizzle.uniqueSort(results)}return outermost&&(dirruns=dirrunsUnique,outermostContext=contextBackup),unmatched};return bySet?markFunction(superMatcher):superMatcher}var i,support,Expr,getText,isXML,tokenize,compile,select,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+1*new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){return a===b&&(hasDuplicate=!0),0},MAX_NEGATIVE=1<<31,hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=function(list,elem){for(var i=0,len=list.length;len>i;i++)if(list[i]===elem)return i;return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",identifier="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",attributes="\\["+whitespace+"*("+identifier+")(?:"+whitespace+"*([*^$|!~]?=)"+whitespace+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+identifier+"))|)"+whitespace+"*\\]",pseudos=":("+identifier+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+attributes+")*)|.*)\\)|)",rwhitespace=new RegExp(whitespace+"+","g"),rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*?)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+identifier+")"),CLASS:new RegExp("^\\.("+identifier+")"),TAG:new RegExp("^("+identifier+"|[*])"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:0>high?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,1023&high|56320)},unloadHandler=function(){setDocument()};try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes),arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){for(var j=target.length,i=0;target[j++]=els[i++];);target.length=j-1}}}support=Sizzle.support={},isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?"HTML"!==documentElement.nodeName:!1},setDocument=Sizzle.setDocument=function(node){var hasCompare,parent,doc=node?node.ownerDocument||node:preferredDoc;return doc!==document&&9===doc.nodeType&&doc.documentElement?(document=doc,docElem=document.documentElement,documentIsHTML=!isXML(document),(parent=document.defaultView)&&parent.top!==parent&&(parent.addEventListener?parent.addEventListener("unload",unloadHandler,!1):parent.attachEvent&&parent.attachEvent("onunload",unloadHandler)),support.attributes=assert(function(div){return div.className="i",!div.getAttribute("className")}),support.getElementsByTagName=assert(function(div){return div.appendChild(document.createComment("")),!div.getElementsByTagName("*").length}),support.getElementsByClassName=rnative.test(document.getElementsByClassName),support.getById=assert(function(div){return docElem.appendChild(div).id=expando,!document.getElementsByName||!document.getElementsByName(expando).length}),support.getById?(Expr.find.ID=function(id,context){if("undefined"!=typeof context.getElementById&&documentIsHTML){var m=context.getElementById(id);return m?[m]:[]}},Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}}):(delete Expr.find.ID,Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node="undefined"!=typeof elem.getAttributeNode&&elem.getAttributeNode("id");return node&&node.value===attrId}}),Expr.find.TAG=support.getElementsByTagName?function(tag,context){return"undefined"!=typeof context.getElementsByTagName?context.getElementsByTagName(tag):support.qsa?context.querySelectorAll(tag):void 0}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if("*"===tag){for(;elem=results[i++];)1===elem.nodeType&&tmp.push(elem);return tmp}return results},Expr.find.CLASS=support.getElementsByClassName&&function(className,context){return"undefined"!=typeof context.getElementsByClassName&&documentIsHTML?context.getElementsByClassName(className):void 0},rbuggyMatches=[],rbuggyQSA=[],(support.qsa=rnative.test(document.querySelectorAll))&&(assert(function(div){docElem.appendChild(div).innerHTML="<a id='"+expando+"'></a><select id='"+expando+"-\r\\' msallowcapture=''><option selected=''></option></select>",div.querySelectorAll("[msallowcapture^='']").length&&rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")"),div.querySelectorAll("[selected]").length||rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")"),div.querySelectorAll("[id~="+expando+"-]").length||rbuggyQSA.push("~="),div.querySelectorAll(":checked").length||rbuggyQSA.push(":checked"),div.querySelectorAll("a#"+expando+"+*").length||rbuggyQSA.push(".#.+[+~]")}),assert(function(div){var input=document.createElement("input");input.setAttribute("type","hidden"),div.appendChild(input).setAttribute("name","D"),div.querySelectorAll("[name=d]").length&&rbuggyQSA.push("name"+whitespace+"*[*^$|!~]?="),div.querySelectorAll(":enabled").length||rbuggyQSA.push(":enabled",":disabled"),div.querySelectorAll("*,:x"),rbuggyQSA.push(",.*:")})),(support.matchesSelector=rnative.test(matches=docElem.matches||docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector))&&assert(function(div){support.disconnectedMatch=matches.call(div,"div"),matches.call(div,"[s!='']:x"),rbuggyMatches.push("!=",pseudos)}),rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|")),rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|")),hasCompare=rnative.test(docElem.compareDocumentPosition),contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=9===a.nodeType?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!(!bup||1!==bup.nodeType||!(adown.contains?adown.contains(bup):a.compareDocumentPosition&&16&a.compareDocumentPosition(bup)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},sortOrder=hasCompare?function(a,b){if(a===b)return hasDuplicate=!0,0;var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;return compare?compare:(compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&compare||!support.sortDetached&&b.compareDocumentPosition(a)===compare?a===document||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)?-1:b===document||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)?1:sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0:4&compare?-1:1)}:function(a,b){if(a===b)return hasDuplicate=!0,0;var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup)return a===document?-1:b===document?1:aup?-1:bup?1:sortInput?indexOf(sortInput,a)-indexOf(sortInput,b):0;if(aup===bup)return siblingCheck(a,b);for(cur=a;cur=cur.parentNode;)ap.unshift(cur);for(cur=b;cur=cur.parentNode;)bp.unshift(cur);for(;ap[i]===bp[i];)i++;return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0},document):document},Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)},Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document&&setDocument(elem),expr=expr.replace(rattributeQuotes,"='$1']"),!(!support.matchesSelector||!documentIsHTML||compilerCache[expr+" "]||rbuggyMatches&&rbuggyMatches.test(expr)||rbuggyQSA&&rbuggyQSA.test(expr)))try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&11!==elem.document.nodeType)return ret}catch(e){}return Sizzle(expr,document,null,[elem]).length>0},Sizzle.contains=function(context,elem){return(context.ownerDocument||context)!==document&&setDocument(context),contains(context,elem)},Sizzle.attr=function(elem,name){(elem.ownerDocument||elem)!==document&&setDocument(elem);var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):void 0;return void 0!==val?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null},Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)},Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;if(hasDuplicate=!support.detectDuplicates,sortInput=!support.sortStable&&results.slice(0),results.sort(sortOrder),hasDuplicate){for(;elem=results[i++];)elem===results[i]&&(j=duplicates.push(i));for(;j--;)results.splice(duplicates[j],1)}return sortInput=null,results},getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(1===nodeType||9===nodeType||11===nodeType){if("string"==typeof elem.textContent)return elem.textContent;for(elem=elem.firstChild;elem;elem=elem.nextSibling)ret+=getText(elem)}else if(3===nodeType||4===nodeType)return elem.nodeValue}else for(;node=elem[i++];)ret+=getText(node);return ret},Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){return match[1]=match[1].replace(runescape,funescape),match[3]=(match[3]||match[4]||match[5]||"").replace(runescape,funescape),"~="===match[2]&&(match[3]=" "+match[3]+" "),match.slice(0,4)},CHILD:function(match){return match[1]=match[1].toLowerCase(),"nth"===match[1].slice(0,3)?(match[3]||Sizzle.error(match[0]),match[4]=+(match[4]?match[5]+(match[6]||1):2*("even"===match[3]||"odd"===match[3])),match[5]=+(match[7]+match[8]||"odd"===match[3])):match[3]&&Sizzle.error(match[0]),match},PSEUDO:function(match){var excess,unquoted=!match[6]&&match[2];return matchExpr.CHILD.test(match[0])?null:(match[3]?match[2]=match[4]||match[5]||"":unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,!0))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)&&(match[0]=match[0].slice(0,excess),match[2]=unquoted.slice(0,excess)),match.slice(0,3))}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return"*"===nodeNameSelector?function(){return!0}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test("string"==typeof elem.className&&elem.className||"undefined"!=typeof elem.getAttribute&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);return null==result?"!="===operator:operator?(result+="","="===operator?result===check:"!="===operator?result!==check:"^="===operator?check&&0===result.indexOf(check):"*="===operator?check&&result.indexOf(check)>-1:"$="===operator?check&&result.slice(-check.length)===check:"~="===operator?(" "+result.replace(rwhitespace," ")+" ").indexOf(check)>-1:"|="===operator?result===check||result.slice(0,check.length+1)===check+"-":!1):!0}},CHILD:function(type,what,argument,first,last){var simple="nth"!==type.slice(0,3),forward="last"!==type.slice(-4),ofType="of-type"===what;return 1===first&&0===last?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,uniqueCache,outerCache,node,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType,diff=!1;if(parent){if(simple){for(;dir;){for(node=elem;node=node[dir];)if(ofType?node.nodeName.toLowerCase()===name:1===node.nodeType)return!1;start=dir="only"===type&&!start&&"nextSibling"}return!0}if(start=[forward?parent.firstChild:parent.lastChild],forward&&useCache){for(node=parent,outerCache=node[expando]||(node[expando]={}),uniqueCache=outerCache[node.uniqueID]||(outerCache[node.uniqueID]={}),cache=uniqueCache[type]||[],nodeIndex=cache[0]===dirruns&&cache[1],diff=nodeIndex&&cache[2],node=nodeIndex&&parent.childNodes[nodeIndex];node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop();)if(1===node.nodeType&&++diff&&node===elem){uniqueCache[type]=[dirruns,nodeIndex,diff];break}}else if(useCache&&(node=elem,outerCache=node[expando]||(node[expando]={}),uniqueCache=outerCache[node.uniqueID]||(outerCache[node.uniqueID]={}),cache=uniqueCache[type]||[],nodeIndex=cache[0]===dirruns&&cache[1],diff=nodeIndex),diff===!1)for(;(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())&&((ofType?node.nodeName.toLowerCase()!==name:1!==node.nodeType)||!++diff||(useCache&&(outerCache=node[expando]||(node[expando]={}),uniqueCache=outerCache[node.uniqueID]||(outerCache[node.uniqueID]={}),uniqueCache[type]=[dirruns,diff]),node!==elem)););return diff-=last,diff===first||diff%first===0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);return fn[expando]?fn(argument):fn.length>1?(args=[pseudo,pseudo,"",argument],Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){for(var idx,matched=fn(seed,argument),i=matched.length;i--;)idx=indexOf(seed,matched[i]),seed[idx]=!(matches[idx]=matched[i])}):function(elem){return fn(elem,0,args)}):fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){for(var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;i--;)(elem=unmatched[i])&&(seed[i]=!(matches[i]=elem))}):function(elem,context,xml){return input[0]=elem,matcher(input,null,xml,results),input[0]=null,!results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){return text=text.replace(runescape,funescape),function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){return ridentifier.test(lang||"")||Sizzle.error("unsupported lang: "+lang),lang=lang.replace(runescape,funescape).toLowerCase(),function(elem){var elemLang;do if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))return elemLang=elemLang.toLowerCase(),elemLang===lang||0===elemLang.indexOf(lang+"-");while((elem=elem.parentNode)&&1===elem.nodeType);return!1}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return elem.disabled===!1},disabled:function(elem){return elem.disabled===!0},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return"input"===nodeName&&!!elem.checked||"option"===nodeName&&!!elem.selected},selected:function(elem){return elem.parentNode&&elem.parentNode.selectedIndex,elem.selected===!0},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling)if(elem.nodeType<6)return!1;return!0},parent:function(elem){return!Expr.pseudos.empty(elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&"button"===elem.type||"button"===name},text:function(elem){var attr;return"input"===elem.nodeName.toLowerCase()&&"text"===elem.type&&(null==(attr=elem.getAttribute("type"))||"text"===attr.toLowerCase())},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[0>argument?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){for(var i=0;length>i;i+=2)matchIndexes.push(i);return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){for(var i=1;length>i;i+=2)matchIndexes.push(i);return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=0>argument?argument+length:argument;--i>=0;)matchIndexes.push(i);return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=0>argument?argument+length:argument;++i<length;)matchIndexes.push(i);return matchIndexes})}},Expr.pseudos.nth=Expr.pseudos.eq;for(i in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})Expr.pseudos[i]=createInputPseudo(i);for(i in{submit:!0,reset:!0})Expr.pseudos[i]=createButtonPseudo(i);return setFilters.prototype=Expr.filters=Expr.pseudos,Expr.setFilters=new setFilters,tokenize=Sizzle.tokenize=function(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached)return parseOnly?0:cached.slice(0);for(soFar=selector,groups=[],preFilters=Expr.preFilter;soFar;){(!matched||(match=rcomma.exec(soFar)))&&(match&&(soFar=soFar.slice(match[0].length)||soFar),groups.push(tokens=[])),matched=!1,(match=rcombinators.exec(soFar))&&(matched=match.shift(),tokens.push({value:matched,type:match[0].replace(rtrim," ")}),soFar=soFar.slice(matched.length));for(type in Expr.filter)!(match=matchExpr[type].exec(soFar))||preFilters[type]&&!(match=preFilters[type](match))||(matched=match.shift(),tokens.push({value:matched,type:type,matches:match}),soFar=soFar.slice(matched.length));if(!matched)break}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)},compile=Sizzle.compile=function(selector,match){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){for(match||(match=tokenize(selector)),i=match.length;i--;)cached=matcherFromTokens(match[i]),cached[expando]?setMatchers.push(cached):elementMatchers.push(cached);cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers)),cached.selector=selector}return cached},select=Sizzle.select=function(selector,context,results,seed){var i,tokens,token,type,find,compiled="function"==typeof selector&&selector,match=!seed&&tokenize(selector=compiled.selector||selector);if(results=results||[],1===match.length){if(tokens=match[0]=match[0].slice(0),tokens.length>2&&"ID"===(token=tokens[0]).type&&support.getById&&9===context.nodeType&&documentIsHTML&&Expr.relative[tokens[1].type]){if(context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0],!context)return results;compiled&&(context=context.parentNode),selector=selector.slice(tokens.shift().value.length)}for(i=matchExpr.needsContext.test(selector)?0:tokens.length;i--&&(token=tokens[i],!Expr.relative[type=token.type]);)if((find=Expr.find[type])&&(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context))){if(tokens.splice(i,1),selector=seed.length&&toSelector(tokens),!selector)return push.apply(results,seed),results;break}}return(compiled||compile(selector,match))(seed,context,!documentIsHTML,results,!context||rsibling.test(selector)&&testContext(context.parentNode)||context),results},support.sortStable=expando.split("").sort(sortOrder).join("")===expando,support.detectDuplicates=!!hasDuplicate,setDocument(),support.sortDetached=assert(function(div1){return 1&div1.compareDocumentPosition(document.createElement("div"))}),assert(function(div){return div.innerHTML="<a href='#'></a>","#"===div.firstChild.getAttribute("href")})||addHandle("type|href|height|width",function(elem,name,isXML){return isXML?void 0:elem.getAttribute(name,"type"===name.toLowerCase()?1:2)}),support.attributes&&assert(function(div){return div.innerHTML="<input/>",div.firstChild.setAttribute("value",""),""===div.firstChild.getAttribute("value")})||addHandle("value",function(elem,name,isXML){return isXML||"input"!==elem.nodeName.toLowerCase()?void 0:elem.defaultValue}),assert(function(div){return null==div.getAttribute("disabled")})||addHandle(booleans,function(elem,name,isXML){var val;return isXML?void 0:elem[name]===!0?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null}),Sizzle}(window);jQuery.find=Sizzle,jQuery.expr=Sizzle.selectors,jQuery.expr[":"]=jQuery.expr.pseudos,jQuery.uniqueSort=jQuery.unique=Sizzle.uniqueSort,jQuery.text=Sizzle.getText,jQuery.isXMLDoc=Sizzle.isXML,jQuery.contains=Sizzle.contains;var dir=function(elem,_dir,until){for(var matched=[],truncate=void 0!==until;(elem=elem[_dir])&&9!==elem.nodeType;)if(1===elem.nodeType){if(truncate&&jQuery(elem).is(until))break;matched.push(elem)}return matched},_siblings=function(n,elem){for(var matched=[];n;n=n.nextSibling)1===n.nodeType&&n!==elem&&matched.push(n);return matched},rneedsContext=jQuery.expr.match.needsContext,rsingleTag=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,risSimple=/^.[^:#\[\.,]*$/;jQuery.filter=function(expr,elems,not){var elem=elems[0];return not&&(expr=":not("+expr+")"),1===elems.length&&1===elem.nodeType?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return 1===elem.nodeType}))},jQuery.fn.extend({find:function(selector){var i,len=this.length,ret=[],self=this;if("string"!=typeof selector)return this.pushStack(jQuery(selector).filter(function(){for(i=0;len>i;i++)if(jQuery.contains(self[i],this))return!0}));for(i=0;len>i;i++)jQuery.find(selector,self[i],ret);return ret=this.pushStack(len>1?jQuery.unique(ret):ret),ret.selector=this.selector?this.selector+" "+selector:selector,ret},filter:function(selector){return this.pushStack(winnow(this,selector||[],!1))},not:function(selector){return this.pushStack(winnow(this,selector||[],!0))},is:function(selector){return!!winnow(this,"string"==typeof selector&&rneedsContext.test(selector)?jQuery(selector):selector||[],!1).length}});var rootjQuery,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,init=jQuery.fn.init=function(selector,context,root){var match,elem;if(!selector)return this;if(root=root||rootjQuery,"string"==typeof selector){if(match="<"===selector[0]&&">"===selector[selector.length-1]&&selector.length>=3?[null,selector,null]:rquickExpr.exec(selector),!match||!match[1]&&context)return!context||context.jquery?(context||root).find(selector):this.constructor(context).find(selector);if(match[1]){if(context=context instanceof jQuery?context[0]:context,jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,!0)),rsingleTag.test(match[1])&&jQuery.isPlainObject(context))for(match in context)jQuery.isFunction(this[match])?this[match](context[match]):this.attr(match,context[match]);return this}return elem=document.getElementById(match[2]),elem&&elem.parentNode&&(this.length=1,this[0]=elem),this.context=document,this.selector=selector,this}return selector.nodeType?(this.context=this[0]=selector,this.length=1,this):jQuery.isFunction(selector)?void 0!==root.ready?root.ready(selector):selector(jQuery):(void 0!==selector.selector&&(this.selector=selector.selector,this.context=selector.context),jQuery.makeArray(selector,this))};init.prototype=jQuery.fn,rootjQuery=jQuery(document);var rparentsprev=/^(?:parents|prev(?:Until|All))/,guaranteedUnique={children:!0,contents:!0,next:!0,prev:!0};jQuery.fn.extend({has:function(target){var targets=jQuery(target,this),l=targets.length;

return this.filter(function(){for(var i=0;l>i;i++)if(jQuery.contains(this,targets[i]))return!0})},closest:function(selectors,context){for(var cur,i=0,l=this.length,matched=[],pos=rneedsContext.test(selectors)||"string"!=typeof selectors?jQuery(selectors,context||this.context):0;l>i;i++)for(cur=this[i];cur&&cur!==context;cur=cur.parentNode)if(cur.nodeType<11&&(pos?pos.index(cur)>-1:1===cur.nodeType&&jQuery.find.matchesSelector(cur,selectors))){matched.push(cur);break}return this.pushStack(matched.length>1?jQuery.uniqueSort(matched):matched)},index:function(elem){return elem?"string"==typeof elem?indexOf.call(jQuery(elem),this[0]):indexOf.call(this,elem.jquery?elem[0]:elem):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(selector,context){return this.pushStack(jQuery.uniqueSort(jQuery.merge(this.get(),jQuery(selector,context))))},addBack:function(selector){return this.add(null==selector?this.prevObject:this.prevObject.filter(selector))}}),jQuery.each({parent:function parent(elem){var parent=elem.parentNode;return parent&&11!==parent.nodeType?parent:null},parents:function(elem){return dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return dir(elem,"nextSibling")},prevAll:function(elem){return dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return dir(elem,"previousSibling",until)},siblings:function(elem){return _siblings((elem.parentNode||{}).firstChild,elem)},children:function(elem){return _siblings(elem.firstChild)},contents:function(elem){return elem.contentDocument||jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var matched=jQuery.map(this,fn,until);return"Until"!==name.slice(-5)&&(selector=until),selector&&"string"==typeof selector&&(matched=jQuery.filter(selector,matched)),this.length>1&&(guaranteedUnique[name]||jQuery.uniqueSort(matched),rparentsprev.test(name)&&matched.reverse()),this.pushStack(matched)}});var rnotwhite=/\S+/g;jQuery.Callbacks=function(options){options="string"==typeof options?createOptions(options):jQuery.extend({},options);var firing,memory,_fired,_locked,list=[],queue=[],firingIndex=-1,fire=function(){for(_locked=options.once,_fired=firing=!0;queue.length;firingIndex=-1)for(memory=queue.shift();++firingIndex<list.length;)list[firingIndex].apply(memory[0],memory[1])===!1&&options.stopOnFalse&&(firingIndex=list.length,memory=!1);options.memory||(memory=!1),firing=!1,_locked&&(list=memory?[]:"")},self={add:function(){return list&&(memory&&!firing&&(firingIndex=list.length-1,queue.push(memory)),function add(args){jQuery.each(args,function(_,arg){jQuery.isFunction(arg)?options.unique&&self.has(arg)||list.push(arg):arg&&arg.length&&"string"!==jQuery.type(arg)&&add(arg)})}(arguments),memory&&!firing&&fire()),this},remove:function(){return jQuery.each(arguments,function(_,arg){for(var index;(index=jQuery.inArray(arg,list,index))>-1;)list.splice(index,1),firingIndex>=index&&firingIndex--}),this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:list.length>0},empty:function(){return list&&(list=[]),this},disable:function(){return _locked=queue=[],list=memory="",this},disabled:function(){return!list},lock:function(){return _locked=queue=[],memory||(list=memory=""),this},locked:function(){return!!_locked},fireWith:function(context,args){return _locked||(args=args||[],args=[context,args.slice?args.slice():args],queue.push(args),firing||fire()),this},fire:function(){return self.fireWith(this,arguments),this},fired:function(){return!!_fired}};return self},jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],_state="pending",_promise2={state:function(){return _state},always:function(){return deferred.done(arguments).fail(arguments),this},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var fn=jQuery.isFunction(fns[i])&&fns[i];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);returned&&jQuery.isFunction(returned.promise)?returned.promise().progress(newDefer.notify).done(newDefer.resolve).fail(newDefer.reject):newDefer[tuple[0]+"With"](this===_promise2?newDefer.promise():this,fn?[returned]:arguments)})}),fns=null}).promise()},promise:function(obj){return null!=obj?jQuery.extend(obj,_promise2):_promise2}},deferred={};return _promise2.pipe=_promise2.then,jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];_promise2[tuple[1]]=list.add,stateString&&list.add(function(){_state=stateString},tuples[1^i][2].disable,tuples[2][2].lock),deferred[tuple[0]]=function(){return deferred[tuple[0]+"With"](this===deferred?_promise2:this,arguments),this},deferred[tuple[0]+"With"]=list.fireWith}),_promise2.promise(deferred),func&&func.call(deferred,deferred),deferred},when:function(subordinate){var progressValues,progressContexts,resolveContexts,i=0,resolveValues=_slice.call(arguments),length=resolveValues.length,remaining=1!==length||subordinate&&jQuery.isFunction(subordinate.promise)?length:0,deferred=1===remaining?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this,values[i]=arguments.length>1?_slice.call(arguments):value,values===progressValues?deferred.notifyWith(contexts,values):--remaining||deferred.resolveWith(contexts,values)}};if(length>1)for(progressValues=new Array(length),progressContexts=new Array(length),resolveContexts=new Array(length);length>i;i++)resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)?resolveValues[i].promise().progress(updateFunc(i,progressContexts,progressValues)).done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject):--remaining;return remaining||deferred.resolveWith(resolveContexts,resolveValues),deferred.promise()}});var readyList;jQuery.fn.ready=function(fn){return jQuery.ready.promise().done(fn),this},jQuery.extend({isReady:!1,readyWait:1,holdReady:function(hold){hold?jQuery.readyWait++:jQuery.ready(!0)},ready:function(wait){(wait===!0?--jQuery.readyWait:jQuery.isReady)||(jQuery.isReady=!0,wait!==!0&&--jQuery.readyWait>0||(readyList.resolveWith(document,[jQuery]),jQuery.fn.triggerHandler&&(jQuery(document).triggerHandler("ready"),jQuery(document).off("ready"))))}}),jQuery.ready.promise=function(obj){return readyList||(readyList=jQuery.Deferred(),"complete"===document.readyState||"loading"!==document.readyState&&!document.documentElement.doScroll?window.setTimeout(jQuery.ready):(document.addEventListener("DOMContentLoaded",completed),window.addEventListener("load",completed))),readyList.promise(obj)},jQuery.ready.promise();var access=function access(elems,fn,key,value,chainable,emptyGet,raw){var i=0,len=elems.length,bulk=null==key;if("object"===jQuery.type(key)){chainable=!0;for(i in key)access(elems,fn,i,key[i],!0,emptyGet,raw)}else if(void 0!==value&&(chainable=!0,jQuery.isFunction(value)||(raw=!0),bulk&&(raw?(fn.call(elems,value),fn=null):(bulk=fn,fn=function(elem,key,value){return bulk.call(jQuery(elem),value)})),fn))for(;len>i;i++)fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)));return chainable?elems:bulk?fn.call(elems):len?fn(elems[0],key):emptyGet},acceptData=function(owner){return 1===owner.nodeType||9===owner.nodeType||!+owner.nodeType};Data.uid=1,Data.prototype={register:function(owner,initial){var value=initial||{};return owner.nodeType?owner[this.expando]=value:Object.defineProperty(owner,this.expando,{value:value,writable:!0,configurable:!0}),owner[this.expando]},cache:function(owner){if(!acceptData(owner))return{};var value=owner[this.expando];return value||(value={},acceptData(owner)&&(owner.nodeType?owner[this.expando]=value:Object.defineProperty(owner,this.expando,{value:value,configurable:!0}))),value},set:function(owner,data,value){var prop,cache=this.cache(owner);if("string"==typeof data)cache[data]=value;else for(prop in data)cache[prop]=data[prop];return cache},get:function(owner,key){return void 0===key?this.cache(owner):owner[this.expando]&&owner[this.expando][key]},access:function(owner,key,value){var stored;return void 0===key||key&&"string"==typeof key&&void 0===value?(stored=this.get(owner,key),void 0!==stored?stored:this.get(owner,jQuery.camelCase(key))):(this.set(owner,key,value),void 0!==value?value:key)},remove:function(owner,key){var i,name,camel,cache=owner[this.expando];if(void 0!==cache){if(void 0===key)this.register(owner);else{jQuery.isArray(key)?name=key.concat(key.map(jQuery.camelCase)):(camel=jQuery.camelCase(key),key in cache?name=[key,camel]:(name=camel,name=name in cache?[name]:name.match(rnotwhite)||[])),i=name.length;for(;i--;)delete cache[name[i]]}(void 0===key||jQuery.isEmptyObject(cache))&&(owner.nodeType?owner[this.expando]=void 0:delete owner[this.expando])}},hasData:function(owner){var cache=owner[this.expando];return void 0!==cache&&!jQuery.isEmptyObject(cache)}};var dataPriv=new Data,dataUser=new Data,rbrace=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,rmultiDash=/[A-Z]/g;jQuery.extend({hasData:function(elem){return dataUser.hasData(elem)||dataPriv.hasData(elem)},data:function(elem,name,_data){return dataUser.access(elem,name,_data)},removeData:function(elem,name){dataUser.remove(elem,name)},_data:function(elem,name,data){return dataPriv.access(elem,name,data)},_removeData:function(elem,name){dataPriv.remove(elem,name)}}),jQuery.fn.extend({data:function data(key,value){var i,name,data,elem=this[0],attrs=elem&&elem.attributes;if(void 0===key){if(this.length&&(data=dataUser.get(elem),1===elem.nodeType&&!dataPriv.get(elem,"hasDataAttrs"))){for(i=attrs.length;i--;)attrs[i]&&(name=attrs[i].name,0===name.indexOf("data-")&&(name=jQuery.camelCase(name.slice(5)),dataAttr(elem,name,data[name])));dataPriv.set(elem,"hasDataAttrs",!0)}return data}return"object"===("undefined"==typeof key?"undefined":_typeof(key))?this.each(function(){dataUser.set(this,key)}):access(this,function(value){var data,camelKey;if(elem&&void 0===value){if(data=dataUser.get(elem,key)||dataUser.get(elem,key.replace(rmultiDash,"-$&").toLowerCase()),void 0!==data)return data;if(camelKey=jQuery.camelCase(key),data=dataUser.get(elem,camelKey),void 0!==data)return data;if(data=dataAttr(elem,camelKey,void 0),void 0!==data)return data}else camelKey=jQuery.camelCase(key),this.each(function(){var data=dataUser.get(this,camelKey);dataUser.set(this,camelKey,value),key.indexOf("-")>-1&&void 0!==data&&dataUser.set(this,key,value)})},null,value,arguments.length>1,null,!0)},removeData:function(key){return this.each(function(){dataUser.remove(this,key)})}}),jQuery.extend({queue:function queue(elem,type,data){var queue;return elem?(type=(type||"fx")+"queue",queue=dataPriv.get(elem,type),data&&(!queue||jQuery.isArray(data)?queue=dataPriv.access(elem,type,jQuery.makeArray(data)):queue.push(data)),queue||[]):void 0},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type)};"inprogress"===fn&&(fn=queue.shift(),startLength--),fn&&("fx"===type&&queue.unshift("inprogress"),delete hooks.stop,fn.call(elem,next,hooks)),!startLength&&hooks&&hooks.empty.fire()},_queueHooks:function(elem,type){var key=type+"queueHooks";return dataPriv.get(elem,key)||dataPriv.access(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){dataPriv.remove(elem,[type+"queue",key])})})}}),jQuery.fn.extend({queue:function(type,data){var setter=2;return"string"!=typeof type&&(data=type,type="fx",setter--),arguments.length<setter?jQuery.queue(this[0],type):void 0===data?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type),"fx"===type&&"inprogress"!==queue[0]&&jQuery.dequeue(this,type)})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){--count||defer.resolveWith(elements,[elements])};for("string"!=typeof type&&(obj=type,type=void 0),type=type||"fx";i--;)tmp=dataPriv.get(elements[i],type+"queueHooks"),tmp&&tmp.empty&&(count++,tmp.empty.add(resolve));return resolve(),defer.promise(obj)}});var pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,rcssNum=new RegExp("^(?:([+-])=|)("+pnum+")([a-z%]*)$","i"),cssExpand=["Top","Right","Bottom","Left"],isHidden=function(elem,el){return elem=el||elem,"none"===jQuery.css(elem,"display")||!jQuery.contains(elem.ownerDocument,elem)},rcheckableType=/^(?:checkbox|radio)$/i,rtagName=/<([\w:-]+)/,rscriptType=/^$|\/(?:java|ecma)script/i,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option,wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td;var rhtml=/<|&#?\w+;/;!function(){var fragment=document.createDocumentFragment(),div=fragment.appendChild(document.createElement("div")),input=document.createElement("input");input.setAttribute("type","radio"),input.setAttribute("checked","checked"),input.setAttribute("name","t"),div.appendChild(input),support.checkClone=div.cloneNode(!0).cloneNode(!0).lastChild.checked,div.innerHTML="<textarea>x</textarea>",support.noCloneChecked=!!div.cloneNode(!0).lastChild.defaultValue}();var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,rtypenamespace=/^([^.]*)(?:\.(.+)|)/;jQuery.event={global:{},add:function(elem,types,handler,data,selector){var handleObjIn,eventHandle,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=dataPriv.get(elem);if(elemData)for(handler.handler&&(handleObjIn=handler,handler=handleObjIn.handler,selector=handleObjIn.selector),handler.guid||(handler.guid=jQuery.guid++),(events=elemData.events)||(events=elemData.events={}),(eventHandle=elemData.handle)||(eventHandle=elemData.handle=function(e){return"undefined"!=typeof jQuery&&jQuery.event.triggered!==e.type?jQuery.event.dispatch.apply(elem,arguments):void 0}),types=(types||"").match(rnotwhite)||[""],t=types.length;t--;)tmp=rtypenamespace.exec(types[t])||[],type=origType=tmp[1],namespaces=(tmp[2]||"").split(".").sort(),type&&(special=jQuery.event.special[type]||{},type=(selector?special.delegateType:special.bindType)||type,special=jQuery.event.special[type]||{},handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn),(handlers=events[type])||(handlers=events[type]=[],handlers.delegateCount=0,special.setup&&special.setup.call(elem,data,namespaces,eventHandle)!==!1||elem.addEventListener&&elem.addEventListener(type,eventHandle)),special.add&&(special.add.call(elem,handleObj),handleObj.handler.guid||(handleObj.handler.guid=handler.guid)),selector?handlers.splice(handlers.delegateCount++,0,handleObj):handlers.push(handleObj),jQuery.event.global[type]=!0)},remove:function(elem,types,handler,selector,mappedTypes){var j,origCount,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=dataPriv.hasData(elem)&&dataPriv.get(elem);if(elemData&&(events=elemData.events)){for(types=(types||"").match(rnotwhite)||[""],t=types.length;t--;)if(tmp=rtypenamespace.exec(types[t])||[],type=origType=tmp[1],namespaces=(tmp[2]||"").split(".").sort(),type){for(special=jQuery.event.special[type]||{},type=(selector?special.delegateType:special.bindType)||type,handlers=events[type]||[],tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"),origCount=j=handlers.length;j--;)handleObj=handlers[j],!mappedTypes&&origType!==handleObj.origType||handler&&handler.guid!==handleObj.guid||tmp&&!tmp.test(handleObj.namespace)||selector&&selector!==handleObj.selector&&("**"!==selector||!handleObj.selector)||(handlers.splice(j,1),handleObj.selector&&handlers.delegateCount--,special.remove&&special.remove.call(elem,handleObj));origCount&&!handlers.length&&(special.teardown&&special.teardown.call(elem,namespaces,elemData.handle)!==!1||jQuery.removeEvent(elem,type,elemData.handle),delete events[type])}else for(type in events)jQuery.event.remove(elem,type+types[t],handler,selector,!0);jQuery.isEmptyObject(events)&&dataPriv.remove(elem,"handle events")}},dispatch:function(event){event=jQuery.event.fix(event);var i,j,ret,matched,handleObj,handlerQueue=[],args=_slice.call(arguments),handlers=(dataPriv.get(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};if(args[0]=event,event.delegateTarget=this,!special.preDispatch||special.preDispatch.call(this,event)!==!1){for(handlerQueue=jQuery.event.handlers.call(this,event,handlers),i=0;(matched=handlerQueue[i++])&&!event.isPropagationStopped();)for(event.currentTarget=matched.elem,j=0;(handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped();)(!event.rnamespace||event.rnamespace.test(handleObj.namespace))&&(event.handleObj=handleObj,event.data=handleObj.data,ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args),void 0!==ret&&(event.result=ret)===!1&&(event.preventDefault(),event.stopPropagation()));return special.postDispatch&&special.postDispatch.call(this,event),event.result}},handlers:function(event,_handlers){var i,matches,sel,handleObj,handlerQueue=[],delegateCount=_handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&("click"!==event.type||isNaN(event.button)||event.button<1))for(;cur!==this;cur=cur.parentNode||this)if(1===cur.nodeType&&(cur.disabled!==!0||"click"!==event.type)){for(matches=[],i=0;delegateCount>i;i++)handleObj=_handlers[i],sel=handleObj.selector+" ",void 0===matches[sel]&&(matches[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>-1:jQuery.find(sel,this,null,[cur]).length),matches[sel]&&matches.push(handleObj);matches.length&&handlerQueue.push({elem:cur,handlers:matches})}return delegateCount<_handlers.length&&handlerQueue.push({elem:this,handlers:_handlers.slice(delegateCount)}),handlerQueue},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){return null==event.which&&(event.which=null!=original.charCode?original.charCode:original.keyCode),event}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var eventDoc,doc,body,button=original.button;return null==event.pageX&&null!=original.clientX&&(eventDoc=event.target.ownerDocument||document,doc=eventDoc.documentElement,body=eventDoc.body,event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0),event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)),event.which||void 0===button||(event.which=1&button?1:2&button?3:4&button?2:0),event}},fix:function(event){if(event[jQuery.expando])return event;var i,prop,copy,type=event.type,originalEvent=event,fixHook=this.fixHooks[type];for(fixHook||(this.fixHooks[type]=fixHook=rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{}),copy=fixHook.props?this.props.concat(fixHook.props):this.props,event=new jQuery.Event(originalEvent),i=copy.length;i--;)prop=copy[i],event[prop]=originalEvent[prop];return event.target||(event.target=document),3===event.target.nodeType&&(event.target=event.target.parentNode),fixHook.filter?fixHook.filter(event,originalEvent):event},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==safeActiveElement()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===safeActiveElement()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&jQuery.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(event){return jQuery.nodeName(event.target,"a")}},beforeunload:{postDispatch:function(event){void 0!==event.result&&event.originalEvent&&(event.originalEvent.returnValue=event.result)}}}},jQuery.removeEvent=function(elem,type,handle){elem.removeEventListener&&elem.removeEventListener(type,handle)},jQuery.Event=function(src,props){return this instanceof jQuery.Event?(src&&src.type?(this.originalEvent=src,this.type=src.type,this.isDefaultPrevented=src.defaultPrevented||void 0===src.defaultPrevented&&src.returnValue===!1?returnTrue:returnFalse):this.type=src,props&&jQuery.extend(this,props),this.timeStamp=src&&src.timeStamp||jQuery.now(),void(this[jQuery.expando]=!0)):new jQuery.Event(src,props)},jQuery.Event.prototype={constructor:jQuery.Event,isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue,e&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue,e&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=returnTrue,e&&e.stopImmediatePropagation(),this.stopPropagation()}},jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;return(!related||related!==target&&!jQuery.contains(target,related))&&(event.type=handleObj.origType,ret=handleObj.handler.apply(this,arguments),event.type=fix),ret}}}),jQuery.fn.extend({on:function(types,selector,data,fn){return _on(this,types,selector,data,fn)},one:function(types,selector,data,fn){return _on(this,types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj)return handleObj=types.handleObj,jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler),this;if("object"===("undefined"==typeof types?"undefined":_typeof(types))){for(type in types)this.off(type,selector,types[type]);return this}return(selector===!1||"function"==typeof selector)&&(fn=selector,selector=void 0),fn===!1&&(fn=returnFalse),this.each(function(){jQuery.event.remove(this,types,fn,selector)})}});var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,rnoInnerhtml=/<script|<style|<link/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;jQuery.extend({htmlPrefilter:function(html){return html.replace(rxhtmlTag,"<$1></$2>")},clone:function clone(elem,dataAndEvents,deepDataAndEvents){var i,l,srcElements,destElements,clone=elem.cloneNode(!0),inPage=jQuery.contains(elem.ownerDocument,elem);if(!(support.noCloneChecked||1!==elem.nodeType&&11!==elem.nodeType||jQuery.isXMLDoc(elem)))for(destElements=getAll(clone),srcElements=getAll(elem),i=0,l=srcElements.length;l>i;i++)fixInput(srcElements[i],destElements[i]);if(dataAndEvents)if(deepDataAndEvents)for(srcElements=srcElements||getAll(elem),destElements=destElements||getAll(clone),i=0,l=srcElements.length;l>i;i++)cloneCopyEvent(srcElements[i],destElements[i]);else cloneCopyEvent(elem,clone);return destElements=getAll(clone,"script"),destElements.length>0&&setGlobalEval(destElements,!inPage&&getAll(elem,"script")),clone},cleanData:function(elems){for(var data,elem,type,special=jQuery.event.special,i=0;void 0!==(elem=elems[i]);i++)if(acceptData(elem)){if(data=elem[dataPriv.expando]){if(data.events)for(type in data.events)special[type]?jQuery.event.remove(elem,type):jQuery.removeEvent(elem,type,data.handle);elem[dataPriv.expando]=void 0}elem[dataUser.expando]&&(elem[dataUser.expando]=void 0)}}}),jQuery.fn.extend({domManip:domManip,detach:function(selector){return _remove(this,selector,!0)},remove:function(selector){return _remove(this,selector)},text:function(value){return access(this,function(value){return void 0===value?jQuery.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=value)})},null,value,arguments.length)},append:function(){return domManip(this,arguments,function(elem){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var target=manipulationTarget(this,elem);target.appendChild(elem)}})},prepend:function(){return domManip(this,arguments,function(elem){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return domManip(this,arguments,function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this)})},after:function(){return domManip(this,arguments,function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this.nextSibling)})},empty:function(){for(var elem,i=0;null!=(elem=this[i]);i++)1===elem.nodeType&&(jQuery.cleanData(getAll(elem,!1)),elem.textContent="");return this},clone:function(dataAndEvents,deepDataAndEvents){return dataAndEvents=null==dataAndEvents?!1:dataAndEvents,deepDataAndEvents=null==deepDataAndEvents?dataAndEvents:deepDataAndEvents,this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(void 0===value&&1===elem.nodeType)return elem.innerHTML;if("string"==typeof value&&!rnoInnerhtml.test(value)&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=jQuery.htmlPrefilter(value);try{for(;l>i;i++)elem=this[i]||{},1===elem.nodeType&&(jQuery.cleanData(getAll(elem,!1)),elem.innerHTML=value);elem=0}catch(e){}}elem&&this.empty().append(value)},null,value,arguments.length)},replaceWith:function(){var ignored=[];return domManip(this,arguments,function(elem){var parent=this.parentNode;jQuery.inArray(this,ignored)<0&&(jQuery.cleanData(getAll(this)),parent&&parent.replaceChild(elem,this))},ignored)}}),jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){for(var elems,ret=[],insert=jQuery(selector),last=insert.length-1,i=0;last>=i;i++)elems=i===last?this:this.clone(!0),jQuery(insert[i])[original](elems),push.apply(ret,elems.get());return this.pushStack(ret)}});var iframe,elemdisplay={HTML:"block",BODY:"block"},rmargin=/^margin/,rnumnonpx=new RegExp("^("+pnum+")(?!px)[a-z%]+$","i"),getStyles=function(elem){var view=elem.ownerDocument.defaultView;return view.opener||(view=window),view.getComputedStyle(elem)},swap=function(elem,options,callback,args){var ret,name,old={};for(name in options)old[name]=elem.style[name],elem.style[name]=options[name];ret=callback.apply(elem,args||[]);for(name in options)elem.style[name]=old[name];return ret},documentElement=document.documentElement;!function(){function computeStyleTests(){div.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",div.innerHTML="",documentElement.appendChild(container);var divStyle=window.getComputedStyle(div);pixelPositionVal="1%"!==divStyle.top,reliableMarginLeftVal="2px"===divStyle.marginLeft,boxSizingReliableVal="4px"===divStyle.width,div.style.marginRight="50%",pixelMarginRightVal="4px"===divStyle.marginRight,documentElement.removeChild(container)}var pixelPositionVal,boxSizingReliableVal,pixelMarginRightVal,reliableMarginLeftVal,container=document.createElement("div"),div=document.createElement("div");div.style&&(div.style.backgroundClip="content-box",div.cloneNode(!0).style.backgroundClip="",support.clearCloneStyle="content-box"===div.style.backgroundClip,container.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",container.appendChild(div),jQuery.extend(support,{pixelPosition:function(){return computeStyleTests(),pixelPositionVal},boxSizingReliable:function(){return null==boxSizingReliableVal&&computeStyleTests(),boxSizingReliableVal},pixelMarginRight:function(){return null==boxSizingReliableVal&&computeStyleTests(),pixelMarginRightVal},reliableMarginLeft:function(){return null==boxSizingReliableVal&&computeStyleTests(),reliableMarginLeftVal},reliableMarginRight:function(){var ret,marginDiv=div.appendChild(document.createElement("div"));return marginDiv.style.cssText=div.style.cssText="-webkit-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",marginDiv.style.marginRight=marginDiv.style.width="0",div.style.width="1px",documentElement.appendChild(container),ret=!parseFloat(window.getComputedStyle(marginDiv).marginRight),documentElement.removeChild(container),div.removeChild(marginDiv),ret}}))}();var rdisplayswap=/^(none|table(?!-c[ea]).+)/,cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:"0",fontWeight:"400"},cssPrefixes=["Webkit","O","Moz","ms"],emptyStyle=document.createElement("div").style;jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return""===ret?"1":ret}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function style(elem,name,value,extra){if(elem&&3!==elem.nodeType&&8!==elem.nodeType&&elem.style){var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;return name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(origName)||origName),hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName],void 0===value?hooks&&"get"in hooks&&void 0!==(ret=hooks.get(elem,!1,extra))?ret:style[name]:(type="undefined"==typeof value?"undefined":_typeof(value),"string"===type&&(ret=rcssNum.exec(value))&&ret[1]&&(value=adjustCSS(elem,name,ret),type="number"),null!=value&&value===value&&("number"===type&&(value+=ret&&ret[3]||(jQuery.cssNumber[origName]?"":"px")),support.clearCloneStyle||""!==value||0!==name.indexOf("background")||(style[name]="inherit"),hooks&&"set"in hooks&&void 0===(value=hooks.set(elem,value,extra))||(style[name]=value)),void 0)}},css:function(elem,name,extra,styles){var val,num,hooks,origName=jQuery.camelCase(name);return name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(origName)||origName),hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName],hooks&&"get"in hooks&&(val=hooks.get(elem,!0,extra)),void 0===val&&(val=curCSS(elem,name,styles)),"normal"===val&&name in cssNormalTransform&&(val=cssNormalTransform[name]),""===extra||extra?(num=parseFloat(val),extra===!0||isFinite(num)?num||0:val):val}}),jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){return computed?rdisplayswap.test(jQuery.css(elem,"display"))&&0===elem.offsetWidth?swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)}):getWidthOrHeight(elem,name,extra):void 0},set:function(elem,value,extra){var matches,styles=extra&&getStyles(elem),subtract=extra&&augmentWidthOrHeight(elem,name,extra,"border-box"===jQuery.css(elem,"boxSizing",!1,styles),styles);

return subtract&&(matches=rcssNum.exec(value))&&"px"!==(matches[3]||"px")&&(elem.style[name]=value,value=jQuery.css(elem,name)),setPositiveNumber(elem,value,subtract)}}}),jQuery.cssHooks.marginLeft=addGetHookIf(support.reliableMarginLeft,function(elem,computed){return computed?(parseFloat(curCSS(elem,"marginLeft"))||elem.getBoundingClientRect().left-swap(elem,{marginLeft:0},function(){return elem.getBoundingClientRect().left}))+"px":void 0}),jQuery.cssHooks.marginRight=addGetHookIf(support.reliableMarginRight,function(elem,computed){return computed?swap(elem,{display:"inline-block"},curCSS,[elem,"marginRight"]):void 0}),jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){for(var i=0,expanded={},parts="string"==typeof value?value.split(" "):[value];4>i;i++)expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0];return expanded}},rmargin.test(prefix)||(jQuery.cssHooks[prefix+suffix].set=setPositiveNumber)}),jQuery.fn.extend({css:function(name,value){return access(this,function(elem,name,value){var styles,len,map={},i=0;if(jQuery.isArray(name)){for(styles=getStyles(elem),len=name.length;len>i;i++)map[name[i]]=jQuery.css(elem,name[i],!1,styles);return map}return void 0!==value?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},show:function(){return showHide(this,!0)},hide:function(){return showHide(this)},toggle:function(state){return"boolean"==typeof state?state?this.show():this.hide():this.each(function(){isHidden(this)?jQuery(this).show():jQuery(this).hide()})}}),jQuery.Tween=Tween,Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem,this.prop=prop,this.easing=easing||jQuery.easing._default,this.options=options,this.start=this.now=this.cur(),this.end=end,this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];return this.pos=eased=this.options.duration?jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration):percent,this.now=(this.end-this.start)*eased+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),hooks&&hooks.set?hooks.set(this):Tween.propHooks._default.set(this),this}},Tween.prototype.init.prototype=Tween.prototype,Tween.propHooks={_default:{get:function(tween){var result;return 1!==tween.elem.nodeType||null!=tween.elem[tween.prop]&&null==tween.elem.style[tween.prop]?tween.elem[tween.prop]:(result=jQuery.css(tween.elem,tween.prop,""),result&&"auto"!==result?result:0)},set:function(tween){jQuery.fx.step[tween.prop]?jQuery.fx.step[tween.prop](tween):1!==tween.elem.nodeType||null==tween.elem.style[jQuery.cssProps[tween.prop]]&&!jQuery.cssHooks[tween.prop]?tween.elem[tween.prop]=tween.now:jQuery.style(tween.elem,tween.prop,tween.now+tween.unit)}}},Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){tween.elem.nodeType&&tween.elem.parentNode&&(tween.elem[tween.prop]=tween.now)}},jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2},_default:"swing"},jQuery.fx=Tween.prototype.init,jQuery.fx.step={};var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rrun=/queueHooks$/;jQuery.Animation=jQuery.extend(Animation,{tweeners:{"*":[function(prop,value){var tween=this.createTween(prop,value);return adjustCSS(tween.elem,prop,rcssNum.exec(value),tween),tween}]},tweener:function(props,callback){jQuery.isFunction(props)?(callback=props,props=["*"]):props=props.match(rnotwhite);for(var prop,index=0,length=props.length;length>index;index++)prop=props[index],Animation.tweeners[prop]=Animation.tweeners[prop]||[],Animation.tweeners[prop].unshift(callback)},prefilters:[defaultPrefilter],prefilter:function(callback,prepend){prepend?Animation.prefilters.unshift(callback):Animation.prefilters.push(callback)}}),jQuery.speed=function(speed,easing,fn){var opt=speed&&"object"===("undefined"==typeof speed?"undefined":_typeof(speed))?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};return opt.duration=jQuery.fx.off?0:"number"==typeof opt.duration?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default,(null==opt.queue||opt.queue===!0)&&(opt.queue="fx"),opt.old=opt.complete,opt.complete=function(){jQuery.isFunction(opt.old)&&opt.old.call(this),opt.queue&&jQuery.dequeue(this,opt.queue)},opt},jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);(empty||dataPriv.get(this,"finish"))&&anim.stop(!0)};return doAnimation.finish=doAnimation,empty||optall.queue===!1?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop,stop(gotoEnd)};return"string"!=typeof type&&(gotoEnd=clearQueue,clearQueue=type,type=void 0),clearQueue&&type!==!1&&this.queue(type||"fx",[]),this.each(function(){var dequeue=!0,index=null!=type&&type+"queueHooks",timers=jQuery.timers,data=dataPriv.get(this);if(index)data[index]&&data[index].stop&&stopQueue(data[index]);else for(index in data)data[index]&&data[index].stop&&rrun.test(index)&&stopQueue(data[index]);for(index=timers.length;index--;)timers[index].elem!==this||null!=type&&timers[index].queue!==type||(timers[index].anim.stop(gotoEnd),dequeue=!1,timers.splice(index,1));(dequeue||!gotoEnd)&&jQuery.dequeue(this,type)})},finish:function(type){return type!==!1&&(type=type||"fx"),this.each(function(){var index,data=dataPriv.get(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;for(data.finish=!0,jQuery.queue(this,type,[]),hooks&&hooks.stop&&hooks.stop.call(this,!0),index=timers.length;index--;)timers[index].elem===this&&timers[index].queue===type&&(timers[index].anim.stop(!0),timers.splice(index,1));for(index=0;length>index;index++)queue[index]&&queue[index].finish&&queue[index].finish.call(this);delete data.finish})}}),jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return null==speed||"boolean"==typeof speed?cssFn.apply(this,arguments):this.animate(genFx(name,!0),speed,easing,callback)}}),jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}}),jQuery.timers=[],jQuery.fx.tick=function(){var timer,i=0,timers=jQuery.timers;for(fxNow=jQuery.now();i<timers.length;i++)timer=timers[i],timer()||timers[i]!==timer||timers.splice(i--,1);timers.length||jQuery.fx.stop(),fxNow=void 0},jQuery.fx.timer=function(timer){jQuery.timers.push(timer),timer()?jQuery.fx.start():jQuery.timers.pop()},jQuery.fx.interval=13,jQuery.fx.start=function(){timerId||(timerId=window.setInterval(jQuery.fx.tick,jQuery.fx.interval))},jQuery.fx.stop=function(){window.clearInterval(timerId),timerId=null},jQuery.fx.speeds={slow:600,fast:200,_default:400},jQuery.fn.delay=function(time,type){return time=jQuery.fx?jQuery.fx.speeds[time]||time:time,type=type||"fx",this.queue(type,function(next,hooks){var timeout=window.setTimeout(next,time);hooks.stop=function(){window.clearTimeout(timeout)}})},function(){var input=document.createElement("input"),select=document.createElement("select"),opt=select.appendChild(document.createElement("option"));input.type="checkbox",support.checkOn=""!==input.value,support.optSelected=opt.selected,select.disabled=!0,support.optDisabled=!opt.disabled,input=document.createElement("input"),input.value="t",input.type="radio",support.radioValue="t"===input.value}();var boolHook,attrHandle=jQuery.expr.attrHandle;jQuery.fn.extend({attr:function(name,value){return access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})}}),jQuery.extend({attr:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(3!==nType&&8!==nType&&2!==nType)return"undefined"==typeof elem.getAttribute?jQuery.prop(elem,name,value):(1===nType&&jQuery.isXMLDoc(elem)||(name=name.toLowerCase(),hooks=jQuery.attrHooks[name]||(jQuery.expr.match.bool.test(name)?boolHook:void 0)),void 0!==value?null===value?void jQuery.removeAttr(elem,name):hooks&&"set"in hooks&&void 0!==(ret=hooks.set(elem,value,name))?ret:(elem.setAttribute(name,value+""),value):hooks&&"get"in hooks&&null!==(ret=hooks.get(elem,name))?ret:(ret=jQuery.find.attr(elem,name),null==ret?void 0:ret))},attrHooks:{type:{set:function(elem,value){if(!support.radioValue&&"radio"===value&&jQuery.nodeName(elem,"input")){var val=elem.value;return elem.setAttribute("type",value),val&&(elem.value=val),value}}}},removeAttr:function(elem,value){var name,propName,i=0,attrNames=value&&value.match(rnotwhite);if(attrNames&&1===elem.nodeType)for(;name=attrNames[i++];)propName=jQuery.propFix[name]||name,jQuery.expr.match.bool.test(name)&&(elem[propName]=!1),elem.removeAttribute(name)}}),boolHook={set:function(elem,value,name){return value===!1?jQuery.removeAttr(elem,name):elem.setAttribute(name,name),name}},jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=attrHandle[name]||jQuery.find.attr;attrHandle[name]=function(elem,name,isXML){var ret,handle;return isXML||(handle=attrHandle[name],attrHandle[name]=ret,ret=null!=getter(elem,name,isXML)?name.toLowerCase():null,attrHandle[name]=handle),ret}});var rfocusable=/^(?:input|select|textarea|button)$/i,rclickable=/^(?:a|area)$/i;jQuery.fn.extend({prop:function(name,value){return access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){return this.each(function(){delete this[jQuery.propFix[name]||name]})}}),jQuery.extend({prop:function(elem,name,value){var ret,hooks,nType=elem.nodeType;if(3!==nType&&8!==nType&&2!==nType)return 1===nType&&jQuery.isXMLDoc(elem)||(name=jQuery.propFix[name]||name,hooks=jQuery.propHooks[name]),void 0!==value?hooks&&"set"in hooks&&void 0!==(ret=hooks.set(elem,value,name))?ret:elem[name]=value:hooks&&"get"in hooks&&null!==(ret=hooks.get(elem,name))?ret:elem[name]},propHooks:{tabIndex:{get:function(elem){var tabindex=jQuery.find.attr(elem,"tabindex");return tabindex?parseInt(tabindex,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),support.optSelected||(jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;return parent&&parent.parentNode&&parent.parentNode.selectedIndex,null}}),jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this});var rclass=/[\t\r\n\f]/g;jQuery.fn.extend({addClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(jQuery.isFunction(value))return this.each(function(j){jQuery(this).addClass(value.call(this,j,getClass(this)))});if("string"==typeof value&&value)for(classes=value.match(rnotwhite)||[];elem=this[i++];)if(curValue=getClass(elem),cur=1===elem.nodeType&&(" "+curValue+" ").replace(rclass," ")){for(j=0;clazz=classes[j++];)cur.indexOf(" "+clazz+" ")<0&&(cur+=clazz+" ");finalValue=jQuery.trim(cur),curValue!==finalValue&&elem.setAttribute("class",finalValue)}return this},removeClass:function(value){var classes,elem,cur,curValue,clazz,j,finalValue,i=0;if(jQuery.isFunction(value))return this.each(function(j){jQuery(this).removeClass(value.call(this,j,getClass(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof value&&value)for(classes=value.match(rnotwhite)||[];elem=this[i++];)if(curValue=getClass(elem),cur=1===elem.nodeType&&(" "+curValue+" ").replace(rclass," ")){for(j=0;clazz=classes[j++];)for(;cur.indexOf(" "+clazz+" ")>-1;)cur=cur.replace(" "+clazz+" "," ");finalValue=jQuery.trim(cur),curValue!==finalValue&&elem.setAttribute("class",finalValue)}return this},toggleClass:function(value,stateVal){var type="undefined"==typeof value?"undefined":_typeof(value);return"boolean"==typeof stateVal&&"string"===type?stateVal?this.addClass(value):this.removeClass(value):this.each(jQuery.isFunction(value)?function(i){jQuery(this).toggleClass(value.call(this,i,getClass(this),stateVal),stateVal)}:function(){var className,i,self,classNames;if("string"===type)for(i=0,self=jQuery(this),classNames=value.match(rnotwhite)||[];className=classNames[i++];)self.hasClass(className)?self.removeClass(className):self.addClass(className);else(void 0===value||"boolean"===type)&&(className=getClass(this),className&&dataPriv.set(this,"__className__",className),this.setAttribute&&this.setAttribute("class",className||value===!1?"":dataPriv.get(this,"__className__")||""))})},hasClass:function(selector){var className,elem,i=0;for(className=" "+selector+" ";elem=this[i++];)if(1===elem.nodeType&&(" "+getClass(elem)+" ").replace(rclass," ").indexOf(className)>-1)return!0;return!1}});var rreturn=/\r/g;jQuery.fn.extend({val:function(value){var hooks,ret,isFunction,elem=this[0];{if(arguments.length)return isFunction=jQuery.isFunction(value),this.each(function(i){var val;1===this.nodeType&&(val=isFunction?value.call(this,i,jQuery(this).val()):value,null==val?val="":"number"==typeof val?val+="":jQuery.isArray(val)&&(val=jQuery.map(val,function(value){return null==value?"":value+""})),hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()],hooks&&"set"in hooks&&void 0!==hooks.set(this,val,"value")||(this.value=val))});if(elem)return hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()],hooks&&"get"in hooks&&void 0!==(ret=hooks.get(elem,"value"))?ret:(ret=elem.value,"string"==typeof ret?ret.replace(rreturn,""):null==ret?"":ret)}}}),jQuery.extend({valHooks:{option:{get:function(elem){return jQuery.trim(elem.value)}},select:{get:function(elem){for(var value,option,options=elem.options,index=elem.selectedIndex,one="select-one"===elem.type||0>index,values=one?null:[],max=one?index+1:options.length,i=0>index?max:one?index:0;max>i;i++)if(option=options[i],!(!option.selected&&i!==index||(support.optDisabled?option.disabled:null!==option.getAttribute("disabled"))||option.parentNode.disabled&&jQuery.nodeName(option.parentNode,"optgroup"))){if(value=jQuery(option).val(),one)return value;values.push(value)}return values},set:function(elem,value){for(var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;i--;)option=options[i],(option.selected=jQuery.inArray(jQuery.valHooks.option.get(option),values)>-1)&&(optionSet=!0);return optionSet||(elem.selectedIndex=-1),values}}}}),jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){return jQuery.isArray(value)?elem.checked=jQuery.inArray(jQuery(elem).val(),value)>-1:void 0}},support.checkOn||(jQuery.valHooks[this].get=function(elem){return null===elem.getAttribute("value")?"on":elem.value})});var rfocusMorph=/^(?:focusinfocus|focusoutblur)$/;jQuery.extend(jQuery.event,{trigger:function(event,data,elem,onlyHandlers){var i,cur,tmp,bubbleType,ontype,handle,special,eventPath=[elem||document],type=hasOwn.call(event,"type")?event.type:event,namespaces=hasOwn.call(event,"namespace")?event.namespace.split("."):[];if(cur=tmp=elem=elem||document,3!==elem.nodeType&&8!==elem.nodeType&&!rfocusMorph.test(type+jQuery.event.triggered)&&(type.indexOf(".")>-1&&(namespaces=type.split("."),type=namespaces.shift(),namespaces.sort()),ontype=type.indexOf(":")<0&&"on"+type,event=event[jQuery.expando]?event:new jQuery.Event(type,"object"===("undefined"==typeof event?"undefined":_typeof(event))&&event),event.isTrigger=onlyHandlers?2:3,event.namespace=namespaces.join("."),event.rnamespace=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,event.result=void 0,event.target||(event.target=elem),data=null==data?[event]:jQuery.makeArray(data,[event]),special=jQuery.event.special[type]||{},onlyHandlers||!special.trigger||special.trigger.apply(elem,data)!==!1)){if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){for(bubbleType=special.delegateType||type,rfocusMorph.test(bubbleType+type)||(cur=cur.parentNode);cur;cur=cur.parentNode)eventPath.push(cur),tmp=cur;tmp===(elem.ownerDocument||document)&&eventPath.push(tmp.defaultView||tmp.parentWindow||window)}for(i=0;(cur=eventPath[i++])&&!event.isPropagationStopped();)event.type=i>1?bubbleType:special.bindType||type,handle=(dataPriv.get(cur,"events")||{})[event.type]&&dataPriv.get(cur,"handle"),handle&&handle.apply(cur,data),handle=ontype&&cur[ontype],handle&&handle.apply&&acceptData(cur)&&(event.result=handle.apply(cur,data),event.result===!1&&event.preventDefault());return event.type=type,onlyHandlers||event.isDefaultPrevented()||special._default&&special._default.apply(eventPath.pop(),data)!==!1||!acceptData(elem)||ontype&&jQuery.isFunction(elem[type])&&!jQuery.isWindow(elem)&&(tmp=elem[ontype],tmp&&(elem[ontype]=null),jQuery.event.triggered=type,elem[type](),jQuery.event.triggered=void 0,tmp&&(elem[ontype]=tmp)),event.result}},simulate:function(type,elem,event){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:!0});jQuery.event.trigger(e,null,elem),e.isDefaultPrevented()&&event.preventDefault()}}),jQuery.fn.extend({trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];return elem?jQuery.event.trigger(type,data,elem,!0):void 0}}),jQuery.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}}),jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)}}),support.focusin="onfocusin"in window,support.focusin||jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event))};jQuery.event.special[fix]={setup:function(){var doc=this.ownerDocument||this,attaches=dataPriv.access(doc,fix);attaches||doc.addEventListener(orig,handler,!0),dataPriv.access(doc,fix,(attaches||0)+1)},teardown:function(){var doc=this.ownerDocument||this,attaches=dataPriv.access(doc,fix)-1;attaches?dataPriv.access(doc,fix,attaches):(doc.removeEventListener(orig,handler,!0),dataPriv.remove(doc,fix))}}});var location=window.location,nonce=jQuery.now(),rquery=/\?/;jQuery.parseJSON=function(data){return JSON.parse(data+"")},jQuery.parseXML=function(data){var xml;if(!data||"string"!=typeof data)return null;try{xml=(new window.DOMParser).parseFromString(data,"text/xml")}catch(e){xml=void 0}return(!xml||xml.getElementsByTagName("parsererror").length)&&jQuery.error("Invalid XML: "+data),xml};var rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/gm,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,prefilters={},transports={},allTypes="*/".concat("*"),originAnchor=document.createElement("a");originAnchor.href=location.href,jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:location.href,type:"GET",isLocal:rlocalProtocol.test(location.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;2!==state&&(state=2,timeoutTimer&&window.clearTimeout(timeoutTimer),transport=void 0,responseHeadersString=headers||"",jqXHR.readyState=status>0?4:0,isSuccess=status>=200&&300>status||304===status,responses&&(response=ajaxHandleResponses(s,jqXHR,responses)),response=ajaxConvert(s,response,jqXHR,isSuccess),isSuccess?(s.ifModified&&(modified=jqXHR.getResponseHeader("Last-Modified"),modified&&(jQuery.lastModified[cacheURL]=modified),modified=jqXHR.getResponseHeader("etag"),modified&&(jQuery.etag[cacheURL]=modified)),204===status||"HEAD"===s.type?statusText="nocontent":304===status?statusText="notmodified":(statusText=response.state,success=response.data,error=response.error,isSuccess=!error)):(error=statusText,(status||!statusText)&&(statusText="error",0>status&&(status=0))),jqXHR.status=status,jqXHR.statusText=(nativeStatusText||statusText)+"",isSuccess?deferred.resolveWith(callbackContext,[success,statusText,jqXHR]):deferred.rejectWith(callbackContext,[jqXHR,statusText,error]),jqXHR.statusCode(_statusCode),_statusCode=void 0,fireGlobals&&globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error]),completeDeferred.fireWith(callbackContext,[jqXHR,statusText]),fireGlobals&&(globalEventContext.trigger("ajaxComplete",[jqXHR,s]),--jQuery.active||jQuery.event.trigger("ajaxStop")))}"object"===("undefined"==typeof url?"undefined":_typeof(url))&&(options=url,url=void 0),options=options||{};var transport,cacheURL,responseHeadersString,responseHeaders,timeoutTimer,urlAnchor,fireGlobals,i,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),_statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(2===state){if(!responseHeaders)for(responseHeaders={};match=rheaders.exec(responseHeadersString);)responseHeaders[match[1].toLowerCase()]=match[2];match=responseHeaders[key.toLowerCase()]}return null==match?null:match},getAllResponseHeaders:function(){return 2===state?responseHeadersString:null},setRequestHeader:function(name,value){var lname=name.toLowerCase();return state||(name=requestHeadersNames[lname]=requestHeadersNames[lname]||name,requestHeaders[name]=value),this},overrideMimeType:function(type){return state||(s.mimeType=type),this},statusCode:function(map){var code;if(map)if(2>state)for(code in map)_statusCode[code]=[_statusCode[code],map[code]];else jqXHR.always(map[jqXHR.status]);return this},abort:function(statusText){var finalText=statusText||strAbort;return transport&&transport.abort(finalText),done(0,finalText),this}};if(deferred.promise(jqXHR).complete=completeDeferred.add,jqXHR.success=jqXHR.done,jqXHR.error=jqXHR.fail,s.url=((url||s.url||location.href)+"").replace(rhash,"").replace(rprotocol,location.protocol+"//"),s.type=options.method||options.type||s.method||s.type,s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().match(rnotwhite)||[""],null==s.crossDomain){urlAnchor=document.createElement("a");try{urlAnchor.href=s.url,urlAnchor.href=urlAnchor.href,s.crossDomain=originAnchor.protocol+"//"+originAnchor.host!=urlAnchor.protocol+"//"+urlAnchor.host}catch(e){s.crossDomain=!0}}if(s.data&&s.processData&&"string"!=typeof s.data&&(s.data=jQuery.param(s.data,s.traditional)),inspectPrefiltersOrTransports(prefilters,s,options,jqXHR),2===state)return jqXHR;fireGlobals=jQuery.event&&s.global,fireGlobals&&0===jQuery.active++&&jQuery.event.trigger("ajaxStart"),s.type=s.type.toUpperCase(),s.hasContent=!rnoContent.test(s.type),cacheURL=s.url,s.hasContent||(s.data&&(cacheURL=s.url+=(rquery.test(cacheURL)?"&":"?")+s.data,delete s.data),s.cache===!1&&(s.url=rts.test(cacheURL)?cacheURL.replace(rts,"$1_="+nonce++):cacheURL+(rquery.test(cacheURL)?"&":"?")+"_="+nonce++)),s.ifModified&&(jQuery.lastModified[cacheURL]&&jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL]),jQuery.etag[cacheURL]&&jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])),(s.data&&s.hasContent&&s.contentType!==!1||options.contentType)&&jqXHR.setRequestHeader("Content-Type",s.contentType),jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+("*"!==s.dataTypes[0]?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers)jqXHR.setRequestHeader(i,s.headers[i]);if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===!1||2===state))return jqXHR.abort();strAbort="abort";for(i in{success:1,error:1,complete:1})jqXHR[i](s[i]);if(transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR)){if(jqXHR.readyState=1,fireGlobals&&globalEventContext.trigger("ajaxSend",[jqXHR,s]),2===state)return jqXHR;s.async&&s.timeout>0&&(timeoutTimer=window.setTimeout(function(){jqXHR.abort("timeout")},s.timeout));try{state=1,transport.send(requestHeaders,done)}catch(e){if(!(2>state))throw e;done(-1,e)}}else done(-1,"No Transport");return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,void 0,callback,"script")}}),jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){return jQuery.isFunction(data)&&(type=type||callback,callback=data,data=void 0),jQuery.ajax(jQuery.extend({url:url,type:method,dataType:type,data:data,success:callback},jQuery.isPlainObject(url)&&url))}}),jQuery._evalUrl=function(url){return jQuery.ajax({url:url,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},jQuery.fn.extend({wrapAll:function(html){var wrap;return jQuery.isFunction(html)?this.each(function(i){jQuery(this).wrapAll(html.call(this,i))}):(this[0]&&(wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&wrap.insertBefore(this[0]),wrap.map(function(){for(var elem=this;elem.firstElementChild;)elem=elem.firstElementChild;return elem}).append(this)),this)},wrapInner:function(html){return this.each(jQuery.isFunction(html)?function(i){jQuery(this).wrapInner(html.call(this,i))}:function(){var self=jQuery(this),contents=self.contents();contents.length?contents.wrapAll(html):self.append(html)})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){jQuery.nodeName(this,"body")||jQuery(this).replaceWith(this.childNodes)}).end()}}),jQuery.expr.filters.hidden=function(elem){return!jQuery.expr.filters.visible(elem)},jQuery.expr.filters.visible=function(elem){return elem.offsetWidth>0||elem.offsetHeight>0||elem.getClientRects().length>0};var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():null==value?"":value,s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};if(void 0===traditional&&(traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional),jQuery.isArray(a)||a.jquery&&!jQuery.isPlainObject(a))jQuery.each(a,function(){add(this.name,this.value)});else for(prefix in a)buildParams(prefix,a[prefix],traditional,add);return s.join("&").replace(r20,"+")},jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!rcheckableType.test(type))}).map(function(i,elem){var val=jQuery(this).val();return null==val?null:jQuery.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}}),jQuery.ajaxSettings.xhr=function(){try{return new window.XMLHttpRequest}catch(e){}};var xhrSuccessStatus={0:200,1223:204},xhrSupported=jQuery.ajaxSettings.xhr();support.cors=!!xhrSupported&&"withCredentials"in xhrSupported,support.ajax=xhrSupported=!!xhrSupported,jQuery.ajaxTransport(function(options){var _callback,errorCallback;return support.cors||xhrSupported&&!options.crossDomain?{send:function(headers,complete){var i,xhr=options.xhr();if(xhr.open(options.type,options.url,options.async,options.username,options.password),options.xhrFields)for(i in options.xhrFields)xhr[i]=options.xhrFields[i];options.mimeType&&xhr.overrideMimeType&&xhr.overrideMimeType(options.mimeType),options.crossDomain||headers["X-Requested-With"]||(headers["X-Requested-With"]="XMLHttpRequest");for(i in headers)xhr.setRequestHeader(i,headers[i]);_callback=function(type){return function(){_callback&&(_callback=errorCallback=xhr.onload=xhr.onerror=xhr.onabort=xhr.onreadystatechange=null,"abort"===type?xhr.abort():"error"===type?"number"!=typeof xhr.status?complete(0,"error"):complete(xhr.status,xhr.statusText):complete(xhrSuccessStatus[xhr.status]||xhr.status,xhr.statusText,"text"!==(xhr.responseType||"text")||"string"!=typeof xhr.responseText?{binary:xhr.response}:{text:xhr.responseText},xhr.getAllResponseHeaders()))}},xhr.onload=_callback(),errorCallback=xhr.onerror=_callback("error"),void 0!==xhr.onabort?xhr.onabort=errorCallback:xhr.onreadystatechange=function(){4===xhr.readyState&&window.setTimeout(function(){_callback&&errorCallback()})},_callback=_callback("abort");try{xhr.send(options.hasContent&&options.data||null)}catch(e){if(_callback)throw e}},abort:function(){_callback&&_callback()}}:void 0}),jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(text){return jQuery.globalEval(text),text}}}),jQuery.ajaxPrefilter("script",function(s){void 0===s.cache&&(s.cache=!1),s.crossDomain&&(s.type="GET")}),jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,_callback2;return{send:function(_,complete){script=jQuery("<script>").prop({charset:s.scriptCharset,src:s.url}).on("load error",_callback2=function(evt){script.remove(),_callback2=null,evt&&complete("error"===evt.type?404:200,evt.type)}),document.head.appendChild(script[0])},abort:function(){_callback2&&_callback2()}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+"_"+nonce++;return this[callback]=!0,callback}}),jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==!1&&(rjsonp.test(s.url)?"url":"string"==typeof s.data&&0===(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(s.data)&&"data");

return jsonProp||"jsonp"===s.dataTypes[0]?(callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback,jsonProp?s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName):s.jsonp!==!1&&(s.url+=(rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName),s.converters["script json"]=function(){return responseContainer||jQuery.error(callbackName+" was not called"),responseContainer[0]},s.dataTypes[0]="json",overwritten=window[callbackName],window[callbackName]=function(){responseContainer=arguments},jqXHR.always(function(){void 0===overwritten?jQuery(window).removeProp(callbackName):window[callbackName]=overwritten,s[callbackName]&&(s.jsonpCallback=originalSettings.jsonpCallback,oldCallbacks.push(callbackName)),responseContainer&&jQuery.isFunction(overwritten)&&overwritten(responseContainer[0]),responseContainer=overwritten=void 0}),"script"):void 0}),support.createHTMLDocument=function(){var body=document.implementation.createHTMLDocument("").body;return body.innerHTML="<form></form><form></form>",2===body.childNodes.length}(),jQuery.parseHTML=function(data,context,keepScripts){if(!data||"string"!=typeof data)return null;"boolean"==typeof context&&(keepScripts=context,context=!1),context=context||(support.createHTMLDocument?document.implementation.createHTMLDocument(""):document);var parsed=rsingleTag.exec(data),scripts=!keepScripts&&[];return parsed?[context.createElement(parsed[1])]:(parsed=buildFragment([data],context,scripts),scripts&&scripts.length&&jQuery(scripts).remove(),jQuery.merge([],parsed.childNodes))};var _load=jQuery.fn.load;jQuery.fn.load=function(url,params,callback){if("string"!=typeof url&&_load)return _load.apply(this,arguments);var selector,type,response,self=this,off=url.indexOf(" ");return off>-1&&(selector=jQuery.trim(url.slice(off)),url=url.slice(0,off)),jQuery.isFunction(params)?(callback=params,params=void 0):params&&"object"===("undefined"==typeof params?"undefined":_typeof(params))&&(type="POST"),self.length>0&&jQuery.ajax({url:url,type:type||"GET",dataType:"html",data:params}).done(function(responseText){response=arguments,self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).always(callback&&function(jqXHR,status){self.each(function(){callback.apply(self,response||[jqXHR.responseText,status,jqXHR])})}),this},jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}}),jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length},jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,calculatePosition,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};"static"===position&&(elem.style.position="relative"),curOffset=curElem.offset(),curCSSTop=jQuery.css(elem,"top"),curCSSLeft=jQuery.css(elem,"left"),calculatePosition=("absolute"===position||"fixed"===position)&&(curCSSTop+curCSSLeft).indexOf("auto")>-1,calculatePosition?(curPosition=curElem.position(),curTop=curPosition.top,curLeft=curPosition.left):(curTop=parseFloat(curCSSTop)||0,curLeft=parseFloat(curCSSLeft)||0),jQuery.isFunction(options)&&(options=options.call(elem,i,jQuery.extend({},curOffset))),null!=options.top&&(props.top=options.top-curOffset.top+curTop),null!=options.left&&(props.left=options.left-curOffset.left+curLeft),"using"in options?options.using.call(elem,props):curElem.css(props)}},jQuery.fn.extend({offset:function(options){if(arguments.length)return void 0===options?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)});var docElem,win,elem=this[0],box={top:0,left:0},doc=elem&&elem.ownerDocument;if(doc)return docElem=doc.documentElement,jQuery.contains(docElem,elem)?(box=elem.getBoundingClientRect(),win=getWindow(doc),{top:box.top+win.pageYOffset-docElem.clientTop,left:box.left+win.pageXOffset-docElem.clientLeft}):box},position:function(){if(this[0]){var offsetParent,offset,elem=this[0],parentOffset={top:0,left:0};return"fixed"===jQuery.css(elem,"position")?offset=elem.getBoundingClientRect():(offsetParent=this.offsetParent(),offset=this.offset(),jQuery.nodeName(offsetParent[0],"html")||(parentOffset=offsetParent.offset()),parentOffset.top+=jQuery.css(offsetParent[0],"borderTopWidth",!0)-offsetParent.scrollTop(),parentOffset.left+=jQuery.css(offsetParent[0],"borderLeftWidth",!0)-offsetParent.scrollLeft()),{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",!0),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var offsetParent=this.offsetParent;offsetParent&&"static"===jQuery.css(offsetParent,"position");)offsetParent=offsetParent.offsetParent;return offsetParent||documentElement})}}),jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top="pageYOffset"===prop;jQuery.fn[method]=function(val){return access(this,function(elem,method,val){var win=getWindow(elem);return void 0===val?win?win[prop]:elem[method]:void(win?win.scrollTo(top?win.pageXOffset:val,top?val:win.pageYOffset):elem[method]=val)},method,val,arguments.length)}}),jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]=addGetHookIf(support.pixelPosition,function(elem,computed){return computed?(computed=curCSS(elem,prop),rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed):void 0})}),jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||"boolean"!=typeof margin),extra=defaultExtra||(margin===!0||value===!0?"margin":"border");return access(this,function(elem,type,value){var doc;return jQuery.isWindow(elem)?elem.document.documentElement["client"+name]:9===elem.nodeType?(doc=elem.documentElement,Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])):void 0===value?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:void 0,chainable,null)}})}),jQuery.fn.extend({bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return 1===arguments.length?this.off(selector,"**"):this.off(types,selector||"**",fn)},size:function(){return this.length}}),jQuery.fn.andSelf=jQuery.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return jQuery});var _jQuery=window.jQuery,_$=window.$;return jQuery.noConflict=function(deep){return window.$===jQuery&&(window.$=_$),deep&&window.jQuery===jQuery&&(window.jQuery=_jQuery),jQuery},noGlobal||(window.jQuery=window.$=jQuery),jQuery}),/*!
  * https://github.com/paulmillr/es6-shim
  * @license es6-shim Copyright 2013-2016 by Paul Miller (http://paulmillr.com)
  *   and contributors,  MIT License
  * es6-shim: v0.34.4
  * see https://github.com/paulmillr/es6-shim/blob/0.34.4/LICENSE
  * Details and documentation:
  * https://github.com/paulmillr/es6-shim/
  */
function(root,factory){"function"==typeof define&&define.amd?define("es6-shim",factory):"object"===("undefined"==typeof exports?"undefined":_typeof(exports))?module.exports=factory():root.returnExports=factory()}(this,function(){var ArrayIterator,_apply=Function.call.bind(Function.apply),_call=Function.call.bind(Function.call),isArray=Array.isArray,keys=Object.keys,not=function(func){return function(){return!_apply(func,this,arguments)}},throwsError=function(func){try{return func(),!1}catch(e){return!0}},valueOrFalseIfThrows=function(func){try{return func()}catch(e){return!1}},isCallableWithoutNew=not(throwsError),arePropertyDescriptorsSupported=function(){return!throwsError(function(){Object.defineProperty({},"x",{get:function(){}})})},supportsDescriptors=!!Object.defineProperty&&arePropertyDescriptorsSupported(),functionsHaveNames="foo"===function(){}.name,_forEach=Function.call.bind(Array.prototype.forEach),_reduce=Function.call.bind(Array.prototype.reduce),_filter=Function.call.bind(Array.prototype.filter),_some=Function.call.bind(Array.prototype.some),defineProperty=function(object,name,value,force){!force&&name in object||(supportsDescriptors?Object.defineProperty(object,name,{configurable:!0,enumerable:!1,writable:!0,value:value}):object[name]=value)},defineProperties=function(object,map,forceOverride){_forEach(keys(map),function(name){var method=map[name];defineProperty(object,name,method,!!forceOverride)})},_toString=Function.call.bind(Object.prototype.toString),isCallable="function"==typeof/abc/?function(x){return"function"==typeof x&&"[object Function]"===_toString(x)}:function(x){return"function"==typeof x},Value={getter:function(object,name,_getter){if(!supportsDescriptors)throw new TypeError("getters require true ES5 support");Object.defineProperty(object,name,{configurable:!0,enumerable:!1,get:_getter})},proxy:function(originalObject,key,targetObject){if(!supportsDescriptors)throw new TypeError("getters require true ES5 support");var originalDescriptor=Object.getOwnPropertyDescriptor(originalObject,key);Object.defineProperty(targetObject,key,{configurable:originalDescriptor.configurable,enumerable:originalDescriptor.enumerable,get:function(){return originalObject[key]},set:function(value){originalObject[key]=value}})},redefine:function(object,property,newValue){if(supportsDescriptors){var descriptor=Object.getOwnPropertyDescriptor(object,property);descriptor.value=newValue,Object.defineProperty(object,property,descriptor)}else object[property]=newValue},defineByDescriptor:function(object,property,descriptor){supportsDescriptors?Object.defineProperty(object,property,descriptor):"value"in descriptor&&(object[property]=descriptor.value)},preserveToString:function(target,source){source&&isCallable(source.toString)&&defineProperty(target,"toString",source.toString.bind(source),!0)}},create=Object.create||function(prototype,properties){var Prototype=function(){};Prototype.prototype=prototype;var object=new Prototype;return"undefined"!=typeof properties&&keys(properties).forEach(function(key){Value.defineByDescriptor(object,key,properties[key])}),object},supportsSubclassing=function(C,f){return Object.setPrototypeOf?valueOrFalseIfThrows(function(){var Sub=function Subclass(arg){var o=new C(arg);return Object.setPrototypeOf(o,Subclass.prototype),o};return Object.setPrototypeOf(Sub,C),Sub.prototype=create(C.prototype,{constructor:{value:Sub}}),f(Sub)}):!1},getGlobal=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")},globals=getGlobal(),globalIsFinite=globals.isFinite,_indexOf=Function.call.bind(String.prototype.indexOf),_concat=Function.call.bind(Array.prototype.concat),_sort=Function.call.bind(Array.prototype.sort),_strSlice=Function.call.bind(String.prototype.slice),_push=Function.call.bind(Array.prototype.push),_pushApply=Function.apply.bind(Array.prototype.push),_shift=Function.call.bind(Array.prototype.shift),_max=Math.max,_min=Math.min,_floor=Math.floor,_abs=Math.abs,_log=Math.log,_sqrt=Math.sqrt,_hasOwnProperty=Function.call.bind(Object.prototype.hasOwnProperty),noop=function(){},_Symbol=globals.Symbol||{},symbolSpecies=_Symbol.species||"@@species",numberIsNaN=Number.isNaN||function(value){return value!==value},numberIsFinite=Number.isFinite||function(value){return"number"==typeof value&&globalIsFinite(value)},isStandardArguments=function(value){return"[object Arguments]"===_toString(value)},isLegacyArguments=function(value){return null!==value&&"object"===("undefined"==typeof value?"undefined":_typeof(value))&&"number"==typeof value.length&&value.length>=0&&"[object Array]"!==_toString(value)&&"[object Function]"===_toString(value.callee)},isArguments=isStandardArguments(arguments)?isStandardArguments:isLegacyArguments,Type={primitive:function(x){return null===x||"function"!=typeof x&&"object"!==("undefined"==typeof x?"undefined":_typeof(x))},object:function(x){return null!==x&&"object"===("undefined"==typeof x?"undefined":_typeof(x))},string:function(x){return"[object String]"===_toString(x)},regex:function(x){return"[object RegExp]"===_toString(x)},symbol:function(x){return"function"==typeof globals.Symbol&&"symbol"===("undefined"==typeof x?"undefined":_typeof(x))}},overrideNative=function(object,property,replacement){var original=object[property];defineProperty(object,property,replacement,!0),Value.preserveToString(object[property],original)},hasSymbols="function"==typeof _Symbol&&"function"==typeof _Symbol["for"]&&Type.symbol(_Symbol()),$iterator$=Type.symbol(_Symbol.iterator)?_Symbol.iterator:"_es6-shim iterator_";globals.Set&&"function"==typeof(new globals.Set)["@@iterator"]&&($iterator$="@@iterator"),globals.Reflect||defineProperty(globals,"Reflect",{});var Reflect=globals.Reflect,$String=String,ES={Call:function(F,V){var args=arguments.length>2?arguments[2]:[];if(!ES.IsCallable(F))throw new TypeError(F+" is not a function");return _apply(F,V,args)},RequireObjectCoercible:function(x,optMessage){if(null==x)throw new TypeError(optMessage||"Cannot call method on "+x);return x},TypeIsObject:function(x){return void 0===x||null===x||x===!0||x===!1?!1:"function"==typeof x||"object"===("undefined"==typeof x?"undefined":_typeof(x))},ToObject:function(o,optMessage){return Object(ES.RequireObjectCoercible(o,optMessage))},IsCallable:isCallable,IsConstructor:function(x){return ES.IsCallable(x)},ToInt32:function(x){return ES.ToNumber(x)>>0},ToUint32:function(x){return ES.ToNumber(x)>>>0},ToNumber:function(value){if("[object Symbol]"===_toString(value))throw new TypeError("Cannot convert a Symbol value to a number");return+value},ToInteger:function(value){var number=ES.ToNumber(value);return numberIsNaN(number)?0:0!==number&&numberIsFinite(number)?(number>0?1:-1)*_floor(_abs(number)):number},ToLength:function(value){var len=ES.ToInteger(value);return 0>=len?0:len>Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:len},SameValue:function(a,b){return a===b?0===a?1/a===1/b:!0:numberIsNaN(a)&&numberIsNaN(b)},SameValueZero:function(a,b){return a===b||numberIsNaN(a)&&numberIsNaN(b)},IsIterable:function(o){return ES.TypeIsObject(o)&&("undefined"!=typeof o[$iterator$]||isArguments(o))},GetIterator:function(o){if(isArguments(o))return new ArrayIterator(o,"value");var itFn=ES.GetMethod(o,$iterator$);if(!ES.IsCallable(itFn))throw new TypeError("value is not an iterable");var it=ES.Call(itFn,o);if(!ES.TypeIsObject(it))throw new TypeError("bad iterator");return it},GetMethod:function(o,p){var func=ES.ToObject(o)[p];if(void 0===func||null===func)return void 0;if(!ES.IsCallable(func))throw new TypeError("Method not callable: "+p);return func},IteratorComplete:function(iterResult){return!!iterResult.done},IteratorClose:function(iterator,completionIsThrow){var returnMethod=ES.GetMethod(iterator,"return");if(void 0!==returnMethod){var innerResult,innerException;try{innerResult=ES.Call(returnMethod,iterator)}catch(e){innerException=e}if(!completionIsThrow){if(innerException)throw innerException;if(!ES.TypeIsObject(innerResult))throw new TypeError("Iterator's return method returned a non-object.")}}},IteratorNext:function(it){var result=arguments.length>1?it.next(arguments[1]):it.next();if(!ES.TypeIsObject(result))throw new TypeError("bad iterator");return result},IteratorStep:function(it){var result=ES.IteratorNext(it),done=ES.IteratorComplete(result);return done?!1:result},Construct:function(C,args,newTarget,isES6internal){var target="undefined"==typeof newTarget?C:newTarget;if(!isES6internal&&Reflect.construct)return Reflect.construct(C,args,target);var proto=target.prototype;ES.TypeIsObject(proto)||(proto=Object.prototype);var obj=create(proto),result=ES.Call(C,obj,args);return ES.TypeIsObject(result)?result:obj},SpeciesConstructor:function(O,defaultConstructor){var C=O.constructor;if(void 0===C)return defaultConstructor;if(!ES.TypeIsObject(C))throw new TypeError("Bad constructor");var S=C[symbolSpecies];if(void 0===S||null===S)return defaultConstructor;if(!ES.IsConstructor(S))throw new TypeError("Bad @@species");return S},CreateHTML:function(string,tag,attribute,value){var S=ES.ToString(string),p1="<"+tag;if(""!==attribute){var V=ES.ToString(value),escapedV=V.replace(/"/g,"&quot;");p1+=" "+attribute+'="'+escapedV+'"'}var p2=p1+">",p3=p2+S;return p3+"</"+tag+">"},IsRegExp:function(argument){if(!ES.TypeIsObject(argument))return!1;var isRegExp=argument[_Symbol.match];return"undefined"!=typeof isRegExp?!!isRegExp:Type.regex(argument)},ToString:function(string){return $String(string)}};if(supportsDescriptors&&hasSymbols){var defineWellKnownSymbol=function(name){if(Type.symbol(_Symbol[name]))return _Symbol[name];var sym=_Symbol["for"]("Symbol."+name);return Object.defineProperty(_Symbol,name,{configurable:!1,enumerable:!1,writable:!1,value:sym}),sym};if(!Type.symbol(_Symbol.search)){var symbolSearch=defineWellKnownSymbol("search"),originalSearch=String.prototype.search;defineProperty(RegExp.prototype,symbolSearch,function(string){return ES.Call(originalSearch,string,[this])});var searchShim=function(regexp){var O=ES.RequireObjectCoercible(this);if(null!==regexp&&"undefined"!=typeof regexp){var searcher=ES.GetMethod(regexp,symbolSearch);if("undefined"!=typeof searcher)return ES.Call(searcher,regexp,[O])}return ES.Call(originalSearch,O,[ES.ToString(regexp)])};overrideNative(String.prototype,"search",searchShim)}if(!Type.symbol(_Symbol.replace)){var symbolReplace=defineWellKnownSymbol("replace"),originalReplace=String.prototype.replace;defineProperty(RegExp.prototype,symbolReplace,function(string,replaceValue){return ES.Call(originalReplace,string,[this,replaceValue])});var replaceShim=function(searchValue,replaceValue){var O=ES.RequireObjectCoercible(this);if(null!==searchValue&&"undefined"!=typeof searchValue){var replacer=ES.GetMethod(searchValue,symbolReplace);if("undefined"!=typeof replacer)return ES.Call(replacer,searchValue,[O,replaceValue])}return ES.Call(originalReplace,O,[ES.ToString(searchValue),replaceValue])};overrideNative(String.prototype,"replace",replaceShim)}if(!Type.symbol(_Symbol.split)){var symbolSplit=defineWellKnownSymbol("split"),originalSplit=String.prototype.split;defineProperty(RegExp.prototype,symbolSplit,function(string,limit){return ES.Call(originalSplit,string,[this,limit])});var splitShim=function(separator,limit){var O=ES.RequireObjectCoercible(this);if(null!==separator&&"undefined"!=typeof separator){var splitter=ES.GetMethod(separator,symbolSplit);if("undefined"!=typeof splitter)return ES.Call(splitter,separator,[O,limit])}return ES.Call(originalSplit,O,[ES.ToString(separator),limit])};overrideNative(String.prototype,"split",splitShim)}var symbolMatchExists=Type.symbol(_Symbol.match),stringMatchIgnoresSymbolMatch=symbolMatchExists&&function(){var o={};return o[_Symbol.match]=function(){return 42},42!=="a".match(o)}();if(!symbolMatchExists||stringMatchIgnoresSymbolMatch){var symbolMatch=defineWellKnownSymbol("match"),originalMatch=String.prototype.match;defineProperty(RegExp.prototype,symbolMatch,function(string){return ES.Call(originalMatch,string,[this])});var matchShim=function(regexp){var O=ES.RequireObjectCoercible(this);if(null!==regexp&&"undefined"!=typeof regexp){var matcher=ES.GetMethod(regexp,symbolMatch);if("undefined"!=typeof matcher)return ES.Call(matcher,regexp,[O])}return ES.Call(originalMatch,O,[ES.ToString(regexp)])};overrideNative(String.prototype,"match",matchShim)}}var wrapConstructor=function(original,replacement,keysToSkip){Value.preserveToString(replacement,original),Object.setPrototypeOf&&Object.setPrototypeOf(original,replacement),supportsDescriptors?_forEach(Object.getOwnPropertyNames(original),function(key){key in noop||keysToSkip[key]||Value.proxy(original,key,replacement)}):_forEach(Object.keys(original),function(key){key in noop||keysToSkip[key]||(replacement[key]=original[key])}),replacement.prototype=original.prototype,Value.redefine(original.prototype,"constructor",replacement)},defaultSpeciesGetter=function(){return this},addDefaultSpecies=function(C){supportsDescriptors&&!_hasOwnProperty(C,symbolSpecies)&&Value.getter(C,symbolSpecies,defaultSpeciesGetter)},addIterator=function(prototype,impl){var implementation=impl||function(){return this};defineProperty(prototype,$iterator$,implementation),!prototype[$iterator$]&&Type.symbol($iterator$)&&(prototype[$iterator$]=implementation)},createDataProperty=function(object,name,value){supportsDescriptors?Object.defineProperty(object,name,{configurable:!0,enumerable:!0,writable:!0,value:value}):object[name]=value},createDataPropertyOrThrow=function(object,name,value){if(createDataProperty(object,name,value),!ES.SameValue(object[name],value))throw new TypeError("property is nonconfigurable")},emulateES6construct=function(o,defaultNewTarget,defaultProto,slots){if(!ES.TypeIsObject(o))throw new TypeError("Constructor requires `new`: "+defaultNewTarget.name);var proto=defaultNewTarget.prototype;ES.TypeIsObject(proto)||(proto=defaultProto);var obj=create(proto);for(var name in slots)if(_hasOwnProperty(slots,name)){var value=slots[name];defineProperty(obj,name,value,!0)}return obj};if(String.fromCodePoint&&1!==String.fromCodePoint.length){var originalFromCodePoint=String.fromCodePoint;overrideNative(String,"fromCodePoint",function(){return ES.Call(originalFromCodePoint,this,arguments)})}var StringShims={fromCodePoint:function(){for(var next,result=[],i=0,length=arguments.length;length>i;i++){if(next=Number(arguments[i]),!ES.SameValue(next,ES.ToInteger(next))||0>next||next>1114111)throw new RangeError("Invalid code point "+next);65536>next?_push(result,String.fromCharCode(next)):(next-=65536,_push(result,String.fromCharCode((next>>10)+55296)),_push(result,String.fromCharCode(next%1024+56320)))}return result.join("")},raw:function(callSite){var cooked=ES.ToObject(callSite,"bad callSite"),rawString=ES.ToObject(cooked.raw,"bad raw value"),len=rawString.length,literalsegments=ES.ToLength(len);if(0>=literalsegments)return"";for(var nextKey,next,nextSeg,nextSub,stringElements=[],nextIndex=0;literalsegments>nextIndex&&(nextKey=ES.ToString(nextIndex),nextSeg=ES.ToString(rawString[nextKey]),_push(stringElements,nextSeg),!(nextIndex+1>=literalsegments));)next=nextIndex+1<arguments.length?arguments[nextIndex+1]:"",nextSub=ES.ToString(next),_push(stringElements,nextSub),nextIndex+=1;return stringElements.join("")}};String.raw&&"xy"!==String.raw({raw:{0:"x",1:"y",length:2}})&&overrideNative(String,"raw",StringShims.raw),defineProperties(String,StringShims);var stringRepeat=function repeat(s,times){if(1>times)return"";if(times%2)return repeat(s,times-1)+s;var half=repeat(s,times/2);return half+half},stringMaxLength=1/0,StringPrototypeShims={repeat:function(times){var thisStr=ES.ToString(ES.RequireObjectCoercible(this)),numTimes=ES.ToInteger(times);if(0>numTimes||numTimes>=stringMaxLength)throw new RangeError("repeat count must be less than infinity and not overflow maximum string size");return stringRepeat(thisStr,numTimes)},startsWith:function(searchString){var S=ES.ToString(ES.RequireObjectCoercible(this));if(ES.IsRegExp(searchString))throw new TypeError('Cannot call method "startsWith" with a regex');var position,searchStr=ES.ToString(searchString);arguments.length>1&&(position=arguments[1]);var start=_max(ES.ToInteger(position),0);return _strSlice(S,start,start+searchStr.length)===searchStr},endsWith:function(searchString){var S=ES.ToString(ES.RequireObjectCoercible(this));if(ES.IsRegExp(searchString))throw new TypeError('Cannot call method "endsWith" with a regex');var endPosition,searchStr=ES.ToString(searchString),len=S.length;arguments.length>1&&(endPosition=arguments[1]);var pos="undefined"==typeof endPosition?len:ES.ToInteger(endPosition),end=_min(_max(pos,0),len);return _strSlice(S,end-searchStr.length,end)===searchStr},includes:function(searchString){if(ES.IsRegExp(searchString))throw new TypeError('"includes" does not accept a RegExp');var position,searchStr=ES.ToString(searchString);return arguments.length>1&&(position=arguments[1]),-1!==_indexOf(this,searchStr,position)},codePointAt:function(pos){var thisStr=ES.ToString(ES.RequireObjectCoercible(this)),position=ES.ToInteger(pos),length=thisStr.length;if(position>=0&&length>position){var first=thisStr.charCodeAt(position),isEnd=position+1===length;if(55296>first||first>56319||isEnd)return first;var second=thisStr.charCodeAt(position+1);return 56320>second||second>57343?first:1024*(first-55296)+(second-56320)+65536}}};if(String.prototype.includes&&"a".includes("a",1/0)!==!1&&overrideNative(String.prototype,"includes",StringPrototypeShims.includes),String.prototype.startsWith&&String.prototype.endsWith){var startsWithRejectsRegex=throwsError(function(){"/a/".startsWith(/a/)}),startsWithHandlesInfinity=valueOrFalseIfThrows(function(){return"abc".startsWith("a",1/0)===!1});startsWithRejectsRegex&&startsWithHandlesInfinity||(overrideNative(String.prototype,"startsWith",StringPrototypeShims.startsWith),overrideNative(String.prototype,"endsWith",StringPrototypeShims.endsWith))}if(hasSymbols){var startsWithSupportsSymbolMatch=valueOrFalseIfThrows(function(){var re=/a/;return re[_Symbol.match]=!1,"/a/".startsWith(re)});startsWithSupportsSymbolMatch||overrideNative(String.prototype,"startsWith",StringPrototypeShims.startsWith);var endsWithSupportsSymbolMatch=valueOrFalseIfThrows(function(){var re=/a/;return re[_Symbol.match]=!1,"/a/".endsWith(re)});endsWithSupportsSymbolMatch||overrideNative(String.prototype,"endsWith",StringPrototypeShims.endsWith);var includesSupportsSymbolMatch=valueOrFalseIfThrows(function(){var re=/a/;return re[_Symbol.match]=!1,"/a/".includes(re)});includesSupportsSymbolMatch||overrideNative(String.prototype,"includes",StringPrototypeShims.includes)}defineProperties(String.prototype,StringPrototypeShims);var ws=["	\n\f\r ","\u2028","\u2029"].join(""),trimRegexp=new RegExp("(^["+ws+"]+)|(["+ws+"]+$)","g"),trimShim=function(){return ES.ToString(ES.RequireObjectCoercible(this)).replace(trimRegexp,"")},nonWS=["","",""].join(""),nonWSregex=new RegExp("["+nonWS+"]","g"),isBadHexRegex=/^[\-+]0x[0-9a-f]+$/i,hasStringTrimBug=nonWS.trim().length!==nonWS.length;defineProperty(String.prototype,"trim",trimShim,hasStringTrimBug);var StringIterator=function(s){ES.RequireObjectCoercible(s),this._s=ES.ToString(s),this._i=0};StringIterator.prototype.next=function(){var s=this._s,i=this._i;if("undefined"==typeof s||i>=s.length)return this._s=void 0,{value:void 0,done:!0};var second,len,first=s.charCodeAt(i);return 55296>first||first>56319||i+1===s.length?len=1:(second=s.charCodeAt(i+1),len=56320>second||second>57343?1:2),this._i=i+len,{value:s.substr(i,len),done:!1}},addIterator(StringIterator.prototype),addIterator(String.prototype,function(){return new StringIterator(this)});var ArrayShims={from:function(items){var mapFn,C=this;arguments.length>1&&(mapFn=arguments[1]);var mapping,T;if("undefined"==typeof mapFn)mapping=!1;else{if(!ES.IsCallable(mapFn))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(T=arguments[2]),mapping=!0}var length,result,i,usingIterator="undefined"!=typeof(isArguments(items)||ES.GetMethod(items,$iterator$));if(usingIterator){result=ES.IsConstructor(C)?Object(new C):[];var next,nextValue,iterator=ES.GetIterator(items);for(i=0;;){if(next=ES.IteratorStep(iterator),next===!1)break;nextValue=next.value;try{mapping&&(nextValue="undefined"==typeof T?mapFn(nextValue,i):_call(mapFn,T,nextValue,i)),result[i]=nextValue}catch(e){throw ES.IteratorClose(iterator,!0),e}i+=1}length=i}else{var arrayLike=ES.ToObject(items);length=ES.ToLength(arrayLike.length),result=ES.IsConstructor(C)?Object(new C(length)):new Array(length);var value;for(i=0;length>i;++i)value=arrayLike[i],mapping&&(value="undefined"==typeof T?mapFn(value,i):_call(mapFn,T,value,i)),result[i]=value}return result.length=length,result},of:function(){for(var len=arguments.length,C=this,A=isArray(C)||!ES.IsCallable(C)?new Array(len):ES.Construct(C,[len]),k=0;len>k;++k)createDataPropertyOrThrow(A,k,arguments[k]);return A.length=len,A}};defineProperties(Array,ArrayShims),addDefaultSpecies(Array);var iteratorResult=function(x){return{value:x,done:0===arguments.length}};ArrayIterator=function(array,kind){this.i=0,this.array=array,this.kind=kind},defineProperties(ArrayIterator.prototype,{next:function(){var i=this.i,array=this.array;if(!(this instanceof ArrayIterator))throw new TypeError("Not an ArrayIterator");if("undefined"!=typeof array)for(var len=ES.ToLength(array.length);len>i;i++){var retval,kind=this.kind;return"key"===kind?retval=i:"value"===kind?retval=array[i]:"entry"===kind&&(retval=[i,array[i]]),this.i=i+1,{value:retval,done:!1}}return this.array=void 0,{value:void 0,done:!0}}}),addIterator(ArrayIterator.prototype);var orderKeys=function(a,b){var aNumeric=String(ES.ToInteger(a))===a,bNumeric=String(ES.ToInteger(b))===b;return aNumeric&&bNumeric?b-a:aNumeric&&!bNumeric?-1:!aNumeric&&bNumeric?1:a.localeCompare(b)},getAllKeys=function(object){var ownKeys=[],keys=[];for(var key in object)_push(_hasOwnProperty(object,key)?ownKeys:keys,key);return _sort(ownKeys,orderKeys),_sort(keys,orderKeys),_concat(ownKeys,keys)},ObjectIterator=function(object,kind){defineProperties(this,{object:object,array:getAllKeys(object),kind:kind})};defineProperties(ObjectIterator.prototype,{next:function(){var key,array=this.array;if(!(this instanceof ObjectIterator))throw new TypeError("Not an ObjectIterator");for(;array.length>0;)if(key=_shift(array),key in this.object)return iteratorResult("key"===this.kind?key:"value"===this.kind?this.object[key]:[key,this.object[key]]);return iteratorResult()}}),addIterator(ObjectIterator.prototype);var arrayOfSupportsSubclassing=Array.of===ArrayShims.of||function(){var Foo=function(len){this.length=len};Foo.prototype=[];var fooArr=Array.of.apply(Foo,[1,2]);return fooArr instanceof Foo&&2===fooArr.length}();arrayOfSupportsSubclassing||overrideNative(Array,"of",ArrayShims.of);var ArrayPrototypeShims={copyWithin:function(target,start){var end,o=ES.ToObject(this),len=ES.ToLength(o.length),relativeTarget=ES.ToInteger(target),relativeStart=ES.ToInteger(start),to=0>relativeTarget?_max(len+relativeTarget,0):_min(relativeTarget,len),from=0>relativeStart?_max(len+relativeStart,0):_min(relativeStart,len);arguments.length>2&&(end=arguments[2]);var relativeEnd="undefined"==typeof end?len:ES.ToInteger(end),finalItem=0>relativeEnd?_max(len+relativeEnd,0):_min(relativeEnd,len),count=_min(finalItem-from,len-to),direction=1;for(to>from&&from+count>to&&(direction=-1,from+=count-1,to+=count-1);count>0;)from in o?o[to]=o[from]:delete o[to],from+=direction,to+=direction,count-=1;return o},fill:function(value){var start;arguments.length>1&&(start=arguments[1]);var end;arguments.length>2&&(end=arguments[2]);var O=ES.ToObject(this),len=ES.ToLength(O.length);start=ES.ToInteger("undefined"==typeof start?0:start),end=ES.ToInteger("undefined"==typeof end?len:end);for(var relativeStart=0>start?_max(len+start,0):_min(start,len),relativeEnd=0>end?len+end:end,i=relativeStart;len>i&&relativeEnd>i;++i)O[i]=value;return O},find:function(predicate){var list=ES.ToObject(this),length=ES.ToLength(list.length);if(!ES.IsCallable(predicate))throw new TypeError("Array#find: predicate must be a function");for(var value,thisArg=arguments.length>1?arguments[1]:null,i=0;length>i;i++)if(value=list[i],thisArg){if(_call(predicate,thisArg,value,i,list))return value}else if(predicate(value,i,list))return value},findIndex:function(predicate){var list=ES.ToObject(this),length=ES.ToLength(list.length);if(!ES.IsCallable(predicate))throw new TypeError("Array#findIndex: predicate must be a function");for(var thisArg=arguments.length>1?arguments[1]:null,i=0;length>i;i++)if(thisArg){if(_call(predicate,thisArg,list[i],i,list))return i}else if(predicate(list[i],i,list))return i;return-1},keys:function(){return new ArrayIterator(this,"key")},values:function(){return new ArrayIterator(this,"value")},entries:function(){return new ArrayIterator(this,"entry")}};if(Array.prototype.keys&&!ES.IsCallable([1].keys().next)&&delete Array.prototype.keys,Array.prototype.entries&&!ES.IsCallable([1].entries().next)&&delete Array.prototype.entries,Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[$iterator$]&&(defineProperties(Array.prototype,{values:Array.prototype[$iterator$]}),Type.symbol(_Symbol.unscopables)&&(Array.prototype[_Symbol.unscopables].values=!0)),functionsHaveNames&&Array.prototype.values&&"values"!==Array.prototype.values.name){var originalArrayPrototypeValues=Array.prototype.values;overrideNative(Array.prototype,"values",function(){return ES.Call(originalArrayPrototypeValues,this,arguments)}),defineProperty(Array.prototype,$iterator$,Array.prototype.values,!0)}defineProperties(Array.prototype,ArrayPrototypeShims),addIterator(Array.prototype,function(){return this.values()}),Object.getPrototypeOf&&addIterator(Object.getPrototypeOf([].values()));var arrayFromSwallowsNegativeLengths=function(){return valueOrFalseIfThrows(function(){return 0===Array.from({length:-1}).length})}(),arrayFromHandlesIterables=function(){var arr=Array.from([0].entries());return 1===arr.length&&isArray(arr[0])&&0===arr[0][0]&&0===arr[0][1]}();arrayFromSwallowsNegativeLengths&&arrayFromHandlesIterables||overrideNative(Array,"from",ArrayShims.from);var arrayFromHandlesUndefinedMapFunction=function(){return valueOrFalseIfThrows(function(){return Array.from([0],void 0)})}();if(!arrayFromHandlesUndefinedMapFunction){var origArrayFrom=Array.from;overrideNative(Array,"from",function(items){return arguments.length>1&&"undefined"!=typeof arguments[1]?ES.Call(origArrayFrom,this,arguments):_call(origArrayFrom,this,items)})}var int32sAsOne=-(Math.pow(2,32)-1),toLengthsCorrectly=function(method,reversed){var obj={length:int32sAsOne};return obj[reversed?(obj.length>>>0)-1:0]=!0,valueOrFalseIfThrows(function(){return _call(method,obj,function(){throw new RangeError("should not reach here")},[]),!0})};if(!toLengthsCorrectly(Array.prototype.forEach)){var originalForEach=Array.prototype.forEach;overrideNative(Array.prototype,"forEach",function(){return ES.Call(originalForEach,this.length>=0?this:[],arguments)},!0)}if(!toLengthsCorrectly(Array.prototype.map)){var originalMap=Array.prototype.map;overrideNative(Array.prototype,"map",function(){return ES.Call(originalMap,this.length>=0?this:[],arguments)},!0)}if(!toLengthsCorrectly(Array.prototype.filter)){var originalFilter=Array.prototype.filter;overrideNative(Array.prototype,"filter",function(){return ES.Call(originalFilter,this.length>=0?this:[],arguments)},!0)}if(!toLengthsCorrectly(Array.prototype.some)){var originalSome=Array.prototype.some;overrideNative(Array.prototype,"some",function(){return ES.Call(originalSome,this.length>=0?this:[],arguments)},!0)}if(!toLengthsCorrectly(Array.prototype.every)){var originalEvery=Array.prototype.every;overrideNative(Array.prototype,"every",function(){return ES.Call(originalEvery,this.length>=0?this:[],arguments)},!0)}if(!toLengthsCorrectly(Array.prototype.reduce)){var originalReduce=Array.prototype.reduce;overrideNative(Array.prototype,"reduce",function(){return ES.Call(originalReduce,this.length>=0?this:[],arguments)},!0)}if(!toLengthsCorrectly(Array.prototype.reduceRight,!0)){var originalReduceRight=Array.prototype.reduceRight;overrideNative(Array.prototype,"reduceRight",function(){return ES.Call(originalReduceRight,this.length>=0?this:[],arguments)},!0)}var lacksOctalSupport=8!==Number("0o10"),lacksBinarySupport=2!==Number("0b10"),trimsNonWhitespace=_some(nonWS,function(c){return 0===Number(c+0+c)});if(lacksOctalSupport||lacksBinarySupport||trimsNonWhitespace){var OrigNumber=Number,binaryRegex=/^0b[01]+$/i,octalRegex=/^0o[0-7]+$/i,isBinary=binaryRegex.test.bind(binaryRegex),isOctal=octalRegex.test.bind(octalRegex),toPrimitive=function(O){var result;if("function"==typeof O.valueOf&&(result=O.valueOf(),Type.primitive(result)))return result;if("function"==typeof O.toString&&(result=O.toString(),Type.primitive(result)))return result;throw new TypeError("No default value")},hasNonWS=nonWSregex.test.bind(nonWSregex),isBadHex=isBadHexRegex.test.bind(isBadHexRegex),NumberShim=function(){var NumberShim=function(value){var primValue;primValue=arguments.length>0?Type.primitive(value)?value:toPrimitive(value,"number"):0,"string"==typeof primValue&&(primValue=ES.Call(trimShim,primValue),isBinary(primValue)?primValue=parseInt(_strSlice(primValue,2),2):isOctal(primValue)?primValue=parseInt(_strSlice(primValue,2),8):(hasNonWS(primValue)||isBadHex(primValue))&&(primValue=0/0));var receiver=this,valueOfSucceeds=valueOrFalseIfThrows(function(){return OrigNumber.prototype.valueOf.call(receiver),!0});return receiver instanceof NumberShim&&!valueOfSucceeds?new OrigNumber(primValue):OrigNumber(primValue)};return NumberShim}();wrapConstructor(OrigNumber,NumberShim,{}),defineProperties(NumberShim,{NaN:OrigNumber.NaN,MAX_VALUE:OrigNumber.MAX_VALUE,MIN_VALUE:OrigNumber.MIN_VALUE,NEGATIVE_INFINITY:OrigNumber.NEGATIVE_INFINITY,POSITIVE_INFINITY:OrigNumber.POSITIVE_INFINITY}),Number=NumberShim,Value.redefine(globals,"Number",NumberShim)}var maxSafeInteger=Math.pow(2,53)-1;defineProperties(Number,{MAX_SAFE_INTEGER:maxSafeInteger,MIN_SAFE_INTEGER:-maxSafeInteger,EPSILON:2.220446049250313e-16,parseInt:globals.parseInt,parseFloat:globals.parseFloat,isFinite:numberIsFinite,isInteger:function(value){return numberIsFinite(value)&&ES.ToInteger(value)===value},isSafeInteger:function(value){return Number.isInteger(value)&&_abs(value)<=Number.MAX_SAFE_INTEGER},isNaN:numberIsNaN}),defineProperty(Number,"parseInt",globals.parseInt,Number.parseInt!==globals.parseInt),[,1].find(function(item,idx){return 0===idx})||overrideNative(Array.prototype,"find",ArrayPrototypeShims.find),0!==[,1].findIndex(function(item,idx){return 0===idx})&&overrideNative(Array.prototype,"findIndex",ArrayPrototypeShims.findIndex);var isEnumerableOn=Function.bind.call(Function.bind,Object.prototype.propertyIsEnumerable),ensureEnumerable=function(obj,prop){supportsDescriptors&&isEnumerableOn(obj,prop)&&Object.defineProperty(obj,prop,{enumerable:!1})},sliceArgs=function(){for(var initial=Number(this),len=arguments.length,desiredArgCount=len-initial,args=new Array(0>desiredArgCount?0:desiredArgCount),i=initial;len>i;++i)args[i-initial]=arguments[i];return args},assignTo=function(source){return function(target,key){return target[key]=source[key],target}},assignReducer=function(target,source){var symbols,sourceKeys=keys(Object(source));return ES.IsCallable(Object.getOwnPropertySymbols)&&(symbols=_filter(Object.getOwnPropertySymbols(Object(source)),isEnumerableOn(source))),_reduce(_concat(sourceKeys,symbols||[]),assignTo(source),target)},ObjectShims={assign:function(target){var to=ES.ToObject(target,"Cannot convert undefined or null to object");return _reduce(ES.Call(sliceArgs,1,arguments),assignReducer,to);

},is:function(a,b){return ES.SameValue(a,b)}},assignHasPendingExceptions=Object.assign&&Object.preventExtensions&&function(){var thrower=Object.preventExtensions({1:2});try{Object.assign(thrower,"xy")}catch(e){return"y"===thrower[1]}}();if(assignHasPendingExceptions&&overrideNative(Object,"assign",ObjectShims.assign),defineProperties(Object,ObjectShims),supportsDescriptors){var ES5ObjectShims={setPrototypeOf:function(Object,magic){var set,checkArgs=function(O,proto){if(!ES.TypeIsObject(O))throw new TypeError("cannot set prototype on a non-object");if(null!==proto&&!ES.TypeIsObject(proto))throw new TypeError("can only set prototype to an object or null"+proto)},setPrototypeOf=function(O,proto){return checkArgs(O,proto),_call(set,O,proto),O};try{set=Object.getOwnPropertyDescriptor(Object.prototype,magic).set,_call(set,{},null)}catch(e){if(Object.prototype!=={}[magic])return;set=function(proto){this[magic]=proto},setPrototypeOf.polyfill=setPrototypeOf(setPrototypeOf({},null),Object.prototype)instanceof Object}return setPrototypeOf}(Object,"__proto__")};defineProperties(Object,ES5ObjectShims)}Object.setPrototypeOf&&Object.getPrototypeOf&&null!==Object.getPrototypeOf(Object.setPrototypeOf({},null))&&null===Object.getPrototypeOf(Object.create(null))&&!function(){var FAKENULL=Object.create(null),gpo=Object.getPrototypeOf,spo=Object.setPrototypeOf;Object.getPrototypeOf=function(o){var result=gpo(o);return result===FAKENULL?null:result},Object.setPrototypeOf=function(o,p){var proto=null===p?FAKENULL:p;return spo(o,proto)},Object.setPrototypeOf.polyfill=!1}();var objectKeysAcceptsPrimitives=!throwsError(function(){Object.keys("foo")});if(!objectKeysAcceptsPrimitives){var originalObjectKeys=Object.keys;overrideNative(Object,"keys",function(value){return originalObjectKeys(ES.ToObject(value))}),keys=Object.keys}if(Object.getOwnPropertyNames){var objectGOPNAcceptsPrimitives=!throwsError(function(){Object.getOwnPropertyNames("foo")});if(!objectGOPNAcceptsPrimitives){var cachedWindowNames="object"===("undefined"==typeof window?"undefined":_typeof(window))?Object.getOwnPropertyNames(window):[],originalObjectGetOwnPropertyNames=Object.getOwnPropertyNames;overrideNative(Object,"getOwnPropertyNames",function(value){var val=ES.ToObject(value);if("[object Window]"===_toString(val))try{return originalObjectGetOwnPropertyNames(val)}catch(e){return _concat([],cachedWindowNames)}return originalObjectGetOwnPropertyNames(val)})}}if(Object.getOwnPropertyDescriptor){var objectGOPDAcceptsPrimitives=!throwsError(function(){Object.getOwnPropertyDescriptor("foo","bar")});if(!objectGOPDAcceptsPrimitives){var originalObjectGetOwnPropertyDescriptor=Object.getOwnPropertyDescriptor;overrideNative(Object,"getOwnPropertyDescriptor",function(value,property){return originalObjectGetOwnPropertyDescriptor(ES.ToObject(value),property)})}}if(Object.seal){var objectSealAcceptsPrimitives=!throwsError(function(){Object.seal("foo")});if(!objectSealAcceptsPrimitives){var originalObjectSeal=Object.seal;overrideNative(Object,"seal",function(value){return Type.object(value)?originalObjectSeal(value):value})}}if(Object.isSealed){var objectIsSealedAcceptsPrimitives=!throwsError(function(){Object.isSealed("foo")});if(!objectIsSealedAcceptsPrimitives){var originalObjectIsSealed=Object.isSealed;overrideNative(Object,"isSealed",function(value){return Type.object(value)?originalObjectIsSealed(value):!0})}}if(Object.freeze){var objectFreezeAcceptsPrimitives=!throwsError(function(){Object.freeze("foo")});if(!objectFreezeAcceptsPrimitives){var originalObjectFreeze=Object.freeze;overrideNative(Object,"freeze",function(value){return Type.object(value)?originalObjectFreeze(value):value})}}if(Object.isFrozen){var objectIsFrozenAcceptsPrimitives=!throwsError(function(){Object.isFrozen("foo")});if(!objectIsFrozenAcceptsPrimitives){var originalObjectIsFrozen=Object.isFrozen;overrideNative(Object,"isFrozen",function(value){return Type.object(value)?originalObjectIsFrozen(value):!0})}}if(Object.preventExtensions){var objectPreventExtensionsAcceptsPrimitives=!throwsError(function(){Object.preventExtensions("foo")});if(!objectPreventExtensionsAcceptsPrimitives){var originalObjectPreventExtensions=Object.preventExtensions;overrideNative(Object,"preventExtensions",function(value){return Type.object(value)?originalObjectPreventExtensions(value):value})}}if(Object.isExtensible){var objectIsExtensibleAcceptsPrimitives=!throwsError(function(){Object.isExtensible("foo")});if(!objectIsExtensibleAcceptsPrimitives){var originalObjectIsExtensible=Object.isExtensible;overrideNative(Object,"isExtensible",function(value){return Type.object(value)?originalObjectIsExtensible(value):!1})}}if(Object.getPrototypeOf){var objectGetProtoAcceptsPrimitives=!throwsError(function(){Object.getPrototypeOf("foo")});if(!objectGetProtoAcceptsPrimitives){var originalGetProto=Object.getPrototypeOf;overrideNative(Object,"getPrototypeOf",function(value){return originalGetProto(ES.ToObject(value))})}}var hasFlags=supportsDescriptors&&function(){var desc=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags");return desc&&ES.IsCallable(desc.get)}();if(supportsDescriptors&&!hasFlags){var regExpFlagsGetter=function(){if(!ES.TypeIsObject(this))throw new TypeError("Method called on incompatible type: must be an object.");var result="";return this.global&&(result+="g"),this.ignoreCase&&(result+="i"),this.multiline&&(result+="m"),this.unicode&&(result+="u"),this.sticky&&(result+="y"),result};Value.getter(RegExp.prototype,"flags",regExpFlagsGetter)}var regExpSupportsFlagsWithRegex=supportsDescriptors&&valueOrFalseIfThrows(function(){return"/a/i"===String(new RegExp(/a/g,"i"))}),regExpNeedsToSupportSymbolMatch=hasSymbols&&supportsDescriptors&&function(){var regex=/./;return regex[_Symbol.match]=!1,RegExp(regex)===regex}();if(supportsDescriptors&&(!regExpSupportsFlagsWithRegex||regExpNeedsToSupportSymbolMatch)){var flagsGetter=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags").get,sourceDesc=Object.getOwnPropertyDescriptor(RegExp.prototype,"source")||{},legacySourceGetter=function(){return this.source},sourceGetter=ES.IsCallable(sourceDesc.get)?sourceDesc.get:legacySourceGetter,OrigRegExp=RegExp,RegExpShim=function(){return function RegExp(pattern,flags){var patternIsRegExp=ES.IsRegExp(pattern),calledWithNew=this instanceof RegExp;if(!calledWithNew&&patternIsRegExp&&"undefined"==typeof flags&&pattern.constructor===RegExp)return pattern;var P=pattern,F=flags;return Type.regex(pattern)?(P=ES.Call(sourceGetter,pattern),F="undefined"==typeof flags?ES.Call(flagsGetter,pattern):flags,new RegExp(P,F)):(patternIsRegExp&&(P=pattern.source,F="undefined"==typeof flags?pattern.flags:flags),new OrigRegExp(pattern,flags))}}();wrapConstructor(OrigRegExp,RegExpShim,{$input:!0}),RegExp=RegExpShim,Value.redefine(globals,"RegExp",RegExpShim)}if(supportsDescriptors){var regexGlobals={input:"$_",lastMatch:"$&",lastParen:"$+",leftContext:"$`",rightContext:"$'"};_forEach(keys(regexGlobals),function(prop){prop in RegExp&&!(regexGlobals[prop]in RegExp)&&Value.getter(RegExp,regexGlobals[prop],function(){return RegExp[prop]})})}addDefaultSpecies(RegExp);var inverseEpsilon=1/Number.EPSILON,roundTiesToEven=function(n){return n+inverseEpsilon-inverseEpsilon},BINARY_32_EPSILON=Math.pow(2,-23),BINARY_32_MAX_VALUE=Math.pow(2,127)*(2-BINARY_32_EPSILON),BINARY_32_MIN_VALUE=Math.pow(2,-126),numberCLZ=Number.prototype.clz;delete Number.prototype.clz;var MathShims={acosh:function(value){var x=Number(value);return Number.isNaN(x)||1>value?0/0:1===x?0:x===1/0?x:_log(x/Math.E+_sqrt(x+1)*_sqrt(x-1)/Math.E)+1},asinh:function(value){var x=Number(value);return 0!==x&&globalIsFinite(x)?0>x?-Math.asinh(-x):_log(x+_sqrt(x*x+1)):x},atanh:function(value){var x=Number(value);return Number.isNaN(x)||-1>x||x>1?0/0:-1===x?-(1/0):1===x?1/0:0===x?x:.5*_log((1+x)/(1-x))},cbrt:function(value){var x=Number(value);if(0===x)return x;var result,negate=0>x;return negate&&(x=-x),x===1/0?result=1/0:(result=Math.exp(_log(x)/3),result=(x/(result*result)+2*result)/3),negate?-result:result},clz32:function(value){var x=Number(value),number=ES.ToUint32(x);return 0===number?32:numberCLZ?ES.Call(numberCLZ,number):31-_floor(_log(number+.5)*Math.LOG2E)},cosh:function(value){var x=Number(value);return 0===x?1:Number.isNaN(x)?0/0:globalIsFinite(x)?(0>x&&(x=-x),x>21?Math.exp(x)/2:(Math.exp(x)+Math.exp(-x))/2):1/0},expm1:function(value){var x=Number(value);if(x===-(1/0))return-1;if(!globalIsFinite(x)||0===x)return x;if(_abs(x)>.5)return Math.exp(x)-1;for(var t=x,sum=0,n=1;sum+t!==sum;)sum+=t,n+=1,t*=x/n;return sum},hypot:function(){for(var result=0,largest=0,i=0;i<arguments.length;++i){var value=_abs(Number(arguments[i]));value>largest?(result*=largest/value*(largest/value),result+=1,largest=value):result+=value>0?value/largest*(value/largest):value}return largest===1/0?1/0:largest*_sqrt(result)},log2:function(value){return _log(value)*Math.LOG2E},log10:function(value){return _log(value)*Math.LOG10E},log1p:function(value){var x=Number(value);return-1>x||Number.isNaN(x)?0/0:0===x||x===1/0?x:-1===x?-(1/0):1+x-1===0?x:x*(_log(1+x)/(1+x-1))},sign:function(value){var number=Number(value);return 0===number?number:Number.isNaN(number)?number:0>number?-1:1},sinh:function(value){var x=Number(value);return globalIsFinite(x)&&0!==x?_abs(x)<1?(Math.expm1(x)-Math.expm1(-x))/2:(Math.exp(x-1)-Math.exp(-x-1))*Math.E/2:x},tanh:function(value){var x=Number(value);if(Number.isNaN(x)||0===x)return x;if(x===1/0)return 1;if(x===-(1/0))return-1;var a=Math.expm1(x),b=Math.expm1(-x);return a===1/0?1:b===1/0?-1:(a-b)/(Math.exp(x)+Math.exp(-x))},trunc:function(value){var x=Number(value);return 0>x?-_floor(-x):_floor(x)},imul:function(x,y){var a=ES.ToUint32(x),b=ES.ToUint32(y),ah=a>>>16&65535,al=65535&a,bh=b>>>16&65535,bl=65535&b;return al*bl+(ah*bl+al*bh<<16>>>0)|0},fround:function(x){var v=Number(x);if(0===v||v===1/0||v===-(1/0)||numberIsNaN(v))return v;var sign=Math.sign(v),abs=_abs(v);if(BINARY_32_MIN_VALUE>abs)return sign*roundTiesToEven(abs/BINARY_32_MIN_VALUE/BINARY_32_EPSILON)*BINARY_32_MIN_VALUE*BINARY_32_EPSILON;var a=(1+BINARY_32_EPSILON/Number.EPSILON)*abs,result=a-(a-abs);return result>BINARY_32_MAX_VALUE||numberIsNaN(result)?sign*(1/0):sign*result}};defineProperties(Math,MathShims),defineProperty(Math,"log1p",MathShims.log1p,-1e-17!==Math.log1p(-1e-17)),defineProperty(Math,"asinh",MathShims.asinh,Math.asinh(-1e7)!==-Math.asinh(1e7)),defineProperty(Math,"tanh",MathShims.tanh,-2e-17!==Math.tanh(-2e-17)),defineProperty(Math,"acosh",MathShims.acosh,Math.acosh(Number.MAX_VALUE)===1/0),defineProperty(Math,"cbrt",MathShims.cbrt,Math.abs(1-Math.cbrt(1e-300)/1e-100)/Number.EPSILON>8),defineProperty(Math,"sinh",MathShims.sinh,-2e-17!==Math.sinh(-2e-17));var expm1OfTen=Math.expm1(10);defineProperty(Math,"expm1",MathShims.expm1,expm1OfTen>22025.465794806718||22025.465794806718>expm1OfTen);var origMathRound=Math.round,roundHandlesBoundaryConditions=0===Math.round(.5-Number.EPSILON/4)&&1===Math.round(-.5+Number.EPSILON/3.99),smallestPositiveNumberWhereRoundBreaks=inverseEpsilon+1,largestPositiveNumberWhereRoundBreaks=2*inverseEpsilon-1,roundDoesNotIncreaseIntegers=[smallestPositiveNumberWhereRoundBreaks,largestPositiveNumberWhereRoundBreaks].every(function(num){return Math.round(num)===num});defineProperty(Math,"round",function(x){var floor=_floor(x),ceil=-1===floor?-0:floor+1;return.5>x-floor?floor:ceil},!roundHandlesBoundaryConditions||!roundDoesNotIncreaseIntegers),Value.preserveToString(Math.round,origMathRound);var origImul=Math.imul;-5!==Math.imul(4294967295,5)&&(Math.imul=MathShims.imul,Value.preserveToString(Math.imul,origImul)),2!==Math.imul.length&&overrideNative(Math,"imul",function(){return ES.Call(origImul,Math,arguments)});var PromiseShim=function(){var setTimeout=globals.setTimeout;if("function"==typeof setTimeout||"object"===("undefined"==typeof setTimeout?"undefined":_typeof(setTimeout))){ES.IsPromise=function(promise){return ES.TypeIsObject(promise)?"undefined"==typeof promise._promise?!1:!0:!1};var makeZeroTimeout,PromiseCapability=function(C){if(!ES.IsConstructor(C))throw new TypeError("Bad promise constructor");var capability=this,resolver=function(resolve,reject){if(void 0!==capability.resolve||void 0!==capability.reject)throw new TypeError("Bad Promise implementation!");capability.resolve=resolve,capability.reject=reject};if(capability.resolve=void 0,capability.reject=void 0,capability.promise=new C(resolver),!ES.IsCallable(capability.resolve)||!ES.IsCallable(capability.reject))throw new TypeError("Bad promise constructor")};"undefined"!=typeof window&&ES.IsCallable(window.postMessage)&&(makeZeroTimeout=function(){var timeouts=[],messageName="zero-timeout-message",setZeroTimeout=function(fn){_push(timeouts,fn),window.postMessage(messageName,"*")},handleMessage=function(event){if(event.source===window&&event.data===messageName){if(event.stopPropagation(),0===timeouts.length)return;var fn=_shift(timeouts);fn()}};return window.addEventListener("message",handleMessage,!0),setZeroTimeout});var Promise$prototype,Promise$prototype$then,makePromiseAsap=function(){var P=globals.Promise,pr=P&&P.resolve&&P.resolve();return pr&&function(task){return pr.then(task)}},enqueue=ES.IsCallable(globals.setImmediate)?globals.setImmediate:"object"===("undefined"==typeof process?"undefined":_typeof(process))&&process.nextTick?process.nextTick:makePromiseAsap()||(ES.IsCallable(makeZeroTimeout)?makeZeroTimeout():function(task){setTimeout(task,0)}),PROMISE_IDENTITY=function(x){return x},PROMISE_THROWER=function(e){throw e},PROMISE_PENDING=0,PROMISE_FULFILLED=1,PROMISE_REJECTED=2,PROMISE_FULFILL_OFFSET=0,PROMISE_REJECT_OFFSET=1,PROMISE_CAPABILITY_OFFSET=2,PROMISE_FAKE_CAPABILITY={},enqueuePromiseReactionJob=function(handler,capability,argument){enqueue(function(){promiseReactionJob(handler,capability,argument)})},promiseReactionJob=function(handler,promiseCapability,argument){var handlerResult,f;if(promiseCapability===PROMISE_FAKE_CAPABILITY)return handler(argument);try{handlerResult=handler(argument),f=promiseCapability.resolve}catch(e){handlerResult=e,f=promiseCapability.reject}f(handlerResult)},fulfillPromise=function(promise,value){var _promise=promise._promise,length=_promise.reactionLength;if(length>0&&(enqueuePromiseReactionJob(_promise.fulfillReactionHandler0,_promise.reactionCapability0,value),_promise.fulfillReactionHandler0=void 0,_promise.rejectReactions0=void 0,_promise.reactionCapability0=void 0,length>1))for(var i=1,idx=0;length>i;i++,idx+=3)enqueuePromiseReactionJob(_promise[idx+PROMISE_FULFILL_OFFSET],_promise[idx+PROMISE_CAPABILITY_OFFSET],value),promise[idx+PROMISE_FULFILL_OFFSET]=void 0,promise[idx+PROMISE_REJECT_OFFSET]=void 0,promise[idx+PROMISE_CAPABILITY_OFFSET]=void 0;_promise.result=value,_promise.state=PROMISE_FULFILLED,_promise.reactionLength=0},rejectPromise=function(promise,reason){var _promise=promise._promise,length=_promise.reactionLength;if(length>0&&(enqueuePromiseReactionJob(_promise.rejectReactionHandler0,_promise.reactionCapability0,reason),_promise.fulfillReactionHandler0=void 0,_promise.rejectReactions0=void 0,_promise.reactionCapability0=void 0,length>1))for(var i=1,idx=0;length>i;i++,idx+=3)enqueuePromiseReactionJob(_promise[idx+PROMISE_REJECT_OFFSET],_promise[idx+PROMISE_CAPABILITY_OFFSET],reason),promise[idx+PROMISE_FULFILL_OFFSET]=void 0,promise[idx+PROMISE_REJECT_OFFSET]=void 0,promise[idx+PROMISE_CAPABILITY_OFFSET]=void 0;_promise.result=reason,_promise.state=PROMISE_REJECTED,_promise.reactionLength=0},createResolvingFunctions=function(promise){var alreadyResolved=!1,resolve=function(resolution){var then;if(!alreadyResolved){if(alreadyResolved=!0,resolution===promise)return rejectPromise(promise,new TypeError("Self resolution"));if(!ES.TypeIsObject(resolution))return fulfillPromise(promise,resolution);try{then=resolution.then}catch(e){return rejectPromise(promise,e)}return ES.IsCallable(then)?void enqueue(function(){promiseResolveThenableJob(promise,resolution,then)}):fulfillPromise(promise,resolution)}},reject=function(reason){return alreadyResolved?void 0:(alreadyResolved=!0,rejectPromise(promise,reason))};return{resolve:resolve,reject:reject}},optimizedThen=function(then,thenable,resolve,reject){then===Promise$prototype$then?_call(then,thenable,resolve,reject,PROMISE_FAKE_CAPABILITY):_call(then,thenable,resolve,reject)},promiseResolveThenableJob=function(promise,thenable,then){var resolvingFunctions=createResolvingFunctions(promise),resolve=resolvingFunctions.resolve,reject=resolvingFunctions.reject;try{optimizedThen(then,thenable,resolve,reject)}catch(e){reject(e)}},Promise=function(){var PromiseShim=function(resolver){if(!(this instanceof PromiseShim))throw new TypeError('Constructor Promise requires "new"');if(this&&this._promise)throw new TypeError("Bad construction");if(!ES.IsCallable(resolver))throw new TypeError("not a valid resolver");var promise=emulateES6construct(this,PromiseShim,Promise$prototype,{_promise:{result:void 0,state:PROMISE_PENDING,reactionLength:0,fulfillReactionHandler0:void 0,rejectReactionHandler0:void 0,reactionCapability0:void 0}}),resolvingFunctions=createResolvingFunctions(promise),reject=resolvingFunctions.reject;try{resolver(resolvingFunctions.resolve,reject)}catch(e){reject(e)}return promise};return PromiseShim}();Promise$prototype=Promise.prototype;var _promiseAllResolver=function(index,values,capability,remaining){var alreadyCalled=!1;return function(x){if(!alreadyCalled&&(alreadyCalled=!0,values[index]=x,0===--remaining.count)){var resolve=capability.resolve;resolve(values)}}},performPromiseAll=function(iteratorRecord,C,resultCapability){for(var next,nextValue,it=iteratorRecord.iterator,values=[],remaining={count:1},index=0;;){try{if(next=ES.IteratorStep(it),next===!1){iteratorRecord.done=!0;break}nextValue=next.value}catch(e){throw iteratorRecord.done=!0,e}values[index]=void 0;var nextPromise=C.resolve(nextValue),resolveElement=_promiseAllResolver(index,values,resultCapability,remaining);remaining.count+=1,optimizedThen(nextPromise.then,nextPromise,resolveElement,resultCapability.reject),index+=1}if(0===--remaining.count){var resolve=resultCapability.resolve;resolve(values)}return resultCapability.promise},performPromiseRace=function(iteratorRecord,C,resultCapability){for(var next,nextValue,nextPromise,it=iteratorRecord.iterator;;){try{if(next=ES.IteratorStep(it),next===!1){iteratorRecord.done=!0;break}nextValue=next.value}catch(e){throw iteratorRecord.done=!0,e}nextPromise=C.resolve(nextValue),optimizedThen(nextPromise.then,nextPromise,resultCapability.resolve,resultCapability.reject)}return resultCapability.promise};return defineProperties(Promise,{all:function(iterable){var C=this;if(!ES.TypeIsObject(C))throw new TypeError("Promise is not object");var iterator,iteratorRecord,capability=new PromiseCapability(C);try{return iterator=ES.GetIterator(iterable),iteratorRecord={iterator:iterator,done:!1},performPromiseAll(iteratorRecord,C,capability)}catch(e){var exception=e;if(iteratorRecord&&!iteratorRecord.done)try{ES.IteratorClose(iterator,!0)}catch(ee){exception=ee}var reject=capability.reject;return reject(exception),capability.promise}},race:function(iterable){var C=this;if(!ES.TypeIsObject(C))throw new TypeError("Promise is not object");var iterator,iteratorRecord,capability=new PromiseCapability(C);try{return iterator=ES.GetIterator(iterable),iteratorRecord={iterator:iterator,done:!1},performPromiseRace(iteratorRecord,C,capability)}catch(e){var exception=e;if(iteratorRecord&&!iteratorRecord.done)try{ES.IteratorClose(iterator,!0)}catch(ee){exception=ee}var reject=capability.reject;return reject(exception),capability.promise}},reject:function(reason){var C=this;if(!ES.TypeIsObject(C))throw new TypeError("Bad promise constructor");var capability=new PromiseCapability(C),rejectFunc=capability.reject;return rejectFunc(reason),capability.promise},resolve:function(v){var C=this;if(!ES.TypeIsObject(C))throw new TypeError("Bad promise constructor");if(ES.IsPromise(v)){var constructor=v.constructor;if(constructor===C)return v}var capability=new PromiseCapability(C),resolveFunc=capability.resolve;return resolveFunc(v),capability.promise}}),defineProperties(Promise$prototype,{"catch":function(onRejected){return this.then(null,onRejected)},then:function(onFulfilled,onRejected){var promise=this;if(!ES.IsPromise(promise))throw new TypeError("not a promise");var resultCapability,C=ES.SpeciesConstructor(promise,Promise),returnValueIsIgnored=arguments.length>2&&arguments[2]===PROMISE_FAKE_CAPABILITY;resultCapability=returnValueIsIgnored&&C===Promise?PROMISE_FAKE_CAPABILITY:new PromiseCapability(C);var value,fulfillReactionHandler=ES.IsCallable(onFulfilled)?onFulfilled:PROMISE_IDENTITY,rejectReactionHandler=ES.IsCallable(onRejected)?onRejected:PROMISE_THROWER,_promise=promise._promise;if(_promise.state===PROMISE_PENDING){if(0===_promise.reactionLength)_promise.fulfillReactionHandler0=fulfillReactionHandler,_promise.rejectReactionHandler0=rejectReactionHandler,_promise.reactionCapability0=resultCapability;else{var idx=3*(_promise.reactionLength-1);_promise[idx+PROMISE_FULFILL_OFFSET]=fulfillReactionHandler,_promise[idx+PROMISE_REJECT_OFFSET]=rejectReactionHandler,_promise[idx+PROMISE_CAPABILITY_OFFSET]=resultCapability}_promise.reactionLength+=1}else if(_promise.state===PROMISE_FULFILLED)value=_promise.result,enqueuePromiseReactionJob(fulfillReactionHandler,resultCapability,value);else{if(_promise.state!==PROMISE_REJECTED)throw new TypeError("unexpected Promise state");value=_promise.result,enqueuePromiseReactionJob(rejectReactionHandler,resultCapability,value)}return resultCapability.promise}}),PROMISE_FAKE_CAPABILITY=new PromiseCapability(Promise),Promise$prototype$then=Promise$prototype.then,Promise}}();if(globals.Promise&&(delete globals.Promise.accept,delete globals.Promise.defer,delete globals.Promise.prototype.chain),"function"==typeof PromiseShim){defineProperties(globals,{Promise:PromiseShim});var promiseSupportsSubclassing=supportsSubclassing(globals.Promise,function(S){return S.resolve(42).then(function(){})instanceof S}),promiseIgnoresNonFunctionThenCallbacks=!throwsError(function(){globals.Promise.reject(42).then(null,5).then(null,noop)}),promiseRequiresObjectContext=throwsError(function(){globals.Promise.call(3,noop)}),promiseResolveBroken=function(Promise){var p=Promise.resolve(5);p.constructor={};var p2=Promise.resolve(p);try{p2.then(null,noop).then(null,noop)}catch(e){return!0}return p===p2}(globals.Promise),getsThenSynchronously=supportsDescriptors&&function(){var count=0,thenable=Object.defineProperty({},"then",{get:function(){count+=1}});return Promise.resolve(thenable),1===count}(),BadResolverPromise=function BadResolverPromise(executor){var p=new Promise(executor);executor(3,function(){}),this.then=p.then,this.constructor=BadResolverPromise};BadResolverPromise.prototype=Promise.prototype,BadResolverPromise.all=Promise.all;var hasBadResolverPromise=valueOrFalseIfThrows(function(){return!!BadResolverPromise.all([1,2])});if(promiseSupportsSubclassing&&promiseIgnoresNonFunctionThenCallbacks&&promiseRequiresObjectContext&&!promiseResolveBroken&&getsThenSynchronously&&!hasBadResolverPromise||(Promise=PromiseShim,overrideNative(globals,"Promise",PromiseShim)),1!==Promise.all.length){var origAll=Promise.all;overrideNative(Promise,"all",function(){return ES.Call(origAll,this,arguments)})}if(1!==Promise.race.length){var origRace=Promise.race;overrideNative(Promise,"race",function(){return ES.Call(origRace,this,arguments)})}if(1!==Promise.resolve.length){var origResolve=Promise.resolve;overrideNative(Promise,"resolve",function(){return ES.Call(origResolve,this,arguments)})}if(1!==Promise.reject.length){var origReject=Promise.reject;overrideNative(Promise,"reject",function(){return ES.Call(origReject,this,arguments)})}ensureEnumerable(Promise,"all"),ensureEnumerable(Promise,"race"),ensureEnumerable(Promise,"resolve"),ensureEnumerable(Promise,"reject"),addDefaultSpecies(Promise)}var testOrder=function(a){var b=keys(_reduce(a,function(o,k){return o[k]=!0,o},{}));return a.join(":")===b.join(":")},preservesInsertionOrder=testOrder(["z","a","bb"]),preservesNumericInsertionOrder=testOrder(["z",1,"a","3",2]);if(supportsDescriptors){var fastkey=function(key){return preservesInsertionOrder?"undefined"==typeof key||null===key?"^"+ES.ToString(key):"string"==typeof key?"$"+key:"number"==typeof key?preservesNumericInsertionOrder?key:"n"+key:"boolean"==typeof key?"b"+key:null:null},emptyObject=function(){return Object.create?Object.create(null):{}},addIterableToMap=function(MapConstructor,map,iterable){if(isArray(iterable)||Type.string(iterable))_forEach(iterable,function(entry){if(!ES.TypeIsObject(entry))throw new TypeError("Iterator value "+entry+" is not an entry object");map.set(entry[0],entry[1])});else if(iterable instanceof MapConstructor)_call(MapConstructor.prototype.forEach,iterable,function(value,key){map.set(key,value)});else{var iter,adder;if(null!==iterable&&"undefined"!=typeof iterable){if(adder=map.set,!ES.IsCallable(adder))throw new TypeError("bad map");iter=ES.GetIterator(iterable)}if("undefined"!=typeof iter)for(;;){var next=ES.IteratorStep(iter);if(next===!1)break;var nextItem=next.value;try{if(!ES.TypeIsObject(nextItem))throw new TypeError("Iterator value "+nextItem+" is not an entry object");_call(adder,map,nextItem[0],nextItem[1])}catch(e){throw ES.IteratorClose(iter,!0),e}}}},addIterableToSet=function(SetConstructor,set,iterable){if(isArray(iterable)||Type.string(iterable))_forEach(iterable,function(value){set.add(value)});else if(iterable instanceof SetConstructor)_call(SetConstructor.prototype.forEach,iterable,function(value){set.add(value)});else{var iter,adder;if(null!==iterable&&"undefined"!=typeof iterable){if(adder=set.add,!ES.IsCallable(adder))throw new TypeError("bad set");iter=ES.GetIterator(iterable)}if("undefined"!=typeof iter)for(;;){var next=ES.IteratorStep(iter);if(next===!1)break;var nextValue=next.value;try{_call(adder,set,nextValue)}catch(e){throw ES.IteratorClose(iter,!0),e}}}},collectionShims={Map:function(){var empty={},MapEntry=function(key,value){this.key=key,this.value=value,this.next=null,this.prev=null};MapEntry.prototype.isRemoved=function(){return this.key===empty};var isMap=function(map){return!!map._es6map},requireMapSlot=function(map,method){if(!ES.TypeIsObject(map)||!isMap(map))throw new TypeError("Method Map.prototype."+method+" called on incompatible receiver "+ES.ToString(map))},MapIterator=function(map,kind){requireMapSlot(map,"[[MapIterator]]"),this.head=map._head,this.i=this.head,this.kind=kind};MapIterator.prototype={next:function(){var result,i=this.i,kind=this.kind,head=this.head;if("undefined"==typeof this.i)return{value:void 0,done:!0};for(;i.isRemoved()&&i!==head;)i=i.prev;for(;i.next!==head;)if(i=i.next,!i.isRemoved())return result="key"===kind?i.key:"value"===kind?i.value:[i.key,i.value],this.i=i,{value:result,done:!1};return this.i=void 0,{value:void 0,done:!0}}},addIterator(MapIterator.prototype);var Map$prototype,MapShim=function Map(){if(!(this instanceof Map))throw new TypeError('Constructor Map requires "new"');if(this&&this._es6map)throw new TypeError("Bad construction");var map=emulateES6construct(this,Map,Map$prototype,{_es6map:!0,_head:null,_storage:emptyObject(),_size:0}),head=new MapEntry(null,null);return head.next=head.prev=head,map._head=head,arguments.length>0&&addIterableToMap(Map,map,arguments[0]),map};return Map$prototype=MapShim.prototype,Value.getter(Map$prototype,"size",function(){if("undefined"==typeof this._size)throw new TypeError("size method called on incompatible Map");return this._size}),defineProperties(Map$prototype,{get:function(key){requireMapSlot(this,"get");var fkey=fastkey(key);if(null!==fkey){var entry=this._storage[fkey];return entry?entry.value:void 0}for(var head=this._head,i=head;(i=i.next)!==head;)if(ES.SameValueZero(i.key,key))return i.value},has:function(key){requireMapSlot(this,"has");var fkey=fastkey(key);if(null!==fkey)return"undefined"!=typeof this._storage[fkey];for(var head=this._head,i=head;(i=i.next)!==head;)if(ES.SameValueZero(i.key,key))return!0;return!1},set:function(key,value){requireMapSlot(this,"set");var entry,head=this._head,i=head,fkey=fastkey(key);if(null!==fkey){if("undefined"!=typeof this._storage[fkey])return this._storage[fkey].value=value,this;entry=this._storage[fkey]=new MapEntry(key,value),i=head.prev}for(;(i=i.next)!==head;)if(ES.SameValueZero(i.key,key))return i.value=value,this;return entry=entry||new MapEntry(key,value),ES.SameValue(-0,key)&&(entry.key=0),entry.next=this._head,entry.prev=this._head.prev,entry.prev.next=entry,entry.next.prev=entry,this._size+=1,this},"delete":function(key){requireMapSlot(this,"delete");var head=this._head,i=head,fkey=fastkey(key);if(null!==fkey){if("undefined"==typeof this._storage[fkey])return!1;i=this._storage[fkey].prev,delete this._storage[fkey]}for(;(i=i.next)!==head;)if(ES.SameValueZero(i.key,key))return i.key=i.value=empty,i.prev.next=i.next,i.next.prev=i.prev,this._size-=1,!0;return!1},clear:function(){requireMapSlot(this,"clear"),this._size=0,this._storage=emptyObject();for(var head=this._head,i=head,p=i.next;(i=p)!==head;)i.key=i.value=empty,p=i.next,i.next=i.prev=head;head.next=head.prev=head},keys:function(){return requireMapSlot(this,"keys"),new MapIterator(this,"key")},values:function(){return requireMapSlot(this,"values"),new MapIterator(this,"value")},entries:function(){return requireMapSlot(this,"entries"),new MapIterator(this,"key+value")},forEach:function(callback){requireMapSlot(this,"forEach");for(var context=arguments.length>1?arguments[1]:null,it=this.entries(),entry=it.next();!entry.done;entry=it.next())context?_call(callback,context,entry.value[1],entry.value[0],this):callback(entry.value[1],entry.value[0],this)}}),addIterator(Map$prototype,Map$prototype.entries),MapShim}(),Set:function(){var Set$prototype,isSet=function(set){return set._es6set&&"undefined"!=typeof set._storage},requireSetSlot=function(set,method){if(!ES.TypeIsObject(set)||!isSet(set))throw new TypeError("Set.prototype."+method+" called on incompatible receiver "+ES.ToString(set))},SetShim=function Set(){if(!(this instanceof Set))throw new TypeError('Constructor Set requires "new"');if(this&&this._es6set)throw new TypeError("Bad construction");var set=emulateES6construct(this,Set,Set$prototype,{_es6set:!0,"[[SetData]]":null,_storage:emptyObject()});if(!set._es6set)throw new TypeError("bad set");return arguments.length>0&&addIterableToSet(Set,set,arguments[0]),set};Set$prototype=SetShim.prototype;var decodeKey=function(key){var k=key;if("^null"===k)return null;if("^undefined"===k)return void 0;var first=k.charAt(0);return"$"===first?_strSlice(k,1):"n"===first?+_strSlice(k,1):"b"===first?"btrue"===k:+k},ensureMap=function(set){if(!set["[[SetData]]"]){var m=set["[[SetData]]"]=new collectionShims.Map;_forEach(keys(set._storage),function(key){var k=decodeKey(key);m.set(k,k)}),set["[[SetData]]"]=m}set._storage=null};return Value.getter(SetShim.prototype,"size",function(){return requireSetSlot(this,"size"),this._storage?keys(this._storage).length:(ensureMap(this),this["[[SetData]]"].size)}),defineProperties(SetShim.prototype,{has:function(key){requireSetSlot(this,"has");var fkey;return this._storage&&null!==(fkey=fastkey(key))?!!this._storage[fkey]:(ensureMap(this),this["[[SetData]]"].has(key))},add:function(key){requireSetSlot(this,"add");var fkey;return this._storage&&null!==(fkey=fastkey(key))?(this._storage[fkey]=!0,this):(ensureMap(this),this["[[SetData]]"].set(key,key),this)},"delete":function(key){requireSetSlot(this,"delete");var fkey;if(this._storage&&null!==(fkey=fastkey(key))){var hasFKey=_hasOwnProperty(this._storage,fkey);return delete this._storage[fkey]&&hasFKey}return ensureMap(this),this["[[SetData]]"]["delete"](key)},clear:function(){requireSetSlot(this,"clear"),this._storage&&(this._storage=emptyObject()),this["[[SetData]]"]&&this["[[SetData]]"].clear()},
values:function(){return requireSetSlot(this,"values"),ensureMap(this),this["[[SetData]]"].values()},entries:function(){return requireSetSlot(this,"entries"),ensureMap(this),this["[[SetData]]"].entries()},forEach:function(callback){requireSetSlot(this,"forEach");var context=arguments.length>1?arguments[1]:null,entireSet=this;ensureMap(entireSet),this["[[SetData]]"].forEach(function(value,key){context?_call(callback,context,key,key,entireSet):callback(key,key,entireSet)})}}),defineProperty(SetShim.prototype,"keys",SetShim.prototype.values,!0),addIterator(SetShim.prototype,SetShim.prototype.values),SetShim}()};if(globals.Map||globals.Set){var mapAcceptsArguments=valueOrFalseIfThrows(function(){return 2===new Map([[1,2]]).get(1)});if(!mapAcceptsArguments){var OrigMapNoArgs=globals.Map;globals.Map=function Map(){if(!(this instanceof Map))throw new TypeError('Constructor Map requires "new"');var m=new OrigMapNoArgs;return arguments.length>0&&addIterableToMap(Map,m,arguments[0]),delete m.constructor,Object.setPrototypeOf(m,globals.Map.prototype),m},globals.Map.prototype=create(OrigMapNoArgs.prototype),defineProperty(globals.Map.prototype,"constructor",globals.Map,!0),Value.preserveToString(globals.Map,OrigMapNoArgs)}var testMap=new Map,mapUsesSameValueZero=function(){var m=new Map([[1,0],[2,0],[3,0],[4,0]]);return m.set(-0,m),m.get(0)===m&&m.get(-0)===m&&m.has(0)&&m.has(-0)}(),mapSupportsChaining=testMap.set(1,2)===testMap;if(!mapUsesSameValueZero||!mapSupportsChaining){var origMapSet=Map.prototype.set;overrideNative(Map.prototype,"set",function(k,v){return _call(origMapSet,this,0===k?0:k,v),this})}if(!mapUsesSameValueZero){var origMapGet=Map.prototype.get,origMapHas=Map.prototype.has;defineProperties(Map.prototype,{get:function(k){return _call(origMapGet,this,0===k?0:k)},has:function(k){return _call(origMapHas,this,0===k?0:k)}},!0),Value.preserveToString(Map.prototype.get,origMapGet),Value.preserveToString(Map.prototype.has,origMapHas)}var testSet=new Set,setUsesSameValueZero=function(s){return s["delete"](0),s.add(-0),!s.has(0)}(testSet),setSupportsChaining=testSet.add(1)===testSet;if(!setUsesSameValueZero||!setSupportsChaining){var origSetAdd=Set.prototype.add;Set.prototype.add=function(v){return _call(origSetAdd,this,0===v?0:v),this},Value.preserveToString(Set.prototype.add,origSetAdd)}if(!setUsesSameValueZero){var origSetHas=Set.prototype.has;Set.prototype.has=function(v){return _call(origSetHas,this,0===v?0:v)},Value.preserveToString(Set.prototype.has,origSetHas);var origSetDel=Set.prototype["delete"];Set.prototype["delete"]=function(v){return _call(origSetDel,this,0===v?0:v)},Value.preserveToString(Set.prototype["delete"],origSetDel)}var mapSupportsSubclassing=supportsSubclassing(globals.Map,function(M){var m=new M([]);return m.set(42,42),m instanceof M}),mapFailsToSupportSubclassing=Object.setPrototypeOf&&!mapSupportsSubclassing,mapRequiresNew=function(){try{return!(globals.Map()instanceof globals.Map)}catch(e){return e instanceof TypeError}}();if(0!==globals.Map.length||mapFailsToSupportSubclassing||!mapRequiresNew){var OrigMap=globals.Map;globals.Map=function Map(){if(!(this instanceof Map))throw new TypeError('Constructor Map requires "new"');var m=new OrigMap;return arguments.length>0&&addIterableToMap(Map,m,arguments[0]),delete m.constructor,Object.setPrototypeOf(m,Map.prototype),m},globals.Map.prototype=OrigMap.prototype,defineProperty(globals.Map.prototype,"constructor",globals.Map,!0),Value.preserveToString(globals.Map,OrigMap)}var setSupportsSubclassing=supportsSubclassing(globals.Set,function(S){var s=new S([]);return s.add(42,42),s instanceof S}),setFailsToSupportSubclassing=Object.setPrototypeOf&&!setSupportsSubclassing,setRequiresNew=function(){try{return!(globals.Set()instanceof globals.Set)}catch(e){return e instanceof TypeError}}();if(0!==globals.Set.length||setFailsToSupportSubclassing||!setRequiresNew){var OrigSet=globals.Set;globals.Set=function Set(){if(!(this instanceof Set))throw new TypeError('Constructor Set requires "new"');var s=new OrigSet;return arguments.length>0&&addIterableToSet(Set,s,arguments[0]),delete s.constructor,Object.setPrototypeOf(s,Set.prototype),s},globals.Set.prototype=OrigSet.prototype,defineProperty(globals.Set.prototype,"constructor",globals.Set,!0),Value.preserveToString(globals.Set,OrigSet)}var mapIterationThrowsStopIterator=!valueOrFalseIfThrows(function(){return(new Map).keys().next().done});if(("function"!=typeof globals.Map.prototype.clear||0!==(new globals.Set).size||0!==(new globals.Map).size||"function"!=typeof globals.Map.prototype.keys||"function"!=typeof globals.Set.prototype.keys||"function"!=typeof globals.Map.prototype.forEach||"function"!=typeof globals.Set.prototype.forEach||isCallableWithoutNew(globals.Map)||isCallableWithoutNew(globals.Set)||"function"!=typeof(new globals.Map).keys().next||mapIterationThrowsStopIterator||!mapSupportsSubclassing)&&defineProperties(globals,{Map:collectionShims.Map,Set:collectionShims.Set},!0),globals.Set.prototype.keys!==globals.Set.prototype.values&&defineProperty(globals.Set.prototype,"keys",globals.Set.prototype.values,!0),addIterator(Object.getPrototypeOf((new globals.Map).keys())),addIterator(Object.getPrototypeOf((new globals.Set).keys())),functionsHaveNames&&"has"!==globals.Set.prototype.has.name){var anonymousSetHas=globals.Set.prototype.has;overrideNative(globals.Set.prototype,"has",function(key){return _call(anonymousSetHas,this,key)})}}defineProperties(globals,collectionShims),addDefaultSpecies(globals.Map),addDefaultSpecies(globals.Set)}var throwUnlessTargetIsObject=function(target){if(!ES.TypeIsObject(target))throw new TypeError("target must be an object")},ReflectShims={apply:function(){return ES.Call(ES.Call,null,arguments)},construct:function(constructor,args){if(!ES.IsConstructor(constructor))throw new TypeError("First argument must be a constructor.");var newTarget=arguments.length>2?arguments[2]:constructor;if(!ES.IsConstructor(newTarget))throw new TypeError("new.target must be a constructor.");return ES.Construct(constructor,args,newTarget,"internal")},deleteProperty:function(target,key){if(throwUnlessTargetIsObject(target),supportsDescriptors){var desc=Object.getOwnPropertyDescriptor(target,key);if(desc&&!desc.configurable)return!1}return delete target[key]},enumerate:function(target){return throwUnlessTargetIsObject(target),new ObjectIterator(target,"key")},has:function(target,key){return throwUnlessTargetIsObject(target),key in target}};Object.getOwnPropertyNames&&Object.assign(ReflectShims,{ownKeys:function(target){throwUnlessTargetIsObject(target);var keys=Object.getOwnPropertyNames(target);return ES.IsCallable(Object.getOwnPropertySymbols)&&_pushApply(keys,Object.getOwnPropertySymbols(target)),keys}});var callAndCatchException=function(func){return!throwsError(func)};if(Object.preventExtensions&&Object.assign(ReflectShims,{isExtensible:function(target){return throwUnlessTargetIsObject(target),Object.isExtensible(target)},preventExtensions:function(target){return throwUnlessTargetIsObject(target),callAndCatchException(function(){Object.preventExtensions(target)})}}),supportsDescriptors){var internalGet=function(target,key,receiver){var desc=Object.getOwnPropertyDescriptor(target,key);if(!desc){var parent=Object.getPrototypeOf(target);return null===parent?void 0:internalGet(parent,key,receiver)}return"value"in desc?desc.value:desc.get?ES.Call(desc.get,receiver):void 0},internalSet=function(target,key,value,receiver){var desc=Object.getOwnPropertyDescriptor(target,key);if(!desc){var parent=Object.getPrototypeOf(target);if(null!==parent)return internalSet(parent,key,value,receiver);desc={value:void 0,writable:!0,enumerable:!0,configurable:!0}}if("value"in desc){if(!desc.writable)return!1;if(!ES.TypeIsObject(receiver))return!1;var existingDesc=Object.getOwnPropertyDescriptor(receiver,key);return existingDesc?Reflect.defineProperty(receiver,key,{value:value}):Reflect.defineProperty(receiver,key,{value:value,writable:!0,enumerable:!0,configurable:!0})}return desc.set?(_call(desc.set,receiver,value),!0):!1};Object.assign(ReflectShims,{defineProperty:function(target,propertyKey,attributes){return throwUnlessTargetIsObject(target),callAndCatchException(function(){Object.defineProperty(target,propertyKey,attributes)})},getOwnPropertyDescriptor:function(target,propertyKey){return throwUnlessTargetIsObject(target),Object.getOwnPropertyDescriptor(target,propertyKey)},get:function(target,key){throwUnlessTargetIsObject(target);var receiver=arguments.length>2?arguments[2]:target;return internalGet(target,key,receiver)},set:function(target,key,value){throwUnlessTargetIsObject(target);var receiver=arguments.length>3?arguments[3]:target;return internalSet(target,key,value,receiver)}})}if(Object.getPrototypeOf){var objectDotGetPrototypeOf=Object.getPrototypeOf;ReflectShims.getPrototypeOf=function(target){return throwUnlessTargetIsObject(target),objectDotGetPrototypeOf(target)}}if(Object.setPrototypeOf&&ReflectShims.getPrototypeOf){var willCreateCircularPrototype=function(object,lastProto){for(var proto=lastProto;proto;){if(object===proto)return!0;proto=ReflectShims.getPrototypeOf(proto)}return!1};Object.assign(ReflectShims,{setPrototypeOf:function(object,proto){if(throwUnlessTargetIsObject(object),null!==proto&&!ES.TypeIsObject(proto))throw new TypeError("proto must be an object or null");return proto===Reflect.getPrototypeOf(object)?!0:Reflect.isExtensible&&!Reflect.isExtensible(object)?!1:willCreateCircularPrototype(object,proto)?!1:(Object.setPrototypeOf(object,proto),!0)}})}var defineOrOverrideReflectProperty=function(key,shim){if(ES.IsCallable(globals.Reflect[key])){var acceptsPrimitives=valueOrFalseIfThrows(function(){return globals.Reflect[key](1),globals.Reflect[key](0/0),globals.Reflect[key](!0),!0});acceptsPrimitives&&overrideNative(globals.Reflect,key,shim)}else defineProperty(globals.Reflect,key,shim)};if(Object.keys(ReflectShims).forEach(function(key){defineOrOverrideReflectProperty(key,ReflectShims[key])}),functionsHaveNames&&"getPrototypeOf"!==globals.Reflect.getPrototypeOf.name){var originalReflectGetProto=globals.Reflect.getPrototypeOf;overrideNative(globals.Reflect,"getPrototypeOf",function(target){return _call(originalReflectGetProto,globals.Reflect,target)})}if(globals.Reflect.setPrototypeOf&&valueOrFalseIfThrows(function(){return globals.Reflect.setPrototypeOf(1,{}),!0})&&overrideNative(globals.Reflect,"setPrototypeOf",ReflectShims.setPrototypeOf),globals.Reflect.defineProperty&&(valueOrFalseIfThrows(function(){var basic=!globals.Reflect.defineProperty(1,"test",{value:1}),extensible="function"!=typeof Object.preventExtensions||!globals.Reflect.defineProperty(Object.preventExtensions({}),"test",{});return basic&&extensible})||overrideNative(globals.Reflect,"defineProperty",ReflectShims.defineProperty)),globals.Reflect.construct&&(valueOrFalseIfThrows(function(){var F=function(){};return globals.Reflect.construct(function(){},[],F)instanceof F})||overrideNative(globals.Reflect,"construct",ReflectShims.construct)),"Invalid Date"!==String(new Date(0/0))){var dateToString=Date.prototype.toString,shimmedDateToString=function(){var valueOf=+this;return valueOf!==valueOf?"Invalid Date":ES.Call(dateToString,this)};overrideNative(Date.prototype,"toString",shimmedDateToString)}var stringHTMLshims={anchor:function(name){return ES.CreateHTML(this,"a","name",name)},big:function(){return ES.CreateHTML(this,"big","","")},blink:function(){return ES.CreateHTML(this,"blink","","")},bold:function(){return ES.CreateHTML(this,"b","","")},fixed:function(){return ES.CreateHTML(this,"tt","","")},fontcolor:function(color){return ES.CreateHTML(this,"font","color",color)},fontsize:function(size){return ES.CreateHTML(this,"font","size",size)},italics:function(){return ES.CreateHTML(this,"i","","")},link:function(url){return ES.CreateHTML(this,"a","href",url)},small:function(){return ES.CreateHTML(this,"small","","")},strike:function(){return ES.CreateHTML(this,"strike","","")},sub:function(){return ES.CreateHTML(this,"sub","","")},sup:function(){return ES.CreateHTML(this,"sup","","")}};_forEach(Object.keys(stringHTMLshims),function(key){var method=String.prototype[key],shouldOverwrite=!1;if(ES.IsCallable(method)){var output=_call(method,"",' " '),quotesCount=_concat([],output.match(/"/g)).length;shouldOverwrite=output!==output.toLowerCase()||quotesCount>2}else shouldOverwrite=!0;shouldOverwrite&&overrideNative(String.prototype,key,stringHTMLshims[key])});var JSONstringifiesSymbols=function(){if(!hasSymbols)return!1;var stringify="object"===("undefined"==typeof JSON?"undefined":_typeof(JSON))&&"function"==typeof JSON.stringify?JSON.stringify:null;if(!stringify)return!1;if("undefined"!=typeof stringify(_Symbol()))return!0;if("[null]"!==stringify([_Symbol()]))return!0;var obj={a:_Symbol()};return obj[_Symbol()]=!0,"{}"!==stringify(obj)?!0:!1}(),JSONstringifyAcceptsObjectSymbol=valueOrFalseIfThrows(function(){return hasSymbols?"{}"===JSON.stringify(Object(_Symbol()))&&"[{}]"===JSON.stringify([Object(_Symbol())]):!0});if(JSONstringifiesSymbols||!JSONstringifyAcceptsObjectSymbol){var origStringify=JSON.stringify;overrideNative(JSON,"stringify",function(value){if("symbol"!==("undefined"==typeof value?"undefined":_typeof(value))){var replacer;arguments.length>1&&(replacer=arguments[1]);var args=[value];if(isArray(replacer))args.push(replacer);else{var replaceFn=ES.IsCallable(replacer)?replacer:null,wrappedReplacer=function(key,val){var parsedValue=replaceFn?_call(replaceFn,this,key,val):val;return"symbol"!==("undefined"==typeof parsedValue?"undefined":_typeof(parsedValue))?Type.symbol(parsedValue)?assignTo({})(parsedValue):parsedValue:void 0};args.push(wrappedReplacer)}return arguments.length>2&&args.push(arguments[2]),origStringify.apply(this,args)}})}return globals}),define("jqueryplugins",["jquery"],function($){$.prototype.extend({popAttr:function(attr){var ret=this.attr(attr);return this.removeAttr(attr),ret},popData:function(name){var ret=this.data(name);return this.removeData(name),ret},tag:function(){return this[0]&&this[0].tagName&&this[0].tagName.toLowerCase()},textNodes:function(){return 1===this.length&&this[0]instanceof Text?[this[0]]:Array.from(this.add(this.contents().add(this.find("*").contents())).filter(function(){return this instanceof Text})).sort(function(left,right){return 2&left.compareDocumentPosition(right)?1:-1})},prevTextNode:function(){var elem=this.first()[0],parent=this.parent();if(!parent.length)return null;var textNodes=parent.textNodes().filter(function(e){var pos=e.compareDocumentPosition(elem);return 4&pos&&!(8&pos)});return textNodes=textNodes[textNodes.length-1],textNodes?textNodes:parent.prevTextNode()},nextTextNode:function(){var elem=this.last()[0],parent=this.parent();if(!parent.length)return null;var textNodes=parent.textNodes().filter(function(e){var pos=e.compareDocumentPosition(elem);return 2&pos&&!(8&pos)})[0];return textNodes?textNodes:parent.nextTextNode()}})}),function(){function Token(){for(var i=0;i<arguments.length;i++)for(var j in arguments[i])this[j]=arguments[i][j]}function cacheChildPos(token,childToken){token.childAt=token.childAt||{};for(var i=childToken.start;i<childToken.end;i+=1)token.childAt[i]=childToken}function shouldTest(rule,text,lastToken,unmatchedLength){return!(rule.canFollow&&!(rule.canFollow.indexOf(lastToken&&lastToken.type)>-1)||rule.cannotFollow&&(-1!==rule.cannotFollow.indexOf(lastToken&&lastToken.type)||rule.cannotFollow.indexOf("text")>-1&&unmatchedLength)||rule.peek&&rule.peek!==text.slice(0,rule.peek.length))}function _lex(parentToken){for(var src=parentToken.innerText,frontTokenStack=[],index=0,firstUnmatchedIndex=index,endIndex=src.length,lastToken=null;endIndex>index;){for(var slice=src.slice(index),mode=(frontTokenStack.length?frontTokenStack[0]:parentToken).innerMode,i=0,l=mode.length;l>i;i+=1){var rule=rules[mode[i]];if(shouldTest(rule,slice,lastToken,index>firstUnmatchedIndex)&&rule.pattern.test(slice)){var match=rule.pattern.exec(slice),tokenData=rule.fn(match),isMatchingBack=!1,ft=0;if(tokenData.matches){for(;ft<frontTokenStack.length;ft+=1){var type=frontTokenStack[ft].type;if(type in tokenData.matches){isMatchingBack=!0;break}tokenData.cannotCross&&tokenData.cannotCross.indexOf(type)>-1&&(ft=frontTokenStack.length-1)}if(ft>=frontTokenStack.length&&!tokenData.isFront)continue}index>firstUnmatchedIndex&&parentToken.addChild({type:"text",text:src.slice(firstUnmatchedIndex,index),innerMode:mode}),lastToken=parentToken.addChild(tokenData),index+=lastToken.text.length,firstUnmatchedIndex=index,isMatchingBack&&(foldTokens(parentToken,lastToken,frontTokenStack[ft]),frontTokenStack=frontTokenStack.slice(ft+1)),lastToken.isFrontToken()&&frontTokenStack.unshift(lastToken);break}}i===l&&(index+=1,null===lastToken&&(lastToken={type:"text"}))}for(index>firstUnmatchedIndex&&parentToken.addChild({type:"text",text:src.slice(firstUnmatchedIndex,index),innerMode:(frontTokenStack.length?frontTokenStack[0]:parentToken).innerMode});frontTokenStack.length>0;)frontTokenStack.shift().demote();return parentToken}function foldTokens(parentToken,backToken,frontToken){var backTokenIndex=parentToken.children.indexOf(backToken),frontTokenIndex=parentToken.children.indexOf(frontToken);backToken.children=parentToken.children.splice(frontTokenIndex+1,backTokenIndex-(frontTokenIndex+1)),backToken.children.forEach(function(token){cacheChildPos(backToken,token)}),backToken.type=backToken.matches[frontToken.type],backToken.innerText="";for(var i=0,l=backToken.children.length;l>i;i++)backToken.innerText+=backToken.children[i].text;backToken.start=frontToken.start,backToken.text=frontToken.text+backToken.innerText+backToken.text,Object.keys(frontToken).forEach(function(key){Object.hasOwnProperty.call(backToken,key)||(backToken[key]=frontToken[key])}),backToken.isFront&&(backToken.isFront=!1),parentToken.children.splice(frontTokenIndex,1),cacheChildPos(parentToken,backToken)}var Lexer=void 0,rules={};Token.prototype={constructor:Token,addChild:function(tokenData){var index=this.lastChildEnd(),childToken=new Token({start:index,end:tokenData.text&&index+tokenData.text.length,children:[]},tokenData);return childToken.innerText&&_lex(childToken),this.children.push(childToken),cacheChildPos(this,childToken),childToken},lastChild:function(){return this.children?this.children[this.children.length-1]||null:null},lastChildEnd:function(){var lastToken=this.lastChild();return lastToken?lastToken.end:this.start+Math.max(0,this.text.indexOf(this.innerText))},tokenAt:function(index){if(index<this.start||index>=this.end)return null;if(this.childAt)return this.childAt[index]&&this.childAt[index].tokenAt(index)||this;if(this.children.length)for(var i=0;i<this.children.length;i+=1){var childToken=this.children[i].tokenAt(index);if(childToken)return childToken}return this},pathAt:function(index){if(index<this.start||index>=this.end)return[];if(this.childAt)return(this.childAt[index]&&this.childAt[index].pathAt(index)||[]).concat(this);var path=[];if(this.children.length)for(var i=0;i<this.children.length;i+=1){var childPath=this.children[i].pathAt(index);if(childPath.length){path.concat(childPath);break}}return path.concat(this)},nearestTokenAt:function(index){return index<this.start||index>=this.end?null:this.children?this.children.reduce(function(prevValue,child){return prevValue||(index>=child.start&&index<child.end?child:null)},null):this},everyLeaf:function everyLeaf(fn){if(!this.children||0===this.children.length)return!!fn(this);var ret=void 0;return this.children.everyLeaf(function(){ret=ret&&!!everyLeaf(fn)})},isWhitespace:function(){return this.everyLeaf(function(e){return"whitespace"===e.type||!e.text.trim()})},isFrontToken:function(){return this.isFront},isBackToken:function(){return"matches"in this},demote:function(){this.type="text"},error:function(message){this.type="error",this.message=message},toString:function(){var ret=this.type+"("+this.start+""+this.end+")";return this.children&&this.children.length>0&&(ret+="["+this.children+"]"),ret}},Lexer={lex:function(src,initIndex){return _lex(new Token({type:"root",start:initIndex||0,end:src.length,text:src,innerText:src,children:[],childAt:{},innerMode:Lexer.startMode}))},rules:rules},"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=Lexer:"function"==typeof define&&define.amd?define("lexer",[],function(){return Lexer}):"function"==typeof StoryFormat&&this instanceof StoryFormat?(this.modules||(this.modules={}),this.modules.Lexer=Lexer):this.TwineLexer=Lexer}.call(eval("this")||("undefined"!=typeof global?global:window)),function(){function escape(str){return str&&"object"===("undefined"==typeof str?"undefined":_typeof(str))?(Object.keys(str).forEach(function(e){str[e]=escape(str[e])}),str):(str+"").replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function notChars(){return"[^"+Array.apply(0,arguments).map(escape).join("")+"]*"}function makeWrapper(starter){return function(){return"("+starter+Array.apply(0,arguments).join("|")+")"}}var Patterns=void 0,either=makeWrapper("?:"),notBefore=makeWrapper("?!"),before=makeWrapper("?="),ws="[ \\f\\t\\v-\u2028\u2029]*",mws=ws.replace("*","+"),wb="\\b",escapedLine="\\\\\\n\\\\?|\\n\\\\",br="\\n(?!\\\\)",anyLetter="[\\w\\---]",anyLetterStrict="[\\w--]",eol=either("\\n","$"),noUnescapedLineBreak="("+either(escapedLine,"[^\\n]")+"+)",bullet="\\*",bulleted=ws+"("+bullet+"+)"+mws+noUnescapedLineBreak+eol,numberPoint="(?:0\\.)",numbered=ws+"("+numberPoint+"+)"+mws+noUnescapedLineBreak+eol,hr=ws+"-{3,}"+ws+eol,heading=ws+"(#{1,6})"+ws+noUnescapedLineBreak+eol,align=ws+"(==+>|<=+|=+><=+|<==+>)"+ws+eol,passageLink={opener:"\\[\\[(?!\\[)",text:"("+notChars("]")+")",rightSeparator:either("\\->","\\|"),leftSeparator:"<\\-",closer:"\\]\\]",legacySeparator:"\\|",legacyText:"("+either("[^\\|\\]]","\\]"+notBefore("\\]"))+"+)"},validPropertyName=anyLetter.replace("\\-","")+"*"+anyLetter.replace("\\-","").replace("\\w","a-zA-Z")+anyLetter.replace("\\-","")+"*",variable="\\$("+validPropertyName+")",property="'s"+mws+"("+validPropertyName+")",belongingProperty="("+validPropertyName+")"+mws+"of"+wb+notBefore("it"+wb),possessiveOperator="'s"+mws,belongingOperator="of"+wb,identifier=either("it","time")+wb,itsProperty="its"+mws+"("+validPropertyName+")",itsOperator="its"+mws,belongingItProperty="("+validPropertyName+")"+mws+"of"+mws+"it"+wb,belongingItOperator="of"+wb+mws+"it"+wb,macro={opener:"\\(",name:"("+either(anyLetter.replace("]","\\/]")+anyLetter+"*",variable)+"):",closer:"\\)"},twine1Macro="<<[^>\\s]+\\s*(?:\\\\.|'(?:[^'\\\\]*\\\\.)*[^'\\\\]*'|\"(?:[^\"\\\\]*\\\\.)*[^\"\\\\]*\"|[^'\"\\\\>]|>(?!>))*>>",tag={name:"[a-zA-Z][\\w\\-]*",attrs:"(?:\"[^\"]*\"|'[^']*'|[^'\">])*?"},hookTagFront="\\|("+anyLetter.replace("]","_]")+"*)>",hookTagBack="<("+anyLetter.replace("]","_]")+"*)\\|",number="\\b(\\d+(?:\\.\\d+)?(?:[eE][+\\-]?\\d+)?|NaN)"+notBefore("m?s")+"\\b";passageLink.main=passageLink.opener+either(passageLink.text+passageLink.rightSeparator,passageLink.text.replace("*","*?")+passageLink.leftSeparator)+passageLink.text,Patterns={upperLetter:"[A-Z-]",lowerLetter:"[a-z0-9_\\--]",anyLetter:anyLetter,anyLetterStrict:anyLetterStrict,whitespace:mws,escapedLine:escapedLine,br:br,commentFront:"<!--",commentBack:"-->",tag:"<\\/?"+tag.name+tag.attrs+">",tagPeek:"<",scriptStyleTag:"<("+either("script","style")+")"+tag.attrs+">[^]*?<\\/\\1>",scriptStyleTagOpener:"<",url:"("+either("https?","mailto","javascript","ftp","data")+":\\/\\/[^\\s<]+[^<.,:;\"')\\]\\s])",bullet:bullet,hr:hr,heading:heading,align:align,bulleted:bulleted,numbered:numbered,delOpener:escape("~~"),italicOpener:escape("//"),boldOpener:escape("''"),supOpener:escape("^^"),strongFront:escape("**"),strongBack:escape("**"),emFront:escape("*"),emBack:escape("*"),verbatimOpener:"`+",collapsedFront:"{",collapsedBack:"}",hookAppendedFront:"\\[",hookPrependedFront:hookTagFront+"\\[",hookAnonymousFront:"\\[",hookBack:"\\]"+notBefore(hookTagBack),hookAppendedBack:"\\]"+hookTagBack,passageLink:passageLink.main+passageLink.closer,passageLinkPeek:"[[",legacyLink:passageLink.opener+passageLink.legacyText+passageLink.legacySeparator+passageLink.legacyText+passageLink.closer,legacyLinkPeek:"[[",simpleLink:passageLink.opener+passageLink.legacyText+passageLink.closer,simpleLinkPeek:"[[",macroFront:macro.opener+before(macro.name),macroFrontPeek:"(",macroName:macro.name,groupingFront:"\\("+notBefore(macro.name),groupingFrontPeek:"(",groupingBack:"\\)",twine1Macro:twine1Macro,twine1MacroPeek:"<<",property:property,propertyPeek:"'s",belongingProperty:belongingProperty,possessiveOperator:possessiveOperator,belongingOperator:belongingOperator,belongingOperatorPeek:"of",itsOperator:itsOperator,itsOperatorPeek:"its",belongingItOperator:belongingItOperator,belongingItOperatorPeek:"of",variable:variable,variablePeek:"$",hookRef:"\\?("+anyLetter+"+)\\b",hookRefPeek:"?",cssTime:"(\\d+\\.?\\d*|\\d*\\.?\\d+)(m?s)"+wb,colour:either(either("Red","Orange","Yellow","Lime","Green","Cyan","Aqua","Blue","Navy","Purple","Fuchsia","Magenta","White","Gray","Grey","Black"),"#[\\dA-Fa-f]{3}(?:[\\dA-Fa-f]{3})?"),number:number,"boolean":either("true","false")+wb,identifier:identifier,itsProperty:itsProperty,itsPropertyPeek:"its",belongingItProperty:belongingItProperty,escapedStringChar:"\\\\[^\\n]",singleStringOpener:"'",doubleStringOpener:'"',is:"is"+notBefore(" not"," in")+wb,isNot:"is not"+wb,and:"and"+wb,or:"or"+wb,not:"not"+wb,inequality:either("<(?!=)","<=",">(?!=)",">="),isIn:"is in"+wb,contains:"contains"+wb,addition:escape("+")+notBefore("="),subtraction:escape("-")+notBefore("="),multiplication:escape("*")+notBefore("="),division:either("/","%")+notBefore("="),comma:",",spread:"\\.\\.\\."+notBefore("\\."),to:either("to"+wb,"="),into:"into"+wb,augmentedAssign:either("\\+","\\-","\\*","\\/","%")+"="},"object"===("undefined"==typeof module?"undefined":_typeof(module))?module.exports=Patterns:"function"==typeof define&&define.amd?define("patterns",[],function(){return Patterns}):"function"==typeof StoryFormat&&this instanceof StoryFormat?(this.modules||(this.modules={}),this.modules.Patterns=Patterns):this.Patterns=Patterns}.call(eval("this")||("undefined"!=typeof global?global:window)),function(){function rules(Lexer){function textTokenFn(name){return name=name||"innerText",function(match){var innerText=match.reduceRight(function(a,b,index){return a||(index?b:"")},""),data={};return data[name]=innerText,data}}function openerFn(name,foldedName){var matches={};return matches[name]=foldedName,function(){return{isFront:!0,matches:matches}}}function setupRules(mode,target){return Object.keys(target).forEach(function(ruleName){var innerFn=target[ruleName].fn;target[ruleName].fn=function(match){var ret=innerFn(match);return ret.text||(ret.text=match[0]),ret.type||(ret.type=ruleName),ret.innerMode||(ret.innerMode=mode),ret}}),target}var emptyFn=Object.bind(0,null),markupMode=[],macroMode=[],blockRules=setupRules(markupMode,{hr:{fn:emptyFn},bulleted:{fn:function(match){return{depth:match[1].length,innerText:match[2]}}},numbered:{fn:function(match){return{depth:match[1].length/2,innerText:match[2]}}},heading:{fn:function(match){return{depth:match[1].length,innerText:match[2]}}},align:{fn:function(match){var align=void 0,arrow=match[1],centerIndex=arrow.indexOf("><");return~centerIndex?(align=Math.round(centerIndex/(arrow.length-2)*50),25===align&&(align="center")):"<"===arrow[0]&&">"===arrow.slice(-1)?align="justify":arrow.indexOf(">")>-1?align="right":arrow.indexOf("<")>-1&&(align="left"),{align:align}}}});Object.keys(blockRules).forEach(function(key){blockRules[key].canFollow=[null,"br","hr","bulleted","numbered","heading","align"],blockRules[key].cannotFollow=["text"]});var inlineRules=setupRules(markupMode,{twine1Macro:{fn:function(){return{type:"error",message:"Harlowe macros use a different syntax to Twine 1 and SugarCube macros."}}},br:{fn:emptyFn},emBack:{fn:function(){return{matches:{emFront:"em"}}}},strongBack:{fn:function(){return{matches:{strongFront:"strong"}}}},strongFront:{fn:function(){return{isFront:!0}}},emFront:{fn:function(){return{isFront:!0}}},boldOpener:{fn:openerFn("boldOpener","bold")},italicOpener:{fn:openerFn("italicOpener","italic")},delOpener:{fn:openerFn("delOpener","del")},supOpener:{fn:openerFn("supOpener","sup")},commentFront:{fn:function(){return{isFront:!0}}},commentBack:{fn:function(){return{matches:{commentFront:"comment"}}}},scriptStyleTag:{fn:emptyFn},tag:{fn:emptyFn},url:{fn:emptyFn},passageLink:{fn:function(match){var p1=match[1],p2=match[2],p3=match[3];return{type:"twineLink",innerText:p2?p3:p1,passage:p1?p3:p2}}},simpleLink:{fn:function(match){return{type:"twineLink",innerText:match[1],passage:match[1]}}},hookPrependedFront:{fn:function(match){return{name:match[1],isFront:!0,tagPosition:"prepended"}}},hookAnonymousFront:{fn:function(){return{isFront:!0,demote:function(){this.error("This tagged hook doesn't have a matching ].")}}},canFollow:["macro","variable"]},hookAppendedFront:{fn:function(){return{isFront:!0}},cannotFollow:["macro","variable"]},hookBack:{fn:function(){return{type:"hookAppendedBack",matches:{hookPrependedFront:"hook",hookAnonymousFront:"hook"}}}},hookAppendedBack:{fn:function(match){return{name:match[1],tagPosition:"appended",matches:{hookAppendedFront:"hook"}}}},verbatimOpener:{fn:function(match){var number=match[0].length,matches={};return matches["verbatim"+number]="verbatim",{type:"verbatim"+number,isFront:!0,matches:matches}}},collapsedFront:{fn:function(){return{isFront:!0}}},collapsedBack:{fn:function(){return{matches:{collapsedFront:"collapsed"}}}},escapedLine:{fn:emptyFn},legacyLink:{fn:function(match){return{type:"twineLink",innerText:match[1],passage:match[2]}}}}),expressionRules=setupRules(macroMode,{macroFront:{fn:function(match){return{isFront:!0,name:match[1]}}},groupingBack:{fn:function(){return{matches:{groupingFront:"grouping",macroFront:"macro"},cannotCross:["singleStringOpener","doubleStringOpener"]}}},hookRef:{fn:textTokenFn("name")},variable:{fn:textTokenFn("name")},whitespace:{fn:emptyFn,cannotFollow:"text"}}),macroRules=setupRules(macroMode,Object.assign({macroName:{canFollow:["macroFront"],fn:function(match){return match[2]?{isMethodCall:!0,innerText:match[2]}:{isMethodCall:!1}}},groupingFront:{fn:function(){return{isFront:!0}}},property:{fn:textTokenFn("name"),canFollow:["variable","hookRef","property","itsProperty","belongingItProperty","macro","grouping","string","boolean","number"]},possessiveOperator:{fn:emptyFn},itsProperty:{cannotFollow:["text"],fn:textTokenFn("name")},itsOperator:{cannotFollow:["text"],fn:emptyFn},belongingItProperty:{cannotFollow:["text"],fn:textTokenFn("name")},belongingItOperator:{cannotFollow:["text"],fn:emptyFn},belongingProperty:{cannotFollow:["text"],fn:textTokenFn("name")},belongingOperator:{cannotFollow:["text"],fn:emptyFn},escapedStringChar:{fn:function(){return{type:"text"}}},singleStringOpener:{fn:function(){return{isFront:!0,matches:{singleStringOpener:"string"}}}},doubleStringOpener:{fn:function(){return{isFront:!0,matches:{doubleStringOpener:"string"}}}},cssTime:{fn:function(match){return{value:+match[1]*("s"===match[2].toLowerCase()?1e3:1)}}},colour:{cannotFollow:["text"],fn:function(match){var colour,m=match[0].toLowerCase(),mapping={red:"e61919",orange:"e68019",yellow:"e5e619",lime:"80e619",green:"19e619",cyan:"19e5e6",aqua:"19e5e6",blue:"197fe6",navy:"1919e6",purple:"7f19e6",fuchsia:"e619e5",magenta:"e619e5",white:"fff",black:"000",gray:"888",grey:"888"};return colour=Object.hasOwnProperty.call(mapping,m)?"#"+mapping[m]:m,{colour:colour}}},number:{fn:function(match){return{value:parseFloat(match[0])}}},addition:{fn:emptyFn},subtraction:{fn:emptyFn},multiplication:{fn:emptyFn},division:{fn:emptyFn},inequality:{fn:function(match){return{operator:match[0]}}},augmentedAssign:{fn:function(match){return{operator:match[0][0]}}},identifier:{fn:textTokenFn("name"),cannotFollow:["text"]
}},["boolean","is","to","into","and","or","not","isNot","contains","isIn"].reduce(function(a,e){return a[e]={fn:emptyFn,cannotFollow:["text"]},a},{}),["comma","spread","addition","subtraction","multiplication","division"].reduce(function(a,e){return a[e]={fn:emptyFn},a},{})));markupMode.push.apply(markupMode,_toConsumableArray(Object.keys(blockRules)).concat(_toConsumableArray(Object.keys(inlineRules)),_toConsumableArray(Object.keys(expressionRules)))),macroMode.push.apply(macroMode,_toConsumableArray(Object.keys(expressionRules)).concat(_toConsumableArray(Object.keys(macroRules))));var allRules=Object.assign({},blockRules,inlineRules,expressionRules,macroRules);return Object.keys(allRules).forEach(function(key){var re=Patterns[key];allRules[key].pattern="string"!=typeof re?re:new RegExp("^(?:"+re+")","i"),Patterns[key+"Peek"]&&(allRules[key].peek=Patterns[key+"Peek"])}),Object.assign(Lexer.rules,allRules),Lexer.startMode=markupMode,Lexer}function exporter(Lexer){var TwineMarkup=Object.freeze({lex:rules(Lexer).lex,Patterns:Patterns});return TwineMarkup}var Patterns=void 0;Object.assign=Object.assign||function(obj){for(var i=1;i<arguments.length;i++){var target=arguments[i];for(var key in target)Object.hasOwnProperty.call(target,key)&&(obj[key]=target[key])}return obj},"object"===("undefined"==typeof module?"undefined":_typeof(module))?(Patterns=require("patterns"),module.exports=exporter(require("lexer"))):"function"==typeof define&&define.amd?define("markup",["lexer","patterns"],function(Lexer,P){return Patterns=P,exporter(Lexer)}):"function"==typeof StoryFormat&&this instanceof StoryFormat?(Patterns=this.modules.Patterns,this.modules.Markup=exporter(this.modules.Lexer),this.lex=this.modules.Markup.lex):(Patterns=this.Patterns,this.TwineMarkup=exporter(this.TwineLexer))}.call(eval("this")||("undefined"!=typeof global?global:window)),define("utils/selectors",[],function(){return Object.freeze({passage:"tw-passage",story:"tw-story",sidebar:"tw-sidebar",internalLink:"tw-link",brokenLink:"tw-broken-link",hook:"tw-hook",pseudoHook:"tw-pseudo-hook",enchantment:"tw-enchantment",expression:"tw-expression",enchanter:"[enchanter]",script:"[role=script]",stylesheet:"[role=stylesheet]",storyData:"tw-storydata",passageData:"tw-passagedata",whitespace:"tw-char[char=space], tw-char[char=tab], br",collapsed:"tw-collapsed"})}),define("utils/customelements",[],function(){if(document.registerElement){var CustomElements={};return function register(name){for(var proto=Object.create(HTMLElement.prototype),propDef={},_len=arguments.length,props=Array(_len>1?_len-1:0),_key=1;_len>_key;_key++)props[_key-1]=arguments[_key];props.forEach(function(p){propDef[p]={value:null}}),Object.defineProperties(proto,propDef);var el=document.registerElement(name,{prototype:proto});return CustomElements[name]=el,register}("tw-storydata","storyname","startnode","creator","creator-version","options")("tw-passagedata","name","pid","position")("tw-story")("tw-debugger")("tw-passage")("tw-link","passage-name")("tw-broken-link","passage-name")("tw-expression","type","name","js")("tw-sidebar")("tw-icon")("tw-align")("tw-collapsed")("tw-verbatim")("tw-hook","name","source")("tw-pseudo-hook")("tw-transition-container")("tw-error")("tw-error-explanation")("tw-error-explanation-button")("tw-notifier","message"),Object.freeze(CustomElements)}}),define("utils",["jquery","markup","utils/selectors","utils/customelements"],function(_$2,TwineMarkup,Selectors){var lockDesc={configurable:0,writable:0},t8nAnimationTimes={"transition-in":Object.create(null),"transition-out":Object.create(null)},usuallyBlockElements="audio,blockquote,canvas,div,h1,h2,h3,h4,h5,hr,ol,p,pre,table,ul,video,tw-align,tw-story,tw-passage".split(","),usuallyInlineElements="a,b,i,em,strong,sup,sub,abbr,acronym,s,strike,del,big,small,script,img,button,input,tw-link,tw-broken-link,tw-verbatim,tw-collapsed,tw-error".split(","),nonDetachableElements=["audio"],storyElement=void 0,Utils={lockProperties:function(obj){for(var keys=Object.keys(obj),propDesc={},i=0;i<keys.length;i++)propDesc[keys[i]]=lockDesc;return Object.defineProperties(obj,propDesc)},lockProperty:function(obj,prop,value){var propDesc=Object.create(lockDesc);return value&&(propDesc.value=value),Object.defineProperty(obj,prop,propDesc),obj},getInheritedPropertyDescriptor:function(obj,prop){for(;obj&&!obj.hasOwnProperty(prop);)obj=Object.getPrototypeOf(obj);return obj&&Object.getOwnPropertyDescriptor(obj,prop)||null},toJSLiteral:JSON.stringify,toTSStringLiteral:function(str){var _Math,consecutiveGraves=(_Math=Math).max.apply(_Math,_toConsumableArray((str.match(/(`+)/g)||[]).map(function(e){return e.length}).concat(0)))+1;return"`".repeat(consecutiveGraves)+str+"`".repeat(consecutiveGraves)},cssTimeUnit:function(s){if("string"==typeof s){if(s=s.toLowerCase(),"ms"===s.slice(-2))return+s.slice(0,-2)||0;if("s"===s.slice(-1))return 1e3*+s.slice(0,-1)||0}else if(Array.isArray(s)){var _ret=function(){var ret=[];return s.forEach(function(e){var time=Utils.cssTimeUnit(e);time>0&&ret.push(time)}),{v:ret}}();if("object"===("undefined"==typeof _ret?"undefined":_typeof(_ret)))return _ret.v}return 0},nth:function(num){var lastDigit=(num+"").slice(-1);return num+("1"===lastDigit?"st":"2"===lastDigit?"nd":"3"===lastDigit?"rd":"th")},plural:function(num,noun){return num+" "+noun+(num>1?"s":"")},unescape:function(text){return text.replace(/&(?:amp|lt|gt|quot|nbsp|zwnj|#39|#96);/g,function(e){return{"&amp;":"&","&gt;":">","&lt;":"<","&quot;":'"',"&#39;":"'","&nbsp;":String.fromCharCode(160),"&zwnj;":String.fromCharCode(8204)}[e]})},escape:function(text){return text.replace(/[&><"']/g,function(e){return{"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#39;"}[e]})},insensitiveName:function(e){return(e+"").toLowerCase().replace(/-|_/g,"")},wrapHTMLTag:function(text,tagName){return"<"+tagName+">"+text+"</"+tagName+">"},findAndFilter:function(q,selector){return q=_$2(q||Utils.storyElement),q.filter(selector).add(q.find(selector))},closestHookSpan:function(elems){var ret=elems.closest(Selectors.hook+","+Selectors.pseudoHook);return ret.length?ret:elems},childrenProbablyInline:function(jq){var unknown=[];return Array.prototype.every.call(jq.find("*"),function(elem){return elem.hidden||/none|inline/.test(elem.style.display)?!0:usuallyBlockElements.indexOf(elem.tagName.toLowerCase())>-1||/none|inline/.test(elem.style.display)?!1:usuallyInlineElements.indexOf(elem.tagName.toLowerCase())>-1?!0:(unknown.push(elem),!0)})&&unknown.every(function(elem){return/none|inline/.test(elem.style.display)})},transitionReplace:function(oldElem,newElem,transIndex){oldElem=Utils.closestHookSpan(oldElem);var container1=_$2("<tw-transition-container>").css("position","relative");container1.insertBefore(oldElem.first());var container2a=void 0;newElem&&(container2a=_$2("<tw-transition-container>").appendTo(container1),newElem.appendTo(container2a));var container2b=_$2("<tw-transition-container>").css("position","absolute").prependTo(container1);oldElem.detach().appendTo(container2b),Utils.transitionOut(container2b,transIndex),newElem&&Utils.transitionIn(container2a,transIndex,function(){container2a.unwrap().children().first().unwrap()})},transitionOut:function(el,transIndex){function onComplete(){el.remove()}var childrenInline=Utils.childrenProbablyInline(el),mustWrap=el.length>1||!childrenInline||-1===["tw-hook","tw-passage"].indexOf(el.tag());mustWrap&&(el=el.wrapAll("<tw-transition-container>").parent()),el.attr("data-t8n",transIndex).addClass("transition-out"),Utils.childrenProbablyInline(el)&&el.css("display","inline-block");var delay=Utils.transitionTime(transIndex,"transition-out");delay?window.setTimeout(onComplete,delay):onComplete()},transitionIn:function(el,transIndex){function onComplete(){var detachable=0===Utils.findAndFilter(el,nonDetachableElements.join(",")).length;mustWrap&&detachable?el.contents().unwrap():el.removeClass("transition-in").removeAttr("data-t8n")}var childrenInline=Utils.childrenProbablyInline(el),mustWrap=el.length>1||!childrenInline||-1===["tw-hook","tw-passage"].indexOf(el.tag());mustWrap&&(el=el.wrapAll("<tw-transition-container>").parent()),el.attr("data-t8n",transIndex).addClass("transition-in"),Utils.childrenProbablyInline(el)&&el.css("display","inline-block");var delay=Utils.transitionTime(transIndex,"transition-in");delay?window.setTimeout(onComplete,delay):onComplete()},transitionTime:function(transIndex,className){var animClass=t8nAnimationTimes[className];if(!animClass[transIndex]){var p=_$2("<p>").appendTo(document.body).attr("data-t8n",transIndex).addClass(className);animClass[transIndex]=Utils.cssTimeUnit(p.css("animation-duration"))+Utils.cssTimeUnit(p.css("animation-delay")),p.remove()}return animClass[transIndex]},$:function(str,context){return _$2(str,context||Utils.storyElement).not(".transition-out, .transition-out *")},log:function(data){window.console&&console.log(data)},impossible:function(where,data){window.console&&console.error(where+"(): "+data)},assert:function(assertion){window.console&&(assertion||console.error("Assertion failed!"))},assertMustHave:function(object,props){if(window.console)for(var i=0;i<props.length;i+=1)props[i]in object||console.error("Assertion failed: "+object+" lacks property "+props[i])},assertOnlyHas:function(object,props){if(window.console)for(var i in object)-1===props.indexOf(i)&&console.error("Assertion failed: "+object+" had unexpected property '"+i+"'!")},get storyElement(){return storyElement}};return _$2(function(){return storyElement=_$2(Selectors.story)}),Object.freeze(Utils)}),define("twinescript/compiler",["utils"],function(_ref){function indexOfType(array){for(var _len2=arguments.length,types=Array(_len2>1?_len2-1:0),_key2=1;_len2>_key2;_key2++)types[_key2-1]=arguments[_key2];for(var i=0;i<array.length;i+=1)if(types.indexOf(array[i].type)>-1)return i;return 0/0}function rightAssociativeIndexOfType(array){for(var _len3=arguments.length,types=Array(_len3>1?_len3-1:0),_key3=1;_len3>_key3;_key3++)types[_key3-1]=arguments[_key3];return array.length-1-indexOfType.apply(void 0,[[].concat(_toConsumableArray(array)).reverse()].concat(types))}function compile(tokens,isVarRef){if(!tokens)return"";tokens=[].concat(tokens);var token=tokens[0];if(1===tokens.length){if("identifier"===token.type)return isVarRef?"TwineError.create('keyword','I can\\'t use \\'"+token.text+"\\' in this position.') ":" Operations.Identifiers."+token.text.toLowerCase()+" ";if("variable"===token.type)return"VarRef.create(State.variables,"+toJSLiteral(token.name)+")"+(isVarRef?"":".get()");if("hookRef"===token.type)return isVarRef?"VarRef.create(section.selectHook('?"+token.name+"'), 'TwineScript_Assignee')":" section.selectHook('?"+token.name+"') ";if("string"===token.type)return token.text.replace(/\n/g,"\\n");if("colour"===token.type)return"Colour.create("+toJSLiteral(token.colour)+")";if("root"===token.type)return compile(token.children)}var i=void 0,macroNameToken=void 0,left=void 0,right=void 0,midString=void 0,operation=void 0,assignment=void 0,possessive=void 0,needsLeft=!0,needsRight=!0,implicitLeftIt=!1;return(i=indexOfType(tokens,"comma"))>-1?(midString=",",needsRight=!1):(i=indexOfType(tokens,"spread"))>-1?(midString="Operations.makeSpreader(",right=compile(tokens.splice(i+1))+")",needsLeft=!1):(i=indexOfType(tokens,"to"))>-1?(assignment="to",left="Operations.setIt("+compile(tokens.slice(0,i),"varRef")+")"):(i=indexOfType(tokens,"into"))>-1?(assignment="into",right=compile(tokens.slice(0,i),"varRef"),left="Operations.setIt("+compile(tokens.slice(i+1),"varRef")+")"):(i=indexOfType(tokens,"augmentedAssign"))>-1?(assignment=tokens[i].operator,left=compile(tokens.slice(0,i),"varRef"),right="Operations['"+assignment+"']("+(compile(tokens.slice(0,i))+","+compile(tokens.splice(i+1)))+")"):(i=indexOfType(tokens,"and","or"))>-1?operation=tokens[i].type:(i=indexOfType(tokens,"is","isNot"))>-1?(implicitLeftIt=!0,operation=tokens[i].type):(i=indexOfType(tokens,"contains","isIn"))>-1?(implicitLeftIt=!0,operation=tokens[i].type):(i=indexOfType(tokens,"inequality"))>-1?(implicitLeftIt=!0,operation=tokens[i].operator):(i=indexOfType(tokens,"addition","subtraction"))>-1?(operation=tokens[i].text,left=compile(tokens.slice(0,i)),left.trim()||(left="0")):(i=indexOfType(tokens,"multiplication","division"))>-1?operation=tokens[i].text:(i=indexOfType(tokens,"not"))>-1?(midString="Operations.not(",right=compile(tokens.splice(i+1))+")",needsLeft=!1):(i=indexOfType(tokens,"belongingProperty"))>-1?(right="VarRef.create("+compile(tokens.slice(i+1),"varref")+","+toJSLiteral(tokens[i].name)+")"+(isVarRef?"":".get()"),midString=" ",needsLeft=needsRight=!1):(i=indexOfType(tokens,"belongingOperator","belongingItOperator"))>-1?(tokens[i].type.includes("It")&&(right="Operations.Identifiers.it",needsRight=!1),possessive="belonging"):(i=rightAssociativeIndexOfType(tokens,"property"))>-1?(left="VarRef.create("+compile(tokens.slice(0,i),"varref")+","+toJSLiteral(tokens[i].name)+")"+(isVarRef?"":".get()"),midString=" ",needsLeft=needsRight=!1):(i=rightAssociativeIndexOfType(tokens,"itsProperty"))>-1||(i=indexOfType(tokens,"belongingItProperty"))>-1?(left="VarRef.create(Operations.Identifiers.it,"+toJSLiteral(tokens[i].name)+").get()",midString=" ",needsLeft=needsRight=!1):(i=rightAssociativeIndexOfType(tokens,"possessiveOperator","itsOperator"))>-1?(tokens[i].type.includes("it")&&(left="Operations.Identifiers.it",needsLeft=!1),possessive="possessive"):(i=indexOfType(tokens,"macro"))>-1?(macroNameToken=tokens[i].children[0],assert("macroName"===macroNameToken.type),midString="Macros.run("+(macroNameToken.isMethodCall?compile(macroNameToken.children):'"'+tokens[i].name+'"')+", [section,"+compile(tokens[i].children.slice(1))+"])",needsLeft=needsRight=!1):(i=indexOfType(tokens,"grouping"))>-1&&(midString="("+compile(tokens[i].children,isVarRef)+")",needsLeft=needsRight=!1),i>-1?(left=left||compile(tokens.slice(0,i),isVarRef).trim(),right=right||compile(tokens.splice(i+1)).trim(),implicitLeftIt&&!left&&(left=" Operations.Identifiers.it "),needsLeft&&!left||needsRight&&!right?"TwineError.create('operation','I need some code to be "+(needsLeft?"left ":"")+(needsLeft&&needsRight?"and ":"")+(needsRight?"right ":"")+'of "'+tokens[i].text+"\"')":midString?left+midString+right:assignment?"Operations.makeAssignmentRequest("+[left,right,toJSLiteral(assignment)]+")":possessive?"VarRef.create("+("belonging"===possessive?right:left)+",{computed:true,value:"+("belonging"===possessive?left:right)+"})"+(isVarRef?"":".get()"):operation?" Operations["+toJSLiteral(operation)+"]("+left+","+right+") ":""):1===tokens.length?((token.value||token.text)+"").trim()||" ":tokens.reduce(function(a,token){return a+compile(token,isVarRef)},"")}var toJSLiteral=_ref.toJSLiteral,assert=_ref.assert;return compile}),define("internaltypes/twineerror",["jquery","utils"],function($,_ref2){var impossible=_ref2.impossible,assert=_ref2.assert,escape=_ref2.escape,errorExplanations={syntax:"The markup seems to contain a mistake.",saving:"I tried to save or load the game, but I couldn't do it.",operation:"I tried to use an operation on some data, but the data's type was incorrect.",macrocall:"I tried to use a macro, but its call wasn't written correctly.",datatype:"I tried to use a macro, but was given the wrong type of data to it.",keyword:"I was given a keyword in a way that I didn't understand.",changer:"This is a command to change a hook, but it isn't being used correctly.",infinite:"I almost ended up doing the same thing over and over, forever.",property:"I tried to access a value in a string/array/datamap, but I couldn't find it.",unimplemented:"I currently don't have this particular feature. I'm sorry.",javascript:"This error message was reported by your browser's Javascript engine. I don't understand it either, but it usually means that an expression was badly written."},TwineError={create:function(type,message,explanation){return message||impossible("TwineError.create","called with only 1 string."),assert(explanation||type in errorExplanations),Object.assign(Object.create(this),{type:type,message:message,explanation:explanation})},fromError:function(error){return TwineError.create("javascript"," "+error.message)},containsError:function(){for(var _len4=arguments.length,args=Array(_len4),_key4=0;_len4>_key4;_key4++)args[_key4]=arguments[_key4];return args.reduce(function(last,e){return last?last:e instanceof Error?e:TwineError.isPrototypeOf(e)?e:Array.isArray(e)?TwineError.containsError.apply(TwineError,_toConsumableArray(e)):!1},!1)},createWarning:function(type,message){return Object.assign(this.create(type,message),{warning:!0})},render:function(titleText){titleText=titleText||"";var errorElement=$("<tw-error class='"+("javascript"===this.type?"javascript ":"")+(this.warning?"warning":"error")+"' title='"+escape(titleText)+"'>"+escape(this.message)+"</tw-error>"),explanationElement=$("<tw-error-explanation>").text(this.explanation||errorExplanations[this.type]).hide(),explanationButton=$("<tw-error-explanation-button tabindex=0>").html("<span class='folddown-arrowhead'>&#9658;</span>");return explanationButton.on("click",function(){explanationElement.toggle(),explanationButton.children(".folddown-arrowhead").css("transform","rotate("+(explanationElement.is(":visible")?"90deg":"0deg")+")")}),errorElement.append(explanationButton).append(explanationElement),errorElement}};return TwineError}),define("renderer",["utils","markup","twinescript/compiler","internaltypes/twineerror"],function(_ref3,TwineMarkup,Compiler,TwineError){function renderTag(token,tagName){var contents=Renderer.render(token.children);return contents&&wrapHTMLTag(contents,tagName)}var wrapHTMLTag=_ref3.wrapHTMLTag,escape=_ref3.escape,impossible=_ref3.impossible,toJSLiteral=_ref3.toJSLiteral,Renderer=void 0,center="text-align: center; max-width:50%; ";return Renderer={options:{},exec:function(){var cachedInput=void 0,cachedOutput=void 0;return function(src){return"string"!=typeof src?(impossible("Renderer.exec","source was not a string, but "+("undefined"==typeof src?"undefined":_typeof(src))),""):src===cachedInput?cachedOutput:(cachedInput=src,cachedOutput=Renderer.render(TwineMarkup.lex(src).children))}}(),render:function render(tokens){var out="";if(!tokens)return out;for(var len=tokens.length,i=0;len>i;i+=1){var token=tokens[i];switch(token.type){case"error":out+=TwineError.create("syntax",token.message).render(escape(token.text))[0].outerHTML;break;case"numbered":case"bulleted":var tagName="numbered"===token.type?"ol":"ul";out+="<"+tagName+">";for(var depth=1;len>i&&tokens[i]&&tokens[i].type===token.type;)out+=("<"+tagName+">").repeat(Math.max(0,tokens[i].depth-depth)),out+=("</"+tagName+">").repeat(Math.max(0,depth-tokens[i].depth)),depth=tokens[i].depth,out+=renderTag(tokens[i],"li"),i+=1;i-=1,out+=("</"+tagName+">").repeat(depth+1);break;case"align":for(;token&&"align"===token.type;){var style="",body="",align=token.align,j=i+=1;if("left"===align){i-=1;break}for(;len>i&&tokens[i]&&"align"!==tokens[i].type;)i+=1;switch(body+=render(tokens.slice(j,i)),align){case"center":style+=center+"margin-left: auto; margin-right: auto;";break;case"justify":case"right":style+="text-align: "+align+";";break;default:+align&&(style+=center+"margin-left: "+align+"%;")}out+="<tw-align "+(style?'style="'+style+'"':"")+(Renderer.options.debug?' title="'+token.text+'"':"")+">"+body+"</tw-align>\n",token=tokens[i]}break;case"heading":out+=renderTag(token,"h"+token.depth);break;case"br":case"hr":out+="<"+token.type+">";break;case"escapedLine":case"comment":break;case"inlineUrl":out+='<a class="link" href="'+escape(token.text)+'">'+token.text+"</a>";break;case"scriptStyleTag":case"tag":out+=token.text.startsWith("</")?token.text:token.text.replace(/>$/," data-raw>");break;case"sub":case"sup":case"del":case"strong":case"em":out+=renderTag(token,token.type);break;case"bold":out+=renderTag(token,"b");break;case"italic":out+=renderTag(token,"i");break;case"twineLink":var newTwineLinkToken=TwineMarkup.lex("(link-goto:"+toJSLiteral(token.innerText)+","+toJSLiteral(token.passage)+")");out+=render(newTwineLinkToken.children);break;case"hook":out+="<tw-hook "+(token.name?'name="'+token.name+'"':"")+(Renderer.options.debug&&token.name?' title="Hook: ?'+token.name+'"':"")+' source="'+escape(token.innerText)+'"></tw-hook>';break;case"verbatim":out+=wrapHTMLTag(escape(token.innerText).replace(/\n/g,"<br>"),"tw-verbatim");break;case"collapsed":out+=renderTag(token,"tw-collapsed");break;case"hookRef":case"variable":case"macro":out+='<tw-expression type="'+token.type+'" name="'+escape(token.name||token.text)+'"'+(Renderer.options.debug?' title="'+escape(token.text)+'"':"")+' js="'+escape(Compiler(token))+'"></tw-expression>';break;default:out+=token.children&&token.children.length?render(token.children):token.text}}return out}},Object.freeze(Renderer)}),define("passages",["jquery","utils","utils/selectors"],function($,_ref4,Selectors){function Passage(elem){return Object.assign(new Map([["source",unescape(elem.html())],["tags",(elem.attr("tags")||"").split(/\s/)],["name",elem.attr("name")]]),{TwineScript_TypeName:"passage datamap",TwineScript_ObjectName:"a passage datamap"})}var unescape=_ref4.unescape,Passages=Object.assign(new Map,{TwineScript_ObjectName:"the Passages datamap",getTagged:function(tag){var ret=[];return this.forEach(function(v){var tags=v instanceof Map&&v.get("tags");Array.isArray(tags)&&tags.indexOf(tag)>-1&&ret.push(v)}),ret.sort(function(left,right){return left.get("name")>right.get("name")})},create:Passage});return $(function(){Array.from($(Selectors.storyData+" > "+Selectors.passageData)).forEach(function(e){e=$(e),Passages.set(e.attr("name"),new Passage(e))})}),Passages}),define("state",["utils","passages"],function(_ref5,Passages){var impossible=_ref5.impossible,SystemVariables={TwineScript_ObjectName:"this story's variables",TwineScript_Writeproof:[]},Moment={passage:"",variables:SystemVariables,create:function(p,v){var ret=Object.create(Moment);return ret.passage=p||"",ret.variables=Object.assign(Object.create(this.variables),v),ret}},timeline=[],recent=-1,present=Moment.create(),serialisable=!0,State=Object.assign({get passage(){return present.passage},get variables(){return present.variables},get pastLength(){return recent},get futureLength(){return timeline.length-1-recent},passageNameVisited:function(name){var ret=0;if(!Passages.get(name))return 0;for(var i=0;recent>=i;i++)ret+=+(name===timeline[i].passage);return ret},passageNameLastVisited:function(name){if(!Passages.get(name))return 1/0;if(name===present.passage)return 0;for(var i=recent;i>0;i--)if(timeline[i].passage===name)return recent-i+1;return 1/0},pastPassageNames:function(){for(var ret=[],i=recent-1;i>=0;i--)ret.unshift(timeline[i].passage);return ret},newPresent:function(newPassageName){present=(timeline[recent]||Moment).create(newPassageName)},play:function(newPassageName){present||impossible("State.play","present is undefined!"),present.passage=newPassageName,timeline=timeline.slice(0,recent+1).concat(present),recent+=1,this.newPresent(newPassageName)},rewind:function(arg){var steps=1,moved=!1;if(arg)if("string"==typeof arg){if(steps=this.passageNameLastVisited(arg),steps===1/0)return}else"number"==typeof arg&&(steps=arg);for(;steps>0&&recent>0;steps--)moved=!0,recent-=1;return moved&&this.newPresent(timeline[recent].passage),moved},fastForward:function(arg){var steps=1,moved=!1;for("number"==typeof arg&&(steps=arg);steps>0&&timeline.length>0;steps--)moved=!0,recent+=1;return moved&&this.newPresent(timeline[recent].passage),moved},reset:function(){timeline=[],recent=-1,present=Moment.create(),serialisable=!0}},function(){function isSerialisable(variable){return"number"==typeof variable||"boolean"==typeof variable||"string"==typeof variable||null===variable||Array.isArray(variable)&&variable.every(isSerialisable)||variable instanceof Set&&Array.from(variable).every(isSerialisable)||variable instanceof Map&&Array.from(variable.values()).every(isSerialisable)}function replacer(name,variable){return variable instanceof Set?{"(dataset:)":Array.from(variable)}:variable instanceof Map?{"(datamap:)":Array.from(variable)}:variable}function reviver(name,variable){if(Object.prototype.isPrototypeOf(variable)){if(Array.isArray(variable["(dataset:)"]))return new Set(variable["(dataset:)"]);if(Array.isArray(variable["(datamap:)"]))return new Map(variable["(datamap:)"])}return variable}function serialise(){var ret=timeline.slice(0,recent+1);if(serialisable=serialisable&&ret.every(function(moment){return Object.keys(moment.variables).every(function(e){return isSerialisable(moment.variables[e])})}),!serialisable)return!1;try{return JSON.stringify(ret,replacer)}catch(e){return!1}}function deserialise(str){var newTimeline=void 0,lastVariables=SystemVariables;try{newTimeline=JSON.parse(str,reviver)}catch(e){return!1}return Array.isArray(newTimeline)?(newTimeline=newTimeline.map(function(moment){return"object"===("undefined"==typeof moment?"undefined":_typeof(moment))&&moment.hasOwnProperty("passage")&&moment.hasOwnProperty("variables")?(moment.variables=Object.assign(Object.create(lastVariables),moment.variables),lastVariables=moment.variables,Object.assign(Object.create(Moment),moment)):!1})).indexOf(!1)>-1?!1:(timeline=newTimeline,recent=timeline.length-1,void this.newPresent(timeline[recent].passage)):!1}return{serialise:serialise,deserialise:deserialise}}());return Object.seal(Moment),Object.freeze(State)}),define("utils/naturalsort",[],function(){return function(locale){return function naturalSort(a,b){var oFxNcL,oFyNcL,collator,colCmp,re=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,sre=/(^[ ]*|[ ]*$)/g,dre=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,hre=/^0x[0-9a-f]+$/i,ore=/^0/,i=function(s){return naturalSort.insensitive&&(""+s).toLowerCase()||""+s},x=i(a).replace(sre,"")||"",y=i(b).replace(sre,"")||"",xN=x.replace(re,"\x00$1\x00").replace(/\0$/,"").replace(/^\0/,"").split("\x00"),yN=y.replace(re,"\x00$1\x00").replace(/\0$/,"").replace(/^\0/,"").split("\x00"),xD=parseInt(x.match(hre))||1!==xN.length&&x.match(dre)&&Date.parse(x),yD=parseInt(y.match(hre))||xD&&y.match(dre)&&Date.parse(y)||null;if(locale&&window.Intl&&window.Intl.Collator&&(collator=window.Intl.Collator(locale)),yD){if(yD>xD)return-1;if(xD>yD)return 1}for(var cLoc=0,numS=Math.max(xN.length,yN.length);numS>cLoc;cLoc++){if(oFxNcL=!(xN[cLoc]||"").match(ore)&&parseFloat(xN[cLoc])||xN[cLoc]||0,oFyNcL=!(yN[cLoc]||"").match(ore)&&parseFloat(yN[cLoc])||yN[cLoc]||0,isNaN(oFxNcL)!==isNaN(oFyNcL))return isNaN(oFxNcL)?1:-1;if(("undefined"==typeof oFxNcL?"undefined":_typeof(oFxNcL))!==("undefined"==typeof oFyNcL?"undefined":_typeof(oFyNcL)))oFxNcL+="",oFyNcL+="";else if("string"==typeof oFxNcL&&collator&&(colCmp=collator.compare(oFxNcL,oFyNcL),0!==colCmp))return colCmp;if(oFyNcL>oFxNcL)return-1;if(oFxNcL>oFyNcL)return 1}return 0}}}),define("utils/operationutils",["utils","internaltypes/twineerror"],function(_ref6,TwineError){function isObject(value){return!!value&&("object"===("undefined"==typeof value?"undefined":_typeof(value))||"function"==typeof value)}function collectionType(value){return Array.isArray(value)?"array":value instanceof Map?"datamap":value instanceof Set?"dataset":value&&"object"===("undefined"==typeof value?"undefined":_typeof(value))?"object":""}function isValidDatamapName(map,name){if(assert(map instanceof Map),"string"!=typeof name&&"number"!=typeof name)return TwineError.create("property","Only strings and numbers can be used as data names for "+objectName(map)+", not "+objectName(name)+".");var otherName="string"==typeof name?+name:""+name;return!Number.isNaN(otherName)&&map.has(otherName)?TwineError.create("property","You mustn't use both "+objectName(name)+" and "+objectName(otherName)+" as data names in the same datamap."):!0}function isSequential(value){return"string"==typeof value||Array.isArray(value)}function clone(value){if(!isObject(value))return value;if("function"==typeof value.TwineScript_Clone)return value.TwineScript_Clone();if(Array.isArray(value))return[].concat(_toConsumableArray(value));if(value instanceof Map)return Object.assign(new Map(value),value);if(value instanceof Set)return Object.assign(new Set(value),value);if("function"==typeof value)return Object.assign(value.bind(),value);switch(Object.getPrototypeOf(value)){case Object.prototype:return Object.assign({},value);case null:return Object.assign(Object.create(null),value)}return impossible("OperationUtils.clone","The value "+(value.toSource?value.toSource():value)+" cannot be cloned!"),value}function coerceToString(fn,left,right){return"string"==typeof left&&isObject(right)&&"TwineScript_ToString"in right?fn(left,right.TwineScript_ToString()):"string"==typeof right&&isObject(left)&&"TwineScript_ToString"in left?fn(left.TwineScript_ToString(),right):!1}function objectName(obj){return isObject(obj)&&"TwineScript_ObjectName"in obj?obj.TwineScript_ObjectName:Array.isArray(obj)?"an array":obj instanceof Map?"a datamap":obj instanceof Set?"a dataset":"boolean"==typeof obj?"the logic value '"+obj+"'":"string"==typeof obj||"number"==typeof obj?"the "+("undefined"==typeof obj?"undefined":_typeof(obj))+" "+toJSLiteral(obj):void 0===obj?"an empty variable":"...whatever this is"}function typeName(obj){return obj.innerType?"either"===obj.pattern?(assert(Array.isArray(obj.innerType)),obj.innerType.map(typeName).join(" or ")):"optional"===obj.pattern?"(an optional) "+typeName(obj.innerType):typeName(obj.innerType):obj===String||obj===Number||obj===Boolean?"a "+_typeof(obj()):obj===Map?"a datamap":obj===Set?"a dataset":obj===Array?"an array":isObject(obj)&&"TwineScript_TypeName"in obj?obj.TwineScript_TypeName:objectName(obj)}function is(l,r){return"object"!==("undefined"==typeof l?"undefined":_typeof(l))&&"object"!==("undefined"==typeof r?"undefined":_typeof(r))?l===r:Array.isArray(l)&&Array.isArray(r)?l.length!==r.length?!1:l.every(function(element,index){return is(r[index],element)}):l instanceof Map&&r instanceof Map?is(Array.from(l.entries()).sort(),Array.from(r.entries()).sort()):l instanceof Set&&r instanceof Set?is(Array.from(l.values()),Array.from(r.values())):l&&"function"==typeof l.TwineScript_is?l.TwineScript_is(r):l&&"object"===("undefined"==typeof l?"undefined":_typeof(l))&&r&&"object"===("undefined"==typeof r?"undefined":_typeof(r))&&Object.getPrototypeOf(l)===Object.prototype&&Object.getPrototypeOf(r)===Object.prototype?is(Object.getOwnPropertyNames(l).map(function(name){return[name,l[name]]}),Object.getOwnPropertyNames(r).map(function(name){return[name,r[name]]})):Object.is(l,r)}function contains(container,obj){if(container){if("string"==typeof container)return container.indexOf(obj)>-1;if(Array.isArray(container))return container.some(function(e){return is(e,obj)});if(container instanceof Set||container instanceof Map)return Array.from(container.keys()).some(function(e){return is(e,obj)})}return is(container,obj)}function subset(sequence,a,b){if(!a||!b)return TwineError.create("macrocall","The sub"+collectionType(sequence)+" index values must not be 0 or NaN.");if(0>a&&(a=sequence.length+a+1),0>b&&(b=sequence.length+b+1),a>b)return subset(sequence,b,a);var isString="string"==typeof sequence;isString&&(sequence=Array.from(sequence));var ret=sequence.slice(a>0?a-1:a,b);return isString?ret.join(""):ret}var assert=_ref6.assert,impossible=_ref6.impossible,toJSLiteral=_ref6.toJSLiteral,OperationUtils=Object.freeze({isObject:isObject,isValidDatamapName:isValidDatamapName,collectionType:collectionType,isSequential:isSequential,clone:clone,coerceToString:coerceToString,objectName:objectName,typeName:typeName,is:is,contains:contains,subset:subset,numericIndex:/^(?:[1-9]\d*|0)$/});return OperationUtils}),define("macros",["jquery","utils/naturalsort","utils","utils/operationutils","internaltypes/twineerror"],function($,NaturalSort,_ref7,_ref8,TwineError){
function readArguments(fn){return function(args){args=args.reduce(function(newArgs,el){if(el&&el.spreader===!0)if(Array.isArray(el.value)||"string"==typeof el.value)for(var i=0;i<el.value.length;i++)newArgs.push(el.value[i]);else newArgs.push(el.value instanceof Set?Array.from(el.value).sort(NaturalSort("en")):TwineError.create("operation","I can't spread out "+objectName(el.value)+", which is not a string, dataset or array."));else newArgs.push(el);return newArgs},[]);var error=TwineError.containsError(args);return error?error:fn.apply(void 0,_toConsumableArray(args))}}function singleTypeCheck(arg,type){if(null===type)return void 0===arg;if(type.innerType){if("optional"===type.pattern||"zero or more"===type.pattern)return void 0===arg?!0:singleTypeCheck(arg,type.innerType);if("either"===type.pattern)return type.innerType.some(function(type){return singleTypeCheck(arg,type)});if("wrapped"===type.pattern)return singleTypeCheck(arg,type.innerType)}return void 0!==type&&void 0===arg?!1:type!==Macros.TypeSignature.Any||void 0===arg||arg.TwineScript_Unobservable?type===String?"string"==typeof arg:type===Boolean?"boolean"==typeof arg:type===Number?"number"==typeof arg:type===Array?Array.isArray(arg):type===Map||type===Set?arg instanceof type:Object.isPrototypeOf.call(type,arg):!0}function typeSignatureCheck(name,fn,typeSignature){if(!typeSignature)return fn;typeSignature=[].concat(typeSignature),name="("+(Array.isArray(name)&&name.length>1?name[0]:name)+":)";var signatureInfo=void 0;return signatureInfo=typeSignature.length>0?"The "+name+" macro must only be given "+typeSignature.map(typeName).reduce(function(a,e,i,arr){return a+(0===i?"":i<arr.length-1?", ":", and ")+e},"")+(typeSignature.length>1?", in that order":"."):"The macro must not be given any data - just write "+name+".",function(section){for(var _len5=arguments.length,args=Array(_len5>1?_len5-1:0),_key5=1;_len5>_key5;_key5++)args[_key5-1]=arguments[_key5];for(var rest=void 0,ind=0,end=Math.max(args.length,typeSignature.length);end>ind;ind+=1){var type=typeSignature[ind],arg=args[ind];if(ind>=typeSignature.length&&!rest)return TwineError.create("typesignature",args.length-typeSignature.length+" too many values were given to this "+name+" macro.",signatureInfo);if(type||(type=rest),!type.innerType||"rest"!==type.pattern&&"zero or more"!==type.pattern||(rest=type.innerType,"rest"===type.pattern&&(type=type.innerType)),!singleTypeCheck(arg,type))return void 0===arg?TwineError.create("typesignature","The "+name+" macro needs "+plural(typeSignature.length-ind,"more value")+".",signatureInfo):arg&&arg.TwineScript_Unobservable&&type===Macros.TypeSignature.Any?TwineError.create("typesignature",name+"'s "+nth(ind+1)+" value is not valid data for this macro.",signatureInfo):TwineError.create("typesignature",name+"'s "+nth(ind+1)+" value is "+objectName(arg)+", but should be "+typeName(type)+".",type.message||signatureInfo)}return fn.apply(void 0,[section].concat(args))}}function privateAdd(name,type,fn){Array.isArray(name)?name.forEach(function(n){return lockProperty(macroRegistry,insensitiveName(n),fn)}):lockProperty(macroRegistry,insensitiveName(name),fn)}var insensitiveName=_ref7.insensitiveName,nth=_ref7.nth,plural=_ref7.plural,assert=_ref7.assert,lockProperty=_ref7.lockProperty,objectName=_ref8.objectName,typeName=_ref8.typeName,Macros=void 0,macroRegistry={},commandRegistry={};return Macros={has:function(e){return e=insensitiveName(e),macroRegistry.hasOwnProperty(e)},get:function(e){return e=insensitiveName(e),macroRegistry.hasOwnProperty(e)&&macroRegistry[e]},add:function add(name,fn,typeSignature){return privateAdd(name,"value",readArguments(typeSignatureCheck(name,fn,typeSignature))),add},addChanger:function addChanger(name,fn,changerCommandFn,typeSignature){return assert(changerCommandFn),privateAdd(name,"changer",readArguments(typeSignatureCheck(name,fn,typeSignature))),commandRegistry[Array.isArray(name)?name[0]:name]=changerCommandFn,addChanger},getChangerFn:function(name){return commandRegistry[name]},TypeSignature:{optional:function(type){return{pattern:"optional",innerType:type}},zeroOrMore:function(type){return{pattern:"zero or more",innerType:type}},either:function(){for(var _len6=arguments.length,innerType=Array(_len6),_key6=0;_len6>_key6;_key6++)innerType[_key6]=arguments[_key6];return{pattern:"either",innerType:innerType}},rest:function(type){return{pattern:"rest",innerType:type}},wrapped:function(innerType,message){return{pattern:"wrapped",innerType:innerType,message:message}},Any:{TwineScript_TypeName:"anything"}},run:function(name,args){return TwineError.containsError(name)?name:Macros.has(name)?Macros.get(name)(args):TwineError.create("macrocall","I can't run the macro '"+name+"' because it doesn't exist.")}},Object.freeze(Macros)}),define("datatypes/colour",["utils","jquery"],function(_ref9,$){function css3ToRGB(colourName){if(colourName in cssNameCache)return cssNameCache[colourName];var colour=$("<p>").css("background-color",colourName).css("background-color");return colour=colour.startsWith("rgb")?colour.match(/\d+/g).reduce(function(colour,num,ind){return colour["rgb"[ind]]=+num,colour},{}):{r:192,g:192,b:192},cssNameCache[colourName]=colour,colour}function hexToRGB(str){return"string"!=typeof str?str:(str=str.replace("#",""),str=str.replace(tripleDigit,"$1$1$2$2$3$3"),{r:parseInt(str.slice(0,2),16),g:parseInt(str.slice(2,4),16),b:parseInt(str.slice(4,6),16)})}var assert=_ref9.assert,singleDigit=/^([\da-fA-F])$/,tripleDigit=/^([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,sextupleDigit=/^([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])([\da-fA-F])$/,cssNameCache=Object.create(null),Colour=Object.freeze({colour:!0,TwineScript_TypeName:"a colour",TwineScript_ObjectName:"a colour","TwineScript_+":function(other){var l=this,r=other;return Colour.create({r:Math.min(Math.round(.6*(l.r+r.r)),255),g:Math.min(Math.round(.6*(l.g+r.g)),255),b:Math.min(Math.round(.6*(l.b+r.b)),255)})},TwineScript_Print:function(){return"<tw-colour style='background-color:rgb("+[this.r,this.g,this.b].join(",")+");'></span>"},TwineScript_is:function(other){return Colour.isPrototypeOf(other)&&other.r===this.r&&other.g===this.g&&other.b===this.b},TwineScript_Clone:function(){return Colour.create(this)},toHexString:function(){return assert(this!==Colour),"#"+this.r.toString(16).replace(singleDigit,"0$1")+this.g.toString(16).replace(singleDigit,"0$1")+this.b.toString(16).replace(singleDigit,"0$1")},create:function(rgbObj){return"string"==typeof rgbObj?this.create(Colour.isHexString(rgbObj)?hexToRGB(rgbObj):css3ToRGB(rgbObj)):Object.assign(Object.create(this),rgbObj)},isHexString:function(str){return"string"==typeof str&&"#"===str[0]&&(str.slice(1).match(tripleDigit)||str.slice(1).match(sextupleDigit))}});return Colour}),define("utils/hookutils",["jquery","utils/selectors"],function($,Selectors){function sliceNode(node,start,end){var l=node.textContent.length;if(!(start>=l)){var newNode=void 0,ret=[newNode=0===start?node:node.splitText(start)];return end&&(0>=end&&(end=l-end),l>end&&ret.push(newNode.splitText(end-start))),ret}}function findTextInNodes(textNodes,searchString){var examinedNodes=[],examinedText="",ret=[];if(!textNodes.length||!searchString)return ret;for(;textNodes.length>0;){examinedNodes.push(textNodes[0]),examinedText+=textNodes[0].textContent,textNodes.shift();var index=examinedText.indexOf(searchString);if(index>-1){for(var _ret2,remainingLength=examinedText.length-(index+searchString.length);index>=examinedNodes[0].textContent.length;)index-=examinedNodes[0].textContent.length,examinedNodes.shift();if(1===examinedNodes.length){var _slices=sliceNode(examinedNodes[0],index,index+searchString.length);ret.push(_slices[0]),_slices[1]&&textNodes.unshift(_slices[1]);break}ret.push(sliceNode(examinedNodes[0],index,examinedNodes[0].length)[0]),(_ret2=ret).push.apply(_ret2,_toConsumableArray(examinedNodes.slice(1,-1)));var slices=sliceNode(examinedNodes[examinedNodes.length-1],0,examinedNodes[examinedNodes.length-1].textContent.length-remainingLength);ret.push(slices[0]),slices[1]&&textNodes.unshift(slices[1]),ret=ret.filter(Boolean);break}}return[ret].concat(_toConsumableArray(findTextInNodes(textNodes,searchString)))}var HookUtils={wrapTextNodes:function(searchString,dom,htmlTag){var nodes=findTextInNodes(dom.textNodes(),searchString),ret=$();return nodes.forEach(function(e){ret=ret.add($(e).wrapAll(htmlTag))}),ret},selectorType:function(val){if(val&&"string"==typeof val){var r=/\?(\w*)/.exec(val);return r&&r.length?"hookRef":"<"===val[0]&&">"===val[val.length-1]?"html":"string"}return"undefined"},hookToSelector:function(c){return c=c.replace(/"/g,"&quot;"),Selectors.hook+'[name="'+c+'"]'}};return Object.freeze(HookUtils)}),define("datatypes/hookset",["jquery","utils/hookutils"],function($,_ref10){function hooks(){return this.section.$(hookToSelector(this.selector.slice(1)))}function jQueryCall(methodName){for(var myHooks=hooks.call(this),_len7=arguments.length,args=Array(_len7>1?_len7-1:0),_key7=1;_len7>_key7;_key7++)args[_key7-1]=arguments[_key7];return methodName in myHooks&&myHooks[methodName].apply(myHooks,args)}var hookToSelector=_ref10.hookToSelector,HookSet=Object.freeze({forEach:function(fn){return jQueryCall.call(this,"each",function(i){fn($(this),i)})},text:function(){return jQueryCall.call(this,"text")},TwineScript_ToString:function(){return this.text()},TwineScript_Print:function(){return this.text()},get TwineScript_ObjectName(){return this.selector+" (a hook reference)"},TwineScript_TypeName:"a hook reference (like ?this)",set TwineScript_Assignee(value){this.section.renderInto(value,hooks.call(this),{append:"replace"})},get TwineScript_Assignee(){return this},TwineScript_AssignValue:function(){return jQueryCall.call(this,"text")},TwineScript_DeleteValue:function(prop){"TwineScript_Assignee"===prop&&jQueryCall.call(this,"text","")},create:function(section,hookSelector){var ret=Object.create(this);return ret.section=section,ret.selector=hookSelector,Object.freeze(ret)}});return HookSet}),define("internaltypes/varref",["state","internaltypes/twineerror","utils/operationutils","datatypes/hookset"],function(State,TwineError,_ref11,HookSet){function compilePropertyIndex(obj,prop){var error=void 0;if(obj instanceof Map&&(error=TwineError.containsError(isValidDatamapName(obj,prop))))return error;if(isSequential(obj)){var match=void 0;if("number"==typeof prop)prop-=1;else if("string"==typeof prop&&(match=/(\d+)(?:st|[nr]d|th)last/i.exec(prop)))prop=-match[1]+"";else if("string"==typeof prop&&(match=/(\d+)(?:st|[nr]d|th)/i.exec(prop)))prop=match[1]-1+"";else if("last"===prop)prop=-1;else if("length"!==prop)return TwineError.create("property","You can only access position strings/numbers ('4th', 'last', '2ndlast', (2), etc.) and 'length' of "+objectName(obj)+", not "+objectName(prop)+".")}else if(obj instanceof Set){if("length"!==prop)return TwineError.create("property","You can only get the 'length' of a "+objectName(obj)+".","To check contained values, use the 'contains' operator.");prop="size"}else if("number"==typeof obj||"boolean"==typeof obj)return TwineError.create("property","You can't get data values from "+objectName(obj)+".");return prop}function compilePropertyChain(object,propertyChain){var compiledPropertyChain=propertyChain.reduce(function(arr,prop,i){prop.computed&&(prop=prop.value),prop=Array.isArray(prop)?prop.map(function(prop){return compilePropertyIndex(object,prop)}):compilePropertyIndex(object,prop);var error=void 0;return(error=TwineError.containsError(arr,prop))?error:(i<propertyChain.length-1&&(object=_get(object,prop)),arr.push(prop),arr)},[]);return{compiledPropertyChain:compiledPropertyChain,deepestObject:object}}function objectOrMapGet(obj,prop){return void 0===obj?obj:obj instanceof Map?obj.get(prop):(isSequential(obj)&&0>prop-0&&(prop=obj.length+(prop-0)),obj[prop])}function propertyDebugName(prop){return prop.computed?"("+objectName(prop.value)+")":"'"+prop+"'"}function canSet(obj,prop){if(Array.isArray(prop))return prop.map(function(prop){return canSet(obj,prop)});var specialCollectionErrorMsg="I won't add "+propertyDebugName(prop)+" to "+objectName(obj)+" because it's one of my special system collections.",writeproofErrorMsg="I can't modify '"+propertyDebugName(prop)+"' because it holds one of my special system collections.";if(obj instanceof Map)return obj.TwineScript_Sealed&&!obj.has(prop)?TwineError.create("operation",specialCollectionErrorMsg):obj.TwineScript_Writeproof&&obj.TwineScript_Writeproof.indexOf(prop)>-1?TwineError.create("operation",writeproofErrorMsg):!0;if(isSequential(obj)){if("length"===prop)return TwineError.create("operation","I can't forcibly alter the length of "+objectName(obj)+".");if(+prop!==(0|prop))return TwineError.create("property",objectName(obj)+" can only have position keys ('3rd', '1st', (5), etc.), not "+propertyDebugName(prop)+".")}return!obj.TwineScript_Sealed||prop in obj?obj.TwineScript_Writeproof&&obj.TwineScript_Writeproof.indexOf(prop)>-1?TwineError.create("operation",writeproofErrorMsg):"number"==typeof obj||"boolean"==typeof obj?TwineError.create("operation","You can't alter the data values of "+objectName(obj)+"."):!0:TwineError.create("operation",specialCollectionErrorMsg)}function objectOrMapSet(obj,prop,value){obj instanceof Map?obj.set(prop,value):(isSequential(obj)&&0>prop-0&&(prop=obj.length+(prop-0)),obj[prop]=value)}function objectOrMapDelete(obj,prop){isSequential(obj)&&0>prop-0&&(prop=obj.length+(prop-0)),Array.isArray(obj)&&numericIndex.exec(prop)?obj.splice(prop,1):obj instanceof Map||obj instanceof Set?obj["delete"](prop):obj.TwineScript_DeleteValue?obj.TwineScript_DeleteValue(prop):delete obj[prop]}function wrapError(error){function self(){return error}return{get:self,set:self,"delete":self}}function _get(obj,prop,originalProp){if(Array.isArray(prop))return prop.map(function(e){return _get(obj,e,e)})["string"==typeof obj?"join":"valueOf"]("");"string"==typeof obj&&(obj=[].concat(_toConsumableArray(obj)));var result=objectOrMapGet(obj,prop);return void 0===result?obj===State.variables?defaultValue:TwineError.create("property","I can't find a "+propertyDebugName(originalProp)+" data name in "+objectName(obj)):result}function mutateRight(fn,value){var _this=this,result=this.compiledPropertyChain.reduce(function(arr,prop){var object=void 0;return object=0===arr.length?_this.object:_get.apply(void 0,_toConsumableArray(arr[arr.length-1])),arr.push([object,prop])&&arr},[]).reduceRight(fn,value);return TwineError.containsError(result)?result:void 0}var isObject=_ref11.isObject,isSequential=_ref11.isSequential,objectName=_ref11.objectName,clone=_ref11.clone,numericIndex=_ref11.numericIndex,isValidDatamapName=_ref11.isValidDatamapName,defaultValue=0,VarRefProto=Object.freeze({varref:!0,get:function(){return _get(this.deepestObject,this.compiledPropertyChain.slice(-1)[0],this.propertyChain.slice(-1)[0])},set:function(value){return value&&value.TwineScript_AssignValue&&(value=value.TwineScript_AssignValue()),mutateRight.call(this,function(value,_ref12,i){var _ref13=_slicedToArray(_ref12,2),object=_ref13[0],property=_ref13[1],error=void 0;if(error=TwineError.containsError(value,object,property)||TwineError.containsError(isObject(object)&&canSet(object,property)))return error;if(HookSet.isPrototypeOf(object)&&"string"!=typeof value)return TwineError.create("datatype","You can only set hook references to strings, not "+objectName(value)+".");if("string"==typeof object){var _ret3=function(){if("string"!=typeof value||value.length!==(Array.isArray(property)?property.length:1))return{v:TwineError.create("datatype","I can't put this non-string value, "+objectName(value)+", in a string.")};object=[].concat(_toConsumableArray(object));var valArray=[].concat(_toConsumableArray(value));[].concat(property).forEach(function(index){0>0+index&&(index=object.length+(0+index)),object=[].concat(_toConsumableArray(object.slice(0,index)),[valArray.shift()],_toConsumableArray(object.slice(index+1)))}),object=object.join("")}();if("object"===("undefined"==typeof _ret3?"undefined":_typeof(_ret3)))return _ret3.v}else isObject(object)&&(Array.isArray(property)&&isSequential(value)?("string"==typeof value&&(value=[].concat(_toConsumableArray(value))),property.map(function(prop,i){return[prop,value[i]]}).forEach(function(_ref14){var _ref15=_slicedToArray(_ref14,2),e=_ref15[0],value=_ref15[1];return objectOrMapSet(object,e,value)})):objectOrMapSet(object,property,value));return i>0&&(object=clone(object)),object},value)},"delete":function(){return mutateRight.call(this,function(value,_ref16,i){var _ref17=_slicedToArray(_ref16,2),object=_ref17[0],property=_ref17[1],error=void 0;return(error=TwineError.containsError(value,object,property)||TwineError.containsError(isObject(object)&&canSet(object,property)))?error:(i>0&&(object=clone(object)),null===value?isObject(object)&&(Array.isArray(property)?property.forEach(function(prop){return objectOrMapDelete(object,prop)}):objectOrMapDelete(object,property)):objectOrMapSet(object,property,value),object)},null)},create:function(object,propertyChain){var error=void 0;if(error=TwineError.containsError(object))return wrapError(error);propertyChain=[].concat(propertyChain),VarRefProto.isPrototypeOf(object)&&(propertyChain=object.propertyChain.concat(propertyChain),object=object.object);var _compilePropertyChain=compilePropertyChain(object,propertyChain),compiledPropertyChain=_compilePropertyChain.compiledPropertyChain,deepestObject=_compilePropertyChain.deepestObject;return(error=TwineError.containsError(compiledPropertyChain,deepestObject))?wrapError(error):Object.assign(Object.create(VarRefProto),{object:object,propertyChain:propertyChain,compiledPropertyChain:compiledPropertyChain,deepestObject:deepestObject})},get TwineScript_ObjectName(){return(this.object===State.variables?"$":objectName(this.object)+"'s ")+this.propertyChain.reduce(function(a,e){return a+"'s "+propertyDebugName(e)})}});return VarRefProto}),define("internaltypes/assignmentrequest",["utils"],function(_ref18){var assert=_ref18.assert,assignmentRequest=Object.freeze({assignmentRequest:!0,TwineScript_TypeName:"an assignment operation",TwineScript_ObjectName:"an assignment operation",TwineScript_Unobservable:!0,create:function(dest,src,operator){return assert("propertyChain"in dest&&"object"in dest),Object.assign(Object.create(this),{dest:dest,src:src,operator:operator})}});return assignmentRequest}),define("twinescript/operations",["state","datatypes/colour","internaltypes/assignmentrequest","utils/operationutils","internaltypes/twineerror"],function(State,Colour,AssignmentRequest,_ref19,TwineError){function onlyPrimitives(type,fn,operationVerb,message){return operationVerb=operationVerb||"do this to",function(left,right){1===fn.length&&(right=left);var error=void 0;return(error=TwineError.containsError(left,right))?error:("undefined"==typeof left?"undefined":_typeof(left))!==type||("undefined"==typeof right?"undefined":_typeof(right))!==type?TwineError.create("operation","I can only "+operationVerb+" "+type+"s, not "+objectName(("undefined"==typeof left?"undefined":_typeof(left))!==type?left:right)+".",message):fn(left,right)}}function doNotCoerce(fn){return function(left,right){var error=void 0;return(error=TwineError.containsError(left,right))?error:left&&left.varref?TwineError.create("operation","I can't give an expression a new value."):("undefined"==typeof left?"undefined":_typeof(left))!==("undefined"==typeof right?"undefined":_typeof(right))||collectionType(left)!==collectionType(right)?coerceToString(fn,left,right)||TwineError.create("operation",objectName(left)+" isn't the same type of data as "+objectName(right)):fn(left,right)}}function comparisonOp(fn){return function(left,right){return It=left,fn(left,right)}}var isObject=_ref19.isObject,collectionType=_ref19.collectionType,coerceToString=_ref19.coerceToString,is=_ref19.is,contains=_ref19.contains,objectName=_ref19.objectName,Operations=void 0,It=0,andOrNotMessage="If one of these values is a number, you may want to write a check that it 'is not 0'. Also, if one is a string, you may want to write a check that it 'is not \"\" '.";return Operations={create:function(section){var ret=Object.create(this);return ret.Identifiers={get it(){return It},get time(){return Date.now()-section.timestamp}},ret},and:onlyPrimitives("boolean",doNotCoerce(function(l,r){return l&&r}),"use 'and' to join",andOrNotMessage),or:onlyPrimitives("boolean",doNotCoerce(function(l,r){return l||r}),"use 'or' to join",andOrNotMessage),not:onlyPrimitives("boolean",function(e){return!e},"use 'not' to invert",andOrNotMessage),"+":doNotCoerce(function(l,r){if(Array.isArray(l))return[].concat(_toConsumableArray(l),_toConsumableArray(r));var ret=void 0;return l instanceof Map?(ret=new Map(l),r.forEach(function(v,k){return ret.set(k,v)}),ret):l instanceof Set?(ret=new Set(l),r.forEach(function(v){return ret.add(v)}),ret):"function"==typeof l["TwineScript_+"]?l["TwineScript_+"](r):"string|number|boolean".includes("undefined"==typeof l?"undefined":_typeof(l))?l+r:TwineError.create("operation","I can't use + on "+objectName(l)+".")}),"-":doNotCoerce(function(l,r){if(Array.isArray(l))return l.filter(function(e){return-1===r.indexOf(e)});var ret=void 0;return l instanceof Set?(ret=new Set(l),r.forEach(function(v){return ret["delete"](v)}),ret):"string"==typeof l?l.split(r).join(""):l-r}),"*":onlyPrimitives("number",doNotCoerce(function(l,r){return l*r}),"multiply"),"/":onlyPrimitives("number",doNotCoerce(function(l,r){return 0===r?TwineError.create("operation","I can't divide "+objectName(l)+" by zero."):l/r}),"divide"),"%":onlyPrimitives("number",doNotCoerce(function(l,r){return 0===r?TwineError.create("operation","I can't modulo "+objectName(l)+" by zero."):l%r}),"modulus"),"<":comparisonOp(onlyPrimitives("number",doNotCoerce(function(l,r){return r>l}),"do < to")),">":comparisonOp(onlyPrimitives("number",doNotCoerce(function(l,r){return l>r}),"do > to")),"<=":comparisonOp(onlyPrimitives("number",doNotCoerce(function(l,r){return r>=l}),"do <= to")),">=":comparisonOp(onlyPrimitives("number",doNotCoerce(function(l,r){return l>=r}),"do >= to")),is:comparisonOp(is),isNot:comparisonOp(function(l,r){return!Operations.is(l,r)}),contains:comparisonOp(contains),isIn:comparisonOp(function(l,r){return contains(r,l)}),makeSpreader:function(val){return{value:val,spreader:!0}},makeAssignmentRequest:function(dest,src,operator){var error=TwineError.containsError(dest,src);return error?error:src&&src.TwineScript_Unobservable?TwineError.create("operation","That type of value can't be stored."):isObject(dest)&&"propertyChain"in dest?AssignmentRequest.create(dest,src,operator):TwineError.create("operation","I can't store a new value inside "+objectName(dest)+".")},setIt:function(e){return TwineError.containsError(e)?e:e.varref?(It=e.get(),e):TwineError.create("operation","I can't put a new value into "+objectName(e)+".")}},Object.freeze(Operations)}),define("twinescript/environ",["macros","state","utils","datatypes/colour","internaltypes/varref","internaltypes/twineerror","twinescript/operations"],function(Macros,State,Utils,Colour,VarRef,TwineError,OperationsProto){return function(section){"object"===("undefined"==typeof section?"undefined":_typeof(section))&&section||Utils.impossible("TwineScript.environ","no Section argument was given!");var Operations=OperationsProto.create(section);return section.eval=function(){try{return eval(Array.from(arguments).join(""))}catch(e){return Utils.log(e),Utils.log(Array.from(arguments).join("")),e}},section}}),define("internaltypes/pseudohookset",["jquery","utils/hookutils"],function($,_ref20){var wrapTextNodes=_ref20.wrapTextNodes,PseudoHookSet=Object.freeze({forEach:function(fn){var e=wrapTextNodes(this.selector,this.section.dom,"<tw-pseudo-hook>").parent();e.each(function(i){fn($(this),i)}),e.contents().unwrap().parent().each(function(){this.normalize()})},create:function(section,pseudoHookSelector){var ret=Object.create(this);return ret.section=section,ret.selector=pseudoHookSelector,ret}});return PseudoHookSet}),define("internaltypes/changedescriptor",["jquery","utils","renderer"],function($,_ref21,_ref22){var assertOnlyHas=_ref21.assertOnlyHas,impossible=_ref21.impossible,transitionIn=_ref21.transitionIn,exec=_ref22.exec,changeDescriptorShape=void 0,ChangeDescriptor={source:"",enabled:!0,target:null,append:"append",transition:"instant",transitionTime:0,styles:null,attr:null,data:null,section:null,create:function(properties,changer){var ret=Object.assign(Object.create(this),{attr:[].concat(this.attr||[]),styles:[].concat(this.styles||[])},properties);return changer&&changer.run(ret),ret},update:function(){var _this2=this,target=this.target;Array.isArray(this.styles)&&setTimeout(function(){var _Object;return target.css((_Object=Object).assign.apply(_Object,_toConsumableArray([{}].concat(_this2.styles))))}),this.attr&&this.attr.forEach(function(e){return target.attr(e)}),this.data&&target.data(this.data)},render:function(){var target=this.target,source=this.source,transition=this.transition,enabled=this.enabled,append=this.append;if(assertOnlyHas(this,changeDescriptorShape),!target||!enabled)return $();if(!(append in target)){if("replace"!==append)return void impossible("Section.render","The target jQuery doesn't have a '"+append+"' method.");target.empty(),append="append"}var dom=$(source&&$.parseHTML(exec(source),document,!0));return target[append](dom.length?dom:void 0),this.update(),transition&&transitionIn("replace"===append?target:dom,transition),dom}};return changeDescriptorShape=Object.keys(ChangeDescriptor),Object.seal(ChangeDescriptor)}),define("internaltypes/twinenotifier",["jquery","utils"],function($,_ref23){var impossible=_ref23.impossible,TwineNotifier={create:function(message){return message||impossible("TwineNotifier.create","called with only 1 string."),Object.assign(Object.create(TwineNotifier),{message:message})},render:function(){return $("<tw-notifier>").attr("message",this.message)}};return TwineNotifier}),define("section",["jquery","utils","utils/selectors","renderer","twinescript/environ","state","utils/hookutils","datatypes/hookset","internaltypes/pseudohookset","internaltypes/changedescriptor","internaltypes/twineerror","internaltypes/twinenotifier"],function($,Utils,Selectors,Renderer,Environ,State,HookUtils,HookSet,PseudoHookSet,ChangeDescriptor,TwineError,TwineNotifier){function applyExpressionToHook(expr,result){var nextHook=expr.next(Selectors.hook);if(result&&result.changer)if(nextHook.length){var enabled=this.renderInto(nextHook.popAttr("source"),nextHook,result);if(!enabled)return expr.addClass("false"),void("elseif"!==Utils.insensitiveName(expr.attr("name"))&&(this.stack[0].lastHookShown=!1))}else expr.replaceWith(TwineError.create("changer","The ("+result.macroName+":) command should be assigned to a variable or attached to a hook.","Macros like this should usually be touching the left side of a hook: "+expr.attr("title")+"[Some text]").render(expr.attr("title")));else if(result&&result.live)runLiveHook.call(this,nextHook,result.delay,result.event);else if((result===!1||null===result||void 0===result)&&(nextHook.removeAttr("source"),expr.addClass("false"),nextHook.length))return void(this.stack[0].lastHookShown=!1);nextHook.length&&(this.stack[0].lastHookShown=!0)}function runExpression(expr){var result=this.eval(expr.popAttr("js")||"");if(TwineError.containsError(result))result instanceof Error&&(result=TwineError.fromError(result)),expr.replaceWith(result.render(expr.attr("title"),expr));else if(TwineNotifier.isPrototypeOf(result))expr.append(result.render());else if(result&&result.TwineScript_Print&&!result.changer){if(result=result.TwineScript_Print(),result.earlyExit)return!1;result instanceof $?expr.append(result):TwineError.containsError(result)?(result instanceof Error&&(result=TwineError.fromError(result)),expr.replaceWith(result.render(expr.attr("title"),expr))):this.renderInto(result,expr)}else"string"==typeof result||"number"==typeof result||"object"===("undefined"==typeof result?"undefined":_typeof(result))&&result&&result.toString!==Object.prototype.toString?this.renderInto(result+"",expr):applyExpressionToHook.call(this,expr,result)}function collapse(elem){function noVerbatim(e){return 0===$(this||e).parentsUntil("tw-collapsed").filter("tw-verbatim, tw-expression, [collapsing=false]").length}var beforeNode=elem.prevTextNode();$(beforeNode).parents("tw-collapsed").length||(beforeNode=null);var afterNode=elem.nextTextNode();$(afterNode).parents("tw-collapsed").length||(afterNode=null),Utils.findAndFilter(elem,"br:not([data-raw])").filter(noVerbatim).replaceWith(document.createTextNode(" "));var nodes=elem.textNodes(),finalSpaces=0;nodes.reduce(function(prevNode,node){return noVerbatim(node)?(node.textContent=node.textContent.replace(/\s+/g," ")," "!==node.textContent[0]||prevNode&&prevNode.textContent&&!(prevNode.textContent.search(/\s$/)>-1)||(node.textContent=node.textContent.slice(1)),node):document.createTextNode("A")},beforeNode),[].concat(_toConsumableArray(nodes)).reverse().every(function(node){return noVerbatim(node)?node.textContent.match(/^\s*$/)?(finalSpaces+=node.textContent.length,node.textContent="",!0):(node.textContent=node.textContent.replace(/\s+$/,function(substr){return finalSpaces+=substr.length,""}),!1):!1}),finalSpaces>0&&afterNode&&(nodes[nodes.length-1].textContent+=" "),elem[0]&&supportsNormalize()&&elem[0].normalize()}function runLiveHook(target,delay){var _this3=this,source=target.popAttr("source")||"";delay=void 0===delay?20:delay;var recursive=function recursive(){_this3.inDOM()&&(_this3.renderInto(source,target,{append:"replace"}),target.find(Selectors.expression+"[name='stop']").length||_this3.inDOM()&&setTimeout(recursive,delay))};setTimeout(recursive,delay)}var Section=void 0,supportsNormalize=function(){var result=void 0;return function(){if(void 0!==result)return result;var p=$("<p>");return p[0].normalize?(p.append(document.createTextNode("0-"),document.createTextNode("2"),document.createTextNode(""))[0].normalize(),result=1===p.contents().length):result=!1}}();return Section={create:function(dom){Utils.assert(dom instanceof $&&1===dom.length);var ret=Object.assign(Object.create(this),{timestamp:Date.now(),dom:dom||Utils.storyElement,stack:[],enchantments:[]});return ret=Environ(ret)},inDOM:function(){return $(Utils.storyElement).find(this.dom).length>0},$:function(str){return Utils.$(str,this.dom)},evaluateTwineMarkup:function(expr){var p=$("<p>");this.renderInto(expr,p);var errors=void 0;return(errors=p.find("tw-error")).length>0?errors:p.text()},selectHook:function(selectorString){if(HookSet.isPrototypeOf(selectorString)||PseudoHookSet.isPrototypeOf(selectorString))return selectorString;switch(HookUtils.selectorType(selectorString)){case"hookRef":return HookSet.create(this,selectorString);case"html":return Utils.findAndFilter(this.dom.add(Utils.storyElement),selectorString.slice(1,-1));case"string":return PseudoHookSet.create(this,selectorString)}return null},renderInto:function(source,target,changers){var desc=ChangeDescriptor.create({target:target,source:source});if(desc.section=this,changers&&[].concat(changers).forEach(function(changer){changer&&changer.changer?changer.run(desc):Object.assign(desc,changer)}),"string"==typeof desc.target&&(desc.target=this.selectHook(desc.target)),!desc.target)return Utils.impossible("Section.renderInto","ChangeDescriptor has source but not a target!"),!1;var dom=$();this.stack.length>=50?dom=TwineError.create("infinite","Printing this expression may have trapped me in an infinite loop.").render(target.attr("title")).replaceAll(target):desc.target instanceof $?dom=desc.render():desc.target.forEach(function(e){dom=dom.add(desc.create({target:e}).render())}),this.stack.unshift(Object.create(null));var section=this;return Utils.findAndFilter(dom,Selectors.hook+","+Selectors.expression).each(function(){
var expr=$(this);switch(expr.tag()){case Selectors.hook:expr.attr("source")&&(section.renderInto(expr.attr("source"),expr),expr.removeAttr("source"));break;case Selectors.expression:return runExpression.call(section,expr)}}),dom.length&&target instanceof $&&target.is(Selectors.hook)&&target.parents("tw-collapsed").length>0&&collapse(dom),Utils.findAndFilter(dom,Selectors.collapsed).each(function(){collapse($(this))}),this.stack.shift(),0===this.stack.length&&this.updateEnchantments(),desc.enabled},updateEnchantments:function(){this.enchantments.forEach(function(e){e.disenchant(),e.enchantScope()})}},Object.preventExtensions(Section)}),define("engine",["jquery","utils","utils/selectors","state","section","passages"],function($,Utils,Selectors,State,Section,Passages){function createPassageElement(){var container=$("<tw-passage><tw-sidebar>"),sidebar=container.children(Selectors.sidebar);options.permalink&&State.save&&sidebar.append('<tw-icon tabindex=0 class="permalink" title="Permanent link to this passage"><a href="#'+State.save()+'">&sect;');var back=$('<tw-icon tabindex=0 class="undo" title="Undo">&#8630;</tw-icon>').click(Engine.goBack),fwd=$('<tw-icon tabindex=0 class="redo" title="Redo">&#8631;</tw-icon>').click(Engine.goForward);return State.pastLength<=0&&back.css("visibility","hidden"),State.futureLength<=0&&fwd.css("visibility","hidden"),sidebar.append(back).append(fwd),container}function setupPassageElement(tagType,setupPassage){return"<tw-include type="+tagType+" title='"+escape(setupPassage.get("name"))+"'>"+setupPassage.get("source")+"</tw-include>"}function showPassage(name,stretch){var t8n="instant",passageData=Passages.get(name),story=Utils.storyElement,parent=story.parent();parent.is(Selectors.enchantment)&&(parent=story.unwrap().parent()),passageData&&passageData instanceof Map&&passageData.has("source")||impossible("Engine.showPassage","There's no passage with the name \""+name+'"!'),story.detach();var oldPassages=Utils.$(story.children(passageSelector));!stretch&&t8n&&transitionOut(oldPassages,t8n);var newPassage=createPassageElement().appendTo(story);assert(newPassage.length>0);var section=Section.create(newPassage),source=passageData.get("source");source=(options.debug?Passages.getTagged("debug-header").map(setupPassageElement.bind(0,"debug-header")).join(""):"")+Passages.getTagged("header").map(setupPassageElement.bind(0,"header")).join("")+source+Passages.getTagged("footer").map(setupPassageElement.bind(0,"footer")).join("")+(options.debug?Passages.getTagged("debug-footer").map(setupPassageElement.bind(0,"debug-footer")).join(""):""),State.pastLength<=0&&(options.debug&&(source=Passages.getTagged("debug-startup").map(setupPassageElement.bind(0,"debug-startup")).join("")+source),source=Passages.getTagged("startup").map(setupPassageElement.bind(0,"startup")).join("")+source),section.renderInto(source,newPassage,[{transition:"dissolve"}]),$("html").append(story.parent().length?story.parent():story),scroll(0,stretch?newPassage.offset().top-.05*$(window).height():parent.offset().top)}var escape=Utils.escape,impossible=Utils.impossible,passageSelector=Utils.passageSelector,transitionOut=Utils.transitionOut,assert=Utils.assert,Engine=void 0,options=Object.create(null);return Engine={goBack:function(){State.rewind()&&showPassage(State.passage)},goForward:function(){State.fastForward()&&showPassage(State.passage)},goToPassage:function(id,stretch){State.play(id),showPassage(id,stretch)},showPassage:showPassage,options:options},Object.freeze(Engine)}),define("macrolib/values",["macros","utils/operationutils","internaltypes/twineerror"],function(Macros,_ref24,TwineError){function mathFilter(fn){return function(args){var result=fn.apply(void 0,_toConsumableArray(args));return"number"!=typeof result||isNaN(result)?TwineError.create("macrocall","This mathematical expression doesn't compute!"):result}}function either(){return arguments.length<=~~(Math.random()*arguments.length)+0?void 0:arguments[~~(Math.random()*arguments.length)+0]}var subset=_ref24.subset,objectName=_ref24.objectName,_Macros$TypeSignature=Macros.TypeSignature,rest=_Macros$TypeSignature.rest,zeroOrMore=_Macros$TypeSignature.zeroOrMore,Any=_Macros$TypeSignature.Any;Macros.add(["text","string"],function(){for(var _len8=arguments.length,args=Array(_len8>1?_len8-1:0),_key8=1;_len8>_key8;_key8++)args[_key8-1]=arguments[_key8];return args.join("")},[zeroOrMore(Macros.TypeSignature.either(String,Number,Boolean,Array))])("substring",function(_,string,a,b){return subset(string,a,b)},[String,Number,Number])(["num","number"],function(_,expr){return Number.isNaN(+expr)?TwineError.create("macrocall","I couldn't convert "+objectName(expr)+" to a number."):+expr},[String]),{weekday:[function(){return["Sun","Mon","Tues","Wednes","Thurs","Fri","Satur"][(new Date).getDay()]+"day"},null],monthday:[function(){return(new Date).getDate()},null],currenttime:[function(){var d=new Date,am=d.getHours()<12;return d.getHours()%12+":"+d.getMinutes()+" "+(am?"A":"P")+"M"},null],currentdate:[function(){return(new Date).toDateString()},null],min:[Math.min,rest(Number)],max:[Math.max,rest(Number)],abs:[Math.abs,Number],sign:[Math.sign,Number],sin:[Math.sin,Number],cos:[Math.cos,Number],tan:[Math.tan,Number],floor:[Math.floor,Number],round:[Math.round,Number],ceil:[Math.ceil,Number],pow:[Math.pow,Number],exp:[Math.exp,Number],sqrt:[mathFilter(Math.sqrt),Number],log:[mathFilter(Math.log),Number],log10:[mathFilter(Math.log10),Number],log2:[mathFilter(Math.log2),Number],random:[function(a,b){if(a!==(0|a)||b!==(0|b))return TwineError.create("macrocall","(random:) only accepts whole numbers, not "+objectName(a!==(0|a)?a:b));var from=void 0,to=void 0;return b?(from=Math.min(a,b),to=Math.max(a,b)):(from=0,to=a),to+=1,~~(Math.random()*(to-from))+from},[Number,Macros.TypeSignature.optional(Number)]],either:[either,rest(Any)],alert:[function(text){return window.alert(text||"")},String],prompt:[function(text,value){return window.prompt(text||"",value||"")||""},String,String],confirm:[function(text){return window.confirm(text||"")},String],openURL:[window.open,String],reload:[window.location.reload.bind(window.location),null],gotoURL:[window.location.assign.bind(window.location),String],pageURL:[function(){return window.location.href},null],"":function(){var _this4=this;Object.keys(this).forEach(function(key){key&&!function(){var fn=_this4[key][0],typeSignature=_this4[key][1];Macros.add(key,function(){for(var _len9=arguments.length,rest=Array(_len9>1?_len9-1:0),_key9=1;_len9>_key9;_key9++)rest[_key9-1]=arguments[_key9];return fn.apply(void 0,rest)},typeSignature)}()})}}[""]()}),function(global){!function(){if(!global.requestAnimationFrame){global.webkitRequestAnimationFrame&&(global.requestAnimationFrame=global.webkitRequestAnimationFrame,global.cancelAnimationFrame=global.webkitCancelAnimationFrame||global.webkitCancelRequestAnimationFrame);var lastTime=0;global.requestAnimationFrame=function(callback){var currTime=(new Date).getTime(),timeToCall=Math.max(0,16-(currTime-lastTime)),id=global.setTimeout(function(){callback(currTime+timeToCall)},timeToCall);return lastTime=currTime+timeToCall,id},global.cancelAnimationFrame=function(id){clearTimeout(id)}}}(),"function"==typeof define&&define("requestAnimationFrame",[],function(){return global.requestAnimationFrame})}(window),define("macrolib/commands",["requestAnimationFrame","macros","utils","state","passages","engine","internaltypes/twineerror","utils/operationutils"],function(requestAnimationFrame,Macros,_ref25,State,Passages,Engine,TwineError,_ref26){function storagePrefix(text){return"("+text+" "+Engine.options.ifid+") "}var toJSLiteral=_ref25.toJSLiteral,unescape=_ref25.unescape,isObject=_ref26.isObject,_Macros$TypeSignature2=Macros.TypeSignature,Any=_Macros$TypeSignature2.Any,optional=_Macros$TypeSignature2.optional,hasStorage=!!localStorage&&function(){try{return localStorage.setItem("test","1"),localStorage.removeItem("test"),!0}catch(e){return!1}}();Macros.add("display",function(_,name){return{TwineScript_ObjectName:"a (display: "+toJSLiteral(name)+") command",TwineScript_TypeName:"a (display:) command",TwineScript_Print:function(){return Passages.has(name)?unescape(Passages.get(name).get("source")):TwineError.create("macrocall","I can't (display:) the passage '"+name+"' because it doesn't exist.")}}},[String])("print",function print(_,expr){if(TwineError.containsError(expr))return expr;if(expr&&"function"==typeof expr.TwineScript_Print)expr=expr.TwineScript_Print();else if(expr instanceof Map){if(expr=Array.from(expr.entries()),TwineError.containsError(expr))return expr;expr=expr.reduce(function(html,pair){return html+"<tr><td>"+print(_,pair[0]).TwineScript_Print()+"</td><td>"+print(_,pair[1]).TwineScript_Print()+"</td></tr>"},"<table class=datamap>")+"</table>"}else if(expr instanceof Set)expr=Array.from(expr.values());else if(Array.isArray(expr))expr+="";else{if(isObject(expr))throw new TypeError("I don't know how to print this value yet.");expr+=""}return{TwineScript_ObjectName:"a (print: "+toJSLiteral(expr)+") command",TwineScript_TypeName:"a (print:) command",TwineScript_Print:function(){return expr}}},[Any])("goto",function(_,name){return{TwineScript_ObjectName:"a (go-to: "+toJSLiteral(name)+") command",TwineScript_TypeName:"a (go-to:) command",TwineScript_Print:function(){return Passages.has(name)?(requestAnimationFrame(Engine.goToPassage.bind(Engine,name,!1)),{earlyExit:1}):TwineError.create("macrocall","I can't (go-to:) the passage '"+name+"' because it doesn't exist.")}}},[String])("live",function(_,delay){return{TwineScript_ObjectName:"a (live: "+delay+") command",TwineScript_TypeName:"a (live:) command",live:!0,delay:delay}},[optional(Number)])("stop",function(){return{TwineScript_ObjectName:"a (stop:) command",TwineScript_TypeName:"a (stop:) command",TwineScript_Print:function(){return""}}},[])("savegame",function(_,slotName,fileName){if(fileName=fileName||"",!hasStorage)return!1;var serialisation=State.serialise();if(!serialisation)return TwineError.create("saving","The game's variables contain a complex data structure; the game can no longer be saved.");try{return localStorage.setItem(storagePrefix("Saved Game")+slotName,serialisation),localStorage.setItem(storagePrefix("Saved Game Filename")+slotName,fileName),!0}catch(e){return!1}},[String,optional(String)])("loadgame",function(_,slotName){return{TwineScript_ObjectName:"a (load-game:) command",TwineScript_TypeName:"a (load-game:) command",TwineScript_Print:function(){var saveData=localStorage.getItem(storagePrefix("Saved Game")+slotName);return saveData?(State.deserialise(saveData),requestAnimationFrame(Engine.showPassage.bind(Engine,State.passage,!1)),{earlyExit:1}):TwineError.create("saving","I can't find a save slot named '"+slotName+"'!")}}},[String])}),define("macrolib/datastructures",["jquery","utils/naturalsort","macros","utils/operationutils","state","engine","passages","internaltypes/assignmentrequest","internaltypes/twineerror","internaltypes/twinenotifier"],function($,NaturalSort,Macros,_ref27,State,Engine,Passages,AssignmentRequest,TwineError,TwineNotifier){var objectName=_ref27.objectName,subset=_ref27.subset,collectionType=_ref27.collectionType,isValidDatamapName=_ref27.isValidDatamapName,_Macros$TypeSignature3=Macros.TypeSignature,optional=_Macros$TypeSignature3.optional,rest=_Macros$TypeSignature3.rest,zeroOrMore=_Macros$TypeSignature3.zeroOrMore,Any=_Macros$TypeSignature3.Any;Macros.add("set",function(){for(var debugMessage="",i=0;i<arguments.length-1;i+=1){var ar=arguments.length<=i+1?void 0:arguments[i+1];if("into"===ar.operator)return TwineError.create("macrocall","Please say 'to' when using the (set:) macro.");var result=ar.dest.set(ar.src);if(TwineError.isPrototypeOf(result))return result;Engine.options.debug&&(debugMessage+=(debugMessage?"; ":"")+objectName(ar.dest)+" is now "+objectName(ar.src))}return{TwineScript_TypeName:"a (set:) operation",TwineScript_ObjectName:"a (set:) operation",TwineScript_Unobservable:!0,TwineScript_Print:function(){return debugMessage&&TwineNotifier.create(debugMessage).render()}}},[rest(AssignmentRequest)])("put",function(){for(var debugMessage="",i=0;i<arguments.length-1;i+=1){var ar=arguments.length<=i+1?void 0:arguments[i+1];if("into"!==ar.operator)return TwineError.create("macrocall","Please say 'into' when using the (put:) macro.");var result=ar.dest.set(ar.src);if(TwineError.isPrototypeOf(result))return result;Engine.options.debug&&(debugMessage+=(debugMessage?"; ":"")+objectName(ar.dest)+" is now "+objectName(ar.src))}return{TwineScript_TypeName:"a (put:) operation",TwineScript_ObjectName:"a (put:) operation",TwineScript_Unobservable:!0,TwineScript_Print:function(){return debugMessage&&TwineNotifier.create(debugMessage).render()}}},[rest(AssignmentRequest)])("move",function(_,ar){if("into"!==ar.operator)return TwineError.create("macrocall","Please say 'into' when using the (move:) macro.");if(ar.src&&ar.src.varref){var get=ar.src.get(),error=void 0;if(error=TwineError.containsError(get))return error;ar.dest.set(get),ar.src["delete"]()}else ar.dest.set(ar.src),ar.src.TwineScript_DeleteValue&&ar.src.TwineScript_DeleteValue();return{TwineScript_TypeName:"a (move:) operation",TwineScript_ObjectName:"a (move:) operation",TwineScript_Unobservable:!0,TwineScript_Print:""}},[rest(AssignmentRequest)])(["a","array"],function(){for(var _len10=arguments.length,args=Array(_len10>1?_len10-1:0),_key10=1;_len10>_key10;_key10++)args[_key10-1]=arguments[_key10];return args},zeroOrMore(Any))("range",function range(_,a,b){if(a>b)return range(_,b,a);var ret=[a];for(b-=a;b-->0;)ret.push(++a);return ret},[Number,Number])("subarray",function(_,array,a,b){return subset(array,a,b)},[Array,Number,Number])("shuffled",function(){for(var _len11=arguments.length,args=Array(_len11>1?_len11-1:0),_key11=1;_len11>_key11;_key11++)args[_key11-1]=arguments[_key11];return args.reduce(function(a,e,ind){var j=Math.random()*(ind+1)|0;return j===ind?a.push(e):(a.push(a[j]),a[j]=e),a},[])},[Any,rest(Any)])("sorted",function(){for(var _len12=arguments.length,args=Array(_len12>1?_len12-1:0),_key12=1;_len12>_key12;_key12++)args[_key12-1]=arguments[_key12];return args.sort(NaturalSort("en"))},[String,rest(String)])("rotated",function(_,number){for(var _len13=arguments.length,array=Array(_len13>2?_len13-2:0),_key13=2;_len13>_key13;_key13++)array[_key13-2]=arguments[_key13];return number*=-1,0===number?TwineError.create("macrocall","I can't rotate these values by 0 positions."):Math.abs(number)>=array.length?TwineError.create("macrocall","I can't rotate these "+array.length+" values by "+number+" positions."):array.slice(number).concat(array.slice(0,number))},[Any,Any,rest(Any)])("datanames",function(_,map){return Array.from(map.keys()).sort(NaturalSort("en"))},[Map])("datavalues",function(_,map){return Array.from(map.entries()).sort(function(a,b){return[a[0],b[0]].sort(NaturalSort("en"))[0]===a[0]?-1:1}).map(function(e){return e[1]})},[Map])("history",function(){return State.pastPassageNames()},[])("passage",function(_,passageName){return Passages.get(passageName||State.passage)||TwineError.create("macrocall","There's no passage named '"+passageName+"' in this story.")},[optional(String)])("savedgames",function(){function storagePrefix(text){return"("+text+" "+Engine.options.ifid+") "}var i=0,key=void 0,savesMap=new Map;do{key=localStorage.key(i),i+=1;var prefix=storagePrefix("Saved Game");key&&key.startsWith(prefix)&&(key=key.slice(prefix.length),savesMap.set(key,localStorage.getItem(storagePrefix("Saved Game Filename")+key)))}while(key);return savesMap},[])("datamap",function(){for(var _len14=arguments.length,args=Array(_len14>1?_len14-1:0),_key14=1;_len14>_key14;_key14++)args[_key14-1]=arguments[_key14];var key=void 0,map=new Map,status=args.reduce(function(status,element){var error=void 0;if(TwineError.containsError(status))return status;if(void 0===key)key=element;else{if(error=TwineError.containsError(isValidDatamapName(map,key)))return error;if(map.has(key))return TwineError.create("macrocall","You used the same data name ("+objectName(key)+") twice in the same (datamap:) call.");map.set(key,element),key=void 0}return status},!0);return TwineError.containsError(status)?status:void 0!==key?TwineError.create("macrocall","This datamap has a data name without a value."):map},zeroOrMore(Any))("dataset",function(){for(var _len15=arguments.length,args=Array(_len15>1?_len15-1:0),_key15=1;_len15>_key15;_key15++)args[_key15-1]=arguments[_key15];return new Set(args)},zeroOrMore(Any))("count",function(_,collection,value){switch(collectionType(collection)){case"dataset":case"datamap":return+collection.has(name);case"string":return"string"!=typeof value?new TypeError(objectName(collection)+" can't contain  "+objectName(value)+" because it isn't a string."):collection.split(value).length-1;case"array":return collection.reduce(function(count,e){return count+(e===value)},0)}},[Any,Any])}),define("datatypes/changercommand",["utils","macros","utils/operationutils"],function(_ref28,Macros,_ref29){var assert=_ref28.assert,is=_ref29.is,ChangerCommand={changer:!0,TwineScript_TypeName:"a changer command",TwineScript_Print:function(){return"[A '"+this.macroName+"' command]"},create:function(macroName,params,next){return assert(void 0===params||Array.isArray(params)),Object.assign(Object.create(this),{macroName:macroName,params:params,next:next||null,TwineScript_ObjectName:"a ("+macroName+":) command"})},"TwineScript_+":function(other){for(var ret=this.TwineScript_Clone();ret.next;)ret=ret.next;return ret.next=other,ret},TwineScript_is:function(other){return ChangerCommand.isPrototypeOf(other)?this.macroName===other.macroName&&is(this.params,other.params)&&is(this.next,other.next):void 0},TwineScript_Clone:function(){return this.create(this.macroName,this.params,this.next)},run:function(desc){Macros.getChangerFn(this.macroName).apply(void 0,[desc].concat(_toConsumableArray(this.params))),this.next&&this.next.run(desc)}};return Object.freeze(ChangerCommand)}),define("macrolib/stylechangers",["jquery","macros","utils","utils/selectors","datatypes/colour","datatypes/changercommand","internaltypes/twineerror"],function($,Macros,_ref30,Selectors,Colour,ChangerCommand,TwineError){var insensitiveName=_ref30.insensitiveName,assert=_ref30.assert,childrenProbablyInline=_ref30.childrenProbablyInline,_Macros$TypeSignature4=Macros.TypeSignature,either=_Macros$TypeSignature4.either,wrapped=_Macros$TypeSignature4.wrapped,IfTypeSignature=[wrapped(Boolean,'If you gave a number, you may instead want to check that the number is not 0. If you gave a string, you may instead want to check that the string is not "".')];Macros.addChanger("if",function(_,expr){return ChangerCommand.create("if",[expr])},function(d,expr){return d.enabled=d.enabled&&expr},IfTypeSignature)("unless",function(_,expr){return ChangerCommand.create("unless",[!expr])},function(d,expr){return d.enabled=d.enabled&&expr},IfTypeSignature)("elseif",function(section,expr){return"lastHookShown"in section.stack[0]?ChangerCommand.create("elseif",[section.stack[0].lastHookShown===!1&&!!expr]):TwineError.create("macrocall","There's no (if:) or something else before this to do (else-if:) with.")},function(d,expr){return d.enabled=d.enabled&&expr},IfTypeSignature)("else",function(section){return"lastHookShown"in section.stack[0]?ChangerCommand.create("else",[section.stack[0].lastHookShown===!1]):TwineError.create("macrocall","There's nothing before this to do (else:) with.")},function(d,expr){return d.enabled=d.enabled&&expr},null)(["hook"],function(_,name){return ChangerCommand.create("hook",[name])},function(d,name){return d.attr.push({name:name})},[String])(["transition","t8n"],function(_,name){var validT8ns=["dissolve","shudder","pulse"];return name=insensitiveName(name),-1===validT8ns.indexOf(name)?TwineError.create("macrocall","'"+name+'" is not a valid (transition:)',"Only the following names are recognised (capitalisation and hyphens ignored): "+validT8ns.join(", ")):ChangerCommand.create("transition",[name])},function(d,name){return d.transition=name,d},[String])("font",function(_,family){return ChangerCommand.create("font",[family])},function(d,family){return d.styles.push({"font-family":family}),d},[String])("align",function(_,arrow){var style=void 0,centerIndex=arrow.indexOf("><");if(!/^(==+>|<=+|=+><=+|<==+>)$/.test(arrow))return TwineError.create("macrocall",'The (align:) macro requires an alignment arrow ("==>", "<==", "==><=" etc.) be provided, not "'+arrow+'"');if(~centerIndex){var alignPercent=Math.round(centerIndex/(arrow.length-2)*50);style=Object.assign({"text-align":"center","max-width":"50%"},25===alignPercent?{"margin-left":"auto","margin-right":"auto"}:{"margin-left":alignPercent+"%"})}else style="<"===arrow[0]&&">"===arrow.slice(-1)?{"text-align":"justify","max-width":"50%"}:arrow.includes(">")?{"text-align":"right"}:{"text-align":"left"};return style.display="block",ChangerCommand.create("align",[style])},function(d,style){d.styles.push(style)},[String])(["text-colour","text-color","color","colour"],function(_,CSScolour){return CSScolour&&CSScolour.colour&&(CSScolour=CSScolour.toHexString(CSScolour)),ChangerCommand.create("text-colour",[CSScolour])},function(d,CSScolour){return d.styles.push({color:CSScolour}),d},[either(String,Colour)])("text-rotate",function(_,rotation){return ChangerCommand.create("text-rotate",[rotation])},function(d,rotation){return d.styles.push({display:"inline-block",transform:function(){var currentTransform=$(this).css("transform")||"";return"none"===currentTransform&&(currentTransform=""),currentTransform+" rotate("+rotation+"deg)"}}),d},[Number])("background",function(_,value){return value&&value.colour&&(value=value.toHexString(value)),ChangerCommand.create("background",[value])},function(d,value){var property=void 0;return property=Colour.isHexString(value)?{"background-color":value}:{"background-size":"cover","background-image":"url("+value+")"},d.styles.push(property,{display:function(){return childrenProbablyInline($(this))?"initial":"block"}}),d},[either(String,Colour)]).apply(void 0,_toConsumableArray(function(){var colourTransparent={color:"transparent"},styleTagNames=Object.assign(Object.create(null),{bold:{"font-weight":"bold"},italic:{"font-style":"italic"},underline:{"text-decoration":"underline"},strike:{"text-decoration":"line-through"},superscript:{"vertical-align":"super","font-size":".83em"},subscript:{"vertical-align":"sub","font-size":".83em"},blink:{animation:"fade-in-out 1s steps(1,end) infinite alternate"},shudder:{animation:"shudder linear 0.1s 0s infinite",display:"inline-block"},mark:{"background-color":"hsla(60, 100%, 50%, 0.6)"},condense:{"letter-spacing":"-0.08em"},expand:{"letter-spacing":"0.1em"},outline:[{"text-shadow":function(){var colour=$(this).css("color");return"-1px -1px 0 "+colour+", 1px -1px 0 "+colour+",-1px  1px 0 "+colour+", 1px  1px 0 "+colour}},{color:function(){return $(this).css("background-color")}}],shadow:{"text-shadow":function(){return"0.08em 0.08em 0.08em "+$(this).css("color")}},emboss:{"text-shadow":function(){return"0.08em 0.08em 0em "+$(this).css("color")}},smear:[{"text-shadow":function(){var colour=$(this).css("color");return"0em   0em 0.02em "+colour+",-0.2em 0em  0.5em "+colour+", 0.2em 0em  0.5em "+colour}},colourTransparent],blur:[{"text-shadow":function(){return"0em 0em 0.08em "+$(this).css("color")}},colourTransparent],blurrier:[{"text-shadow":function(){return"0em 0em 0.2em "+$(this).css("color")},"user-select":"none"},colourTransparent],mirror:{display:"inline-block",transform:"scaleX(-1)"},upsidedown:{display:"inline-block",transform:"scaleY(-1)"},fadeinout:{animation:"fade-in-out 2s ease-in-out infinite alternate"},rumble:{animation:"rumble linear 0.1s 0s infinite",display:"inline-block"}});return["text-style",function(_,styleName){return styleName=insensitiveName(styleName),styleName in styleTagNames?ChangerCommand.create("text-style",[styleName]):TwineError.create("macrocall","'"+styleName+'" is not a valid (textstyle:)',"Only the following names are recognised (capitalisation and hyphens ignored): "+Object.keys(styleTagNames).join(", "))},function(d,styleName){return assert(styleName in styleTagNames),d.styles=d.styles.concat(styleTagNames[styleName]),d}]}()).concat([[String]]))("css",function(_,text){return text.trim().endsWith(";")||(text+=";"),ChangerCommand.create("css",[text])},function(d,text){return d.attr.push({style:function(){return($(this).attr("style")||"")+text}}),d},[String])}),define("internaltypes/enchantment",["jquery","utils","internaltypes/changedescriptor"],function($,Utils,ChangeDescriptor){var Enchantment={create:function(descriptor){return Utils.assertOnlyHas(descriptor,["scope","attr","data","changer"]),Object.assign(Object.create(this),{enchantments:$()},descriptor)},enchantScope:function(){var _this5=this,attr=this.attr,data=this.data,changer=this.changer,scope=this.scope;scope instanceof $&&(scope=Array.prototype.map.call(scope,function(e){return $(e)})),this.enchantments=$(),scope.forEach(function(e){var wrapping=e.wrapAll("<tw-enchantment>").parent();if(attr&&wrapping.attr(attr),data&&wrapping.data(data),changer){var cd=ChangeDescriptor.create({target:wrapping});changer.run(cd),cd.update()}e.is("tw-story")&&wrapping.css({width:"100%",height:"100%"}),_this5.enchantments=_this5.enchantments.add(wrapping)})},disenchant:function(){this.enchantments.each(function(){$(this).contents().unwrap()})}};return Object.freeze(Enchantment)}),define("macrolib/enchantments",["jquery","utils","macros","datatypes/hookset","datatypes/changercommand","internaltypes/enchantment","internaltypes/twineerror"],function($,Utils,Macros,HookSet,ChangerCommand,Enchantment,TwineError){function newEnchantmentMacroFns(enchantDesc,name){return Utils.assert(enchantDesc),$(function(){Utils.storyElement.on(enchantDesc.event+".enchantment","."+enchantDesc.classList.replace(/ /g,"."),function(){var enchantment=$(this),event=enchantment.data("enchantmentEvent");event&&event(enchantment)})}),[function(_,selector){return selector.selector&&(selector=selector.selector),selector?ChangerCommand.create(name,[selector]):TwineError.create("datatype","The string given to this ("+name+":) macro was empty.")},function(desc,selector){desc.enabled=!1,enchantDesc.rerender&&(desc.target=selector,desc.append=enchantDesc.rerender);var enchantData=Enchantment.create({attr:Object.assign({"class":enchantDesc.classList},enchantDesc.classList.includes("link")?{tabIndex:"0"}:{}),data:{enchantmentEvent:function(){if(enchantDesc.once){var index=desc.section.enchantments.indexOf(enchantData);desc.section.enchantments.splice(index,1),enchantData.disenchant()}desc.section.renderInto(desc.source,null,Object.assign({},desc,{enabled:!0}))}},scope:desc.section.selectHook(selector)});return desc.section.enchantments.push(enchantData),enchantData.enchantScope(),desc},either(HookSet,String)]}var either=Macros.TypeSignature.either,revisionTypes=["replace","append","prepend"];revisionTypes.forEach(function(e){Macros.addChanger(e,function(_,scope){return scope?ChangerCommand.create(e,[scope]):TwineError.create("datatype","The string given to this ("+e+":) macro was empty.")},function(desc,scope){var collapsing=$(desc.target.context).parents().filter("tw-collapsed").length>0;return collapsing||(desc.attr=[].concat(_toConsumableArray(desc.attr),[{collapsing:!1}])),desc.target=scope,desc.append=e,desc},either(HookSet,String))});var interactionTypes=[{name:"click",enchantDesc:{event:"click",once:!0,rerender:"",classList:"link enchantment-link"}},{name:"mouseover",enchantDesc:{event:"mouseenter",once:!0,rerender:"",classList:"enchantment-mouseover"}},{name:"mouseout",enchantDesc:{event:"mouseleave",once:!0,rerender:"",classList:"enchantment-mouseout"}}];interactionTypes.forEach(function(e){return Macros.addChanger.apply(Macros,[e.name].concat(_toConsumableArray(newEnchantmentMacroFns(e.enchantDesc,e.name))))}),revisionTypes.forEach(function(revisionType){interactionTypes.forEach(function(interactionType){var enchantDesc=Object.assign({},interactionType.enchantDesc,{rerender:revisionType}),name=interactionType.name+"-"+revisionType;Macros.addChanger.apply(Macros,[name].concat(_toConsumableArray(newEnchantmentMacroFns(enchantDesc,name))))})})}),define("macrolib/links",["jquery","macros","utils","utils/selectors","state","passages","engine","datatypes/changercommand"],function($,Macros,Utils,Selectors,State,Passages,Engine,ChangerCommand){var optional=Macros.TypeSignature.optional;$(function(){return $(Utils.storyElement).on("click.passage-link",Selectors.internalLink,function(){var link=$(this),event=link.parent().data("clickEvent");if(event)return void event(link);var next=link.attr("passage-name");next&&Engine.goToPassage(next,!1)})}),[["link","link-replace"],["link-reveal"],["link-repeat"]].forEach(function(arr){return Macros.addChanger(arr,function(_,expr){return ChangerCommand.create(arr[0],[expr])},function(desc,text){var innerSource=desc.source;desc.source="<tw-link tabindex=0>"+text+"</tw-link>",desc.append="link"===arr[0]?"replace":"append",desc.data={clickEvent:function(link){desc.source=innerSource,desc.section.renderInto(innerSource+"",null,desc),"link-reveal"===arr[0]&&link.contents().unwrap()}}},[String])}),Macros.add(["link-goto"],function(section,text,passage){return{TwineScript_TypeName:"a (link-goto: "+Utils.toJSLiteral(text)+", "+Utils.toJSLiteral(passage)+") command",TwineScript_ObjectName:"a (link-goto:) command",TwineScript_Print:function(){var passageName=section.evaluateTwineMarkup(Utils.unescape(passage||text));if(passageName instanceof $)return passageName;if(!Passages.has(passageName))return'<tw-broken-link passage-name="'+Utils.escape(passageName)+'">'+(text||passage)+"</tw-broken-link>";var visited=State.passageNameVisited(passageName);return"<tw-link tabindex=0 "+(visited>0?'class="visited" ':"")+'passage-name="'+Utils.escape(passageName)+'">'+(text||passage)+"</tw-link>"}}},[String,optional(String)])}),define("macrolib",["utils","macrolib/values","macrolib/commands","macrolib/datastructures","macrolib/stylechangers","macrolib/enchantments","macrolib/links"],function(_ref31){var log=_ref31.log;log("Loaded the built-in macros.")}),define("repl",["utils","markup","twinescript/compiler","twinescript/environ"],function(Utils,TwineMarkup,Compiler,Environ){window.REPL=function(a){var r=Compiler(TwineMarkup.lex("(print:"+a+")"));return console.log(r),Environ({}).eval(r)},window.LEX=function(a){var r=TwineMarkup.lex(a);return 1===r.length?r[0]:r}}),require.config({paths:{jquery:"../node_modules/jquery/dist/jquery",almond:"../node_modules/almond/almond","es6-shim":"../node_modules/es6-shim/es6-shim",requestAnimationFrame:"../node_modules/requestanimationframe/app/requestAnimationFrame",jqueryplugins:"utils/jqueryplugins",markup:"./markup/markup",lexer:"./markup/lexer",patterns:"./markup/patterns"},deps:["jquery","es6-shim","jqueryplugins"]}),require(["jquery","renderer","state","engine","passages","utils/selectors","macrolib","repl"],function($,Renderer,State,Engine,Passages,Selectors){function _eval(text){return eval(text+"")}function testPlayCleanup(){["_","Backbone","Store","Mn","Marionette","saveAs","FastClick","JSZip","SVG","requestAnimFrame","UUID","XDate","CodeMirror","ui","nwui","AppPref","Passage","StoryFormat","Story","AppPrefCollection","PassageCollection","StoryCollection","StoryFormatCollection","WelcomeView","StoryItemView","StoryListView","PassageItemView","StoryEditView","TwineRouter","TransRegion","TwineApp","app","storyFormat"].forEach(function(name){try{delete window[name]}catch(e){window[name]=void 0}})}var _installHandlers=function(){var html=$(document.documentElement),debugHTML="<tw-debugger><button class='show-invisibles'>&#9903; Debug View</button></tw-debugger>";html.on("keydown",function(event){13===event.which&&"0"===event.target.getAttribute("tabindex")&&$(event.target).trigger("click");

}),Engine.options.debug&&($(document.body).append(debugHTML),$(".show-invisibles").click(function(){html.toggleClass("debug-mode").is(".debug-mode")})),_installHandlers=null};!function(oldOnError){window.onerror=function(message,_,__,___,error){var stack=error&&error.stack&&"\n"+error.stack.replace(/\([^\)]+\)/g,"")+"\n"||"("+message+")\n";alert("Sorry to interrupt, but this page's code has got itself in a mess. "+stack+"(This is probably due to a bug in the Twine game engine.)"),window.onerror=oldOnError,"function"==typeof oldOnError&&oldOnError.apply(void 0,arguments)}}(window.onerror),$(function(){var header=$(Selectors.storyData);if(0!==header.length){"TwineApp"in window&&testPlayCleanup();var options=header.attr("options");options&&options.split(/\s/).forEach(function(b){Renderer.options[b]=Engine.options[b]=!0});var startPassage=header.attr("startnode");return Renderer.options.ifid=Engine.options.ifid=header.attr("ifid"),startPassage||(startPassage=[].reduce.call($(Selectors.passageData),function(id,el){var pid=el.getAttribute("pid");return id>pid?pid:id},1/0)),startPassage=$(Selectors.passageData+"[pid="+startPassage+"]").attr("name"),_installHandlers(),$(Selectors.script).each(function(i){try{_eval($(this).html())}catch(e){alert("There is a problem with this story's script (#"+(i+1)+"):\n\n"+e.message)}}),$(Selectors.stylesheet).each(function(i){$(document.head).append('<style data-title="Story stylesheet '+(i+1)+'">'+$(this).html())}),window.location.hash&&!window.location.hash.includes("stories")&&State.load(window.location.hash)?void Engine.showPassage(State.passage):void Engine.goToPassage(startPassage)}})}),define("harlowe",function(){}),require(["harlowe"])}();</script>


</body>
</html>
